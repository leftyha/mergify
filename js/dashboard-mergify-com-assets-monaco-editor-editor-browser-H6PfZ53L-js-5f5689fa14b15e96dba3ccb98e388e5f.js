import{J as Kd,D as V,b as H,L as qd,P as _n,M as T,N as xt,Q as nr,U as it,T as Yd,V as Ha,W as Qd,X as ka,m as Xn,Y as Xd,Z as sr,_ as Jd,$ as Mi,t as ye,z as Yi,q as Ne,a0 as el,p as Oe,a1 as Va,a2 as j,a3 as Ms,a4 as Ti,a5 as tl,r as P,a6 as Ii,a7 as il,n as Lt,a8 as nl,a9 as sl,aa as ol,ab as rl,ac as Fa,ad as Fi,ae as al,af as Lo,ag as dl,ah as ll,u as Q,s as Rs,ai as Ba,aj as Bi,ak as hl,S as Ge,al as or,am as cl,R as ul,an as rr,w as gl,C as ar,ao as Ui,ap as Ua,aq as Et,ar as dr,as as fl,at as yo,au as zi,av as ml,aw as _l,ax as Tt,ay as za,az as yt,aA as ct,i as pl,e as vl,aB as $,aC as Cl,l as Jn,aD as pn,aE as wl,aF as bl,aG as Ll,aH as yl,aI as lr,aJ as hr,aK as Sl,E as Ri,aL as $a,aM as $t,aN as Oi,aO as xe,aP as Dl,aQ as Nl,aR as Ml,aS as Ga,aT as Rl,aU as xl,aV as So,aW as tt,aX as Xt,O as El,aY as Tl,aZ as cr,a_ as ur,h as Ai,a$ as ja,b0 as cn,b1 as Za,b2 as Il,b3 as at,g as Ol,b4 as Ka,b5 as vn,b6 as hi,b7 as qa,a as xs,b8 as Al,b9 as Pl,ba as Es,bb as Wl,bc as gr,bd as Ya,be as Hl,bf as kl,bg as Qa,bh as Vl,bi as sn,bj as Fl,bk as Bl,bl as Ul,bm as fr,bn as G,bo as z,bp as es,bq as ke,br as Xa,bs as ae,bt as Ts,bu as oe,bv as fi,bw as Ja,bx as ed,by as Jt,bz as nt,bA as zl,bB as ei,bC as O,bD as td,bE as $l,bF as Do,bG as Gl,bH as mr,bI as Ie,bJ as Ee,bK as te,bL as No,bM as _r,bN as jl,bO as Zl,bP as U,bQ as Cn,bR as Mo,bS as Kl,bT as Ro,bU as ql,bV as Yl,bW as $e,bX as Ql,bY as pr,bZ as vr,b_ as Xl,b$ as id,c0 as Jl,c1 as eh,c2 as th,c3 as Is,c4 as ih,c5 as nh,c6 as nd,c7 as sh,c8 as xi,c9 as oh,ca as rh,cb as Pe,cc as ah,cd as sd,ce as Os,cf as dh,cg as lh,ch as hh}from"./monaco-editor-base-CbpQQOWn.js";import{O as Cr,aF as ts,P as E,I as is,q as ch,f as uh,h as xo,i as Eo,aG as gh,aH as ti,aI as X,aJ as Qi,aK as To,R as W,aL as fh,aM as mh,aN as _h,aO as ph,d as od,C as vh,aP as Ch,o as wh,aQ as bh,G as zt,Q as Lh,aR as on,U as yh,aS as Xi,aT as wn,aU as rd,y as Io,aV as ad,aW as Sh,aX as Dh,aY as dd,aZ as Me,a_ as Nh,a$ as Mh,b0 as wr,D as ld,T as Oo,b1 as wi,b2 as N,b3 as he,b4 as rn,b5 as Rh,b6 as br,b7 as Lr,b8 as yr,b9 as Ao,ba as xh,bb as Sr,bc as Po,bd as Eh,be as Th,bf as Ih,bg as Oh,bh as Ah,bi as Ph,bj as Wh,bk as Hh,bl as kh,bm as Vh,bn as Fh,bo as Bh,bp as Uh,bq as zh,br as $h,bs as Gh,bt as jh,bu as Zh,e as Kh,a as qh,bv as Yh,bw as Qh,bx as Xh,by as Jh,bz as ec,bA as tc,bB as ic,bC as nc,bD as sc,bE as oc,bF as rc,bG as _s,bH as ac,bI as dc,bJ as lc,bK as un,bL as hc,bM as Ze,bN as Dr,bO as cc,bP as hd,bQ as cd,bR as ud,bS as uc,bT as gc,bU as Te,bV as fc,bW as mc,bX as _c,bY as pc,bZ as vc,b_ as Cc,b$ as Nr,c0 as Mr,c1 as Fe,B as wc,F as ns,c2 as bc,c3 as Rr,c4 as Lc,c5 as yc,c6 as Sc,c7 as xr,c8 as He,z as Dc,V as bn,x as Nc,p as Mc,c9 as an,ca as Wo,cb as Er,cc as Rc,cd as xc,ce as Ec,cf as Tc,cg as Tr,ch as Ic,ci as Oc,cj as Ac,ck as ce,cl as Bt,cm as Ir,cn as Pc,co as Wc}from"./monaco-editor-editor-common-D0kkP5dn.js";import{n as Ho,R as Hc,al as de,s as ss,I as Re,aj as ee,K as gd,y as os,ak as ci,p as fd,c as ve,an as It,a as rs,aa as md,u as as,d as ds,a6 as Ot,ad as _d,b as kc,ao as At,ap as Vc,r as pd,ai as Fc,aq as Bc,o as ls,ar as Uc,as as Or,at as zc,k as Pi,au as As,av as $c,aw as Gc,e as jc,ax as Ar,ay as Zc,S as hs,az as Kc,q as vd,aA as qc,aB as Yc,aC as Qc,aD as Xc,aE as Ji,af as Cd,aF as ot,aG as mi,ac as Jc,v as eu,am as tu,aH as wd,aI as iu,aJ as nu,aK as su,aL as ou,aM as ru,aN as au,a1 as du,aO as Ke,aP as lu,f as hu,aQ as je,aR as cu,aS as Pr}from"./monaco-editor-platform-D3l4KW_b.js";(function(){try{var d=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};d.SENTRY_RELEASE={id:"1a852bb1435e099912e47361ac6ea11c1a9da234"}}catch{}})();try{(function(){var d=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},e=new d.Error().stack;e&&(d._sentryDebugIds=d._sentryDebugIds||{},d._sentryDebugIds[e]="e99b58a3-2cb8-44a3-9139-66c75ec757f1",d._sentryDebugIdIdentifier="sentry-dbid-e99b58a3-2cb8-44a3-9139-66c75ec757f1")})()}catch{}function le(d,e){d instanceof Kd?(d.setFontFamily(e.getMassagedFontFamily()),d.setFontWeight(e.fontWeight),d.setFontSize(e.fontSize),d.setFontFeatureSettings(e.fontFeatureSettings),d.setFontVariationSettings(e.fontVariationSettings),d.setLineHeight(e.lineHeight),d.setLetterSpacing(e.letterSpacing)):(d.style.fontFamily=e.getMassagedFontFamily(),d.style.fontWeight=e.fontWeight,d.style.fontSize=e.fontSize+"px",d.style.fontFeatureSettings=e.fontFeatureSettings,d.style.fontVariationSettings=e.fontVariationSettings,d.style.lineHeight=e.lineHeight+"px",d.style.letterSpacing=e.letterSpacing+"px")}class uu{constructor(e,t){this.chr=e,this.type=t,this.width=0}fulfill(e){this.width=e}}class ko{constructor(e,t){this._bareFontInfo=e,this._requests=t,this._container=null,this._testElements=null}read(e){var t;this._createDomElements(),e.document.body.appendChild(this._container),this._readFromDomElements(),(t=this._container)==null||t.remove(),this._container=null,this._testElements=null}_createDomElements(){const e=document.createElement("div");e.style.position="absolute",e.style.top="-50000px",e.style.width="50000px";const t=document.createElement("div");le(t,this._bareFontInfo),e.appendChild(t);const i=document.createElement("div");le(i,this._bareFontInfo),i.style.fontWeight="bold",e.appendChild(i);const n=document.createElement("div");le(n,this._bareFontInfo),n.style.fontStyle="italic",e.appendChild(n);const s=[];for(const o of this._requests){let r;o.type===0&&(r=t),o.type===2&&(r=i),o.type===1&&(r=n),r.appendChild(document.createElement("br"));const a=document.createElement("span");ko._render(a,o),r.appendChild(a),s.push(a)}this._container=e,this._testElements=s}static _render(e,t){if(t.chr===" "){let i=" ";for(let n=0;n<8;n++)i+=i;e.innerText=i}else{let i=t.chr;for(let n=0;n<8;n++)i+=i;e.textContent=i}}_readFromDomElements(){for(let e=0,t=this._requests.length;e<t;e++){const i=this._requests[e],n=this._testElements[e];i.fulfill(n.offsetWidth/256)}}}function gu(d,e,t){new ko(e,t).read(d)}class fu extends V{constructor(){super(...arguments),this._cache=new Map,this._evictUntrustedReadingsTimeout=-1,this._onDidChange=this._register(new H),this.onDidChange=this._onDidChange.event}dispose(){this._evictUntrustedReadingsTimeout!==-1&&(clearTimeout(this._evictUntrustedReadingsTimeout),this._evictUntrustedReadingsTimeout=-1),super.dispose()}clearAllFontInfos(){this._cache.clear(),this._onDidChange.fire()}_ensureCache(e){const t=qd(e);let i=this._cache.get(t);return i||(i=new mu,this._cache.set(t,i)),i}_writeToCache(e,t,i){this._ensureCache(e).put(t,i),!i.isTrusted&&this._evictUntrustedReadingsTimeout===-1&&(this._evictUntrustedReadingsTimeout=e.setTimeout(()=>{this._evictUntrustedReadingsTimeout=-1,this._evictUntrustedReadings(e)},5e3))}_evictUntrustedReadings(e){const t=this._ensureCache(e),i=t.getValues();let n=!1;for(const s of i)s.isTrusted||(n=!0,t.remove(s));n&&this._onDidChange.fire()}readFontInfo(e,t){const i=this._ensureCache(e);if(!i.has(t)){let n=this._actualReadFontInfo(e,t);(n.typicalHalfwidthCharacterWidth<=2||n.typicalFullwidthCharacterWidth<=2||n.spaceWidth<=2||n.maxDigitWidth<=2)&&(n=new Cr({pixelRatio:_n.getInstance(e).value,fontFamily:n.fontFamily,fontWeight:n.fontWeight,fontSize:n.fontSize,fontFeatureSettings:n.fontFeatureSettings,fontVariationSettings:n.fontVariationSettings,lineHeight:n.lineHeight,letterSpacing:n.letterSpacing,isMonospace:n.isMonospace,typicalHalfwidthCharacterWidth:Math.max(n.typicalHalfwidthCharacterWidth,5),typicalFullwidthCharacterWidth:Math.max(n.typicalFullwidthCharacterWidth,5),canUseHalfwidthRightwardsArrow:n.canUseHalfwidthRightwardsArrow,spaceWidth:Math.max(n.spaceWidth,5),middotWidth:Math.max(n.middotWidth,5),wsmiddotWidth:Math.max(n.wsmiddotWidth,5),maxDigitWidth:Math.max(n.maxDigitWidth,5)},!1)),this._writeToCache(e,t,n)}return i.get(t)}_createRequest(e,t,i,n){const s=new uu(e,t);return i.push(s),n==null||n.push(s),s}_actualReadFontInfo(e,t){const i=[],n=[],s=this._createRequest("n",0,i,n),o=this._createRequest("ｍ",0,i,null),r=this._createRequest(" ",0,i,n),a=this._createRequest("0",0,i,n),l=this._createRequest("1",0,i,n),h=this._createRequest("2",0,i,n),c=this._createRequest("3",0,i,n),u=this._createRequest("4",0,i,n),_=this._createRequest("5",0,i,n),f=this._createRequest("6",0,i,n),w=this._createRequest("7",0,i,n),C=this._createRequest("8",0,i,n),v=this._createRequest("9",0,i,n),g=this._createRequest("→",0,i,n),p=this._createRequest("￫",0,i,null),m=this._createRequest("·",0,i,n),b=this._createRequest("⸱",0,i,null),L="|/-_ilm%";for(let M=0,R=L.length;M<R;M++)this._createRequest(L.charAt(M),0,i,n),this._createRequest(L.charAt(M),1,i,n),this._createRequest(L.charAt(M),2,i,n);gu(e,t,i);const y=Math.max(a.width,l.width,h.width,c.width,u.width,_.width,f.width,w.width,C.width,v.width);let S=t.fontFeatureSettings===ts.OFF;const D=n[0].width;for(let M=1,R=n.length;S&&M<R;M++){const I=D-n[M].width;if(I<-.001||I>.001){S=!1;break}}let x=!0;return S&&p.width!==D&&(x=!1),p.width>g.width&&(x=!1),new Cr({pixelRatio:_n.getInstance(e).value,fontFamily:t.fontFamily,fontWeight:t.fontWeight,fontSize:t.fontSize,fontFeatureSettings:t.fontFeatureSettings,fontVariationSettings:t.fontVariationSettings,lineHeight:t.lineHeight,letterSpacing:t.letterSpacing,isMonospace:S,typicalHalfwidthCharacterWidth:s.width,typicalFullwidthCharacterWidth:o.width,canUseHalfwidthRightwardsArrow:x,spaceWidth:r.width,middotWidth:m.width,wsmiddotWidth:b.width,maxDigitWidth:y},!0)}}class mu{constructor(){this._keys=Object.create(null),this._values=Object.create(null)}has(e){const t=e.getId();return!!this._values[t]}get(e){const t=e.getId();return this._values[t]}put(e,t){const i=e.getId();this._keys[i]=e,this._values[i]=t}remove(e){const t=e.getId();delete this._keys[t],delete this._values[t]}getValues(){return Object.keys(this._keys).map(e=>this._values[e])}}const Wr=new fu,Ae=Ho("codeEditorService");class cs{constructor(e){this.id=e.id,this.precondition=e.precondition,this._kbOpts=e.kbOpts,this._menuOpts=e.menuOpts,this.metadata=e.metadata}register(){if(Array.isArray(this._menuOpts)?this._menuOpts.forEach(this._registerMenuItem,this):this._menuOpts&&this._registerMenuItem(this._menuOpts),this._kbOpts){const e=Array.isArray(this._kbOpts)?this._kbOpts:[this._kbOpts];for(const t of e){let i=t.kbExpr;this.precondition&&(i?i=ee.and(i,this.precondition):i=this.precondition);const n={id:this.id,weight:t.weight,args:t.args,when:i,primary:t.primary,secondary:t.secondary,win:t.win,linux:t.linux,mac:t.mac};gd.registerKeybindingRule(n)}}os.registerCommand({id:this.id,handler:(e,t)=>this.runCommand(e,t),metadata:this.metadata})}_registerMenuItem(e){ci.appendMenuItem(e.menuId,{group:e.group,command:{id:this.id,title:e.title,icon:e.icon,precondition:this.precondition},when:e.when,order:e.order})}}class Vo extends cs{constructor(){super(...arguments),this._implementations=[]}addImplementation(e,t,i,n){return this._implementations.push({priority:e,name:t,implementation:i,when:n}),this._implementations.sort((s,o)=>o.priority-s.priority),{dispose:()=>{for(let s=0;s<this._implementations.length;s++)if(this._implementations[s].implementation===i){this._implementations.splice(s,1);return}}}}runCommand(e,t){const i=e.get(ss),n=e.get(Re);i.trace(`Executing Command '${this.id}' which has ${this._implementations.length} bound.`);for(const s of this._implementations){if(s.when){const r=n.getContext(xt());if(!s.when.evaluate(r))continue}const o=s.implementation(e,t);if(o)return i.trace(`Command '${this.id}' was handled by '${s.name}'.`),typeof o=="boolean"?void 0:o}i.trace(`The Command '${this.id}' was not handled by any implementation.`)}}class bd extends cs{constructor(e,t){super(t),this.command=e}runCommand(e,t){return this.command.runCommand(e,t)}}class ui extends cs{static bindToContribution(e){return class extends ui{constructor(i){super(i),this._callback=i.handler}runEditorCommand(i,n,s){const o=e(n);o&&this._callback(o,s)}}}static runEditorCommand(e,t,i,n){const s=e.get(Ae),o=s.getFocusedCodeEditor()||s.getActiveCodeEditor();if(o)return o.invokeWithinContext(r=>{if(r.get(Re).contextMatchesRules(i??void 0))return n(r,o,t)})}runCommand(e,t){return ui.runEditorCommand(e,t,this.precondition,(i,n,s)=>this.runEditorCommand(i,n,s))}}class Fo extends ui{static convertOptions(e){let t;Array.isArray(e.menuOpts)?t=e.menuOpts:e.menuOpts?t=[e.menuOpts]:t=[];function i(n){return n.menuId||(n.menuId=de.EditorContext),n.title||(n.title=e.label),n.when=ee.and(e.precondition,n.when),n}return Array.isArray(e.contextMenuOpts)?t.push(...e.contextMenuOpts.map(i)):e.contextMenuOpts&&t.push(i(e.contextMenuOpts)),e.menuOpts=t,e}constructor(e){super(Fo.convertOptions(e)),this.label=e.label,this.alias=e.alias}runEditorCommand(e,t,i){return this.reportTelemetry(e,t),this.run(e,t,i||{})}reportTelemetry(e,t){e.get(fd).publicLog2("editorActionInvoked",{name:this.label,id:this.id})}}class zm extends Fo{constructor(){super(...arguments),this._implementations=[]}addImplementation(e,t){return this._implementations.push([e,t]),this._implementations.sort((i,n)=>n[0]-i[0]),{dispose:()=>{for(let i=0;i<this._implementations.length;i++)if(this._implementations[i][1]===t){this._implementations.splice(i,1);return}}}}run(e,t,i){for(const n of this._implementations){const s=n[1](e,t,i);if(s)return typeof s=="boolean"?void 0:s}}}class us extends It{run(e,...t){const i=e.get(Ae),n=i.getFocusedCodeEditor()||i.getActiveCodeEditor();if(n)return n.invokeWithinContext(s=>{var l;const o=s.get(Re),r=s.get(ss);if(!o.contextMatchesRules(this.desc.precondition??void 0)){r.debug("[EditorAction2] NOT running command because its precondition is FALSE",this.desc.id,(l=this.desc.precondition)==null?void 0:l.serialize());return}return this.runEditorCommand(s,n,...t)})}}function $m(d,e){os.registerCommand(d,function(t,...i){const n=t.get(ve),[s,o]=i;nr(it.isUri(s)),nr(E.isIPosition(o));const r=t.get(is).getModel(s);if(r){const a=E.lift(o);return n.invokeFunction(e,r,a,...i.slice(2))}return t.get(ch).createModelReference(s).then(a=>new Promise((l,h)=>{try{const c=n.invokeFunction(e,a.object.textEditorModel,E.lift(o),i.slice(2));l(c)}catch(c){h(c)}}).finally(()=>{a.dispose()}))})}function A(d){return De.INSTANCE.registerEditorCommand(d),d}function Gm(d){const e=new d;return De.INSTANCE.registerEditorAction(e),e}function jm(d){return De.INSTANCE.registerEditorAction(d),d}function Zm(d){De.INSTANCE.registerEditorAction(d)}function _u(d,e,t){De.INSTANCE.registerEditorContribution(d,e,t)}var ii;(function(d){function e(o){return De.INSTANCE.getEditorCommand(o)}d.getEditorCommand=e;function t(){return De.INSTANCE.getEditorActions()}d.getEditorActions=t;function i(){return De.INSTANCE.getEditorContributions()}d.getEditorContributions=i;function n(o){return De.INSTANCE.getEditorContributions().filter(r=>o.indexOf(r.id)>=0)}d.getSomeEditorContributions=n;function s(){return De.INSTANCE.getDiffEditorContributions()}d.getDiffEditorContributions=s})(ii||(ii={}));const pu={EditorCommonContributions:"editor.contributions"},kn=class kn{constructor(){this.editorContributions=[],this.diffEditorContributions=[],this.editorActions=[],this.editorCommands=Object.create(null)}registerEditorContribution(e,t,i){this.editorContributions.push({id:e,ctor:t,instantiation:i})}getEditorContributions(){return this.editorContributions.slice(0)}getDiffEditorContributions(){return this.diffEditorContributions.slice(0)}registerEditorAction(e){e.register(),this.editorActions.push(e)}getEditorActions(){return this.editorActions}registerEditorCommand(e){e.register(),this.editorCommands[e.id]=e}getEditorCommand(e){return this.editorCommands[e]||null}};kn.INSTANCE=new kn;let De=kn;Hc.add(pu.EditorCommonContributions,De.INSTANCE);function en(d){return d.register(),d}const Ld=en(new Vo({id:"undo",precondition:void 0,kbOpts:{weight:0,primary:2104},menuOpts:[{menuId:de.MenubarEditMenu,group:"1_do",title:T({key:"miUndo",comment:["&& denotes a mnemonic"]},"&&Undo"),order:1},{menuId:de.CommandPalette,group:"",title:T("undo","Undo"),order:1}]}));en(new bd(Ld,{id:"default:undo",precondition:void 0}));const yd=en(new Vo({id:"redo",precondition:void 0,kbOpts:{weight:0,primary:2103,secondary:[3128],mac:{primary:3128}},menuOpts:[{menuId:de.MenubarEditMenu,group:"1_do",title:T({key:"miRedo",comment:["&& denotes a mnemonic"]},"&&Redo"),order:2},{menuId:de.CommandPalette,group:"",title:T("redo","Redo"),order:1}]}));en(new bd(yd,{id:"default:redo",precondition:void 0}));const vu=en(new Vo({id:"editor.action.selectAll",precondition:void 0,kbOpts:{weight:0,kbExpr:null,primary:2079},menuOpts:[{menuId:de.MenubarSelectionMenu,group:"1_basic",title:T({key:"miSelectAll",comment:["&& denotes a mnemonic"]},"&&Select All"),order:1},{menuId:de.CommandPalette,group:"",title:T("selectAll","Select All"),order:1}]}));var Bo=function(d,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(d,e,t,i);else for(var r=d.length-1;r>=0;r--)(o=d[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},pt=function(d,e){return function(t,i){e(t,i,d)}};const Hr=5*60*1e3;function vt(d,e){const t=d.getModel(e);return!(!t||t.isTooLargeForSyncing())}let kr=class extends V{constructor(e,t,i,n,s,o){super(),this._languageConfigurationService=s,this._modelService=t,this._workerManager=this._register(new Ps(e,this._modelService)),this._logService=n,this._register(o.linkProvider.register({language:"*",hasAccessToAllModels:!0},{provideLinks:async(r,a)=>{if(!vt(this._modelService,r.uri))return Promise.resolve({links:[]});const h=await(await this._workerWithResources([r.uri])).$computeLinks(r.uri.toString());return h&&{links:h}}})),this._register(o.completionProvider.register("*",new Cu(this._workerManager,i,this._modelService,this._languageConfigurationService)))}dispose(){super.dispose()}canComputeUnicodeHighlights(e){return vt(this._modelService,e)}async computedUnicodeHighlights(e,t,i){return(await this._workerWithResources([e])).$computeUnicodeHighlights(e.toString(),t,i)}async computeDiff(e,t,i,n){const o=await(await this._workerWithResources([e,t],!0)).$computeDiff(e.toString(),t.toString(),i,n);if(!o)return null;return{identical:o.identical,quitEarly:o.quitEarly,changes:a(o.changes),moves:o.moves.map(l=>new gh(new ti(new X(l[0],l[1]),new X(l[2],l[3])),a(l[4])))};function a(l){return l.map(h=>{var c;return new Qi(new X(h[0],h[1]),new X(h[2],h[3]),(c=h[4])==null?void 0:c.map(u=>new To(new W(u[0],u[1],u[2],u[3]),new W(u[4],u[5],u[6],u[7]))))})}}async computeMoreMinimalEdits(e,t,i=!1){if(Yd(t)){if(!vt(this._modelService,e))return Promise.resolve(t);const n=Ha.create(),s=this._workerWithResources([e]).then(o=>o.$computeMoreMinimalEdits(e.toString(),t,i));return s.finally(()=>this._logService.trace("FORMAT#computeMoreMinimalEdits",e.toString(!0),n.elapsed())),Promise.race([s,Qd(1e3).then(()=>t)])}else return Promise.resolve(void 0)}canNavigateValueSet(e){return vt(this._modelService,e)}async navigateValueSet(e,t,i){const n=this._modelService.getModel(e);if(!n)return null;const s=this._languageConfigurationService.getLanguageConfiguration(n.getLanguageId()).getWordDefinition(),o=s.source,r=s.flags;return(await this._workerWithResources([e])).$navigateValueSet(e.toString(),t,i,o,r)}canComputeWordRanges(e){return vt(this._modelService,e)}async computeWordRanges(e,t){const i=this._modelService.getModel(e);if(!i)return Promise.resolve(null);const n=this._languageConfigurationService.getLanguageConfiguration(i.getLanguageId()).getWordDefinition(),s=n.source,o=n.flags;return(await this._workerWithResources([e])).$computeWordRanges(e.toString(),t,s,o)}async findSectionHeaders(e,t){return(await this._workerWithResources([e])).$findSectionHeaders(e.toString(),t)}async computeDefaultDocumentColors(e){return(await this._workerWithResources([e])).$computeDefaultDocumentColors(e.toString())}async _workerWithResources(e,t=!1){return await(await this._workerManager.withWorker()).workerWithSyncedResources(e,t)}};kr=Bo([pt(1,is),pt(2,uh),pt(3,ss),pt(4,xo),pt(5,Eo)],kr);class Cu{constructor(e,t,i,n){this.languageConfigurationService=n,this._debugDisplayName="wordbasedCompletions",this._workerManager=e,this._configurationService=t,this._modelService=i}async provideCompletionItems(e,t){const i=this._configurationService.getValue(e.uri,t,"editor");if(i.wordBasedSuggestions==="off")return;const n=[];if(i.wordBasedSuggestions==="currentDocument")vt(this._modelService,e.uri)&&n.push(e.uri);else for(const c of this._modelService.getModels())vt(this._modelService,c.uri)&&(c===e?n.unshift(c.uri):(i.wordBasedSuggestions==="allDocuments"||c.getLanguageId()===e.getLanguageId())&&n.push(c.uri));if(n.length===0)return;const s=this.languageConfigurationService.getLanguageConfiguration(e.getLanguageId()).getWordDefinition(),o=e.getWordAtPosition(t),r=o?new W(t.lineNumber,o.startColumn,t.lineNumber,o.endColumn):W.fromPositions(t),a=r.setEndPosition(t.lineNumber,t.column),h=await(await this._workerManager.withWorker()).textualSuggest(n,o==null?void 0:o.word,s);if(h)return{duration:h.duration,suggestions:h.words.map(c=>({kind:18,label:c,insertText:c,range:{insert:a,replace:r}}))}}}let Ps=class extends V{constructor(e,t){super(),this._workerDescriptor=e,this._modelService=t,this._editorWorkerClient=null,this._lastWorkerUsedTime=new Date().getTime(),this._register(new ka).cancelAndSet(()=>this._checkStopIdleWorker(),Math.round(Hr/2),Xn),this._register(this._modelService.onModelRemoved(n=>this._checkStopEmptyWorker()))}dispose(){this._editorWorkerClient&&(this._editorWorkerClient.dispose(),this._editorWorkerClient=null),super.dispose()}_checkStopEmptyWorker(){if(!this._editorWorkerClient)return;this._modelService.getModels().length===0&&(this._editorWorkerClient.dispose(),this._editorWorkerClient=null)}_checkStopIdleWorker(){if(!this._editorWorkerClient)return;new Date().getTime()-this._lastWorkerUsedTime>Hr&&(this._editorWorkerClient.dispose(),this._editorWorkerClient=null)}withWorker(){return this._lastWorkerUsedTime=new Date().getTime(),this._editorWorkerClient||(this._editorWorkerClient=new Ws(this._workerDescriptor,!1,this._modelService)),Promise.resolve(this._editorWorkerClient)}};Ps=Bo([pt(1,is)],Ps);class wu{constructor(e){this._instance=e,this.proxy=this._instance}dispose(){this._instance.dispose()}setChannel(e,t){throw new Error("Not supported")}}let Ws=class extends V{constructor(e,t,i){super(),this._workerDescriptor=e,this._disposed=!1,this._modelService=i,this._keepIdleModels=t,this._worker=null,this._modelManager=null}fhr(e,t){throw new Error("Not implemented!")}_getOrCreateWorker(){if(!this._worker)try{this._worker=this._register(Xd(this._workerDescriptor)),fh.setChannel(this._worker,this._createEditorWorkerHost())}catch(e){sr(e),this._worker=this._createFallbackLocalWorker()}return this._worker}async _getProxy(){try{const e=this._getOrCreateWorker().proxy;return await e.$ping(),e}catch(e){return sr(e),this._worker=this._createFallbackLocalWorker(),this._worker.proxy}}_createFallbackLocalWorker(){return new wu(new mh(this._createEditorWorkerHost(),null))}_createEditorWorkerHost(){return{$fhr:(e,t)=>this.fhr(e,t)}}_getOrCreateModelManager(e){return this._modelManager||(this._modelManager=this._register(new _h(e,this._modelService,this._keepIdleModels))),this._modelManager}async workerWithSyncedResources(e,t=!1){if(this._disposed)return Promise.reject(Jd());const i=await this._getProxy();return this._getOrCreateModelManager(i).ensureSyncedResources(e,t),i}async textualSuggest(e,t,i){const n=await this.workerWithSyncedResources(e),s=i.source,o=i.flags;return n.$textualSuggest(e.map(r=>r.toString()),t,s,o)}dispose(){super.dispose(),this._disposed=!0}};Ws=Bo([pt(2,is)],Ws);var bu=function(d,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(d,e,t,i);else for(var r=d.length-1;r>=0;r--)(o=d[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},Lu=function(d,e){return function(t,i){e(t,i,d)}};let Vr=class extends V{constructor(e){super(),this._themeService=e,this._onWillCreateCodeEditor=this._register(new H),this._onCodeEditorAdd=this._register(new H),this.onCodeEditorAdd=this._onCodeEditorAdd.event,this._onCodeEditorRemove=this._register(new H),this.onCodeEditorRemove=this._onCodeEditorRemove.event,this._onWillCreateDiffEditor=this._register(new H),this._onDiffEditorAdd=this._register(new H),this.onDiffEditorAdd=this._onDiffEditorAdd.event,this._onDiffEditorRemove=this._register(new H),this.onDiffEditorRemove=this._onDiffEditorRemove.event,this._decorationOptionProviders=new Map,this._codeEditorOpenHandlers=new Mi,this._modelProperties=new Map,this._codeEditors=Object.create(null),this._diffEditors=Object.create(null),this._globalStyleSheet=null}willCreateCodeEditor(){this._onWillCreateCodeEditor.fire()}addCodeEditor(e){this._codeEditors[e.getId()]=e,this._onCodeEditorAdd.fire(e)}removeCodeEditor(e){delete this._codeEditors[e.getId()]&&this._onCodeEditorRemove.fire(e)}listCodeEditors(){return Object.keys(this._codeEditors).map(e=>this._codeEditors[e])}willCreateDiffEditor(){this._onWillCreateDiffEditor.fire()}addDiffEditor(e){this._diffEditors[e.getId()]=e,this._onDiffEditorAdd.fire(e)}listDiffEditors(){return Object.keys(this._diffEditors).map(e=>this._diffEditors[e])}getFocusedCodeEditor(){let e=null;const t=this.listCodeEditors();for(const i of t){if(i.hasTextFocus())return i;i.hasWidgetFocus()&&(e=i)}return e}removeDecorationType(e){const t=this._decorationOptionProviders.get(e);t&&(t.refCount--,t.refCount<=0&&(this._decorationOptionProviders.delete(e),t.dispose(),this.listCodeEditors().forEach(i=>i.removeDecorationsByType(e))))}setModelProperty(e,t,i){const n=e.toString();let s;this._modelProperties.has(n)?s=this._modelProperties.get(n):(s=new Map,this._modelProperties.set(n,s)),s.set(t,i)}getModelProperty(e,t){const i=e.toString();if(this._modelProperties.has(i))return this._modelProperties.get(i).get(t)}async openCodeEditor(e,t,i){for(const n of this._codeEditorOpenHandlers){const s=await n(e,t,i);if(s!==null)return s}return null}registerCodeEditorOpenHandler(e){const t=this._codeEditorOpenHandlers.unshift(e);return ye(t)}};Vr=bu([Lu(0,rs)],Vr);var yu=function(d,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(d,e,t,i);else for(var r=d.length-1;r>=0;r--)(o=d[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},Fr=function(d,e){return function(t,i){e(t,i,d)}},Hs,Dt;let ks=(Dt=class{constructor(e,t,i){this._options=e,this._languageService=t,this._openerService=i,this._onDidRenderAsync=new H,this.onDidRenderAsync=this._onDidRenderAsync.event}dispose(){this._onDidRenderAsync.dispose()}render(e,t,i){if(!e)return{element:document.createElement("span"),dispose:()=>{}};const n=new Ne,s=n.add(el(e,{...this._getRenderOptions(e,n),...t},i));return s.element.classList.add("rendered-markdown"),{element:s.element,dispose:()=>n.dispose()}}_getRenderOptions(e,t){return{codeBlockRenderer:async(i,n)=>{var a,l;let s;i?s=this._languageService.getLanguageIdByLanguageName(i):this._options.editor&&(s=(a=this._options.editor.getModel())==null?void 0:a.getLanguageId()),s||(s=vh);const o=await ph(this._languageService,n,s),r=document.createElement("span");if(r.innerHTML=((l=Hs._ttpTokenizer)==null?void 0:l.createHTML(o))??o,this._options.editor){const h=this._options.editor.getOption(50);le(r,h)}else this._options.codeBlockFontFamily&&(r.style.fontFamily=this._options.codeBlockFontFamily);return this._options.codeBlockFontSize!==void 0&&(r.style.fontSize=this._options.codeBlockFontSize),r},asyncRenderCallback:()=>this._onDidRenderAsync.fire(),actionHandler:{callback:i=>Sd(this._openerService,i,e.isTrusted),disposables:t}}}},Hs=Dt,Dt._ttpTokenizer=Yi("tokenizeToString",{createHTML(e){return e}}),Dt);ks=Hs=yu([Fr(1,od),Fr(2,md)],ks);async function Sd(d,e,t){try{return await d.open(e,{fromUserGesture:!0,allowContributedOpeners:!0,allowCommands:Su(t)})}catch(i){return Oe(i),!1}}function Su(d){return d===!0?!0:d&&Array.isArray(d.enabledCommands)?d.enabledCommands:!1}var Du=function(d,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(d,e,t,i);else for(var r=d.length-1;r>=0;r--)(o=d[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},bi=function(d,e){return function(t,i){e(t,i,d)}};const ze=Ti;let Vs=class extends Va{get _targetWindow(){return j(this._target.targetElements[0])}get _targetDocumentElement(){return j(this._target.targetElements[0]).document.documentElement}get isDisposed(){return this._isDisposed}get isMouseIn(){return this._lockMouseTracker.isMouseIn}get domNode(){return this._hover.containerDomNode}get onDispose(){return this._onDispose.event}get onRequestLayout(){return this._onRequestLayout.event}get anchor(){return this._hoverPosition===2?0:1}get x(){return this._x}get y(){return this._y}get isLocked(){return this._isLocked}set isLocked(e){this._isLocked!==e&&(this._isLocked=e,this._hoverContainer.classList.toggle("locked",this._isLocked))}constructor(e,t,i,n,s,o){var u,_,f,w,C,v,g;super(),this._keybindingService=t,this._configurationService=i,this._openerService=n,this._instantiationService=s,this._accessibilityService=o,this._messageListeners=new Ne,this._isDisposed=!1,this._forcePosition=!1,this._x=0,this._y=0,this._isLocked=!1,this._enableFocusTraps=!1,this._addedFocusTrap=!1,this._onDispose=this._register(new H),this._onRequestLayout=this._register(new H),this._linkHandler=e.linkHandler||(p=>Sd(this._openerService,p,Ms(e.content)?e.content.isTrusted:void 0)),this._target="targetElements"in e.target?e.target:new Nu(e.target),this._hoverPointer=(u=e.appearance)!=null&&u.showPointer?ze("div.workbench-hover-pointer"):void 0,this._hover=this._register(new tl),this._hover.containerDomNode.classList.add("workbench-hover","fadeIn"),(_=e.appearance)!=null&&_.compact&&this._hover.containerDomNode.classList.add("workbench-hover","compact"),(f=e.appearance)!=null&&f.skipFadeInAnimation&&this._hover.containerDomNode.classList.add("skip-fade-in"),e.additionalClasses&&this._hover.containerDomNode.classList.add(...e.additionalClasses),(w=e.position)!=null&&w.forcePosition&&(this._forcePosition=!0),e.trapFocus&&(this._enableFocusTraps=!0),this._hoverPosition=((C=e.position)==null?void 0:C.hoverPosition)??3,this.onmousedown(this._hover.containerDomNode,p=>p.stopPropagation()),this.onkeydown(this._hover.containerDomNode,p=>{p.equals(9)&&this.dispose()}),this._register(P(this._targetWindow,"blur",()=>this.dispose()));const r=ze("div.hover-row.markdown-hover"),a=ze("div.hover-contents");if(typeof e.content=="string")a.textContent=e.content,a.style.whiteSpace="pre-wrap";else if(Ii(e.content))a.appendChild(e.content),a.classList.add("html-hover-contents");else{const p=e.content,m=this._instantiationService.createInstance(ks,{codeBlockFontFamily:this._configurationService.getValue("editor").fontFamily||Ch.fontFamily}),{element:b}=m.render(p,{actionHandler:{callback:L=>this._linkHandler(L),disposables:this._messageListeners},asyncRenderCallback:()=>{a.classList.add("code-hover-contents"),this.layout(),this._onRequestLayout.fire()}});a.appendChild(b)}if(r.appendChild(a),this._hover.contentsDomNode.appendChild(r),e.actions&&e.actions.length>0){const p=ze("div.hover-row.status-bar"),m=ze("div.actions");e.actions.forEach(b=>{const L=this._keybindingService.lookupKeybinding(b.commandId),y=L?L.getLabel():null;il.render(m,{label:b.label,commandId:b.commandId,run:S=>{b.run(S),this.dispose()},iconClass:b.iconClass},y)}),p.appendChild(m),this._hover.containerDomNode.appendChild(p)}this._hoverContainer=ze("div.workbench-hover-container"),this._hoverPointer&&this._hoverContainer.appendChild(this._hoverPointer),this._hoverContainer.appendChild(this._hover.containerDomNode);let l;if(e.actions&&e.actions.length>0?l=!1:((v=e.persistence)==null?void 0:v.hideOnHover)===void 0?l=typeof e.content=="string"||Ms(e.content)&&!e.content.value.includes("](")&&!e.content.value.includes("</a>"):l=e.persistence.hideOnHover,(g=e.appearance)!=null&&g.showHoverHint){const p=ze("div.hover-row.status-bar"),m=ze("div.info");m.textContent=T("hoverhint","Hold {0} key to mouse over",Lt?"Option":"Alt"),p.appendChild(m),this._hover.containerDomNode.appendChild(p)}const h=[...this._target.targetElements];l||h.push(this._hoverContainer);const c=this._register(new Br(h));if(this._register(c.onMouseOut(()=>{this._isLocked||this.dispose()})),l){const p=[...this._target.targetElements,this._hoverContainer];this._lockMouseTracker=this._register(new Br(p)),this._register(this._lockMouseTracker.onMouseOut(()=>{this._isLocked||this.dispose()}))}else this._lockMouseTracker=c}addFocusTrap(){if(!this._enableFocusTraps||this._addedFocusTrap)return;this._addedFocusTrap=!0;const e=this._hover.containerDomNode,t=this.findLastFocusableChild(this._hover.containerDomNode);if(t){const i=nl(this._hoverContainer,ze("div")),n=sl(this._hoverContainer,ze("div"));i.tabIndex=0,n.tabIndex=0,this._register(P(n,"focus",s=>{e.focus(),s.preventDefault()})),this._register(P(i,"focus",s=>{t.focus(),s.preventDefault()}))}}findLastFocusableChild(e){if(e.hasChildNodes())for(let t=0;t<e.childNodes.length;t++){const i=e.childNodes.item(e.childNodes.length-t-1);if(i.nodeType===i.ELEMENT_NODE){const s=i;if(typeof s.tabIndex=="number"&&s.tabIndex>=0)return s}const n=this.findLastFocusableChild(i);if(n)return n}}render(e){var n;e.appendChild(this._hoverContainer);const i=this._hoverContainer.contains(this._hoverContainer.ownerDocument.activeElement)&&ol(this._configurationService.getValue("accessibility.verbosity.hover")===!0&&this._accessibilityService.isScreenReaderOptimized(),(n=this._keybindingService.lookupKeybinding("editor.action.accessibleView"))==null?void 0:n.getAriaLabel());i&&Fa(i),this.layout(),this.addFocusTrap()}layout(){this._hover.containerDomNode.classList.remove("right-aligned"),this._hover.contentsDomNode.style.maxHeight="";const e=h=>{const c=rl(h),u=h.getBoundingClientRect();return{top:u.top*c,bottom:u.bottom*c,right:u.right*c,left:u.left*c}},t=this._target.targetElements.map(h=>e(h)),{top:i,right:n,bottom:s,left:o}=t[0],r=n-o,a=s-i,l={top:i,right:n,bottom:s,left:o,width:r,height:a,center:{x:o+r/2,y:i+a/2}};if(this.adjustHorizontalHoverPosition(l),this.adjustVerticalHoverPosition(l),this.adjustHoverMaxHeight(l),this._hoverContainer.style.padding="",this._hoverContainer.style.margin="",this._hoverPointer){switch(this._hoverPosition){case 1:l.left+=3,l.right+=3,this._hoverContainer.style.paddingLeft="3px",this._hoverContainer.style.marginLeft="-3px";break;case 0:l.left-=3,l.right-=3,this._hoverContainer.style.paddingRight="3px",this._hoverContainer.style.marginRight="-3px";break;case 2:l.top+=3,l.bottom+=3,this._hoverContainer.style.paddingTop="3px",this._hoverContainer.style.marginTop="-3px";break;case 3:l.top-=3,l.bottom-=3,this._hoverContainer.style.paddingBottom="3px",this._hoverContainer.style.marginBottom="-3px";break}l.center.x=l.left+r/2,l.center.y=l.top+a/2}this.computeXCordinate(l),this.computeYCordinate(l),this._hoverPointer&&(this._hoverPointer.classList.remove("top"),this._hoverPointer.classList.remove("left"),this._hoverPointer.classList.remove("right"),this._hoverPointer.classList.remove("bottom"),this.setHoverPointerPosition(l)),this._hover.onContentsChanged()}computeXCordinate(e){const t=this._hover.containerDomNode.clientWidth+2;this._target.x!==void 0?this._x=this._target.x:this._hoverPosition===1?this._x=e.right:this._hoverPosition===0?this._x=e.left-t:(this._hoverPointer?this._x=e.center.x-this._hover.containerDomNode.clientWidth/2:this._x=e.left,this._x+t>=this._targetDocumentElement.clientWidth&&(this._hover.containerDomNode.classList.add("right-aligned"),this._x=Math.max(this._targetDocumentElement.clientWidth-t-2,this._targetDocumentElement.clientLeft))),this._x<this._targetDocumentElement.clientLeft&&(this._x=e.left+2)}computeYCordinate(e){this._target.y!==void 0?this._y=this._target.y:this._hoverPosition===3?this._y=e.top:this._hoverPosition===2?this._y=e.bottom-2:this._hoverPointer?this._y=e.center.y+this._hover.containerDomNode.clientHeight/2:this._y=e.bottom,this._y>this._targetWindow.innerHeight&&(this._y=e.bottom)}adjustHorizontalHoverPosition(e){if(this._target.x!==void 0)return;const t=this._hoverPointer?3:0;if(this._forcePosition){const i=t+2;this._hoverPosition===1?this._hover.containerDomNode.style.maxWidth=`${this._targetDocumentElement.clientWidth-e.right-i}px`:this._hoverPosition===0&&(this._hover.containerDomNode.style.maxWidth=`${e.left-i}px`);return}this._hoverPosition===1?this._targetDocumentElement.clientWidth-e.right<this._hover.containerDomNode.clientWidth+t&&(e.left>=this._hover.containerDomNode.clientWidth+t?this._hoverPosition=0:this._hoverPosition=2):this._hoverPosition===0&&(e.left<this._hover.containerDomNode.clientWidth+t&&(this._targetDocumentElement.clientWidth-e.right>=this._hover.containerDomNode.clientWidth+t?this._hoverPosition=1:this._hoverPosition=2),e.left-this._hover.containerDomNode.clientWidth-t<=this._targetDocumentElement.clientLeft&&(this._hoverPosition=1))}adjustVerticalHoverPosition(e){if(this._target.y!==void 0||this._forcePosition)return;const t=this._hoverPointer?3:0;this._hoverPosition===3?e.top-this._hover.containerDomNode.clientHeight-t<0&&(this._hoverPosition=2):this._hoverPosition===2&&e.bottom+this._hover.containerDomNode.clientHeight+t>this._targetWindow.innerHeight&&(this._hoverPosition=3)}adjustHoverMaxHeight(e){let t=this._targetWindow.innerHeight/2;if(this._forcePosition){const i=(this._hoverPointer?3:0)+2;this._hoverPosition===3?t=Math.min(t,e.top-i):this._hoverPosition===2&&(t=Math.min(t,this._targetWindow.innerHeight-e.bottom-i))}if(this._hover.containerDomNode.style.maxHeight=`${t}px`,this._hover.contentsDomNode.clientHeight<this._hover.contentsDomNode.scrollHeight){const i=`${this._hover.scrollbar.options.verticalScrollbarSize}px`;this._hover.contentsDomNode.style.paddingRight!==i&&(this._hover.contentsDomNode.style.paddingRight=i)}}setHoverPointerPosition(e){if(this._hoverPointer)switch(this._hoverPosition){case 0:case 1:{this._hoverPointer.classList.add(this._hoverPosition===0?"right":"left");const t=this._hover.containerDomNode.clientHeight;t>e.height?this._hoverPointer.style.top=`${e.center.y-(this._y-t)-3}px`:this._hoverPointer.style.top=`${Math.round(t/2)-3}px`;break}case 3:case 2:{this._hoverPointer.classList.add(this._hoverPosition===3?"bottom":"top");const t=this._hover.containerDomNode.clientWidth;let i=Math.round(t/2)-3;const n=this._x+i;(n<e.left||n>e.right)&&(i=e.center.x-this._x-3),this._hoverPointer.style.left=`${i}px`;break}}}focus(){this._hover.containerDomNode.focus()}dispose(){this._isDisposed||(this._onDispose.fire(),this._hoverContainer.remove(),this._messageListeners.dispose(),this._target.dispose(),super.dispose()),this._isDisposed=!0}};Vs=Du([bi(1,as),bi(2,ds),bi(3,md),bi(4,ve),bi(5,Ot)],Vs);class Br extends Va{get onMouseOut(){return this._onMouseOut.event}get isMouseIn(){return this._isMouseIn}constructor(e){super(),this._elements=e,this._isMouseIn=!0,this._onMouseOut=this._register(new H),this._elements.forEach(t=>this.onmouseover(t,()=>this._onTargetMouseOver(t))),this._elements.forEach(t=>this.onmouseleave(t,()=>this._onTargetMouseLeave(t)))}_onTargetMouseOver(e){this._isMouseIn=!0,this._clearEvaluateMouseStateTimeout(e)}_onTargetMouseLeave(e){this._isMouseIn=!1,this._evaluateMouseState(e)}_evaluateMouseState(e){this._clearEvaluateMouseStateTimeout(e),this._mouseTimeout=j(e).setTimeout(()=>this._fireIfMouseOutside(),0)}_clearEvaluateMouseStateTimeout(e){this._mouseTimeout&&(j(e).clearTimeout(this._mouseTimeout),this._mouseTimeout=void 0)}_fireIfMouseOutside(){this._isMouseIn||this._onMouseOut.fire()}}class Nu{constructor(e){this._element=e,this.targetElements=[this._element]}dispose(){}}class Mu{constructor(e,t,i){this.hoverDelegate=e,this.target=t,this.fadeInAnimation=i}async update(e,t,i){if(this._cancellationTokenSource&&(this._cancellationTokenSource.dispose(!0),this._cancellationTokenSource=void 0),this.isDisposed)return;let n;if(e===void 0||Fi(e)||Ii(e))n=e;else if(!al(e.markdown))n=e.markdown??e.markdownNotSupportedFallback;else{this._hoverWidget||this.show(T("iconLabel.loading","Loading..."),t,i),this._cancellationTokenSource=new Lo;const s=this._cancellationTokenSource.token;if(n=await e.markdown(s),n===void 0&&(n=e.markdownNotSupportedFallback),this.isDisposed||s.isCancellationRequested)return}this.show(n,t,i)}show(e,t,i){var s;const n=this._hoverWidget;if(this.hasContent(e)){const o={content:e,target:this.target,actions:i==null?void 0:i.actions,linkHandler:i==null?void 0:i.linkHandler,trapFocus:i==null?void 0:i.trapFocus,appearance:{showPointer:this.hoverDelegate.placement==="element",skipFadeInAnimation:!this.fadeInAnimation||!!n,showHoverHint:(s=i==null?void 0:i.appearance)==null?void 0:s.showHoverHint},position:{hoverPosition:2}};this._hoverWidget=this.hoverDelegate.showHover(o,t)}n==null||n.dispose()}hasContent(e){return e?Ms(e)?!!e.value:!0:!1}get isDisposed(){var e;return(e=this._hoverWidget)==null?void 0:e.isDisposed}dispose(){var e,t;(e=this._hoverWidget)==null||e.dispose(),(t=this._cancellationTokenSource)==null||t.dispose(!0),this._cancellationTokenSource=void 0}}var Ru=function(d,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(d,e,t,i);else for(var r=d.length-1;r>=0;r--)(o=d[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},Li=function(d,e){return function(t,i){e(t,i,d)}};let Fs=class extends V{constructor(e,t,i,n,s){super(),this._instantiationService=e,this._keybindingService=i,this._layoutService=n,this._accessibilityService=s,this._managedHovers=new Map,t.onDidShowContextMenu(()=>this.hideHover()),this._contextViewHandler=this._register(new Vc(this._layoutService))}showHover(e,t,i){var a,l,h,c;if(Ur(this._currentHoverOptions)===Ur(e)||this._currentHover&&((l=(a=this._currentHoverOptions)==null?void 0:a.persistence)!=null&&l.sticky))return;this._currentHoverOptions=e,this._lastHoverOptions=e;const n=e.trapFocus||this._accessibilityService.isScreenReaderOptimized(),s=xt();i||(n&&s?s.classList.contains("monaco-hover")||(this._lastFocusedElementBeforeOpen=s):this._lastFocusedElementBeforeOpen=void 0);const o=new Ne,r=this._instantiationService.createInstance(Vs,e);if((h=e.persistence)!=null&&h.sticky&&(r.isLocked=!0),r.onDispose(()=>{var _,f;((_=this._currentHover)==null?void 0:_.domNode)&&dl(this._currentHover.domNode)&&((f=this._lastFocusedElementBeforeOpen)==null||f.focus()),this._currentHoverOptions===e&&(this._currentHoverOptions=void 0),o.dispose()},void 0,o),!e.container){const u=Ii(e.target)?e.target:e.target.targetElements[0];e.container=this._layoutService.getContainer(j(u))}if(this._contextViewHandler.showContextView(new xu(r,t),e.container),r.onRequestLayout(()=>this._contextViewHandler.layout(),void 0,o),(c=e.persistence)!=null&&c.sticky)o.add(P(j(e.container).document,Q.MOUSE_DOWN,u=>{ll(u.target,r.domNode)||this.doHideHover()}));else{if("targetElements"in e.target)for(const _ of e.target.targetElements)o.add(P(_,Q.CLICK,()=>this.hideHover()));else o.add(P(e.target,Q.CLICK,()=>this.hideHover()));const u=xt();if(u){const _=j(u).document;o.add(P(u,Q.KEY_DOWN,f=>{var w;return this._keyDown(f,r,!!((w=e.persistence)!=null&&w.hideOnKeyDown))})),o.add(P(_,Q.KEY_DOWN,f=>{var w;return this._keyDown(f,r,!!((w=e.persistence)!=null&&w.hideOnKeyDown))})),o.add(P(u,Q.KEY_UP,f=>this._keyUp(f,r))),o.add(P(_,Q.KEY_UP,f=>this._keyUp(f,r)))}}if("IntersectionObserver"in Xn){const u=new IntersectionObserver(f=>this._intersectionChange(f,r),{threshold:0}),_="targetElements"in e.target?e.target.targetElements[0]:e.target;u.observe(_),o.add(ye(()=>u.disconnect()))}return this._currentHover=r,r}hideHover(){var e;(e=this._currentHover)!=null&&e.isLocked||!this._currentHoverOptions||this.doHideHover()}doHideHover(){this._currentHover=void 0,this._currentHoverOptions=void 0,this._contextViewHandler.hideContextView()}_intersectionChange(e,t){e[e.length-1].isIntersecting||t.dispose()}showAndFocusLastHover(){this._lastHoverOptions&&this.showHover(this._lastHoverOptions,!0,!0)}_keyDown(e,t,i){var o,r;if(e.key==="Alt"){t.isLocked=!0;return}const n=new Rs(e);this._keybindingService.resolveKeyboardEvent(n).getSingleModifierDispatchChords().some(a=>!!a)||this._keybindingService.softDispatch(n,n.target).kind!==0||i&&(!((o=this._currentHoverOptions)!=null&&o.trapFocus)||e.key!=="Tab")&&(this.hideHover(),(r=this._lastFocusedElementBeforeOpen)==null||r.focus())}_keyUp(e,t){var i;e.key==="Alt"&&(t.isLocked=!1,t.isMouseIn||(this.hideHover(),(i=this._lastFocusedElementBeforeOpen)==null||i.focus()))}setupManagedHover(e,t,i,n){t.setAttribute("custom-hover","true"),t.title!==""&&(console.warn("HTML element already has a title attribute, which will conflict with the custom hover. Please remove the title attribute."),console.trace("Stack trace:",t.title),t.title="");let s,o;const r=(p,m)=>{var L;const b=o!==void 0;p&&(o==null||o.dispose(),o=void 0),m&&(s==null||s.dispose(),s=void 0),b&&((L=e.onDidHideHover)==null||L.call(e),o=void 0)},a=(p,m,b,L)=>new Ba(async()=>{(!o||o.isDisposed)&&(o=new Mu(e,b||t,p>0),await o.update(typeof i=="function"?i():i,m,{...n,trapFocus:L}))},p);let l=!1;const h=P(t,Q.MOUSE_DOWN,()=>{l=!0,r(!0,!0)},!0),c=P(t,Q.MOUSE_UP,()=>{l=!1},!0),u=P(t,Q.MOUSE_LEAVE,p=>{l=!1,r(!1,p.fromElement===t)},!0),_=p=>{if(s)return;const m=new Ne,b={targetElements:[t],dispose:()=>{}};if(e.placement===void 0||e.placement==="mouse"){const L=y=>{b.x=y.x+10,Ii(y.target)&&zr(y.target,t)!==t&&r(!0,!0)};m.add(P(t,Q.MOUSE_MOVE,L,!0))}s=m,!(Ii(p.target)&&zr(p.target,t)!==t)&&m.add(a(e.delay,!1,b))},f=P(t,Q.MOUSE_OVER,_,!0),w=()=>{if(l||s)return;const p={targetElements:[t],dispose:()=>{}},m=new Ne,b=()=>r(!0,!0);m.add(P(t,Q.BLUR,b,!0)),m.add(a(e.delay,!1,p)),s=m};let C;const v=t.tagName.toLowerCase();v!=="input"&&v!=="textarea"&&(C=P(t,Q.FOCUS,w,!0));const g={show:p=>{r(!1,!0),a(0,p,void 0,p)},hide:()=>{r(!0,!0)},update:async(p,m)=>{i=p,await(o==null?void 0:o.update(i,void 0,m))},dispose:()=>{this._managedHovers.delete(t),f.dispose(),u.dispose(),h.dispose(),c.dispose(),C==null||C.dispose(),r(!0,!0)}};return this._managedHovers.set(t,g),g}showManagedHover(e){const t=this._managedHovers.get(e);t&&t.show(!0)}dispose(){this._managedHovers.forEach(e=>e.dispose()),super.dispose()}};Fs=Ru([Li(0,ve),Li(1,_d),Li(2,as),Li(3,kc),Li(4,Ot)],Fs);function Ur(d){if(d!==void 0)return(d==null?void 0:d.id)??d}class xu{get anchorPosition(){return this._hover.anchor}constructor(e,t=!1){this._hover=e,this._focus=t,this.layer=1}render(e){return this._hover.render(e),this._focus&&this._hover.focus(),this._hover}getAnchor(){return{x:this._hover.x,y:this._hover.y}}layout(){this._hover.layout()}}function zr(d,e){for(e=e??j(d).document.body;!d.hasAttribute("custom-hover")&&d!==e;)d=d.parentElement;return d}pd(Fc,Fs,1);At((d,e)=>{const t=d.getColor(Bc);t&&(e.addRule(`.monaco-workbench .workbench-hover .hover-row:not(:first-child):not(:empty) { border-top: 1px solid ${t.transparent(.5)}; }`),e.addRule(`.monaco-workbench .workbench-hover hr { border-top: 1px solid ${t.transparent(.5)}; }`))});const e_=Ho("IWorkspaceEditService");class Dd{constructor(e){this.metadata=e}static convert(e){return e.edits.map(t=>{if(ni.is(t))return ni.lift(t);if(si.is(t))return si.lift(t);throw new Error("Unsupported edit")})}}class ni extends Dd{static is(e){return e instanceof ni?!0:Bi(e)&&it.isUri(e.resource)&&Bi(e.textEdit)}static lift(e){return e instanceof ni?e:new ni(e.resource,e.textEdit,e.versionId,e.metadata)}constructor(e,t,i=void 0,n){super(n),this.resource=e,this.textEdit=t,this.versionId=i}}class si extends Dd{static is(e){return e instanceof si?!0:Bi(e)&&(!!e.newResource||!!e.oldResource)}static lift(e){return e instanceof si?e:new si(e.oldResource,e.newResource,e.options,e.metadata)}constructor(e,t,i={},n){super(n),this.oldResource=e,this.newResource=t,this.options=i}}var Uo=function(d,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(d,e,t,i);else for(var r=d.length-1;r>=0;r--)(o=d[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},Ln=function(d,e){return function(t,i){e(t,i,d)}};let Bs=class{constructor(e){this._commandService=e}async open(e,t){if(!hl(e,Ge.command))return!1;if(!(t!=null&&t.allowCommands)||(typeof e=="string"&&(e=it.parse(e)),Array.isArray(t.allowCommands)&&!t.allowCommands.includes(e.path)))return!0;let i=[];try{i=or(decodeURIComponent(e.query))}catch{try{i=or(e.query)}catch{}}return Array.isArray(i)||(i=[i]),await this._commandService.executeCommand(e.path,...i),!0}};Bs=Uo([Ln(0,ls)],Bs);let Us=class{constructor(e){this._editorService=e}async open(e,t){typeof e=="string"&&(e=it.parse(e));const{selection:i,uri:n}=Uc(e);return e=n,e.scheme===Ge.file&&(e=cl(e)),await this._editorService.openCodeEditor({resource:e,options:{selection:i,source:t!=null&&t.fromUserGesture?Or.USER:Or.API,...t==null?void 0:t.editorOptions}},this._editorService.getFocusedCodeEditor(),t==null?void 0:t.openToSide),!0}};Us=Uo([Ln(0,Ae)],Us);let $r=class{constructor(e,t){this._openers=new Mi,this._validators=new Mi,this._resolvers=new Mi,this._resolvedUriTargets=new ul(i=>i.with({path:null,fragment:null,query:null}).toString()),this._externalOpeners=new Mi,this._defaultExternalOpener={openExternal:async i=>(rr(i,Ge.http,Ge.https)?gl(i):Xn.location.href=i,!0)},this._openers.push({open:async(i,n)=>n!=null&&n.openExternal||rr(i,Ge.mailto,Ge.http,Ge.https,Ge.vsls)?(await this._doOpenExternal(i,n),!0):!1}),this._openers.push(new Bs(t)),this._openers.push(new Us(e))}registerOpener(e){return{dispose:this._openers.unshift(e)}}async open(e,t){const i=typeof e=="string"?it.parse(e):e,n=this._resolvedUriTargets.get(i)??e;for(const s of this._validators)if(!await s.shouldOpen(n,t))return!1;for(const s of this._openers)if(await s.open(e,t))return!0;return!1}async resolveExternalUri(e,t){for(const i of this._resolvers)try{const n=await i.resolveExternalUri(e,t);if(n)return this._resolvedUriTargets.has(n.resolved)||this._resolvedUriTargets.set(n.resolved,e),n}catch{}throw new Error("Could not resolve external URI: "+e.toString())}async _doOpenExternal(e,t){const i=typeof e=="string"?it.parse(e):e;let n;try{n=(await this.resolveExternalUri(i,t)).resolved}catch{n=i}let s;if(typeof e=="string"&&i.toString()===n.toString()?s=e:s=encodeURI(n.toString(!0)),t!=null&&t.allowContributedOpeners){const o=typeof(t==null?void 0:t.allowContributedOpeners)=="string"?t==null?void 0:t.allowContributedOpeners:void 0;for(const r of this._externalOpeners)if(await r.openExternal(s,{sourceUri:i,preferredOpenerId:o},ar.None))return!0}return this._defaultExternalOpener.openExternal(s,{sourceUri:i},ar.None)}dispose(){this._validators.clear()}};$r=Uo([Ln(0,Ae),Ln(1,ls)],$r);var Eu=function(d,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(d,e,t,i);else for(var r=d.length-1;r>=0;r--)(o=d[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},Tu=function(d,e){return function(t,i){e(t,i,d)}},di;let yn=(di=class{constructor(e,t){}dispose(){}},di.ID="editor.contrib.markerDecorations",di);yn=Eu([Tu(1,wh)],yn);_u(yn.ID,yn,0);class Nd extends V{constructor(e,t){super(),this._onDidChange=this._register(new H),this.onDidChange=this._onDidChange.event,this._referenceDomElement=e,this._width=-1,this._height=-1,this._resizeObserver=null,this.measureReferenceDomElement(!1,t)}dispose(){this.stopObserving(),super.dispose()}getWidth(){return this._width}getHeight(){return this._height}startObserving(){if(!this._resizeObserver&&this._referenceDomElement){let e=null;const t=()=>{e?this.observe({width:e.width,height:e.height}):this.observe()};let i=!1,n=!1;const s=()=>{if(i&&!n)try{i=!1,n=!0,t()}finally{Ui(j(this._referenceDomElement),()=>{n=!1,s()})}};this._resizeObserver=new ResizeObserver(o=>{o&&o[0]&&o[0].contentRect?e={width:o[0].contentRect.width,height:o[0].contentRect.height}:e=null,i=!0,s()}),this._resizeObserver.observe(this._referenceDomElement)}}stopObserving(){this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null)}observe(e){this.measureReferenceDomElement(!0,e)}measureReferenceDomElement(e,t){let i=0,n=0;t?(i=t.width,n=t.height):this._referenceDomElement&&(i=this._referenceDomElement.clientWidth,n=this._referenceDomElement.clientHeight),i=Math.max(5,i),n=Math.max(5,n),(this._width!==i||this._height!==n)&&(this._width=i,this._height=n,e&&this._onDidChange.fire())}}const qt=class qt{constructor(e,t){this.key=e,this.migrate=t}apply(e){const t=qt._read(e,this.key),i=s=>qt._read(e,s),n=(s,o)=>qt._write(e,s,o);this.migrate(t,i,n)}static _read(e,t){if(typeof e>"u")return;const i=t.indexOf(".");if(i>=0){const n=t.substring(0,i);return this._read(e[n],t.substring(i+1))}return e[t]}static _write(e,t,i){const n=t.indexOf(".");if(n>=0){const s=t.substring(0,n);e[s]=e[s]||{},this._write(e[s],t.substring(n+1),i);return}e[t]=i}};qt.items=[];let $i=qt;function Be(d,e){$i.items.push(new $i(d,e))}function we(d,e){Be(d,(t,i,n)=>{if(typeof t<"u"){for(const[s,o]of e)if(t===s){n(d,o);return}}})}function Iu(d){$i.items.forEach(e=>e.apply(d))}we("wordWrap",[[!0,"on"],[!1,"off"]]);we("lineNumbers",[[!0,"on"],[!1,"off"]]);we("cursorBlinking",[["visible","solid"]]);we("renderWhitespace",[[!0,"boundary"],[!1,"none"]]);we("renderLineHighlight",[[!0,"line"],[!1,"none"]]);we("acceptSuggestionOnEnter",[[!0,"on"],[!1,"off"]]);we("tabCompletion",[[!1,"off"],[!0,"onlySnippets"]]);we("hover",[[!0,{enabled:!0}],[!1,{enabled:!1}]]);we("parameterHints",[[!0,{enabled:!0}],[!1,{enabled:!1}]]);we("autoIndent",[[!1,"advanced"],[!0,"full"]]);we("matchBrackets",[[!0,"always"],[!1,"never"]]);we("renderFinalNewline",[[!0,"on"],[!1,"off"]]);we("cursorSmoothCaretAnimation",[[!0,"on"],[!1,"off"]]);we("occurrencesHighlight",[[!0,"singleFile"],[!1,"off"]]);we("wordBasedSuggestions",[[!0,"matchingDocuments"],[!1,"off"]]);Be("autoClosingBrackets",(d,e,t)=>{d===!1&&(t("autoClosingBrackets","never"),typeof e("autoClosingQuotes")>"u"&&t("autoClosingQuotes","never"),typeof e("autoSurround")>"u"&&t("autoSurround","never"))});Be("renderIndentGuides",(d,e,t)=>{typeof d<"u"&&(t("renderIndentGuides",void 0),typeof e("guides.indentation")>"u"&&t("guides.indentation",!!d))});Be("highlightActiveIndentGuide",(d,e,t)=>{typeof d<"u"&&(t("highlightActiveIndentGuide",void 0),typeof e("guides.highlightActiveIndentation")>"u"&&t("guides.highlightActiveIndentation",!!d))});const Ou={method:"showMethods",function:"showFunctions",constructor:"showConstructors",deprecated:"showDeprecated",field:"showFields",variable:"showVariables",class:"showClasses",struct:"showStructs",interface:"showInterfaces",module:"showModules",property:"showProperties",event:"showEvents",operator:"showOperators",unit:"showUnits",value:"showValues",constant:"showConstants",enum:"showEnums",enumMember:"showEnumMembers",keyword:"showKeywords",text:"showWords",color:"showColors",file:"showFiles",reference:"showReferences",folder:"showFolders",typeParameter:"showTypeParameters",snippet:"showSnippets"};Be("suggest.filteredTypes",(d,e,t)=>{if(d&&typeof d=="object"){for(const i of Object.entries(Ou))d[i[0]]===!1&&typeof e(`suggest.${i[1]}`)>"u"&&t(`suggest.${i[1]}`,!1);t("suggest.filteredTypes",void 0)}});Be("quickSuggestions",(d,e,t)=>{if(typeof d=="boolean"){const i=d?"on":"off";t("quickSuggestions",{comments:i,strings:i,other:i})}});Be("experimental.stickyScroll.enabled",(d,e,t)=>{typeof d=="boolean"&&(t("experimental.stickyScroll.enabled",void 0),typeof e("stickyScroll.enabled")>"u"&&t("stickyScroll.enabled",d))});Be("experimental.stickyScroll.maxLineCount",(d,e,t)=>{typeof d=="number"&&(t("experimental.stickyScroll.maxLineCount",void 0),typeof e("stickyScroll.maxLineCount")>"u"&&t("stickyScroll.maxLineCount",d))});Be("codeActionsOnSave",(d,e,t)=>{if(d&&typeof d=="object"){let i=!1;const n={};for(const s of Object.entries(d))typeof s[1]=="boolean"?(i=!0,n[s[0]]=s[1]?"explicit":"never"):n[s[0]]=s[1];i&&t("codeActionsOnSave",n)}});Be("codeActionWidget.includeNearbyQuickfixes",(d,e,t)=>{typeof d=="boolean"&&(t("codeActionWidget.includeNearbyQuickfixes",void 0),typeof e("codeActionWidget.includeNearbyQuickFixes")>"u"&&t("codeActionWidget.includeNearbyQuickFixes",d))});Be("lightbulb.enabled",(d,e,t)=>{typeof d=="boolean"&&t("lightbulb.enabled",d?void 0:"off")});class Au{constructor(){this._tabFocus=!1,this._onDidChangeTabFocus=new H,this.onDidChangeTabFocus=this._onDidChangeTabFocus.event}getTabFocusMode(){return this._tabFocus}setTabFocusMode(e){this._tabFocus=e,this._onDidChangeTabFocus.fire(this._tabFocus)}}const Sn=new Au;var Pu=function(d,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(d,e,t,i);else for(var r=d.length-1;r>=0;r--)(o=d[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},Wu=function(d,e){return function(t,i){e(t,i,d)}};let zs=class extends V{constructor(e,t,i,n,s){super(),this._accessibilityService=s,this._onDidChange=this._register(new H),this.onDidChange=this._onDidChange.event,this._onDidChangeFast=this._register(new H),this.onDidChangeFast=this._onDidChangeFast.event,this._isDominatedByLongLines=!1,this._viewLineCount=1,this._lineNumbersDigitCount=1,this._reservedHeight=0,this._glyphMarginDecorationLaneCount=1,this._computeOptionsMemory=new bh,this.isSimpleWidget=e,this.contextMenuId=t,this._containerObserver=this._register(new Nd(n,i.dimension)),this._targetWindowId=j(n).vscodeWindowId,this._rawOptions=Gr(i),this._validatedOptions=dt.validateOptions(this._rawOptions),this.options=this._computeOptions(),this.options.get(13)&&this._containerObserver.startObserving(),this._register(zt.onDidChangeZoomLevel(()=>this._recomputeOptions())),this._register(Sn.onDidChangeTabFocus(()=>this._recomputeOptions())),this._register(this._containerObserver.onDidChange(()=>this._recomputeOptions())),this._register(Wr.onDidChange(()=>this._recomputeOptions())),this._register(_n.getInstance(j(n)).onDidChange(()=>this._recomputeOptions())),this._register(this._accessibilityService.onDidChangeScreenReaderOptimized(()=>this._recomputeOptions()))}_recomputeOptions(){const e=this._computeOptions(),t=dt.checkEquals(this.options,e);t!==null&&(this.options=e,this._onDidChangeFast.fire(t),this._onDidChange.fire(t))}_computeOptions(){const e=this._readEnvConfiguration(),t=Lh.createFromValidatedSettings(this._validatedOptions,e.pixelRatio,this.isSimpleWidget),i=this._readFontInfo(t),n={memory:this._computeOptionsMemory,outerWidth:e.outerWidth,outerHeight:e.outerHeight-this._reservedHeight,fontInfo:i,extraEditorClassName:e.extraEditorClassName,isDominatedByLongLines:this._isDominatedByLongLines,viewLineCount:this._viewLineCount,lineNumbersDigitCount:this._lineNumbersDigitCount,emptySelectionClipboard:e.emptySelectionClipboard,pixelRatio:e.pixelRatio,tabFocusMode:Sn.getTabFocusMode(),accessibilitySupport:e.accessibilitySupport,glyphMarginDecorationLaneCount:this._glyphMarginDecorationLaneCount};return dt.computeOptions(this._validatedOptions,n)}_readEnvConfiguration(){return{extraEditorClassName:ku(),outerWidth:this._containerObserver.getWidth(),outerHeight:this._containerObserver.getHeight(),emptySelectionClipboard:Ua||Et,pixelRatio:_n.getInstance(dr(this._targetWindowId,!0).window).value,accessibilitySupport:this._accessibilityService.isScreenReaderOptimized()?2:this._accessibilityService.getAccessibilitySupport()}}_readFontInfo(e){return Wr.readFontInfo(dr(this._targetWindowId,!0).window,e)}getRawOptions(){return this._rawOptions}updateOptions(e){const t=Gr(e);dt.applyUpdate(this._rawOptions,t)&&(this._validatedOptions=dt.validateOptions(this._rawOptions),this._recomputeOptions())}observeContainer(e){this._containerObserver.observe(e)}setIsDominatedByLongLines(e){this._isDominatedByLongLines!==e&&(this._isDominatedByLongLines=e,this._recomputeOptions())}setModelLineCount(e){const t=Hu(e);this._lineNumbersDigitCount!==t&&(this._lineNumbersDigitCount=t,this._recomputeOptions())}setViewLineCount(e){this._viewLineCount!==e&&(this._viewLineCount=e,this._recomputeOptions())}setReservedHeight(e){this._reservedHeight!==e&&(this._reservedHeight=e,this._recomputeOptions())}setGlyphMarginDecorationLaneCount(e){this._glyphMarginDecorationLaneCount!==e&&(this._glyphMarginDecorationLaneCount=e,this._recomputeOptions())}};zs=Pu([Wu(4,Ot)],zs);function Hu(d){let e=0;for(;d;)d=Math.floor(d/10),e++;return e||1}function ku(){let d="";return!zi&&!ml&&(d+="no-user-select "),zi&&(d+="no-minimap-shadow ",d+="enable-user-select "),Lt&&(d+="mac "),d}class Vu{constructor(){this._values=[]}_read(e){return this._values[e]}get(e){return this._values[e]}_write(e,t){this._values[e]=t}}class Fu{constructor(){this._values=[]}_read(e){if(e>=this._values.length)throw new Error("Cannot read uninitialized value");return this._values[e]}get(e){return this._read(e)}_write(e,t){this._values[e]=t}}class dt{static validateOptions(e){const t=new Vu;for(const i of on){const n=i.name==="_never_"?void 0:e[i.name];t._write(i.id,i.validate(n))}return t}static computeOptions(e,t){const i=new Fu;for(const n of on)i._write(n.id,n.compute(t,i,e._read(n.id)));return i}static _deepEquals(e,t){if(typeof e!="object"||typeof t!="object"||!e||!t)return e===t;if(Array.isArray(e)||Array.isArray(t))return Array.isArray(e)&&Array.isArray(t)?yo(e,t):!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const i in e)if(!dt._deepEquals(e[i],t[i]))return!1;return!0}static checkEquals(e,t){const i=[];let n=!1;for(const s of on){const o=!dt._deepEquals(e._read(s.id),t._read(s.id));i[s.id]=o,o&&(n=!0)}return n?new yh(i):null}static applyUpdate(e,t){let i=!1;for(const n of on)if(t.hasOwnProperty(n.name)){const s=n.applyUpdate(e[n.name],t[n.name]);e[n.name]=s.newValue,i=i||s.didChange}return i}}function Gr(d){const e=fl(d);return Iu(e),e}class gs{constructor(e,t){this.x=e,this.y=t,this._pageCoordinatesBrand=void 0}toClientCoordinates(e){return new Md(this.x-e.scrollX,this.y-e.scrollY)}}class Md{constructor(e,t){this.clientX=e,this.clientY=t,this._clientCoordinatesBrand=void 0}toPageCoordinates(e){return new gs(this.clientX+e.scrollX,this.clientY+e.scrollY)}}class Bu{constructor(e,t,i,n){this.x=e,this.y=t,this.width=i,this.height=n,this._editorPagePositionBrand=void 0}}class Uu{constructor(e,t){this.x=e,this.y=t,this._positionRelativeToEditorBrand=void 0}}function zo(d){const e=Tt(d);return new Bu(e.left,e.top,e.width,e.height)}function $o(d,e,t){const i=e.width/d.offsetWidth,n=e.height/d.offsetHeight,s=(t.x-e.x)/i,o=(t.y-e.y)/n;return new Uu(s,o)}class ut extends _l{constructor(e,t,i){super(j(i),e),this._editorMouseEventBrand=void 0,this.isFromPointerCapture=t,this.pos=new gs(this.posx,this.posy),this.editorPos=zo(i),this.relativePos=$o(i,this.editorPos,this.pos)}}class zu{constructor(e){this._editorViewDomNode=e}_create(e){return new ut(e,!1,this._editorViewDomNode)}onContextMenu(e,t){return P(e,"contextmenu",i=>{t(this._create(i))})}onMouseUp(e,t){return P(e,"mouseup",i=>{t(this._create(i))})}onMouseDown(e,t){return P(e,Q.MOUSE_DOWN,i=>{t(this._create(i))})}onPointerDown(e,t){return P(e,Q.POINTER_DOWN,i=>{t(this._create(i),i.pointerId)})}onMouseLeave(e,t){return P(e,Q.MOUSE_LEAVE,i=>{t(this._create(i))})}onMouseMove(e,t){return P(e,"mousemove",i=>t(this._create(i)))}}class $u{constructor(e){this._editorViewDomNode=e}_create(e){return new ut(e,!1,this._editorViewDomNode)}onPointerUp(e,t){return P(e,"pointerup",i=>{t(this._create(i))})}onPointerDown(e,t){return P(e,Q.POINTER_DOWN,i=>{t(this._create(i),i.pointerId)})}onPointerLeave(e,t){return P(e,Q.POINTER_LEAVE,i=>{t(this._create(i))})}onPointerMove(e,t){return P(e,"pointermove",i=>t(this._create(i)))}}class Gu extends V{constructor(e){super(),this._editorViewDomNode=e,this._globalPointerMoveMonitor=this._register(new za),this._keydownListener=null}startMonitoring(e,t,i,n,s){this._keydownListener=yt(e.ownerDocument,"keydown",o=>{o.toKeyCodeChord().isModifierKey()||this._globalPointerMoveMonitor.stopMonitoring(!0,o.browserEvent)},!0),this._globalPointerMoveMonitor.startMonitoring(e,t,i,o=>{n(new ut(o,!0,this._editorViewDomNode))},o=>{this._keydownListener.dispose(),s(o)})}stopMonitoring(){this._globalPointerMoveMonitor.stopMonitoring(!0)}}const Vn=class Vn{constructor(e){this._editor=e,this._instanceId=++Vn._idPool,this._counter=0,this._rules=new Map,this._garbageCollectionScheduler=new ct(()=>this.garbageCollect(),1e3)}createClassNameRef(e){const t=this.getOrCreateRule(e);return t.increaseRefCount(),{className:t.className,dispose:()=>{t.decreaseRefCount(),this._garbageCollectionScheduler.schedule()}}}getOrCreateRule(e){const t=this.computeUniqueKey(e);let i=this._rules.get(t);if(!i){const n=this._counter++;i=new ju(t,`dyn-rule-${this._instanceId}-${n}`,pl(this._editor.getContainerDomNode())?this._editor.getContainerDomNode():void 0,e),this._rules.set(t,i)}return i}computeUniqueKey(e){return JSON.stringify(e)}garbageCollect(){for(const e of this._rules.values())e.hasReferences()||(this._rules.delete(e.key),e.dispose())}};Vn._idPool=0;let jr=Vn;class ju{constructor(e,t,i,n){this.key=e,this.className=t,this.properties=n,this._referenceCount=0,this._styleElementDisposables=new Ne,this._styleElement=vl(i,void 0,this._styleElementDisposables),this._styleElement.textContent=this.getCssText(this.className,this.properties)}getCssText(e,t){let i=`.${e} {`;for(const n in t){const s=t[n];let o;typeof s=="object"?o=zc(s.id):o=s;const r=Zu(n);i+=`
	${r}: ${o};`}return i+=`
}`,i}dispose(){this._styleElementDisposables.dispose(),this._styleElement=void 0}increaseRefCount(){this._referenceCount++}decreaseRefCount(){this._referenceCount--}hasReferences(){return this._referenceCount>0}}function Zu(d){return d.replace(/(^[A-Z])/,([e])=>e.toLowerCase()).replace(/([A-Z])/g,([e])=>`-${e.toLowerCase()}`)}class be extends Xi{constructor(e){super(),this._context=e,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),super.dispose()}}class Ve{static write(e,t){e.setAttribute("data-mprt",String(t))}static read(e){const t=e.getAttribute("data-mprt");return t===null?0:parseInt(t,10)}static collect(e,t){const i=[];let n=0;for(;e&&e!==e.ownerDocument.body&&e!==t;)e.nodeType===e.ELEMENT_NODE&&(i[n++]=this.read(e)),e=e.parentElement;const s=new Uint8Array(n);for(let o=0;o<n;o++)s[o]=i[n-o-1];return s}}class Ku{constructor(e,t){this._restrictedRenderingContextBrand=void 0,this._viewLayout=e,this.viewportData=t,this.scrollWidth=this._viewLayout.getScrollWidth(),this.scrollHeight=this._viewLayout.getScrollHeight(),this.visibleRange=this.viewportData.visibleRange,this.bigNumbersDelta=this.viewportData.bigNumbersDelta;const i=this._viewLayout.getCurrentViewport();this.scrollTop=i.top,this.scrollLeft=i.left,this.viewportWidth=i.width,this.viewportHeight=i.height}getScrolledTopFromAbsoluteTop(e){return e-this.scrollTop}getVerticalOffsetForLineNumber(e,t){return this._viewLayout.getVerticalOffsetForLineNumber(e,t)}getVerticalOffsetAfterLineNumber(e,t){return this._viewLayout.getVerticalOffsetAfterLineNumber(e,t)}getDecorationsInViewport(){return this.viewportData.getDecorationsInViewport()}}class qu extends Ku{constructor(e,t,i){super(e,t),this._renderingContextBrand=void 0,this._viewLines=i}linesVisibleRangesForRange(e,t){return this._viewLines.linesVisibleRangesForRange(e,t)}visibleRangeForPosition(e){return this._viewLines.visibleRangeForPosition(e)}}class Yu{constructor(e,t,i,n){this.outsideRenderedLine=e,this.lineNumber=t,this.ranges=i,this.continuesOnNextLine=n}}class fs{static from(e){const t=new Array(e.length);for(let i=0,n=e.length;i<n;i++){const s=e[i];t[i]=new fs(s.left,s.width)}return t}constructor(e,t){this._horizontalRangeBrand=void 0,this.left=Math.round(e),this.width=Math.round(t)}toString(){return`[${this.left},${this.width}]`}}class St{constructor(e,t){this._floatHorizontalRangeBrand=void 0,this.left=e,this.width=t}toString(){return`[${this.left},${this.width}]`}static compare(e,t){return e.left-t.left}}class Qu{constructor(e,t){this.outsideRenderedLine=e,this.originalLeft=t,this.left=Math.round(this.originalLeft)}}class Zr{constructor(e,t){this.outsideRenderedLine=e,this.ranges=t}}class gn{static _createRange(){return this._handyReadyRange||(this._handyReadyRange=document.createRange()),this._handyReadyRange}static _detachRange(e,t){e.selectNodeContents(t)}static _readClientRects(e,t,i,n,s){const o=this._createRange();try{return o.setStart(e,t),o.setEnd(i,n),o.getClientRects()}catch{return null}finally{this._detachRange(o,s)}}static _mergeAdjacentRanges(e){if(e.length===1)return e;e.sort(St.compare);const t=[];let i=0,n=e[0];for(let s=1,o=e.length;s<o;s++){const r=e[s];n.left+n.width+.9>=r.left?n.width=Math.max(n.width,r.left+r.width-n.left):(t[i++]=n,n=r)}return t[i++]=n,t}static _createHorizontalRangesFromClientRects(e,t,i){if(!e||e.length===0)return null;const n=[];for(let s=0,o=e.length;s<o;s++){const r=e[s];n[s]=new St(Math.max(0,(r.left-t)/i),r.width/i)}return this._mergeAdjacentRanges(n)}static readHorizontalRanges(e,t,i,n,s,o){const a=e.children.length-1;if(0>a)return null;if(t=Math.min(a,Math.max(0,t)),n=Math.min(a,Math.max(0,n)),t===n&&i===s&&i===0&&!e.children[t].firstChild){const u=e.children[t].getClientRects();return o.markDidDomLayout(),this._createHorizontalRangesFromClientRects(u,o.clientRectDeltaLeft,o.clientRectScale)}t!==n&&n>0&&s===0&&(n--,s=1073741824);let l=e.children[t].firstChild,h=e.children[n].firstChild;if((!l||!h)&&(!l&&i===0&&t>0&&(l=e.children[t-1].firstChild,i=1073741824),!h&&s===0&&n>0&&(h=e.children[n-1].firstChild,s=1073741824)),!l||!h)return null;i=Math.min(l.textContent.length,Math.max(0,i)),s=Math.min(h.textContent.length,Math.max(0,s));const c=this._readClientRects(l,i,h,s,o.endNode);return o.markDidDomLayout(),this._createHorizontalRangesFromClientRects(c,o.clientRectDeltaLeft,o.clientRectScale)}}const Xu=function(){return Cl?!0:!(Jn||Et||zi)}();let oi=!0;class Kr{constructor(e,t){this.themeType=t;const i=e.options,n=i.get(50);i.get(38)==="off"?this.renderWhitespace=i.get(100):this.renderWhitespace="none",this.renderControlCharacters=i.get(95),this.spaceWidth=n.spaceWidth,this.middotWidth=n.middotWidth,this.wsmiddotWidth=n.wsmiddotWidth,this.useMonospaceOptimizations=n.isMonospace&&!i.get(33),this.canUseHalfwidthRightwardsArrow=n.canUseHalfwidthRightwardsArrow,this.lineHeight=i.get(67),this.stopRenderingLineAfter=i.get(118),this.fontLigatures=i.get(51)}equals(e){return this.themeType===e.themeType&&this.renderWhitespace===e.renderWhitespace&&this.renderControlCharacters===e.renderControlCharacters&&this.spaceWidth===e.spaceWidth&&this.middotWidth===e.middotWidth&&this.wsmiddotWidth===e.wsmiddotWidth&&this.useMonospaceOptimizations===e.useMonospaceOptimizations&&this.canUseHalfwidthRightwardsArrow===e.canUseHalfwidthRightwardsArrow&&this.lineHeight===e.lineHeight&&this.stopRenderingLineAfter===e.stopRenderingLineAfter&&this.fontLigatures===e.fontLigatures}}const Fn=class Fn{constructor(e){this._options=e,this._isMaybeInvalid=!0,this._renderedViewLine=null}getDomNode(){return this._renderedViewLine&&this._renderedViewLine.domNode?this._renderedViewLine.domNode.domNode:null}setDomNode(e){if(this._renderedViewLine)this._renderedViewLine.domNode=$(e);else throw new Error("I have no rendered view line to set the dom node to...")}onContentChanged(){this._isMaybeInvalid=!0}onTokensChanged(){this._isMaybeInvalid=!0}onDecorationsChanged(){this._isMaybeInvalid=!0}onOptionsChanged(e){this._isMaybeInvalid=!0,this._options=e}onSelectionChanged(){return Pi(this._options.themeType)||this._options.renderWhitespace==="selection"?(this._isMaybeInvalid=!0,!0):!1}renderLine(e,t,i,n,s){if(this._isMaybeInvalid===!1)return!1;this._isMaybeInvalid=!1;const o=n.getViewLineRenderingData(e),r=this._options,a=wn.filter(o.inlineDecorations,e,o.minColumn,o.maxColumn);let l=null;if(Pi(r.themeType)||this._options.renderWhitespace==="selection"){const _=n.selections;for(const f of _){if(f.endLineNumber<e||f.startLineNumber>e)continue;const w=f.startLineNumber===e?f.startColumn:o.minColumn,C=f.endLineNumber===e?f.endColumn:o.maxColumn;w<C&&(Pi(r.themeType)&&a.push(new wn(w,C,"inline-selected-text",0)),this._options.renderWhitespace==="selection"&&(l||(l=[]),l.push(new rd(w-1,C-1))))}}const h=new Io(r.useMonospaceOptimizations,r.canUseHalfwidthRightwardsArrow,o.content,o.continuesWithWrappedLine,o.isBasicASCII,o.containsRTL,o.minColumn-1,o.tokens,a,o.tabSize,o.startVisibleColumn,r.spaceWidth,r.middotWidth,r.wsmiddotWidth,r.stopRenderingLineAfter,r.renderWhitespace,r.renderControlCharacters,r.fontLigatures!==ts.OFF,l);if(this._renderedViewLine&&this._renderedViewLine.input.equals(h))return!1;s.appendString('<div style="top:'),s.appendString(String(t)),s.appendString("px;height:"),s.appendString(String(i)),s.appendString('px;" class="'),s.appendString(Fn.CLASS_NAME),s.appendString('">');const c=ad(h,s);s.appendString("</div>");let u=null;return oi&&Xu&&o.isBasicASCII&&r.useMonospaceOptimizations&&c.containsForeignElements===0&&(u=new dn(this._renderedViewLine?this._renderedViewLine.domNode:null,h,c.characterMapping)),u||(u=xd(this._renderedViewLine?this._renderedViewLine.domNode:null,h,c.characterMapping,c.containsRTL,c.containsForeignElements)),this._renderedViewLine=u,!0}layoutLine(e,t,i){this._renderedViewLine&&this._renderedViewLine.domNode&&(this._renderedViewLine.domNode.setTop(t),this._renderedViewLine.domNode.setHeight(i))}getWidth(e){return this._renderedViewLine?this._renderedViewLine.getWidth(e):0}getWidthIsFast(){return this._renderedViewLine?this._renderedViewLine.getWidthIsFast():!0}needsMonospaceFontCheck(){return this._renderedViewLine?this._renderedViewLine instanceof dn:!1}monospaceAssumptionsAreValid(){return this._renderedViewLine&&this._renderedViewLine instanceof dn?this._renderedViewLine.monospaceAssumptionsAreValid():oi}onMonospaceAssumptionsInvalidated(){this._renderedViewLine&&this._renderedViewLine instanceof dn&&(this._renderedViewLine=this._renderedViewLine.toSlowRenderedLine())}getVisibleRangesForRange(e,t,i,n){if(!this._renderedViewLine)return null;t=Math.min(this._renderedViewLine.input.lineContent.length+1,Math.max(1,t)),i=Math.min(this._renderedViewLine.input.lineContent.length+1,Math.max(1,i));const s=this._renderedViewLine.input.stopRenderingLineAfter;if(s!==-1&&t>s+1&&i>s+1)return new Zr(!0,[new St(this.getWidth(n),0)]);s!==-1&&t>s+1&&(t=s+1),s!==-1&&i>s+1&&(i=s+1);const o=this._renderedViewLine.getVisibleRangesForRange(e,t,i,n);return o&&o.length>0?new Zr(!1,o):null}getColumnOfNodeOffset(e,t){return this._renderedViewLine?this._renderedViewLine.getColumnOfNodeOffset(e,t):1}};Fn.CLASS_NAME="view-line";let Xe=Fn;class dn{constructor(e,t,i){this._cachedWidth=-1,this.domNode=e,this.input=t;const n=Math.floor(t.lineContent.length/300);if(n>0){this._keyColumnPixelOffsetCache=new Float32Array(n);for(let s=0;s<n;s++)this._keyColumnPixelOffsetCache[s]=-1}else this._keyColumnPixelOffsetCache=null;this._characterMapping=i,this._charWidth=t.spaceWidth}getWidth(e){if(!this.domNode||this.input.lineContent.length<300){const t=this._characterMapping.getHorizontalOffset(this._characterMapping.length);return Math.round(this._charWidth*t)}return this._cachedWidth===-1&&(this._cachedWidth=this._getReadingTarget(this.domNode).offsetWidth,e==null||e.markDidDomLayout()),this._cachedWidth}getWidthIsFast(){return this.input.lineContent.length<300||this._cachedWidth!==-1}monospaceAssumptionsAreValid(){if(!this.domNode)return oi;if(this.input.lineContent.length<300){const e=this.getWidth(null),t=this.domNode.domNode.firstChild.offsetWidth;Math.abs(e-t)>=2&&(console.warn("monospace assumptions have been violated, therefore disabling monospace optimizations!"),oi=!1)}return oi}toSlowRenderedLine(){return xd(this.domNode,this.input,this._characterMapping,!1,0)}getVisibleRangesForRange(e,t,i,n){const s=this._getColumnPixelOffset(e,t,n),o=this._getColumnPixelOffset(e,i,n);return[new St(s,o-s)]}_getColumnPixelOffset(e,t,i){if(t<=300){const l=this._characterMapping.getHorizontalOffset(t);return this._charWidth*l}const n=Math.floor((t-1)/300)-1,s=(n+1)*300+1;let o=-1;if(this._keyColumnPixelOffsetCache&&(o=this._keyColumnPixelOffsetCache[n],o===-1&&(o=this._actualReadPixelOffset(e,s,i),this._keyColumnPixelOffsetCache[n]=o)),o===-1){const l=this._characterMapping.getHorizontalOffset(t);return this._charWidth*l}const r=this._characterMapping.getHorizontalOffset(s),a=this._characterMapping.getHorizontalOffset(t);return o+this._charWidth*(a-r)}_getReadingTarget(e){return e.domNode.firstChild}_actualReadPixelOffset(e,t,i){if(!this.domNode)return-1;const n=this._characterMapping.getDomPosition(t),s=gn.readHorizontalRanges(this._getReadingTarget(this.domNode),n.partIndex,n.charIndex,n.partIndex,n.charIndex,i);return!s||s.length===0?-1:s[0].left}getColumnOfNodeOffset(e,t){return Ed(this._characterMapping,e,t)}}class Rd{constructor(e,t,i,n,s){if(this.domNode=e,this.input=t,this._characterMapping=i,this._isWhitespaceOnly=/^\s*$/.test(t.lineContent),this._containsForeignElements=s,this._cachedWidth=-1,this._pixelOffsetCache=null,!n||this._characterMapping.length===0){this._pixelOffsetCache=new Float32Array(Math.max(2,this._characterMapping.length+1));for(let o=0,r=this._characterMapping.length;o<=r;o++)this._pixelOffsetCache[o]=-1}}_getReadingTarget(e){return e.domNode.firstChild}getWidth(e){return this.domNode?(this._cachedWidth===-1&&(this._cachedWidth=this._getReadingTarget(this.domNode).offsetWidth,e==null||e.markDidDomLayout()),this._cachedWidth):0}getWidthIsFast(){return this._cachedWidth!==-1}getVisibleRangesForRange(e,t,i,n){if(!this.domNode)return null;if(this._pixelOffsetCache!==null){const s=this._readPixelOffset(this.domNode,e,t,n);if(s===-1)return null;const o=this._readPixelOffset(this.domNode,e,i,n);return o===-1?null:[new St(s,o-s)]}return this._readVisibleRangesForRange(this.domNode,e,t,i,n)}_readVisibleRangesForRange(e,t,i,n,s){if(i===n){const o=this._readPixelOffset(e,t,i,s);return o===-1?null:[new St(o,0)]}else return this._readRawVisibleRangesForRange(e,i,n,s)}_readPixelOffset(e,t,i,n){if(this._characterMapping.length===0){if(this._containsForeignElements===0||this._containsForeignElements===2)return 0;if(this._containsForeignElements===1)return this.getWidth(n);const s=this._getReadingTarget(e);return s.firstChild?(n.markDidDomLayout(),s.firstChild.offsetWidth):0}if(this._pixelOffsetCache!==null){const s=this._pixelOffsetCache[i];if(s!==-1)return s;const o=this._actualReadPixelOffset(e,t,i,n);return this._pixelOffsetCache[i]=o,o}return this._actualReadPixelOffset(e,t,i,n)}_actualReadPixelOffset(e,t,i,n){if(this._characterMapping.length===0){const a=gn.readHorizontalRanges(this._getReadingTarget(e),0,0,0,0,n);return!a||a.length===0?-1:a[0].left}if(i===this._characterMapping.length&&this._isWhitespaceOnly&&this._containsForeignElements===0)return this.getWidth(n);const s=this._characterMapping.getDomPosition(i),o=gn.readHorizontalRanges(this._getReadingTarget(e),s.partIndex,s.charIndex,s.partIndex,s.charIndex,n);if(!o||o.length===0)return-1;const r=o[0].left;if(this.input.isBasicASCII){const a=this._characterMapping.getHorizontalOffset(i),l=Math.round(this.input.spaceWidth*a);if(Math.abs(l-r)<=1)return l}return r}_readRawVisibleRangesForRange(e,t,i,n){if(t===1&&i===this._characterMapping.length)return[new St(0,this.getWidth(n))];const s=this._characterMapping.getDomPosition(t),o=this._characterMapping.getDomPosition(i);return gn.readHorizontalRanges(this._getReadingTarget(e),s.partIndex,s.charIndex,o.partIndex,o.charIndex,n)}getColumnOfNodeOffset(e,t){return Ed(this._characterMapping,e,t)}}class Ju extends Rd{_readVisibleRangesForRange(e,t,i,n,s){const o=super._readVisibleRangesForRange(e,t,i,n,s);if(!o||o.length===0||i===n||i===1&&n===this._characterMapping.length)return o;if(!this.input.containsRTL){const r=this._readPixelOffset(e,t,n,s);if(r!==-1){const a=o[o.length-1];a.left<r&&(a.width=r-a.left)}}return o}}const xd=function(){return Ua?eg:tg}();function eg(d,e,t,i,n){return new Ju(d,e,t,i,n)}function tg(d,e,t,i,n){return new Rd(d,e,t,i,n)}function Ed(d,e,t){const i=e.textContent.length;let n=-1;for(;e;)e=e.previousSibling,n++;return d.getColumn(new Sh(n,t),i)}class st{constructor(e=null){this.hitTarget=e,this.type=0}}class Td{get hitTarget(){return this.spanNode}constructor(e,t,i){this.position=e,this.spanNode=t,this.injectedText=i,this.type=1}}var Ct;(function(d){function e(t,i,n){const s=t.getPositionFromDOMInfo(i,n);return s?new Td(s,i,null):new st(i)}d.createFromDOMInfo=e})(Ct||(Ct={}));class ig{constructor(e,t){this.lastViewCursorsRenderData=e,this.lastTextareaPosition=t}}class fe{static _deduceRage(e,t=null){return!t&&e?new W(e.lineNumber,e.column,e.lineNumber,e.column):t??null}static createUnknown(e,t,i){return{type:0,element:e,mouseColumn:t,position:i,range:this._deduceRage(i)}}static createTextarea(e,t){return{type:1,element:e,mouseColumn:t,position:null,range:null}}static createMargin(e,t,i,n,s,o){return{type:e,element:t,mouseColumn:i,position:n,range:s,detail:o}}static createViewZone(e,t,i,n,s){return{type:e,element:t,mouseColumn:i,position:n,range:this._deduceRage(n),detail:s}}static createContentText(e,t,i,n,s){return{type:6,element:e,mouseColumn:t,position:i,range:this._deduceRage(i,n),detail:s}}static createContentEmpty(e,t,i,n){return{type:7,element:e,mouseColumn:t,position:i,range:this._deduceRage(i),detail:n}}static createContentWidget(e,t,i){return{type:9,element:e,mouseColumn:t,position:null,range:null,detail:i}}static createScrollbar(e,t,i){return{type:11,element:e,mouseColumn:t,position:i,range:this._deduceRage(i)}}static createOverlayWidget(e,t,i){return{type:12,element:e,mouseColumn:t,position:null,range:null,detail:i}}static createOutsideEditor(e,t,i,n){return{type:13,element:null,mouseColumn:e,position:t,range:this._deduceRage(t),outsidePosition:i,outsideDistance:n}}static _typeToString(e){return e===1?"TEXTAREA":e===2?"GUTTER_GLYPH_MARGIN":e===3?"GUTTER_LINE_NUMBERS":e===4?"GUTTER_LINE_DECORATIONS":e===5?"GUTTER_VIEW_ZONE":e===6?"CONTENT_TEXT":e===7?"CONTENT_EMPTY":e===8?"CONTENT_VIEW_ZONE":e===9?"CONTENT_WIDGET":e===10?"OVERVIEW_RULER":e===11?"SCROLLBAR":e===12?"OVERLAY_WIDGET":"UNKNOWN"}static toString(e){return this._typeToString(e.type)+": "+e.position+" - "+e.range+" - "+JSON.stringify(e.detail)}}class _e{static isTextArea(e){return e.length===2&&e[0]===3&&e[1]===7}static isChildOfViewLines(e){return e.length>=4&&e[0]===3&&e[3]===8}static isStrictChildOfViewLines(e){return e.length>4&&e[0]===3&&e[3]===8}static isChildOfScrollableElement(e){return e.length>=2&&e[0]===3&&e[1]===6}static isChildOfMinimap(e){return e.length>=2&&e[0]===3&&e[1]===9}static isChildOfContentWidgets(e){return e.length>=4&&e[0]===3&&e[3]===1}static isChildOfOverflowGuard(e){return e.length>=1&&e[0]===3}static isChildOfOverflowingContentWidgets(e){return e.length>=1&&e[0]===2}static isChildOfOverlayWidgets(e){return e.length>=2&&e[0]===3&&e[1]===4}static isChildOfOverflowingOverlayWidgets(e){return e.length>=1&&e[0]===5}}class gi{constructor(e,t,i){this.viewModel=e.viewModel;const n=e.configuration.options;this.layoutInfo=n.get(146),this.viewDomNode=t.viewDomNode,this.lineHeight=n.get(67),this.stickyTabStops=n.get(117),this.typicalHalfwidthCharacterWidth=n.get(50).typicalHalfwidthCharacterWidth,this.lastRenderData=i,this._context=e,this._viewHelper=t}getZoneAtCoord(e){return gi.getZoneAtCoord(this._context,e)}static getZoneAtCoord(e,t){const i=e.viewLayout.getWhitespaceAtVerticalOffset(t);if(i){const n=i.verticalOffset+i.height/2,s=e.viewModel.getLineCount();let o=null,r,a=null;return i.afterLineNumber!==s&&(a=new E(i.afterLineNumber+1,1)),i.afterLineNumber>0&&(o=new E(i.afterLineNumber,e.viewModel.getLineMaxColumn(i.afterLineNumber))),a===null?r=o:o===null?r=a:t<n?r=o:r=a,{viewZoneId:i.id,afterLineNumber:i.afterLineNumber,positionBefore:o,positionAfter:a,position:r}}return null}getFullLineRangeAtCoord(e){if(this._context.viewLayout.isAfterLines(e)){const n=this._context.viewModel.getLineCount(),s=this._context.viewModel.getLineMaxColumn(n);return{range:new W(n,s,n,s),isAfterLines:!0}}const t=this._context.viewLayout.getLineNumberAtVerticalOffset(e),i=this._context.viewModel.getLineMaxColumn(t);return{range:new W(t,1,t,i),isAfterLines:!1}}getLineNumberAtVerticalOffset(e){return this._context.viewLayout.getLineNumberAtVerticalOffset(e)}isAfterLines(e){return this._context.viewLayout.isAfterLines(e)}isInTopPadding(e){return this._context.viewLayout.isInTopPadding(e)}isInBottomPadding(e){return this._context.viewLayout.isInBottomPadding(e)}getVerticalOffsetForLineNumber(e){return this._context.viewLayout.getVerticalOffsetForLineNumber(e)}findAttribute(e,t){return gi._findAttribute(e,t,this._viewHelper.viewDomNode)}static _findAttribute(e,t,i){for(;e&&e!==e.ownerDocument.body;){if(e.hasAttribute&&e.hasAttribute(t))return e.getAttribute(t);if(e===i)return null;e=e.parentNode}return null}getLineWidth(e){return this._viewHelper.getLineWidth(e)}visibleRangeForPosition(e,t){return this._viewHelper.visibleRangeForPosition(e,t)}getPositionFromDOMInfo(e,t){return this._viewHelper.getPositionFromDOMInfo(e,t)}getCurrentScrollTop(){return this._context.viewLayout.getCurrentScrollTop()}getCurrentScrollLeft(){return this._context.viewLayout.getCurrentScrollLeft()}}class ng{constructor(e,t,i,n){this.editorPos=t,this.pos=i,this.relativePos=n,this.mouseVerticalOffset=Math.max(0,e.getCurrentScrollTop()+this.relativePos.y),this.mouseContentHorizontalOffset=e.getCurrentScrollLeft()+this.relativePos.x-e.layoutInfo.contentLeft,this.isInMarginArea=this.relativePos.x<e.layoutInfo.contentLeft&&this.relativePos.x>=e.layoutInfo.glyphMarginLeft,this.isInContentArea=!this.isInMarginArea,this.mouseColumn=Math.max(0,ge._getMouseColumn(this.mouseContentHorizontalOffset,e.typicalHalfwidthCharacterWidth))}}class sg extends ng{get target(){return this._useHitTestTarget?this.hitTestResult.value.hitTarget:this._eventTarget}get targetPath(){return this._targetPathCacheElement!==this.target&&(this._targetPathCacheElement=this.target,this._targetPathCacheValue=Ve.collect(this.target,this._ctx.viewDomNode)),this._targetPathCacheValue}constructor(e,t,i,n,s){super(e,t,i,n),this.hitTestResult=new wl(()=>ge.doHitTest(this._ctx,this)),this._targetPathCacheElement=null,this._targetPathCacheValue=new Uint8Array(0),this._ctx=e,this._eventTarget=s;const o=!!this._eventTarget;this._useHitTestTarget=!o}toString(){return`pos(${this.pos.x},${this.pos.y}), editorPos(${this.editorPos.x},${this.editorPos.y}), relativePos(${this.relativePos.x},${this.relativePos.y}), mouseVerticalOffset: ${this.mouseVerticalOffset}, mouseContentHorizontalOffset: ${this.mouseContentHorizontalOffset}
	target: ${this.target?this.target.outerHTML:null}`}get wouldBenefitFromHitTestTargetSwitch(){return!this._useHitTestTarget&&this.hitTestResult.value.hitTarget!==null&&this.target!==this.hitTestResult.value.hitTarget}switchToHitTestTarget(){this._useHitTestTarget=!0}_getMouseColumn(e=null){return e&&e.column<this._ctx.viewModel.getLineMaxColumn(e.lineNumber)?dd.visibleColumnFromColumn(this._ctx.viewModel.getLineContent(e.lineNumber),e.column,this._ctx.viewModel.model.getOptions().tabSize)+1:this.mouseColumn}fulfillUnknown(e=null){return fe.createUnknown(this.target,this._getMouseColumn(e),e)}fulfillTextarea(){return fe.createTextarea(this.target,this._getMouseColumn())}fulfillMargin(e,t,i,n){return fe.createMargin(e,this.target,this._getMouseColumn(t),t,i,n)}fulfillViewZone(e,t,i){return fe.createViewZone(e,this.target,this._getMouseColumn(t),t,i)}fulfillContentText(e,t,i){return fe.createContentText(this.target,this._getMouseColumn(e),e,t,i)}fulfillContentEmpty(e,t){return fe.createContentEmpty(this.target,this._getMouseColumn(e),e,t)}fulfillContentWidget(e){return fe.createContentWidget(this.target,this._getMouseColumn(),e)}fulfillScrollbar(e){return fe.createScrollbar(this.target,this._getMouseColumn(e),e)}fulfillOverlayWidget(e){return fe.createOverlayWidget(this.target,this._getMouseColumn(),e)}}const qr={isAfterLines:!0};function ps(d){return{isAfterLines:!1,horizontalDistanceToText:d}}class ge{constructor(e,t){this._context=e,this._viewHelper=t}mouseTargetIsWidget(e){const t=e.target,i=Ve.collect(t,this._viewHelper.viewDomNode);return!!(_e.isChildOfContentWidgets(i)||_e.isChildOfOverflowingContentWidgets(i)||_e.isChildOfOverlayWidgets(i)||_e.isChildOfOverflowingOverlayWidgets(i))}createMouseTarget(e,t,i,n,s){const o=new gi(this._context,this._viewHelper,e),r=new sg(o,t,i,n,s);try{const a=ge._createMouseTarget(o,r);if(a.type===6&&o.stickyTabStops&&a.position!==null){const l=ge._snapToSoftTabBoundary(a.position,o.viewModel),h=W.fromPositions(l,l).plusRange(a.range);return r.fulfillContentText(l,h,a.detail)}return a}catch{return r.fulfillUnknown()}}static _createMouseTarget(e,t){if(t.target===null)return t.fulfillUnknown();const i=t;let n=null;return!_e.isChildOfOverflowGuard(t.targetPath)&&!_e.isChildOfOverflowingContentWidgets(t.targetPath)&&!_e.isChildOfOverflowingOverlayWidgets(t.targetPath)&&(n=n||t.fulfillUnknown()),n=n||ge._hitTestContentWidget(e,i),n=n||ge._hitTestOverlayWidget(e,i),n=n||ge._hitTestMinimap(e,i),n=n||ge._hitTestScrollbarSlider(e,i),n=n||ge._hitTestViewZone(e,i),n=n||ge._hitTestMargin(e,i),n=n||ge._hitTestViewCursor(e,i),n=n||ge._hitTestTextArea(e,i),n=n||ge._hitTestViewLines(e,i),n=n||ge._hitTestScrollbar(e,i),n||t.fulfillUnknown()}static _hitTestContentWidget(e,t){if(_e.isChildOfContentWidgets(t.targetPath)||_e.isChildOfOverflowingContentWidgets(t.targetPath)){const i=e.findAttribute(t.target,"widgetId");return i?t.fulfillContentWidget(i):t.fulfillUnknown()}return null}static _hitTestOverlayWidget(e,t){if(_e.isChildOfOverlayWidgets(t.targetPath)||_e.isChildOfOverflowingOverlayWidgets(t.targetPath)){const i=e.findAttribute(t.target,"widgetId");return i?t.fulfillOverlayWidget(i):t.fulfillUnknown()}return null}static _hitTestViewCursor(e,t){if(t.target){const i=e.lastRenderData.lastViewCursorsRenderData;for(const n of i)if(t.target===n.domNode)return t.fulfillContentText(n.position,null,{mightBeForeignElement:!1,injectedText:null})}if(t.isInContentArea){const i=e.lastRenderData.lastViewCursorsRenderData,n=t.mouseContentHorizontalOffset,s=t.mouseVerticalOffset;for(const o of i){if(n<o.contentLeft||n>o.contentLeft+o.width)continue;const r=e.getVerticalOffsetForLineNumber(o.position.lineNumber);if(r<=s&&s<=r+o.height)return t.fulfillContentText(o.position,null,{mightBeForeignElement:!1,injectedText:null})}}return null}static _hitTestViewZone(e,t){const i=e.getZoneAtCoord(t.mouseVerticalOffset);if(i){const n=t.isInContentArea?8:5;return t.fulfillViewZone(n,i.position,i)}return null}static _hitTestTextArea(e,t){return _e.isTextArea(t.targetPath)?e.lastRenderData.lastTextareaPosition?t.fulfillContentText(e.lastRenderData.lastTextareaPosition,null,{mightBeForeignElement:!1,injectedText:null}):t.fulfillTextarea():null}static _hitTestMargin(e,t){if(t.isInMarginArea){const i=e.getFullLineRangeAtCoord(t.mouseVerticalOffset),n=i.range.getStartPosition();let s=Math.abs(t.relativePos.x);const o={isAfterLines:i.isAfterLines,glyphMarginLeft:e.layoutInfo.glyphMarginLeft,glyphMarginWidth:e.layoutInfo.glyphMarginWidth,lineNumbersWidth:e.layoutInfo.lineNumbersWidth,offsetX:s};if(s-=e.layoutInfo.glyphMarginLeft,s<=e.layoutInfo.glyphMarginWidth){const r=e.viewModel.coordinatesConverter.convertViewPositionToModelPosition(i.range.getStartPosition()),a=e.viewModel.glyphLanes.getLanesAtLine(r.lineNumber);return o.glyphMarginLane=a[Math.floor(s/e.lineHeight)],t.fulfillMargin(2,n,i.range,o)}return s-=e.layoutInfo.glyphMarginWidth,s<=e.layoutInfo.lineNumbersWidth?t.fulfillMargin(3,n,i.range,o):(s-=e.layoutInfo.lineNumbersWidth,t.fulfillMargin(4,n,i.range,o))}return null}static _hitTestViewLines(e,t){if(!_e.isChildOfViewLines(t.targetPath))return null;if(e.isInTopPadding(t.mouseVerticalOffset))return t.fulfillContentEmpty(new E(1,1),qr);if(e.isAfterLines(t.mouseVerticalOffset)||e.isInBottomPadding(t.mouseVerticalOffset)){const n=e.viewModel.getLineCount(),s=e.viewModel.getLineMaxColumn(n);return t.fulfillContentEmpty(new E(n,s),qr)}if(_e.isStrictChildOfViewLines(t.targetPath)){const n=e.getLineNumberAtVerticalOffset(t.mouseVerticalOffset);if(e.viewModel.getLineLength(n)===0){const o=e.getLineWidth(n),r=ps(t.mouseContentHorizontalOffset-o);return t.fulfillContentEmpty(new E(n,1),r)}const s=e.getLineWidth(n);if(t.mouseContentHorizontalOffset>=s){const o=ps(t.mouseContentHorizontalOffset-s),r=new E(n,e.viewModel.getLineMaxColumn(n));return t.fulfillContentEmpty(r,o)}}const i=t.hitTestResult.value;return i.type===1?ge.createMouseTargetFromHitTestPosition(e,t,i.spanNode,i.position,i.injectedText):t.wouldBenefitFromHitTestTargetSwitch?(t.switchToHitTestTarget(),this._createMouseTarget(e,t)):t.fulfillUnknown()}static _hitTestMinimap(e,t){if(_e.isChildOfMinimap(t.targetPath)){const i=e.getLineNumberAtVerticalOffset(t.mouseVerticalOffset),n=e.viewModel.getLineMaxColumn(i);return t.fulfillScrollbar(new E(i,n))}return null}static _hitTestScrollbarSlider(e,t){if(_e.isChildOfScrollableElement(t.targetPath)&&t.target&&t.target.nodeType===1){const i=t.target.className;if(i&&/\b(slider|scrollbar)\b/.test(i)){const n=e.getLineNumberAtVerticalOffset(t.mouseVerticalOffset),s=e.viewModel.getLineMaxColumn(n);return t.fulfillScrollbar(new E(n,s))}}return null}static _hitTestScrollbar(e,t){if(_e.isChildOfScrollableElement(t.targetPath)){const i=e.getLineNumberAtVerticalOffset(t.mouseVerticalOffset),n=e.viewModel.getLineMaxColumn(i);return t.fulfillScrollbar(new E(i,n))}return null}getMouseColumn(e){const t=this._context.configuration.options,i=t.get(146),n=this._context.viewLayout.getCurrentScrollLeft()+e.x-i.contentLeft;return ge._getMouseColumn(n,t.get(50).typicalHalfwidthCharacterWidth)}static _getMouseColumn(e,t){return e<0?1:Math.round(e/t)+1}static createMouseTargetFromHitTestPosition(e,t,i,n,s){const o=n.lineNumber,r=n.column,a=e.getLineWidth(o);if(t.mouseContentHorizontalOffset>a){const v=ps(t.mouseContentHorizontalOffset-a);return t.fulfillContentEmpty(n,v)}const l=e.visibleRangeForPosition(o,r);if(!l)return t.fulfillUnknown(n);const h=l.left;if(Math.abs(t.mouseContentHorizontalOffset-h)<1)return t.fulfillContentText(n,null,{mightBeForeignElement:!!s,injectedText:s});const c=[];if(c.push({offset:l.left,column:r}),r>1){const v=e.visibleRangeForPosition(o,r-1);v&&c.push({offset:v.left,column:r-1})}const u=e.viewModel.getLineMaxColumn(o);if(r<u){const v=e.visibleRangeForPosition(o,r+1);v&&c.push({offset:v.left,column:r+1})}c.sort((v,g)=>v.offset-g.offset);const _=t.pos.toClientCoordinates(j(e.viewDomNode)),f=i.getBoundingClientRect(),w=f.left<=_.clientX&&_.clientX<=f.right;let C=null;for(let v=1;v<c.length;v++){const g=c[v-1],p=c[v];if(g.offset<=t.mouseContentHorizontalOffset&&t.mouseContentHorizontalOffset<=p.offset){C=new W(o,g.column,o,p.column);const m=Math.abs(g.offset-t.mouseContentHorizontalOffset),b=Math.abs(p.offset-t.mouseContentHorizontalOffset);n=m<b?new E(o,g.column):new E(o,p.column);break}}return t.fulfillContentText(n,C,{mightBeForeignElement:!w||!!s,injectedText:s})}static _doHitTestWithCaretRangeFromPoint(e,t){const i=e.getLineNumberAtVerticalOffset(t.mouseVerticalOffset),n=e.getVerticalOffsetForLineNumber(i),s=n+e.lineHeight;if(!(i===e.viewModel.getLineCount()&&t.mouseVerticalOffset>s)){const r=Math.floor((n+s)/2);let a=t.pos.y+(r-t.mouseVerticalOffset);a<=t.editorPos.y&&(a=t.editorPos.y+1),a>=t.editorPos.y+t.editorPos.height&&(a=t.editorPos.y+t.editorPos.height-1);const l=new gs(t.pos.x,a),h=this._actualDoHitTestWithCaretRangeFromPoint(e,l.toClientCoordinates(j(e.viewDomNode)));if(h.type===1)return h}return this._actualDoHitTestWithCaretRangeFromPoint(e,t.pos.toClientCoordinates(j(e.viewDomNode)))}static _actualDoHitTestWithCaretRangeFromPoint(e,t){const i=pn(e.viewDomNode);let n;if(i?typeof i.caretRangeFromPoint>"u"?n=og(i,t.clientX,t.clientY):n=i.caretRangeFromPoint(t.clientX,t.clientY):n=e.viewDomNode.ownerDocument.caretRangeFromPoint(t.clientX,t.clientY),!n||!n.startContainer)return new st;const s=n.startContainer;if(s.nodeType===s.TEXT_NODE){const o=s.parentNode,r=o?o.parentNode:null,a=r?r.parentNode:null;return(a&&a.nodeType===a.ELEMENT_NODE?a.className:null)===Xe.CLASS_NAME?Ct.createFromDOMInfo(e,o,n.startOffset):new st(s.parentNode)}else if(s.nodeType===s.ELEMENT_NODE){const o=s.parentNode,r=o?o.parentNode:null;return(r&&r.nodeType===r.ELEMENT_NODE?r.className:null)===Xe.CLASS_NAME?Ct.createFromDOMInfo(e,s,s.textContent.length):new st(s)}return new st}static _doHitTestWithCaretPositionFromPoint(e,t){const i=e.viewDomNode.ownerDocument.caretPositionFromPoint(t.clientX,t.clientY);if(i.offsetNode.nodeType===i.offsetNode.TEXT_NODE){const n=i.offsetNode.parentNode,s=n?n.parentNode:null,o=s?s.parentNode:null;return(o&&o.nodeType===o.ELEMENT_NODE?o.className:null)===Xe.CLASS_NAME?Ct.createFromDOMInfo(e,i.offsetNode.parentNode,i.offset):new st(i.offsetNode.parentNode)}if(i.offsetNode.nodeType===i.offsetNode.ELEMENT_NODE){const n=i.offsetNode.parentNode,s=n&&n.nodeType===n.ELEMENT_NODE?n.className:null,o=n?n.parentNode:null,r=o&&o.nodeType===o.ELEMENT_NODE?o.className:null;if(s===Xe.CLASS_NAME){const a=i.offsetNode.childNodes[Math.min(i.offset,i.offsetNode.childNodes.length-1)];if(a)return Ct.createFromDOMInfo(e,a,0)}else if(r===Xe.CLASS_NAME)return Ct.createFromDOMInfo(e,i.offsetNode,0)}return new st(i.offsetNode)}static _snapToSoftTabBoundary(e,t){const i=t.getLineContent(e.lineNumber),{tabSize:n}=t.model.getOptions(),s=Dh.atomicPosition(i,e.column-1,n,2);return s!==-1?new E(e.lineNumber,s+1):e}static doHitTest(e,t){let i=new st;if(typeof e.viewDomNode.ownerDocument.caretRangeFromPoint=="function"?i=this._doHitTestWithCaretRangeFromPoint(e,t):e.viewDomNode.ownerDocument.caretPositionFromPoint&&(i=this._doHitTestWithCaretPositionFromPoint(e,t.pos.toClientCoordinates(j(e.viewDomNode)))),i.type===1){const n=e.viewModel.getInjectedTextAt(i.position),s=e.viewModel.normalizePosition(i.position,2);(n||!s.equals(i.position))&&(i=new Td(s,i.spanNode,n))}return i}}function og(d,e,t){const i=document.createRange();let n=d.elementFromPoint(e,t);if(n!==null){for(;n&&n.firstChild&&n.firstChild.nodeType!==n.firstChild.TEXT_NODE&&n.lastChild&&n.lastChild.firstChild;)n=n.lastChild;const s=n.getBoundingClientRect(),o=j(n),r=o.getComputedStyle(n,null).getPropertyValue("font-style"),a=o.getComputedStyle(n,null).getPropertyValue("font-variant"),l=o.getComputedStyle(n,null).getPropertyValue("font-weight"),h=o.getComputedStyle(n,null).getPropertyValue("font-size"),c=o.getComputedStyle(n,null).getPropertyValue("line-height"),u=o.getComputedStyle(n,null).getPropertyValue("font-family"),_=`${r} ${a} ${l} ${h}/${c} ${u}`,f=n.innerText;let w=s.left,C=0,v;if(e>s.left+s.width)C=f.length;else{const g=$s.getInstance();for(let p=0;p<f.length+1;p++){if(v=g.getCharWidth(f.charAt(p),_)/2,w+=v,e<w){C=p;break}w+=v}}i.setStart(n.firstChild,C),i.setEnd(n.firstChild,C)}return i}const wt=class wt{static getInstance(){return wt._INSTANCE||(wt._INSTANCE=new wt),wt._INSTANCE}constructor(){this._cache={},this._canvas=document.createElement("canvas")}getCharWidth(e,t){const i=e+t;if(this._cache[i])return this._cache[i];const n=this._canvas.getContext("2d");n.font=t;const o=n.measureText(e).width;return this._cache[i]=o,o}};wt._INSTANCE=null;let $s=wt;class Go extends Xi{constructor(e,t,i){super(),this._mouseLeaveMonitor=null,this._context=e,this.viewController=t,this.viewHelper=i,this.mouseTargetFactory=new ge(this._context,i),this._mouseDownOperation=this._register(new rg(this._context,this.viewController,this.viewHelper,this.mouseTargetFactory,(o,r)=>this._createMouseTarget(o,r),o=>this._getMouseColumn(o))),this.lastMouseLeaveTime=-1,this._height=this._context.configuration.options.get(146).height;const n=new zu(this.viewHelper.viewDomNode);this._register(n.onContextMenu(this.viewHelper.viewDomNode,o=>this._onContextMenu(o,!0))),this._register(n.onMouseMove(this.viewHelper.viewDomNode,o=>{this._onMouseMove(o),this._mouseLeaveMonitor||(this._mouseLeaveMonitor=P(this.viewHelper.viewDomNode.ownerDocument,"mousemove",r=>{this.viewHelper.viewDomNode.contains(r.target)||this._onMouseLeave(new ut(r,!1,this.viewHelper.viewDomNode))}))})),this._register(n.onMouseUp(this.viewHelper.viewDomNode,o=>this._onMouseUp(o))),this._register(n.onMouseLeave(this.viewHelper.viewDomNode,o=>this._onMouseLeave(o)));let s=0;this._register(n.onPointerDown(this.viewHelper.viewDomNode,(o,r)=>{s=r})),this._register(P(this.viewHelper.viewDomNode,Q.POINTER_UP,o=>{this._mouseDownOperation.onPointerUp()})),this._register(n.onMouseDown(this.viewHelper.viewDomNode,o=>this._onMouseDown(o,s))),this._setupMouseWheelZoomListener(),this._context.addEventHandler(this)}_setupMouseWheelZoomListener(){const e=Ll.INSTANCE;let t=0,i=zt.getZoomLevel(),n=!1,s=0;const o=a=>{if(this.viewController.emitMouseWheel(a),!this._context.configuration.options.get(76))return;const l=new bl(a);if(e.acceptStandardWheelEvent(l),e.isPhysicalMouseWheel()){if(r(a)){const h=zt.getZoomLevel(),c=l.deltaY>0?1:-1;zt.setZoomLevel(h+c),l.preventDefault(),l.stopPropagation()}}else Date.now()-t>50&&(i=zt.getZoomLevel(),n=r(a),s=0),t=Date.now(),s+=l.deltaY,n&&(zt.setZoomLevel(i+s/5),l.preventDefault(),l.stopPropagation())};this._register(P(this.viewHelper.viewDomNode,Q.MOUSE_WHEEL,o,{capture:!0,passive:!1}));function r(a){return Lt?(a.metaKey||a.ctrlKey)&&!a.shiftKey&&!a.altKey:a.ctrlKey&&!a.metaKey&&!a.shiftKey&&!a.altKey}}dispose(){this._context.removeEventHandler(this),this._mouseLeaveMonitor&&(this._mouseLeaveMonitor.dispose(),this._mouseLeaveMonitor=null),super.dispose()}onConfigurationChanged(e){if(e.hasChanged(146)){const t=this._context.configuration.options.get(146).height;this._height!==t&&(this._height=t,this._mouseDownOperation.onHeightChanged())}return!1}onCursorStateChanged(e){return this._mouseDownOperation.onCursorStateChanged(e),!1}onFocusChanged(e){return!1}getTargetAtClientPoint(e,t){const n=new Md(e,t).toPageCoordinates(j(this.viewHelper.viewDomNode)),s=zo(this.viewHelper.viewDomNode);if(n.y<s.y||n.y>s.y+s.height||n.x<s.x||n.x>s.x+s.width)return null;const o=$o(this.viewHelper.viewDomNode,s,n);return this.mouseTargetFactory.createMouseTarget(this.viewHelper.getLastRenderData(),s,n,o,null)}_createMouseTarget(e,t){let i=e.target;if(!this.viewHelper.viewDomNode.contains(i)){const n=pn(this.viewHelper.viewDomNode);n&&(i=n.elementsFromPoint(e.posx,e.posy).find(s=>this.viewHelper.viewDomNode.contains(s)))}return this.mouseTargetFactory.createMouseTarget(this.viewHelper.getLastRenderData(),e.editorPos,e.pos,e.relativePos,t?i:null)}_getMouseColumn(e){return this.mouseTargetFactory.getMouseColumn(e.relativePos)}_onContextMenu(e,t){this.viewController.emitContextMenu({event:e,target:this._createMouseTarget(e,t)})}_onMouseMove(e){this.mouseTargetFactory.mouseTargetIsWidget(e)||e.preventDefault(),!(this._mouseDownOperation.isActive()||e.timestamp<this.lastMouseLeaveTime)&&this.viewController.emitMouseMove({event:e,target:this._createMouseTarget(e,!0)})}_onMouseLeave(e){this._mouseLeaveMonitor&&(this._mouseLeaveMonitor.dispose(),this._mouseLeaveMonitor=null),this.lastMouseLeaveTime=new Date().getTime(),this.viewController.emitMouseLeave({event:e,target:null})}_onMouseUp(e){this.viewController.emitMouseUp({event:e,target:this._createMouseTarget(e,!0)})}_onMouseDown(e,t){const i=this._createMouseTarget(e,!0),n=i.type===6||i.type===7,s=i.type===2||i.type===3||i.type===4,o=i.type===3,r=this._context.configuration.options.get(110),a=i.type===8||i.type===5,l=i.type===9;let h=e.leftButton||e.middleButton;Lt&&e.leftButton&&e.ctrlKey&&(h=!1);const c=()=>{e.preventDefault(),this.viewHelper.focusTextArea()};if(h&&(n||o&&r))c(),this._mouseDownOperation.start(i.type,e,t);else if(s)e.preventDefault();else if(a){const u=i.detail;h&&this.viewHelper.shouldSuppressMouseDownOnViewZone(u.viewZoneId)&&(c(),this._mouseDownOperation.start(i.type,e,t),e.preventDefault())}else l&&this.viewHelper.shouldSuppressMouseDownOnWidget(i.detail)&&(c(),e.preventDefault());this.viewController.emitMouseDown({event:e,target:i})}}class rg extends V{constructor(e,t,i,n,s,o){super(),this._context=e,this._viewController=t,this._viewHelper=i,this._mouseTargetFactory=n,this._createMouseTarget=s,this._getMouseColumn=o,this._mouseMoveMonitor=this._register(new Gu(this._viewHelper.viewDomNode)),this._topBottomDragScrolling=this._register(new ag(this._context,this._viewHelper,this._mouseTargetFactory,(r,a,l)=>this._dispatchMouse(r,a,l))),this._mouseState=new Gs,this._currentSelection=new Me(1,1,1,1),this._isActive=!1,this._lastMouseEvent=null}dispose(){super.dispose()}isActive(){return this._isActive}_onMouseDownThenMove(e){this._lastMouseEvent=e,this._mouseState.setModifiers(e);const t=this._findMousePosition(e,!1);t&&(this._mouseState.isDragAndDrop?this._viewController.emitMouseDrag({event:e,target:t}):t.type===13&&(t.outsidePosition==="above"||t.outsidePosition==="below")?this._topBottomDragScrolling.start(t,e):(this._topBottomDragScrolling.stop(),this._dispatchMouse(t,!0,1)))}start(e,t,i){this._lastMouseEvent=t,this._mouseState.setStartedOnLineNumbers(e===3),this._mouseState.setStartButtons(t),this._mouseState.setModifiers(t);const n=this._findMousePosition(t,!0);if(!n||!n.position)return;this._mouseState.trySetCount(t.detail,n.position),t.detail=this._mouseState.count;const s=this._context.configuration.options;if(!s.get(92)&&s.get(35)&&!s.get(22)&&!this._mouseState.altKey&&t.detail<2&&!this._isActive&&!this._currentSelection.isEmpty()&&n.type===6&&n.position&&this._currentSelection.containsPosition(n.position)){this._mouseState.isDragAndDrop=!0,this._isActive=!0,this._mouseMoveMonitor.startMonitoring(this._viewHelper.viewLinesDomNode,i,t.buttons,o=>this._onMouseDownThenMove(o),o=>{const r=this._findMousePosition(this._lastMouseEvent,!1);yl(o)?this._viewController.emitMouseDropCanceled():this._viewController.emitMouseDrop({event:this._lastMouseEvent,target:r?this._createMouseTarget(this._lastMouseEvent,!0):null}),this._stop()});return}this._mouseState.isDragAndDrop=!1,this._dispatchMouse(n,t.shiftKey,1),this._isActive||(this._isActive=!0,this._mouseMoveMonitor.startMonitoring(this._viewHelper.viewLinesDomNode,i,t.buttons,o=>this._onMouseDownThenMove(o),()=>this._stop()))}_stop(){this._isActive=!1,this._topBottomDragScrolling.stop()}onHeightChanged(){this._mouseMoveMonitor.stopMonitoring()}onPointerUp(){this._mouseMoveMonitor.stopMonitoring()}onCursorStateChanged(e){this._currentSelection=e.selections[0]}_getPositionOutsideEditor(e){const t=e.editorPos,i=this._context.viewModel,n=this._context.viewLayout,s=this._getMouseColumn(e);if(e.posy<t.y){const r=t.y-e.posy,a=Math.max(n.getCurrentScrollTop()-r,0),l=gi.getZoneAtCoord(this._context,a);if(l){const c=this._helpPositionJumpOverViewZone(l);if(c)return fe.createOutsideEditor(s,c,"above",r)}const h=n.getLineNumberAtVerticalOffset(a);return fe.createOutsideEditor(s,new E(h,1),"above",r)}if(e.posy>t.y+t.height){const r=e.posy-t.y-t.height,a=n.getCurrentScrollTop()+e.relativePos.y,l=gi.getZoneAtCoord(this._context,a);if(l){const c=this._helpPositionJumpOverViewZone(l);if(c)return fe.createOutsideEditor(s,c,"below",r)}const h=n.getLineNumberAtVerticalOffset(a);return fe.createOutsideEditor(s,new E(h,i.getLineMaxColumn(h)),"below",r)}const o=n.getLineNumberAtVerticalOffset(n.getCurrentScrollTop()+e.relativePos.y);if(e.posx<t.x){const r=t.x-e.posx;return fe.createOutsideEditor(s,new E(o,1),"left",r)}if(e.posx>t.x+t.width){const r=e.posx-t.x-t.width;return fe.createOutsideEditor(s,new E(o,i.getLineMaxColumn(o)),"right",r)}return null}_findMousePosition(e,t){const i=this._getPositionOutsideEditor(e);if(i)return i;const n=this._createMouseTarget(e,t);if(!n.position)return null;if(n.type===8||n.type===5){const o=this._helpPositionJumpOverViewZone(n.detail);if(o)return fe.createViewZone(n.type,n.element,n.mouseColumn,o,n.detail)}return n}_helpPositionJumpOverViewZone(e){const t=new E(this._currentSelection.selectionStartLineNumber,this._currentSelection.selectionStartColumn),i=e.positionBefore,n=e.positionAfter;return i&&n?i.isBefore(t)?i:n:null}_dispatchMouse(e,t,i){e.position&&this._viewController.dispatchMouse({position:e.position,mouseColumn:e.mouseColumn,startedOnLineNumbers:this._mouseState.startedOnLineNumbers,revealType:i,inSelectionMode:t,mouseDownCount:this._mouseState.count,altKey:this._mouseState.altKey,ctrlKey:this._mouseState.ctrlKey,metaKey:this._mouseState.metaKey,shiftKey:this._mouseState.shiftKey,leftButton:this._mouseState.leftButton,middleButton:this._mouseState.middleButton,onInjectedText:e.type===6&&e.detail.injectedText!==null})}}class ag extends V{constructor(e,t,i,n){super(),this._context=e,this._viewHelper=t,this._mouseTargetFactory=i,this._dispatchMouse=n,this._operation=null}dispose(){super.dispose(),this.stop()}start(e,t){this._operation?this._operation.setPosition(e,t):this._operation=new dg(this._context,this._viewHelper,this._mouseTargetFactory,this._dispatchMouse,e,t)}stop(){this._operation&&(this._operation.dispose(),this._operation=null)}}class dg extends V{constructor(e,t,i,n,s,o){super(),this._context=e,this._viewHelper=t,this._mouseTargetFactory=i,this._dispatchMouse=n,this._position=s,this._mouseEvent=o,this._lastTime=Date.now(),this._animationFrameDisposable=Ui(j(o.browserEvent),()=>this._execute())}dispose(){this._animationFrameDisposable.dispose(),super.dispose()}setPosition(e,t){this._position=e,this._mouseEvent=t}_tick(){const e=Date.now(),t=e-this._lastTime;return this._lastTime=e,t}_getScrollSpeed(){const e=this._context.configuration.options.get(67),t=this._context.configuration.options.get(146).height/e,i=this._position.outsideDistance/e;return i<=1.5?Math.max(30,t*(1+i)):i<=3?Math.max(60,t*(2+i)):Math.max(200,t*(7+i))}_execute(){const e=this._context.configuration.options.get(67),t=this._getScrollSpeed(),i=this._tick(),n=t*(i/1e3)*e,s=this._position.outsidePosition==="above"?-n:n;this._context.viewModel.viewLayout.deltaScrollNow(0,s),this._viewHelper.renderNow();const o=this._context.viewLayout.getLinesViewportData(),r=this._position.outsidePosition==="above"?o.startLineNumber:o.endLineNumber;let a;{const l=zo(this._viewHelper.viewDomNode),h=this._context.configuration.options.get(146).horizontalScrollbarHeight,c=new gs(this._mouseEvent.pos.x,l.y+l.height-h-.1),u=$o(this._viewHelper.viewDomNode,l,c);a=this._mouseTargetFactory.createMouseTarget(this._viewHelper.getLastRenderData(),l,c,u,null)}(!a.position||a.position.lineNumber!==r)&&(this._position.outsidePosition==="above"?a=fe.createOutsideEditor(this._position.mouseColumn,new E(r,1),"above",this._position.outsideDistance):a=fe.createOutsideEditor(this._position.mouseColumn,new E(r,this._context.viewModel.getLineMaxColumn(r)),"below",this._position.outsideDistance)),this._dispatchMouse(a,!0,2),this._animationFrameDisposable=Ui(j(a.element),()=>this._execute())}}const Bn=class Bn{get altKey(){return this._altKey}get ctrlKey(){return this._ctrlKey}get metaKey(){return this._metaKey}get shiftKey(){return this._shiftKey}get leftButton(){return this._leftButton}get middleButton(){return this._middleButton}get startedOnLineNumbers(){return this._startedOnLineNumbers}constructor(){this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._leftButton=!1,this._middleButton=!1,this._startedOnLineNumbers=!1,this._lastMouseDownPosition=null,this._lastMouseDownPositionEqualCount=0,this._lastMouseDownCount=0,this._lastSetMouseDownCountTime=0,this.isDragAndDrop=!1}get count(){return this._lastMouseDownCount}setModifiers(e){this._altKey=e.altKey,this._ctrlKey=e.ctrlKey,this._metaKey=e.metaKey,this._shiftKey=e.shiftKey}setStartButtons(e){this._leftButton=e.leftButton,this._middleButton=e.middleButton}setStartedOnLineNumbers(e){this._startedOnLineNumbers=e}trySetCount(e,t){const i=new Date().getTime();i-this._lastSetMouseDownCountTime>Bn.CLEAR_MOUSE_DOWN_COUNT_TIME&&(e=1),this._lastSetMouseDownCountTime=i,e>this._lastMouseDownCount+1&&(e=this._lastMouseDownCount+1),this._lastMouseDownPosition&&this._lastMouseDownPosition.equals(t)?this._lastMouseDownPositionEqualCount++:this._lastMouseDownPositionEqualCount=1,this._lastMouseDownPosition=t,this._lastMouseDownCount=Math.min(e,this._lastMouseDownPositionEqualCount)}};Bn.CLEAR_MOUSE_DOWN_COUNT_TIME=400;let Gs=Bn;const Yt=class Yt{constructor(e,t,i,n,s){this.value=e,this.selectionStart=t,this.selectionEnd=i,this.selection=n,this.newlineCountBeforeSelection=s}toString(){return`[ <${this.value}>, selectionStart: ${this.selectionStart}, selectionEnd: ${this.selectionEnd}]`}static readFromTextArea(e,t){const i=e.getValue(),n=e.getSelectionStart(),s=e.getSelectionEnd();let o;if(t){const r=i.substring(0,n),a=t.value.substring(0,t.selectionStart);r===a&&(o=t.newlineCountBeforeSelection)}return new Yt(i,n,s,null,o)}collapseSelection(){return this.selectionStart===this.value.length?this:new Yt(this.value,this.value.length,this.value.length,null,void 0)}writeToTextArea(e,t,i){t.setValue(e,this.value),i&&t.setSelectionRange(e,this.selectionStart,this.selectionEnd)}deduceEditorPosition(e){var n,s,o,r;if(e<=this.selectionStart){const a=this.value.substring(e,this.selectionStart);return this._finishDeduceEditorPosition(((n=this.selection)==null?void 0:n.getStartPosition())??null,a,-1)}if(e>=this.selectionEnd){const a=this.value.substring(this.selectionEnd,e);return this._finishDeduceEditorPosition(((s=this.selection)==null?void 0:s.getEndPosition())??null,a,1)}const t=this.value.substring(this.selectionStart,e);if(t.indexOf("…")===-1)return this._finishDeduceEditorPosition(((o=this.selection)==null?void 0:o.getStartPosition())??null,t,1);const i=this.value.substring(e,this.selectionEnd);return this._finishDeduceEditorPosition(((r=this.selection)==null?void 0:r.getEndPosition())??null,i,-1)}_finishDeduceEditorPosition(e,t,i){let n=0,s=-1;for(;(s=t.indexOf(`
`,s+1))!==-1;)n++;return[e,i*t.length,n]}static deduceInput(e,t,i){if(!e)return{text:"",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0};const n=Math.min(lr(e.value,t.value),e.selectionStart,t.selectionStart),s=Math.min(hr(e.value,t.value),e.value.length-e.selectionEnd,t.value.length-t.selectionEnd);e.value.substring(n,e.value.length-s);const o=t.value.substring(n,t.value.length-s),r=e.selectionStart-n,a=e.selectionEnd-n,l=t.selectionStart-n,h=t.selectionEnd-n;if(l===h){const u=e.selectionStart-n;return{text:o,replacePrevCharCnt:u,replaceNextCharCnt:0,positionDelta:0}}const c=a-r;return{text:o,replacePrevCharCnt:c,replaceNextCharCnt:0,positionDelta:0}}static deduceAndroidCompositionInput(e,t){if(!e)return{text:"",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0};if(e.value===t.value)return{text:"",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:t.selectionEnd-e.selectionEnd};const i=Math.min(lr(e.value,t.value),e.selectionEnd),n=Math.min(hr(e.value,t.value),e.value.length-e.selectionEnd),s=e.value.substring(i,e.value.length-n),o=t.value.substring(i,t.value.length-n);e.selectionStart-i;const r=e.selectionEnd-i;t.selectionStart-i;const a=t.selectionEnd-i;return{text:o,replacePrevCharCnt:r,replaceNextCharCnt:s.length-r,positionDelta:a-o.length}}};Yt.EMPTY=new Yt("",0,0,null,void 0);let me=Yt;class Gt{static _getPageOfLine(e,t){return Math.floor((e-1)/t)}static _getRangeForPage(e,t){const i=e*t,n=i+1,s=i+t;return new W(n,1,s+1,1)}static fromEditorSelection(e,t,i,n){const o=Gt._getPageOfLine(t.startLineNumber,i),r=Gt._getRangeForPage(o,i),a=Gt._getPageOfLine(t.endLineNumber,i),l=Gt._getRangeForPage(a,i);let h=r.intersectRanges(new W(1,1,t.startLineNumber,t.startColumn));if(n&&e.getValueLengthInRange(h,1)>500){const v=e.modifyPosition(h.getEndPosition(),-500);h=W.fromPositions(v,h.getEndPosition())}const c=e.getValueInRange(h,1),u=e.getLineCount(),_=e.getLineMaxColumn(u);let f=l.intersectRanges(new W(t.endLineNumber,t.endColumn,u,_));if(n&&e.getValueLengthInRange(f,1)>500){const v=e.modifyPosition(f.getStartPosition(),500);f=W.fromPositions(f.getStartPosition(),v)}const w=e.getValueInRange(f,1);let C;if(o===a||o+1===a)C=e.getValueInRange(t,1);else{const v=r.intersectRanges(t),g=l.intersectRanges(t);C=e.getValueInRange(v,1)+"…"+e.getValueInRange(g,1)}return n&&C.length>2*500&&(C=C.substring(0,500)+"…"+C.substring(C.length-500,C.length)),new me(c+C+w,c.length,c.length+C.length,t,h.endLineNumber-h.startLineNumber)}}var lg=function(d,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(d,e,t,i);else for(var r=d.length-1;r>=0;r--)(o=d[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},Yr=function(d,e){return function(t,i){e(t,i,d)}},Dn;(function(d){d.Tap="-monaco-textarea-synthetic-tap"})(Dn||(Dn={}));const hg={forceCopyWithSyntaxHighlighting:!1},Un=class Un{constructor(){this._lastState=null}set(e,t){this._lastState={lastCopiedValue:e,data:t}}get(e){return this._lastState&&this._lastState.lastCopiedValue===e?this._lastState.data:(this._lastState=null,null)}};Un.INSTANCE=new Un;let Nn=Un;class cg{constructor(){this._lastTypeTextLength=0}handleCompositionUpdate(e){e=e||"";const t={text:e,replacePrevCharCnt:this._lastTypeTextLength,replaceNextCharCnt:0,positionDelta:0};return this._lastTypeTextLength=e.length,t}}let js=class extends V{get textAreaState(){return this._textAreaState}constructor(e,t,i,n,s,o){super(),this._host=e,this._textArea=t,this._OS=i,this._browser=n,this._accessibilityService=s,this._logService=o,this._onFocus=this._register(new H),this.onFocus=this._onFocus.event,this._onBlur=this._register(new H),this.onBlur=this._onBlur.event,this._onKeyDown=this._register(new H),this.onKeyDown=this._onKeyDown.event,this._onKeyUp=this._register(new H),this.onKeyUp=this._onKeyUp.event,this._onCut=this._register(new H),this.onCut=this._onCut.event,this._onPaste=this._register(new H),this.onPaste=this._onPaste.event,this._onType=this._register(new H),this.onType=this._onType.event,this._onCompositionStart=this._register(new H),this.onCompositionStart=this._onCompositionStart.event,this._onCompositionUpdate=this._register(new H),this.onCompositionUpdate=this._onCompositionUpdate.event,this._onCompositionEnd=this._register(new H),this.onCompositionEnd=this._onCompositionEnd.event,this._onSelectionChangeRequest=this._register(new H),this.onSelectionChangeRequest=this._onSelectionChangeRequest.event,this._asyncFocusGainWriteScreenReaderContent=this._register(new Sl),this._asyncTriggerCut=this._register(new ct(()=>this._onCut.fire(),0)),this._textAreaState=me.EMPTY,this._selectionChangeListener=null,this._accessibilityService.isScreenReaderOptimized()&&this.writeNativeTextAreaContent("ctor"),this._register(Ri.runAndSubscribe(this._accessibilityService.onDidChangeScreenReaderOptimized,()=>{this._accessibilityService.isScreenReaderOptimized()&&!this._asyncFocusGainWriteScreenReaderContent.value?this._asyncFocusGainWriteScreenReaderContent.value=this._register(new ct(()=>this.writeNativeTextAreaContent("asyncFocusGain"),0)):this._asyncFocusGainWriteScreenReaderContent.clear()})),this._hasFocus=!1,this._currentComposition=null;let r=null;this._register(this._textArea.onKeyDown(a=>{const l=new Rs(a);(l.keyCode===114||this._currentComposition&&l.keyCode===1)&&l.stopPropagation(),l.equals(9)&&l.preventDefault(),r=l,this._onKeyDown.fire(l)})),this._register(this._textArea.onKeyUp(a=>{const l=new Rs(a);this._onKeyUp.fire(l)})),this._register(this._textArea.onCompositionStart(a=>{const l=new cg;if(this._currentComposition){this._currentComposition=l;return}if(this._currentComposition=l,this._OS===2&&r&&r.equals(114)&&this._textAreaState.selectionStart===this._textAreaState.selectionEnd&&this._textAreaState.selectionStart>0&&this._textAreaState.value.substr(this._textAreaState.selectionStart-1,1)===a.data&&(r.code==="ArrowRight"||r.code==="ArrowLeft")){l.handleCompositionUpdate("x"),this._onCompositionStart.fire({data:a.data});return}if(this._browser.isAndroid){this._onCompositionStart.fire({data:a.data});return}this._onCompositionStart.fire({data:a.data})})),this._register(this._textArea.onCompositionUpdate(a=>{const l=this._currentComposition;if(!l)return;if(this._browser.isAndroid){const c=me.readFromTextArea(this._textArea,this._textAreaState),u=me.deduceAndroidCompositionInput(this._textAreaState,c);this._textAreaState=c,this._onType.fire(u),this._onCompositionUpdate.fire(a);return}const h=l.handleCompositionUpdate(a.data);this._textAreaState=me.readFromTextArea(this._textArea,this._textAreaState),this._onType.fire(h),this._onCompositionUpdate.fire(a)})),this._register(this._textArea.onCompositionEnd(a=>{const l=this._currentComposition;if(!l)return;if(this._currentComposition=null,this._browser.isAndroid){const c=me.readFromTextArea(this._textArea,this._textAreaState),u=me.deduceAndroidCompositionInput(this._textAreaState,c);this._textAreaState=c,this._onType.fire(u),this._onCompositionEnd.fire();return}const h=l.handleCompositionUpdate(a.data);this._textAreaState=me.readFromTextArea(this._textArea,this._textAreaState),this._onType.fire(h),this._onCompositionEnd.fire()})),this._register(this._textArea.onInput(a=>{if(this._textArea.setIgnoreSelectionChangeTime("received input event"),this._currentComposition)return;const l=me.readFromTextArea(this._textArea,this._textAreaState),h=me.deduceInput(this._textAreaState,l,this._OS===2);h.replacePrevCharCnt===0&&h.text.length===1&&($a(h.text.charCodeAt(0))||h.text.charCodeAt(0)===127)||(this._textAreaState=l,(h.text!==""||h.replacePrevCharCnt!==0||h.replaceNextCharCnt!==0||h.positionDelta!==0)&&this._onType.fire(h))})),this._register(this._textArea.onCut(a=>{this._textArea.setIgnoreSelectionChangeTime("received cut event"),this._ensureClipboardGetsEditorSelection(a),this._asyncTriggerCut.schedule()})),this._register(this._textArea.onCopy(a=>{this._ensureClipboardGetsEditorSelection(a)})),this._register(this._textArea.onPaste(a=>{if(this._textArea.setIgnoreSelectionChangeTime("received paste event"),a.preventDefault(),!a.clipboardData)return;let[l,h]=Qr.getTextData(a.clipboardData);l&&(h=h||Nn.INSTANCE.get(l),this._onPaste.fire({text:l,metadata:h}))})),this._register(this._textArea.onFocus(()=>{const a=this._hasFocus;this._setHasFocus(!0),this._accessibilityService.isScreenReaderOptimized()&&this._browser.isSafari&&!a&&this._hasFocus&&(this._asyncFocusGainWriteScreenReaderContent.value||(this._asyncFocusGainWriteScreenReaderContent.value=new ct(()=>this.writeNativeTextAreaContent("asyncFocusGain"),0)),this._asyncFocusGainWriteScreenReaderContent.value.schedule())})),this._register(this._textArea.onBlur(()=>{this._currentComposition&&(this._currentComposition=null,this.writeNativeTextAreaContent("blurWithoutCompositionEnd"),this._onCompositionEnd.fire()),this._setHasFocus(!1)})),this._register(this._textArea.onSyntheticTap(()=>{this._browser.isAndroid&&this._currentComposition&&(this._currentComposition=null,this.writeNativeTextAreaContent("tapWithoutCompositionEnd"),this._onCompositionEnd.fire())}))}_installSelectionChangeListener(){let e=0;return P(this._textArea.ownerDocument,"selectionchange",t=>{if($t.onSelectionChange(),!this._hasFocus||this._currentComposition||!this._browser.isChrome)return;const i=Date.now(),n=i-e;if(e=i,n<5)return;const s=i-this._textArea.getIgnoreSelectionChangeTime();if(this._textArea.resetSelectionChangeTime(),s<100||!this._textAreaState.selection)return;const o=this._textArea.getValue();if(this._textAreaState.value!==o)return;const r=this._textArea.getSelectionStart(),a=this._textArea.getSelectionEnd();if(this._textAreaState.selectionStart===r&&this._textAreaState.selectionEnd===a)return;const l=this._textAreaState.deduceEditorPosition(r),h=this._host.deduceModelPosition(l[0],l[1],l[2]),c=this._textAreaState.deduceEditorPosition(a),u=this._host.deduceModelPosition(c[0],c[1],c[2]),_=new Me(h.lineNumber,h.column,u.lineNumber,u.column);this._onSelectionChangeRequest.fire(_)})}dispose(){super.dispose(),this._selectionChangeListener&&(this._selectionChangeListener.dispose(),this._selectionChangeListener=null)}focusTextArea(){this._setHasFocus(!0),this.refreshFocusState()}isFocused(){return this._hasFocus}refreshFocusState(){this._setHasFocus(this._textArea.hasFocus())}_setHasFocus(e){this._hasFocus!==e&&(this._hasFocus=e,this._selectionChangeListener&&(this._selectionChangeListener.dispose(),this._selectionChangeListener=null),this._hasFocus&&(this._selectionChangeListener=this._installSelectionChangeListener()),this._hasFocus&&this.writeNativeTextAreaContent("focusgain"),this._hasFocus?this._onFocus.fire():this._onBlur.fire())}_setAndWriteTextAreaState(e,t){this._hasFocus||(t=t.collapseSelection()),t.writeToTextArea(e,this._textArea,this._hasFocus),this._textAreaState=t}writeNativeTextAreaContent(e){!this._accessibilityService.isScreenReaderOptimized()&&e==="render"||this._currentComposition||(this._logService.trace(`writeTextAreaState(reason: ${e})`),this._setAndWriteTextAreaState(e,this._host.getScreenReaderContent()))}_ensureClipboardGetsEditorSelection(e){const t=this._host.getDataToCopy(),i={version:1,isFromEmptySelection:t.isFromEmptySelection,multicursorText:t.multicursorText,mode:t.mode};Nn.INSTANCE.set(this._browser.isFirefox?t.text.replace(/\r\n/g,`
`):t.text,i),e.preventDefault(),e.clipboardData&&Qr.setTextData(e.clipboardData,t.text,t.html,i)}};js=lg([Yr(4,Ot),Yr(5,ss)],js);const Qr={getTextData(d){const e=d.getData(Oi.text);let t=null;const i=d.getData("vscode-editor-data");if(typeof i=="string")try{t=JSON.parse(i),t.version!==1&&(t=null)}catch{}return e.length===0&&t===null&&d.files.length>0?[Array.prototype.slice.call(d.files,0).map(s=>s.name).join(`
`),null]:[e,t]},setTextData(d,e,t,i){d.setData(Oi.text,e),typeof t=="string"&&d.setData("text/html",t),d.setData("vscode-editor-data",JSON.stringify(i))}};class ug extends V{get ownerDocument(){return this._actual.ownerDocument}constructor(e){super(),this._actual=e,this.onKeyDown=this._register(new xe(this._actual,"keydown")).event,this.onKeyUp=this._register(new xe(this._actual,"keyup")).event,this.onCompositionStart=this._register(new xe(this._actual,"compositionstart")).event,this.onCompositionUpdate=this._register(new xe(this._actual,"compositionupdate")).event,this.onCompositionEnd=this._register(new xe(this._actual,"compositionend")).event,this.onBeforeInput=this._register(new xe(this._actual,"beforeinput")).event,this.onInput=this._register(new xe(this._actual,"input")).event,this.onCut=this._register(new xe(this._actual,"cut")).event,this.onCopy=this._register(new xe(this._actual,"copy")).event,this.onPaste=this._register(new xe(this._actual,"paste")).event,this.onFocus=this._register(new xe(this._actual,"focus")).event,this.onBlur=this._register(new xe(this._actual,"blur")).event,this._onSyntheticTap=this._register(new H),this.onSyntheticTap=this._onSyntheticTap.event,this._ignoreSelectionChangeTime=0,this._register(this.onKeyDown(()=>$t.onKeyDown())),this._register(this.onBeforeInput(()=>$t.onBeforeInput())),this._register(this.onInput(()=>$t.onInput())),this._register(this.onKeyUp(()=>$t.onKeyUp())),this._register(P(this._actual,Dn.Tap,()=>this._onSyntheticTap.fire()))}hasFocus(){const e=pn(this._actual);return e?e.activeElement===this._actual:this._actual.isConnected?xt()===this._actual:!1}setIgnoreSelectionChangeTime(e){this._ignoreSelectionChangeTime=Date.now()}getIgnoreSelectionChangeTime(){return this._ignoreSelectionChangeTime}resetSelectionChangeTime(){this._ignoreSelectionChangeTime=0}getValue(){return this._actual.value}setValue(e,t){const i=this._actual;i.value!==t&&(this.setIgnoreSelectionChangeTime("setValue"),i.value=t)}getSelectionStart(){return this._actual.selectionDirection==="backward"?this._actual.selectionEnd:this._actual.selectionStart}getSelectionEnd(){return this._actual.selectionDirection==="backward"?this._actual.selectionStart:this._actual.selectionEnd}setSelectionRange(e,t,i){const n=this._actual;let s=null;const o=pn(n);o?s=o.activeElement:s=xt();const r=j(s),a=s===n,l=n.selectionStart,h=n.selectionEnd;if(a&&l===t&&h===i){Et&&r.parent!==r&&n.focus();return}if(a){this.setIgnoreSelectionChangeTime("setSelectionRange"),n.setSelectionRange(t,i),Et&&r.parent!==r&&n.focus();return}try{const c=Dl(n);this.setIgnoreSelectionChangeTime("setSelectionRange"),n.focus(),n.setSelectionRange(t,i),Nl(n,c)}catch{}}}class gg extends Go{constructor(e,t,i){super(e,t,i),this._register(So.addTarget(this.viewHelper.linesContentDomNode)),this._register(P(this.viewHelper.linesContentDomNode,tt.Tap,s=>this.onTap(s))),this._register(P(this.viewHelper.linesContentDomNode,tt.Change,s=>this.onChange(s))),this._register(P(this.viewHelper.linesContentDomNode,tt.Contextmenu,s=>this._onContextMenu(new ut(s,!1,this.viewHelper.viewDomNode),!1))),this._lastPointerType="mouse",this._register(P(this.viewHelper.linesContentDomNode,"pointerdown",s=>{const o=s.pointerType;if(o==="mouse"){this._lastPointerType="mouse";return}else o==="touch"?this._lastPointerType="touch":this._lastPointerType="pen"}));const n=new $u(this.viewHelper.viewDomNode);this._register(n.onPointerMove(this.viewHelper.viewDomNode,s=>this._onMouseMove(s))),this._register(n.onPointerUp(this.viewHelper.viewDomNode,s=>this._onMouseUp(s))),this._register(n.onPointerLeave(this.viewHelper.viewDomNode,s=>this._onMouseLeave(s))),this._register(n.onPointerDown(this.viewHelper.viewDomNode,(s,o)=>this._onMouseDown(s,o)))}onTap(e){!e.initialTarget||!this.viewHelper.linesContentDomNode.contains(e.initialTarget)||(e.preventDefault(),this.viewHelper.focusTextArea(),this._dispatchGesture(e,!1))}onChange(e){this._lastPointerType==="touch"&&this._context.viewModel.viewLayout.deltaScrollNow(-e.translationX,-e.translationY),this._lastPointerType==="pen"&&this._dispatchGesture(e,!0)}_dispatchGesture(e,t){const i=this._createMouseTarget(new ut(e,!1,this.viewHelper.viewDomNode),!1);i.position&&this.viewController.dispatchMouse({position:i.position,mouseColumn:i.position.column,startedOnLineNumbers:!1,revealType:1,mouseDownCount:e.tapCount,inSelectionMode:t,altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,leftButton:!1,middleButton:!1,onInjectedText:i.type===6&&i.detail.injectedText!==null})}_onMouseDown(e,t){e.browserEvent.pointerType!=="touch"&&super._onMouseDown(e,t)}}class fg extends Go{constructor(e,t,i){super(e,t,i),this._register(So.addTarget(this.viewHelper.linesContentDomNode)),this._register(P(this.viewHelper.linesContentDomNode,tt.Tap,n=>this.onTap(n))),this._register(P(this.viewHelper.linesContentDomNode,tt.Change,n=>this.onChange(n))),this._register(P(this.viewHelper.linesContentDomNode,tt.Contextmenu,n=>this._onContextMenu(new ut(n,!1,this.viewHelper.viewDomNode),!1)))}onTap(e){e.preventDefault(),this.viewHelper.focusTextArea();const t=this._createMouseTarget(new ut(e,!1,this.viewHelper.viewDomNode),!1);if(t.position){const i=document.createEvent("CustomEvent");i.initEvent(Dn.Tap,!1,!0),this.viewHelper.dispatchTextAreaEvent(i),this.viewController.moveTo(t.position,1)}}onChange(e){this._context.viewModel.viewLayout.deltaScrollNow(-e.translationX,-e.translationY)}}class mg extends V{constructor(e,t,i){super(),(Ga||Rl&&xl)&&Ml.pointerEvents?this.handler=this._register(new gg(e,t,i)):Xn.TouchEvent?this.handler=this._register(new fg(e,t,i)):this.handler=this._register(new Go(e,t,i))}getTargetAtClientPoint(e,t){return this.handler.getTargetAtClientPoint(e,t)}}class Pt extends Xi{}const zn=class zn extends Pt{constructor(e){super(),this._context=e,this._readConfig(),this._lastCursorModelPosition=new E(1,1),this._renderResult=null,this._activeLineNumber=1,this._context.addEventHandler(this)}_readConfig(){const e=this._context.configuration.options;this._lineHeight=e.get(67);const t=e.get(68);this._renderLineNumbers=t.renderType,this._renderCustomLineNumbers=t.renderFn,this._renderFinalNewline=e.get(96);const i=e.get(146);this._lineNumbersLeft=i.lineNumbersLeft,this._lineNumbersWidth=i.lineNumbersWidth}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){return this._readConfig(),!0}onCursorStateChanged(e){const t=e.selections[0].getPosition();this._lastCursorModelPosition=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(t);let i=!1;return this._activeLineNumber!==t.lineNumber&&(this._activeLineNumber=t.lineNumber,i=!0),(this._renderLineNumbers===2||this._renderLineNumbers===3)&&(i=!0),i}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}onDecorationsChanged(e){return e.affectsLineNumber}_getLineRenderLineNumber(e){const t=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new E(e,1));if(t.column!==1)return"";const i=t.lineNumber;if(this._renderCustomLineNumbers)return this._renderCustomLineNumbers(i);if(this._renderLineNumbers===2){const n=Math.abs(this._lastCursorModelPosition.lineNumber-i);return n===0?'<span class="relative-current-line-number">'+i+"</span>":String(n)}if(this._renderLineNumbers===3){if(this._lastCursorModelPosition.lineNumber===i||i%10===0)return String(i);const n=this._context.viewModel.getLineCount();return i===n?String(i):""}return String(i)}prepareRender(e){if(this._renderLineNumbers===0){this._renderResult=null;return}const t=Jn?this._lineHeight%2===0?" lh-even":" lh-odd":"",i=e.visibleRange.startLineNumber,n=e.visibleRange.endLineNumber,s=this._context.viewModel.getDecorationsInViewport(e.visibleRange).filter(l=>!!l.options.lineNumberClassName);s.sort((l,h)=>W.compareRangesUsingEnds(l.range,h.range));let o=0;const r=this._context.viewModel.getLineCount(),a=[];for(let l=i;l<=n;l++){const h=l-i;let c=this._getLineRenderLineNumber(l),u="";for(;o<s.length&&s[o].range.endLineNumber<l;)o++;for(let _=o;_<s.length;_++){const{range:f,options:w}=s[_];f.startLineNumber<=l&&(u+=" "+w.lineNumberClassName)}if(!c&&!u){a[h]="";continue}l===r&&this._context.viewModel.getLineLength(l)===0&&(this._renderFinalNewline==="off"&&(c=""),this._renderFinalNewline==="dimmed"&&(u+=" dimmed-line-number")),l===this._activeLineNumber&&(u+=" active-line-number"),a[h]=`<div class="${zn.CLASS_NAME}${t}${u}" style="left:${this._lineNumbersLeft}px;width:${this._lineNumbersWidth}px;">${c}</div>`}this._renderResult=a}render(e,t){if(!this._renderResult)return"";const i=t-e;return i<0||i>=this._renderResult.length?"":this._renderResult[i]}};zn.CLASS_NAME="line-numbers";let Mn=zn;At((d,e)=>{const t=d.getColor(Nh),i=d.getColor(Mh);i?e.addRule(`.monaco-editor .line-numbers.dimmed-line-number { color: ${i}; }`):t&&e.addRule(`.monaco-editor .line-numbers.dimmed-line-number { color: ${t.transparent(.4)}; }`)});const Qt=class Qt extends be{constructor(e){super(e);const t=this._context.configuration.options,i=t.get(146);this._canUseLayerHinting=!t.get(32),this._contentLeft=i.contentLeft,this._glyphMarginLeft=i.glyphMarginLeft,this._glyphMarginWidth=i.glyphMarginWidth,this._domNode=$(document.createElement("div")),this._domNode.setClassName(Qt.OUTER_CLASS_NAME),this._domNode.setPosition("absolute"),this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true"),this._glyphMarginBackgroundDomNode=$(document.createElement("div")),this._glyphMarginBackgroundDomNode.setClassName(Qt.CLASS_NAME),this._domNode.appendChild(this._glyphMarginBackgroundDomNode)}dispose(){super.dispose()}getDomNode(){return this._domNode}onConfigurationChanged(e){const t=this._context.configuration.options,i=t.get(146);return this._canUseLayerHinting=!t.get(32),this._contentLeft=i.contentLeft,this._glyphMarginLeft=i.glyphMarginLeft,this._glyphMarginWidth=i.glyphMarginWidth,!0}onScrollChanged(e){return super.onScrollChanged(e)||e.scrollTopChanged}prepareRender(e){}render(e){this._domNode.setLayerHinting(this._canUseLayerHinting),this._domNode.setContain("strict");const t=e.scrollTop-e.bigNumbersDelta;this._domNode.setTop(-t);const i=Math.min(e.scrollHeight,1e6);this._domNode.setHeight(i),this._domNode.setWidth(this._contentLeft),this._glyphMarginBackgroundDomNode.setLeft(this._glyphMarginLeft),this._glyphMarginBackgroundDomNode.setWidth(this._glyphMarginWidth),this._glyphMarginBackgroundDomNode.setHeight(i)}};Qt.CLASS_NAME="glyph-margin",Qt.OUTER_CLASS_NAME="margin";let Rn=Qt;var _g=function(d,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(d,e,t,i);else for(var r=d.length-1;r>=0;r--)(o=d[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},Xr=function(d,e){return function(t,i){e(t,i,d)}};class pg{constructor(e,t,i,n,s){this._context=e,this.modelLineNumber=t,this.distanceToModelLineStart=i,this.widthOfHiddenLineTextBefore=n,this.distanceToModelLineEnd=s,this._visibleTextAreaBrand=void 0,this.startPosition=null,this.endPosition=null,this.visibleTextareaStart=null,this.visibleTextareaEnd=null,this._previousPresentation=null}prepareRender(e){const t=new E(this.modelLineNumber,this.distanceToModelLineStart+1),i=new E(this.modelLineNumber,this._context.viewModel.model.getLineMaxColumn(this.modelLineNumber)-this.distanceToModelLineEnd);this.startPosition=this._context.viewModel.coordinatesConverter.convertModelPositionToViewPosition(t),this.endPosition=this._context.viewModel.coordinatesConverter.convertModelPositionToViewPosition(i),this.startPosition.lineNumber===this.endPosition.lineNumber?(this.visibleTextareaStart=e.visibleRangeForPosition(this.startPosition),this.visibleTextareaEnd=e.visibleRangeForPosition(this.endPosition)):(this.visibleTextareaStart=null,this.visibleTextareaEnd=null)}definePresentation(e){return this._previousPresentation||(e?this._previousPresentation=e:this._previousPresentation={foreground:1,italic:!1,bold:!1,underline:!1,strikethrough:!1}),this._previousPresentation}}const vs=Et;let Zs=class extends be{constructor(e,t,i,n,s){super(e),this._keybindingService=n,this._instantiationService=s,this._primaryCursorPosition=new E(1,1),this._primaryCursorVisibleRange=null,this._viewController=t,this._visibleRangeProvider=i,this._scrollLeft=0,this._scrollTop=0;const o=this._context.configuration.options,r=o.get(146);this._setAccessibilityOptions(o),this._contentLeft=r.contentLeft,this._contentWidth=r.contentWidth,this._contentHeight=r.height,this._fontInfo=o.get(50),this._lineHeight=o.get(67),this._emptySelectionClipboard=o.get(37),this._copyWithSyntaxHighlighting=o.get(25),this._visibleTextArea=null,this._selections=[new Me(1,1,1,1)],this._modelSelections=[new Me(1,1,1,1)],this._lastRenderPosition=null,this.textArea=$(document.createElement("textarea")),Ve.write(this.textArea,7),this.textArea.setClassName(`inputarea ${Xt}`),this.textArea.setAttribute("wrap",this._textAreaWrapping&&!this._visibleTextArea?"on":"off");const{tabSize:a}=this._context.viewModel.model.getOptions();this.textArea.domNode.style.tabSize=`${a*this._fontInfo.spaceWidth}px`,this.textArea.setAttribute("autocorrect","off"),this.textArea.setAttribute("autocapitalize","off"),this.textArea.setAttribute("autocomplete","off"),this.textArea.setAttribute("spellcheck","false"),this.textArea.setAttribute("aria-label",this._getAriaLabel(o)),this.textArea.setAttribute("aria-required",o.get(5)?"true":"false"),this.textArea.setAttribute("tabindex",String(o.get(125))),this.textArea.setAttribute("role","textbox"),this.textArea.setAttribute("aria-roledescription",T("editor","editor")),this.textArea.setAttribute("aria-multiline","true"),this.textArea.setAttribute("aria-autocomplete",o.get(92)?"none":"both"),this._ensureReadOnlyAttribute(),this.textAreaCover=$(document.createElement("div")),this.textAreaCover.setPosition("absolute");const l={getLineCount:()=>this._context.viewModel.getLineCount(),getLineMaxColumn:u=>this._context.viewModel.getLineMaxColumn(u),getValueInRange:(u,_)=>this._context.viewModel.getValueInRange(u,_),getValueLengthInRange:(u,_)=>this._context.viewModel.getValueLengthInRange(u,_),modifyPosition:(u,_)=>this._context.viewModel.modifyPosition(u,_)},h={getDataToCopy:()=>{const u=this._context.viewModel.getPlainTextToCopy(this._modelSelections,this._emptySelectionClipboard,ja),_=this._context.viewModel.model.getEOL(),f=this._emptySelectionClipboard&&this._modelSelections.length===1&&this._modelSelections[0].isEmpty(),w=Array.isArray(u)?u:null,C=Array.isArray(u)?u.join(_):u;let v,g=null;if(hg.forceCopyWithSyntaxHighlighting||this._copyWithSyntaxHighlighting&&C.length<65536){const p=this._context.viewModel.getRichTextToCopy(this._modelSelections,this._emptySelectionClipboard);p&&(v=p.html,g=p.mode)}return{isFromEmptySelection:f,multicursorText:w,text:C,html:v,mode:g}},getScreenReaderContent:()=>{if(this._accessibilitySupport===1){const u=this._selections[0];if(Lt&&u.isEmpty()){const f=u.getStartPosition();let w=this._getWordBeforePosition(f);if(w.length===0&&(w=this._getCharacterBeforePosition(f)),w.length>0)return new me(w,w.length,w.length,W.fromPositions(f),0)}if(Lt&&!u.isEmpty()&&l.getValueLengthInRange(u,0)<500){const f=l.getValueInRange(u,0);return new me(f,0,f.length,u,0)}if(zi&&!u.isEmpty()){const f="vscode-placeholder";return new me(f,0,f.length,null,void 0)}return me.EMPTY}if(cr){const u=this._selections[0];if(u.isEmpty()){const _=u.getStartPosition(),[f,w]=this._getAndroidWordAtPosition(_);if(f.length>0)return new me(f,w,w,W.fromPositions(_),0)}return me.EMPTY}return Gt.fromEditorSelection(l,this._selections[0],this._accessibilityPageSize,this._accessibilitySupport===0)},deduceModelPosition:(u,_,f)=>this._context.viewModel.deduceModelPositionRelativeToViewPosition(u,_,f)},c=this._register(new ug(this.textArea.domNode));this._textAreaInput=this._register(this._instantiationService.createInstance(js,h,c,El,{isAndroid:cr,isChrome:Tl,isFirefox:Et,isSafari:zi})),this._register(this._textAreaInput.onKeyDown(u=>{this._viewController.emitKeyDown(u)})),this._register(this._textAreaInput.onKeyUp(u=>{this._viewController.emitKeyUp(u)})),this._register(this._textAreaInput.onPaste(u=>{let _=!1,f=null,w=null;u.metadata&&(_=this._emptySelectionClipboard&&!!u.metadata.isFromEmptySelection,f=typeof u.metadata.multicursorText<"u"?u.metadata.multicursorText:null,w=u.metadata.mode),this._viewController.paste(u.text,_,f,w)})),this._register(this._textAreaInput.onCut(()=>{this._viewController.cut()})),this._register(this._textAreaInput.onType(u=>{u.replacePrevCharCnt||u.replaceNextCharCnt||u.positionDelta?this._viewController.compositionType(u.text,u.replacePrevCharCnt,u.replaceNextCharCnt,u.positionDelta):this._viewController.type(u.text)})),this._register(this._textAreaInput.onSelectionChangeRequest(u=>{this._viewController.setSelection(u)})),this._register(this._textAreaInput.onCompositionStart(u=>{const _=this.textArea.domNode,f=this._modelSelections[0],{distanceToModelLineStart:w,widthOfHiddenTextBefore:C}=(()=>{const g=_.value.substring(0,Math.min(_.selectionStart,_.selectionEnd)),p=g.lastIndexOf(`
`),m=g.substring(p+1),b=m.lastIndexOf("	"),L=m.length-b-1,y=f.getStartPosition(),S=Math.min(y.column-1,L),D=y.column-1-S,x=m.substring(0,m.length-S),{tabSize:M}=this._context.viewModel.model.getOptions(),R=vg(this.textArea.domNode.ownerDocument,x,this._fontInfo,M);return{distanceToModelLineStart:D,widthOfHiddenTextBefore:R}})(),{distanceToModelLineEnd:v}=(()=>{const g=_.value.substring(Math.max(_.selectionStart,_.selectionEnd)),p=g.indexOf(`
`),m=p===-1?g:g.substring(0,p),b=m.indexOf("	"),L=b===-1?m.length:m.length-b-1,y=f.getEndPosition(),S=Math.min(this._context.viewModel.model.getLineMaxColumn(y.lineNumber)-y.column,L);return{distanceToModelLineEnd:this._context.viewModel.model.getLineMaxColumn(y.lineNumber)-y.column-S}})();this._context.viewModel.revealRange("keyboard",!0,W.fromPositions(this._selections[0].getStartPosition()),0,1),this._visibleTextArea=new pg(this._context,f.startLineNumber,w,C,v),this.textArea.setAttribute("wrap",this._textAreaWrapping&&!this._visibleTextArea?"on":"off"),this._visibleTextArea.prepareRender(this._visibleRangeProvider),this._render(),this.textArea.setClassName(`inputarea ${Xt} ime-input`),this._viewController.compositionStart(),this._context.viewModel.onCompositionStart()})),this._register(this._textAreaInput.onCompositionUpdate(u=>{this._visibleTextArea&&(this._visibleTextArea.prepareRender(this._visibleRangeProvider),this._render())})),this._register(this._textAreaInput.onCompositionEnd(()=>{this._visibleTextArea=null,this.textArea.setAttribute("wrap",this._textAreaWrapping&&!this._visibleTextArea?"on":"off"),this._render(),this.textArea.setClassName(`inputarea ${Xt}`),this._viewController.compositionEnd(),this._context.viewModel.onCompositionEnd()})),this._register(this._textAreaInput.onFocus(()=>{this._context.viewModel.setHasFocus(!0)})),this._register(this._textAreaInput.onBlur(()=>{this._context.viewModel.setHasFocus(!1)})),this._register(ur.onDidChange(()=>{this._ensureReadOnlyAttribute()}))}writeScreenReaderContent(e){this._textAreaInput.writeNativeTextAreaContent(e)}dispose(){super.dispose()}_getAndroidWordAtPosition(e){const t='`~!@#$%^&*()-=+[{]}\\|;:",.<>/?',i=this._context.viewModel.getLineContent(e.lineNumber),n=wr(t,[]);let s=!0,o=e.column,r=!0,a=e.column,l=0;for(;l<50&&(s||r);){if(s&&o<=1&&(s=!1),s){const h=i.charCodeAt(o-2);n.get(h)!==0?s=!1:o--}if(r&&a>i.length&&(r=!1),r){const h=i.charCodeAt(a-1);n.get(h)!==0?r=!1:a++}l++}return[i.substring(o-1,a-1),e.column-o]}_getWordBeforePosition(e){const t=this._context.viewModel.getLineContent(e.lineNumber),i=wr(this._context.configuration.options.get(132),[]);let n=e.column,s=0;for(;n>1;){const o=t.charCodeAt(n-2);if(i.get(o)!==0||s>50)return t.substring(n-1,e.column-1);s++,n--}return t.substring(0,e.column-1)}_getCharacterBeforePosition(e){if(e.column>1){const i=this._context.viewModel.getLineContent(e.lineNumber).charAt(e.column-2);if(!$a(i.charCodeAt(0)))return i}return""}_getAriaLabel(e){var i,n,s;if(e.get(2)===1){const o=(i=this._keybindingService.lookupKeybinding("editor.action.toggleScreenReaderAccessibilityMode"))==null?void 0:i.getAriaLabel(),r=(n=this._keybindingService.lookupKeybinding("workbench.action.showCommands"))==null?void 0:n.getAriaLabel(),a=(s=this._keybindingService.lookupKeybinding("workbench.action.openGlobalKeybindings"))==null?void 0:s.getAriaLabel(),l=T("accessibilityModeOff","The editor is not accessible at this time.");return o?T("accessibilityOffAriaLabel","{0} To enable screen reader optimized mode, use {1}",l,o):r?T("accessibilityOffAriaLabelNoKb","{0} To enable screen reader optimized mode, open the quick pick with {1} and run the command Toggle Screen Reader Accessibility Mode, which is currently not triggerable via keyboard.",l,r):a?T("accessibilityOffAriaLabelNoKbs","{0} Please assign a keybinding for the command Toggle Screen Reader Accessibility Mode by accessing the keybindings editor with {1} and run it.",l,a):l}return e.get(4)}_setAccessibilityOptions(e){this._accessibilitySupport=e.get(2);const t=e.get(3);this._accessibilitySupport===2&&t===ld.accessibilityPageSize.defaultValue?this._accessibilityPageSize=500:this._accessibilityPageSize=t;const n=e.get(146).wrappingColumn;if(n!==-1&&this._accessibilitySupport!==1){const s=e.get(50);this._textAreaWrapping=!0,this._textAreaWidth=Math.round(n*s.typicalHalfwidthCharacterWidth)}else this._textAreaWrapping=!1,this._textAreaWidth=vs?0:1}onConfigurationChanged(e){const t=this._context.configuration.options,i=t.get(146);this._setAccessibilityOptions(t),this._contentLeft=i.contentLeft,this._contentWidth=i.contentWidth,this._contentHeight=i.height,this._fontInfo=t.get(50),this._lineHeight=t.get(67),this._emptySelectionClipboard=t.get(37),this._copyWithSyntaxHighlighting=t.get(25),this.textArea.setAttribute("wrap",this._textAreaWrapping&&!this._visibleTextArea?"on":"off");const{tabSize:n}=this._context.viewModel.model.getOptions();return this.textArea.domNode.style.tabSize=`${n*this._fontInfo.spaceWidth}px`,this.textArea.setAttribute("aria-label",this._getAriaLabel(t)),this.textArea.setAttribute("aria-required",t.get(5)?"true":"false"),this.textArea.setAttribute("tabindex",String(t.get(125))),(e.hasChanged(34)||e.hasChanged(92))&&this._ensureReadOnlyAttribute(),e.hasChanged(2)&&this._textAreaInput.writeNativeTextAreaContent("strategy changed"),!0}onCursorStateChanged(e){return this._selections=e.selections.slice(0),this._modelSelections=e.modelSelections.slice(0),this._textAreaInput.writeNativeTextAreaContent("selection changed"),!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return this._scrollLeft=e.scrollLeft,this._scrollTop=e.scrollTop,!0}onZonesChanged(e){return!0}isFocused(){return this._textAreaInput.isFocused()}focusTextArea(){this._textAreaInput.focusTextArea()}getLastRenderData(){return this._lastRenderPosition}setAriaOptions(e){e.activeDescendant?(this.textArea.setAttribute("aria-haspopup","true"),this.textArea.setAttribute("aria-autocomplete","list"),this.textArea.setAttribute("aria-activedescendant",e.activeDescendant)):(this.textArea.setAttribute("aria-haspopup","false"),this.textArea.setAttribute("aria-autocomplete","both"),this.textArea.removeAttribute("aria-activedescendant")),e.role&&this.textArea.setAttribute("role",e.role)}_ensureReadOnlyAttribute(){const e=this._context.configuration.options;!ur.enabled||e.get(34)&&e.get(92)?this.textArea.setAttribute("readonly","true"):this.textArea.removeAttribute("readonly")}prepareRender(e){var t;this._primaryCursorPosition=new E(this._selections[0].positionLineNumber,this._selections[0].positionColumn),this._primaryCursorVisibleRange=e.visibleRangeForPosition(this._primaryCursorPosition),(t=this._visibleTextArea)==null||t.prepareRender(e)}render(e){this._textAreaInput.writeNativeTextAreaContent("render"),this._render()}_render(){if(this._visibleTextArea){const i=this._visibleTextArea.visibleTextareaStart,n=this._visibleTextArea.visibleTextareaEnd,s=this._visibleTextArea.startPosition,o=this._visibleTextArea.endPosition;if(s&&o&&i&&n&&n.left>=this._scrollLeft&&i.left<=this._scrollLeft+this._contentWidth){const r=this._context.viewLayout.getVerticalOffsetForLineNumber(this._primaryCursorPosition.lineNumber)-this._scrollTop,a=this._newlinecount(this.textArea.domNode.value.substr(0,this.textArea.domNode.selectionStart));let l=this._visibleTextArea.widthOfHiddenLineTextBefore,h=this._contentLeft+i.left-this._scrollLeft,c=n.left-i.left+1;if(h<this._contentLeft){const v=this._contentLeft-h;h+=v,l+=v,c-=v}c>this._contentWidth&&(c=this._contentWidth);const u=this._context.viewModel.getViewLineData(s.lineNumber),_=u.tokens.findTokenIndexAtOffset(s.column-1),f=u.tokens.findTokenIndexAtOffset(o.column-1),w=_===f,C=this._visibleTextArea.definePresentation(w?u.tokens.getPresentation(_):null);this.textArea.domNode.scrollTop=a*this._lineHeight,this.textArea.domNode.scrollLeft=l,this._doRender({lastRenderPosition:null,top:r,left:h,width:c,height:this._lineHeight,useCover:!1,color:(Oo.getColorMap()||[])[C.foreground],italic:C.italic,bold:C.bold,underline:C.underline,strikethrough:C.strikethrough})}return}if(!this._primaryCursorVisibleRange){this._renderAtTopLeft();return}const e=this._contentLeft+this._primaryCursorVisibleRange.left-this._scrollLeft;if(e<this._contentLeft||e>this._contentLeft+this._contentWidth){this._renderAtTopLeft();return}const t=this._context.viewLayout.getVerticalOffsetForLineNumber(this._selections[0].positionLineNumber)-this._scrollTop;if(t<0||t>this._contentHeight){this._renderAtTopLeft();return}if(Lt||this._accessibilitySupport===2){this._doRender({lastRenderPosition:this._primaryCursorPosition,top:t,left:this._textAreaWrapping?this._contentLeft:e,width:this._textAreaWidth,height:this._lineHeight,useCover:!1}),this.textArea.domNode.scrollLeft=this._primaryCursorVisibleRange.left;const i=this._textAreaInput.textAreaState.newlineCountBeforeSelection??this._newlinecount(this.textArea.domNode.value.substr(0,this.textArea.domNode.selectionStart));this.textArea.domNode.scrollTop=i*this._lineHeight;return}this._doRender({lastRenderPosition:this._primaryCursorPosition,top:t,left:this._textAreaWrapping?this._contentLeft:e,width:this._textAreaWidth,height:vs?0:1,useCover:!1})}_newlinecount(e){let t=0,i=-1;do{if(i=e.indexOf(`
`,i+1),i===-1)break;t++}while(!0);return t}_renderAtTopLeft(){this._doRender({lastRenderPosition:null,top:0,left:0,width:this._textAreaWidth,height:vs?0:1,useCover:!0})}_doRender(e){this._lastRenderPosition=e.lastRenderPosition;const t=this.textArea,i=this.textAreaCover;le(t,this._fontInfo),t.setTop(e.top),t.setLeft(e.left),t.setWidth(e.width),t.setHeight(e.height),t.setColor(e.color?Ai.Format.CSS.formatHex(e.color):""),t.setFontStyle(e.italic?"italic":""),e.bold&&t.setFontWeight("bold"),t.setTextDecoration(`${e.underline?" underline":""}${e.strikethrough?" line-through":""}`),i.setTop(e.useCover?e.top:0),i.setLeft(e.useCover?e.left:0),i.setWidth(e.useCover?e.width:0),i.setHeight(e.useCover?e.height:0);const n=this._context.configuration.options;n.get(57)?i.setClassName("monaco-editor-background textAreaCover "+Rn.OUTER_CLASS_NAME):n.get(68).renderType!==0?i.setClassName("monaco-editor-background textAreaCover "+Mn.CLASS_NAME):i.setClassName("monaco-editor-background textAreaCover")}};Zs=_g([Xr(3,as),Xr(4,ve)],Zs);function vg(d,e,t,i){if(e.length===0)return 0;const n=d.createElement("div");n.style.position="absolute",n.style.top="-50000px",n.style.width="50000px";const s=d.createElement("span");le(s,t),s.style.whiteSpace="pre",s.style.tabSize=`${i*t.spaceWidth}px`,s.append(e),n.appendChild(s),d.body.appendChild(n);const o=s.offsetWidth;return n.remove(),o}const B=0;class Y extends ui{runEditorCommand(e,t,i){const n=t._getViewModel();n&&this.runCoreEditorCommand(n,i||{})}}var re;(function(d){const e=function(i){if(!Bi(i))return!1;const n=i;return!(!Fi(n.to)||!cn(n.by)&&!Fi(n.by)||!cn(n.value)&&!Za(n.value)||!cn(n.revealCursor)&&!Il(n.revealCursor))};d.metadata={description:"Scroll editor in the given direction",args:[{name:"Editor scroll argument object",description:"Property-value pairs that can be passed through this argument:\n					* 'to': A mandatory direction value.\n						```\n						'up', 'down'\n						```\n					* 'by': Unit to move. Default is computed based on 'to' value.\n						```\n						'line', 'wrappedLine', 'page', 'halfPage', 'editor'\n						```\n					* 'value': Number of units to move. Default is '1'.\n					* 'revealCursor': If 'true' reveals the cursor if it is outside view port.\n				",constraint:e,schema:{type:"object",required:["to"],properties:{to:{type:"string",enum:["up","down"]},by:{type:"string",enum:["line","wrappedLine","page","halfPage","editor"]},value:{type:"number",default:1},revealCursor:{type:"boolean"}}}}]},d.RawDirection={Up:"up",Right:"right",Down:"down",Left:"left"},d.RawUnit={Line:"line",WrappedLine:"wrappedLine",Page:"page",HalfPage:"halfPage",Editor:"editor",Column:"column"};function t(i){let n;switch(i.to){case d.RawDirection.Up:n=1;break;case d.RawDirection.Right:n=2;break;case d.RawDirection.Down:n=3;break;case d.RawDirection.Left:n=4;break;default:return null}let s;switch(i.by){case d.RawUnit.Line:s=1;break;case d.RawUnit.WrappedLine:s=2;break;case d.RawUnit.Page:s=3;break;case d.RawUnit.HalfPage:s=4;break;case d.RawUnit.Editor:s=5;break;case d.RawUnit.Column:s=6;break;default:s=2}const o=Math.floor(i.value||1),r=!!i.revealCursor;return{direction:n,unit:s,value:o,revealCursor:r,select:!!i.select}}d.parse=t})(re||(re={}));var jt;(function(d){const e=function(t){if(!Bi(t))return!1;const i=t;return!(!Za(i.lineNumber)&&!Fi(i.lineNumber)||!cn(i.at)&&!Fi(i.at))};d.metadata={description:"Reveal the given line at the given logical position",args:[{name:"Reveal line argument object",description:"Property-value pairs that can be passed through this argument:\n					* 'lineNumber': A mandatory line number value.\n					* 'at': Logical position at which line has to be revealed.\n						```\n						'top', 'center', 'bottom'\n						```\n				",constraint:e,schema:{type:"object",required:["lineNumber"],properties:{lineNumber:{type:["number","string"]},at:{type:"string",enum:["top","center","bottom"]}}}}]},d.RawAtArgument={Top:"top",Center:"center",Bottom:"bottom"}})(jt||(jt={}));class Ks{constructor(e){e.addImplementation(1e4,"code-editor",(t,i)=>{const n=t.get(Ae).getFocusedCodeEditor();return n&&n.hasTextFocus()?this._runEditorCommand(t,n,i):!1}),e.addImplementation(1e3,"generic-dom-input-textarea",(t,i)=>{const n=xt();return n&&["input","textarea"].indexOf(n.tagName.toLowerCase())>=0?(this.runDOMCommand(n),!0):!1}),e.addImplementation(0,"generic-dom",(t,i)=>{const n=t.get(Ae).getActiveCodeEditor();return n?(n.focus(),this._runEditorCommand(t,n,i)):!1})}_runEditorCommand(e,t,i){const n=this.runEditorCommand(e,t,i);return n||!0}}var ne;(function(d){class e extends Y{constructor(g){super(g),this._inSelectionMode=g.inSelectionMode}runCoreEditorCommand(g,p){if(!p.position)return;g.model.pushStackElement(),g.setCursorStates(p.source,3,[he.moveTo(g,g.getPrimaryCursorState(),this._inSelectionMode,p.position,p.viewPosition)])&&p.revealType!==2&&g.revealAllCursors(p.source,!0,!0)}}d.MoveTo=A(new e({id:"_moveTo",inSelectionMode:!1,precondition:void 0})),d.MoveToSelect=A(new e({id:"_moveToSelect",inSelectionMode:!0,precondition:void 0}));class t extends Y{runCoreEditorCommand(g,p){g.model.pushStackElement();const m=this._getColumnSelectResult(g,g.getPrimaryCursorState(),g.getCursorColumnSelectData(),p);m!==null&&(g.setCursorStates(p.source,3,m.viewStates.map(b=>rn.fromViewState(b))),g.setCursorColumnSelectData({isReal:!0,fromViewLineNumber:m.fromLineNumber,fromViewVisualColumn:m.fromVisualColumn,toViewLineNumber:m.toLineNumber,toViewVisualColumn:m.toVisualColumn}),m.reversed?g.revealTopMostCursor(p.source):g.revealBottomMostCursor(p.source))}}d.ColumnSelect=A(new class extends t{constructor(){super({id:"columnSelect",precondition:void 0})}_getColumnSelectResult(v,g,p,m){if(typeof m.position>"u"||typeof m.viewPosition>"u"||typeof m.mouseColumn>"u")return null;const b=v.model.validatePosition(m.position),L=v.coordinatesConverter.validateViewPosition(new E(m.viewPosition.lineNumber,m.viewPosition.column),b),y=m.doColumnSelect?p.fromViewLineNumber:L.lineNumber,S=m.doColumnSelect?p.fromViewVisualColumn:m.mouseColumn-1;return wi.columnSelect(v.cursorConfig,v,y,S,L.lineNumber,m.mouseColumn-1)}}),d.CursorColumnSelectLeft=A(new class extends t{constructor(){super({id:"cursorColumnSelectLeft",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:3599,linux:{primary:0}}})}_getColumnSelectResult(v,g,p,m){return wi.columnSelectLeft(v.cursorConfig,v,p)}}),d.CursorColumnSelectRight=A(new class extends t{constructor(){super({id:"cursorColumnSelectRight",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:3601,linux:{primary:0}}})}_getColumnSelectResult(v,g,p,m){return wi.columnSelectRight(v.cursorConfig,v,p)}});class i extends t{constructor(g){super(g),this._isPaged=g.isPaged}_getColumnSelectResult(g,p,m,b){return wi.columnSelectUp(g.cursorConfig,g,m,this._isPaged)}}d.CursorColumnSelectUp=A(new i({isPaged:!1,id:"cursorColumnSelectUp",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:3600,linux:{primary:0}}})),d.CursorColumnSelectPageUp=A(new i({isPaged:!0,id:"cursorColumnSelectPageUp",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:3595,linux:{primary:0}}}));class n extends t{constructor(g){super(g),this._isPaged=g.isPaged}_getColumnSelectResult(g,p,m,b){return wi.columnSelectDown(g.cursorConfig,g,m,this._isPaged)}}d.CursorColumnSelectDown=A(new n({isPaged:!1,id:"cursorColumnSelectDown",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:3602,linux:{primary:0}}})),d.CursorColumnSelectPageDown=A(new n({isPaged:!0,id:"cursorColumnSelectPageDown",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:3596,linux:{primary:0}}}));class s extends Y{constructor(){super({id:"cursorMove",precondition:void 0,metadata:yr.metadata})}runCoreEditorCommand(g,p){const m=yr.parse(p);m&&this._runCursorMove(g,p.source,m)}_runCursorMove(g,p,m){g.model.pushStackElement(),g.setCursorStates(p,3,s._move(g,g.getCursorStates(),m)),g.revealAllCursors(p,!0)}static _move(g,p,m){const b=m.select,L=m.value;switch(m.direction){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:return he.simpleMove(g,p,m.direction,b,L,m.unit);case 11:case 13:case 12:case 14:return he.viewportMove(g,p,m.direction,b,L);default:return null}}}d.CursorMoveImpl=s,d.CursorMove=A(new s);class o extends Y{constructor(g){super(g),this._staticArgs=g.args}runCoreEditorCommand(g,p){let m=this._staticArgs;this._staticArgs.value===-1&&(m={direction:this._staticArgs.direction,unit:this._staticArgs.unit,select:this._staticArgs.select,value:p.pageSize||g.cursorConfig.pageSize}),g.model.pushStackElement(),g.setCursorStates(p.source,3,he.simpleMove(g,g.getCursorStates(),m.direction,m.select,m.value,m.unit)),g.revealAllCursors(p.source,!0)}}d.CursorLeft=A(new o({args:{direction:0,unit:0,select:!1,value:1},id:"cursorLeft",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:15,mac:{primary:15,secondary:[288]}}})),d.CursorLeftSelect=A(new o({args:{direction:0,unit:0,select:!0,value:1},id:"cursorLeftSelect",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:1039}})),d.CursorRight=A(new o({args:{direction:1,unit:0,select:!1,value:1},id:"cursorRight",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:17,mac:{primary:17,secondary:[292]}}})),d.CursorRightSelect=A(new o({args:{direction:1,unit:0,select:!0,value:1},id:"cursorRightSelect",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:1041}})),d.CursorUp=A(new o({args:{direction:2,unit:2,select:!1,value:1},id:"cursorUp",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:16,mac:{primary:16,secondary:[302]}}})),d.CursorUpSelect=A(new o({args:{direction:2,unit:2,select:!0,value:1},id:"cursorUpSelect",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:1040,secondary:[3088],mac:{primary:1040},linux:{primary:1040}}})),d.CursorPageUp=A(new o({args:{direction:2,unit:2,select:!1,value:-1},id:"cursorPageUp",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:11}})),d.CursorPageUpSelect=A(new o({args:{direction:2,unit:2,select:!0,value:-1},id:"cursorPageUpSelect",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:1035}})),d.CursorDown=A(new o({args:{direction:3,unit:2,select:!1,value:1},id:"cursorDown",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:18,mac:{primary:18,secondary:[300]}}})),d.CursorDownSelect=A(new o({args:{direction:3,unit:2,select:!0,value:1},id:"cursorDownSelect",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:1042,secondary:[3090],mac:{primary:1042},linux:{primary:1042}}})),d.CursorPageDown=A(new o({args:{direction:3,unit:2,select:!1,value:-1},id:"cursorPageDown",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:12}})),d.CursorPageDownSelect=A(new o({args:{direction:3,unit:2,select:!0,value:-1},id:"cursorPageDownSelect",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:1036}})),d.CreateCursor=A(new class extends Y{constructor(){super({id:"createCursor",precondition:void 0})}runCoreEditorCommand(v,g){if(!g.position)return;let p;g.wholeLine?p=he.line(v,v.getPrimaryCursorState(),!1,g.position,g.viewPosition):p=he.moveTo(v,v.getPrimaryCursorState(),!1,g.position,g.viewPosition);const m=v.getCursorStates();if(m.length>1){const b=p.modelState?p.modelState.position:null,L=p.viewState?p.viewState.position:null;for(let y=0,S=m.length;y<S;y++){const D=m[y];if(!(b&&!D.modelState.selection.containsPosition(b))&&!(L&&!D.viewState.selection.containsPosition(L))){m.splice(y,1),v.model.pushStackElement(),v.setCursorStates(g.source,3,m);return}}}m.push(p),v.model.pushStackElement(),v.setCursorStates(g.source,3,m)}}),d.LastCursorMoveToSelect=A(new class extends Y{constructor(){super({id:"_lastCursorMoveToSelect",precondition:void 0})}runCoreEditorCommand(v,g){if(!g.position)return;const p=v.getLastAddedCursorIndex(),m=v.getCursorStates(),b=m.slice(0);b[p]=he.moveTo(v,m[p],!0,g.position,g.viewPosition),v.model.pushStackElement(),v.setCursorStates(g.source,3,b)}});class r extends Y{constructor(g){super(g),this._inSelectionMode=g.inSelectionMode}runCoreEditorCommand(g,p){g.model.pushStackElement(),g.setCursorStates(p.source,3,he.moveToBeginningOfLine(g,g.getCursorStates(),this._inSelectionMode)),g.revealAllCursors(p.source,!0)}}d.CursorHome=A(new r({inSelectionMode:!1,id:"cursorHome",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:14,mac:{primary:14,secondary:[2063]}}})),d.CursorHomeSelect=A(new r({inSelectionMode:!0,id:"cursorHomeSelect",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:1038,mac:{primary:1038,secondary:[3087]}}}));class a extends Y{constructor(g){super(g),this._inSelectionMode=g.inSelectionMode}runCoreEditorCommand(g,p){g.model.pushStackElement(),g.setCursorStates(p.source,3,this._exec(g.getCursorStates())),g.revealAllCursors(p.source,!0)}_exec(g){const p=[];for(let m=0,b=g.length;m<b;m++){const L=g[m],y=L.modelState.position.lineNumber;p[m]=rn.fromModelState(L.modelState.move(this._inSelectionMode,y,1,0))}return p}}d.CursorLineStart=A(new a({inSelectionMode:!1,id:"cursorLineStart",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:0,mac:{primary:287}}})),d.CursorLineStartSelect=A(new a({inSelectionMode:!0,id:"cursorLineStartSelect",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:0,mac:{primary:1311}}}));class l extends Y{constructor(g){super(g),this._inSelectionMode=g.inSelectionMode}runCoreEditorCommand(g,p){g.model.pushStackElement(),g.setCursorStates(p.source,3,he.moveToEndOfLine(g,g.getCursorStates(),this._inSelectionMode,p.sticky||!1)),g.revealAllCursors(p.source,!0)}}d.CursorEnd=A(new l({inSelectionMode:!1,id:"cursorEnd",precondition:void 0,kbOpts:{args:{sticky:!1},weight:B,kbExpr:N.textInputFocus,primary:13,mac:{primary:13,secondary:[2065]}},metadata:{description:"Go to End",args:[{name:"args",schema:{type:"object",properties:{sticky:{description:T("stickydesc","Stick to the end even when going to longer lines"),type:"boolean",default:!1}}}}]}})),d.CursorEndSelect=A(new l({inSelectionMode:!0,id:"cursorEndSelect",precondition:void 0,kbOpts:{args:{sticky:!1},weight:B,kbExpr:N.textInputFocus,primary:1037,mac:{primary:1037,secondary:[3089]}},metadata:{description:"Select to End",args:[{name:"args",schema:{type:"object",properties:{sticky:{description:T("stickydesc","Stick to the end even when going to longer lines"),type:"boolean",default:!1}}}}]}}));class h extends Y{constructor(g){super(g),this._inSelectionMode=g.inSelectionMode}runCoreEditorCommand(g,p){g.model.pushStackElement(),g.setCursorStates(p.source,3,this._exec(g,g.getCursorStates())),g.revealAllCursors(p.source,!0)}_exec(g,p){const m=[];for(let b=0,L=p.length;b<L;b++){const y=p[b],S=y.modelState.position.lineNumber,D=g.model.getLineMaxColumn(S);m[b]=rn.fromModelState(y.modelState.move(this._inSelectionMode,S,D,0))}return m}}d.CursorLineEnd=A(new h({inSelectionMode:!1,id:"cursorLineEnd",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:0,mac:{primary:291}}})),d.CursorLineEndSelect=A(new h({inSelectionMode:!0,id:"cursorLineEndSelect",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:0,mac:{primary:1315}}}));class c extends Y{constructor(g){super(g),this._inSelectionMode=g.inSelectionMode}runCoreEditorCommand(g,p){g.model.pushStackElement(),g.setCursorStates(p.source,3,he.moveToBeginningOfBuffer(g,g.getCursorStates(),this._inSelectionMode)),g.revealAllCursors(p.source,!0)}}d.CursorTop=A(new c({inSelectionMode:!1,id:"cursorTop",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:2062,mac:{primary:2064}}})),d.CursorTopSelect=A(new c({inSelectionMode:!0,id:"cursorTopSelect",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:3086,mac:{primary:3088}}}));class u extends Y{constructor(g){super(g),this._inSelectionMode=g.inSelectionMode}runCoreEditorCommand(g,p){g.model.pushStackElement(),g.setCursorStates(p.source,3,he.moveToEndOfBuffer(g,g.getCursorStates(),this._inSelectionMode)),g.revealAllCursors(p.source,!0)}}d.CursorBottom=A(new u({inSelectionMode:!1,id:"cursorBottom",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:2061,mac:{primary:2066}}})),d.CursorBottomSelect=A(new u({inSelectionMode:!0,id:"cursorBottomSelect",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:3085,mac:{primary:3090}}}));class _ extends Y{constructor(){super({id:"editorScroll",precondition:void 0,metadata:re.metadata})}determineScrollMethod(g){const p=[6],m=[1,2,3,4,5,6],b=[4,2],L=[1,3];return p.includes(g.unit)&&b.includes(g.direction)?this._runHorizontalEditorScroll.bind(this):m.includes(g.unit)&&L.includes(g.direction)?this._runVerticalEditorScroll.bind(this):null}runCoreEditorCommand(g,p){const m=re.parse(p);if(!m)return;const b=this.determineScrollMethod(m);b&&b(g,p.source,m)}_runVerticalEditorScroll(g,p,m){const b=this._computeDesiredScrollTop(g,m);if(m.revealCursor){const L=g.getCompletelyVisibleViewRangeAtScrollTop(b);g.setCursorStates(p,3,[he.findPositionInViewportIfOutside(g,g.getPrimaryCursorState(),L,m.select)])}g.viewLayout.setScrollPosition({scrollTop:b},0)}_computeDesiredScrollTop(g,p){if(p.unit===1){const L=g.viewLayout.getFutureViewport(),y=g.getCompletelyVisibleViewRangeAtScrollTop(L.top),S=g.coordinatesConverter.convertViewRangeToModelRange(y);let D;p.direction===1?D=Math.max(1,S.startLineNumber-p.value):D=Math.min(g.model.getLineCount(),S.startLineNumber+p.value);const x=g.coordinatesConverter.convertModelPositionToViewPosition(new E(D,1));return g.viewLayout.getVerticalOffsetForLineNumber(x.lineNumber)}if(p.unit===5){let L=0;return p.direction===3&&(L=g.model.getLineCount()-g.cursorConfig.pageSize),g.viewLayout.getVerticalOffsetForLineNumber(L)}let m;p.unit===3?m=g.cursorConfig.pageSize*p.value:p.unit===4?m=Math.round(g.cursorConfig.pageSize/2)*p.value:m=p.value;const b=(p.direction===1?-1:1)*m;return g.viewLayout.getCurrentScrollTop()+b*g.cursorConfig.lineHeight}_runHorizontalEditorScroll(g,p,m){const b=this._computeDesiredScrollLeft(g,m);g.viewLayout.setScrollPosition({scrollLeft:b},0)}_computeDesiredScrollLeft(g,p){const m=(p.direction===4?-1:1)*p.value;return g.viewLayout.getCurrentScrollLeft()+m*g.cursorConfig.typicalHalfwidthCharacterWidth}}d.EditorScrollImpl=_,d.EditorScroll=A(new _),d.ScrollLineUp=A(new class extends Y{constructor(){super({id:"scrollLineUp",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:2064,mac:{primary:267}}})}runCoreEditorCommand(v,g){d.EditorScroll.runCoreEditorCommand(v,{to:re.RawDirection.Up,by:re.RawUnit.WrappedLine,value:1,revealCursor:!1,select:!1,source:g.source})}}),d.ScrollPageUp=A(new class extends Y{constructor(){super({id:"scrollPageUp",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:2059,win:{primary:523},linux:{primary:523}}})}runCoreEditorCommand(v,g){d.EditorScroll.runCoreEditorCommand(v,{to:re.RawDirection.Up,by:re.RawUnit.Page,value:1,revealCursor:!1,select:!1,source:g.source})}}),d.ScrollEditorTop=A(new class extends Y{constructor(){super({id:"scrollEditorTop",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus}})}runCoreEditorCommand(v,g){d.EditorScroll.runCoreEditorCommand(v,{to:re.RawDirection.Up,by:re.RawUnit.Editor,value:1,revealCursor:!1,select:!1,source:g.source})}}),d.ScrollLineDown=A(new class extends Y{constructor(){super({id:"scrollLineDown",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:2066,mac:{primary:268}}})}runCoreEditorCommand(v,g){d.EditorScroll.runCoreEditorCommand(v,{to:re.RawDirection.Down,by:re.RawUnit.WrappedLine,value:1,revealCursor:!1,select:!1,source:g.source})}}),d.ScrollPageDown=A(new class extends Y{constructor(){super({id:"scrollPageDown",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:2060,win:{primary:524},linux:{primary:524}}})}runCoreEditorCommand(v,g){d.EditorScroll.runCoreEditorCommand(v,{to:re.RawDirection.Down,by:re.RawUnit.Page,value:1,revealCursor:!1,select:!1,source:g.source})}}),d.ScrollEditorBottom=A(new class extends Y{constructor(){super({id:"scrollEditorBottom",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus}})}runCoreEditorCommand(v,g){d.EditorScroll.runCoreEditorCommand(v,{to:re.RawDirection.Down,by:re.RawUnit.Editor,value:1,revealCursor:!1,select:!1,source:g.source})}}),d.ScrollLeft=A(new class extends Y{constructor(){super({id:"scrollLeft",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus}})}runCoreEditorCommand(v,g){d.EditorScroll.runCoreEditorCommand(v,{to:re.RawDirection.Left,by:re.RawUnit.Column,value:2,revealCursor:!1,select:!1,source:g.source})}}),d.ScrollRight=A(new class extends Y{constructor(){super({id:"scrollRight",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus}})}runCoreEditorCommand(v,g){d.EditorScroll.runCoreEditorCommand(v,{to:re.RawDirection.Right,by:re.RawUnit.Column,value:2,revealCursor:!1,select:!1,source:g.source})}});class f extends Y{constructor(g){super(g),this._inSelectionMode=g.inSelectionMode}runCoreEditorCommand(g,p){p.position&&(g.model.pushStackElement(),g.setCursorStates(p.source,3,[he.word(g,g.getPrimaryCursorState(),this._inSelectionMode,p.position)]),p.revealType!==2&&g.revealAllCursors(p.source,!0,!0))}}d.WordSelect=A(new f({inSelectionMode:!1,id:"_wordSelect",precondition:void 0})),d.WordSelectDrag=A(new f({inSelectionMode:!0,id:"_wordSelectDrag",precondition:void 0})),d.LastCursorWordSelect=A(new class extends Y{constructor(){super({id:"lastCursorWordSelect",precondition:void 0})}runCoreEditorCommand(v,g){if(!g.position)return;const p=v.getLastAddedCursorIndex(),m=v.getCursorStates(),b=m.slice(0),L=m[p];b[p]=he.word(v,L,L.modelState.hasSelection(),g.position),v.model.pushStackElement(),v.setCursorStates(g.source,3,b)}});class w extends Y{constructor(g){super(g),this._inSelectionMode=g.inSelectionMode}runCoreEditorCommand(g,p){p.position&&(g.model.pushStackElement(),g.setCursorStates(p.source,3,[he.line(g,g.getPrimaryCursorState(),this._inSelectionMode,p.position,p.viewPosition)]),p.revealType!==2&&g.revealAllCursors(p.source,!1,!0))}}d.LineSelect=A(new w({inSelectionMode:!1,id:"_lineSelect",precondition:void 0})),d.LineSelectDrag=A(new w({inSelectionMode:!0,id:"_lineSelectDrag",precondition:void 0}));class C extends Y{constructor(g){super(g),this._inSelectionMode=g.inSelectionMode}runCoreEditorCommand(g,p){if(!p.position)return;const m=g.getLastAddedCursorIndex(),b=g.getCursorStates(),L=b.slice(0);L[m]=he.line(g,b[m],this._inSelectionMode,p.position,p.viewPosition),g.model.pushStackElement(),g.setCursorStates(p.source,3,L)}}d.LastCursorLineSelect=A(new C({inSelectionMode:!1,id:"lastCursorLineSelect",precondition:void 0})),d.LastCursorLineSelectDrag=A(new C({inSelectionMode:!0,id:"lastCursorLineSelectDrag",precondition:void 0})),d.CancelSelection=A(new class extends Y{constructor(){super({id:"cancelSelection",precondition:N.hasNonEmptySelection,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:9,secondary:[1033]}})}runCoreEditorCommand(v,g){v.model.pushStackElement(),v.setCursorStates(g.source,3,[he.cancelSelection(v,v.getPrimaryCursorState())]),v.revealAllCursors(g.source,!0)}}),d.RemoveSecondaryCursors=A(new class extends Y{constructor(){super({id:"removeSecondaryCursors",precondition:N.hasMultipleSelections,kbOpts:{weight:B+1,kbExpr:N.textInputFocus,primary:9,secondary:[1033]}})}runCoreEditorCommand(v,g){v.model.pushStackElement(),v.setCursorStates(g.source,3,[v.getPrimaryCursorState()]),v.revealAllCursors(g.source,!0),Fa(T("removedCursor","Removed secondary cursors"))}}),d.RevealLine=A(new class extends Y{constructor(){super({id:"revealLine",precondition:void 0,metadata:jt.metadata})}runCoreEditorCommand(v,g){const p=g,m=p.lineNumber||0;let b=typeof m=="number"?m+1:parseInt(m)+1;b<1&&(b=1);const L=v.model.getLineCount();b>L&&(b=L);const y=new W(b,1,b,v.model.getLineMaxColumn(b));let S=0;if(p.at)switch(p.at){case jt.RawAtArgument.Top:S=3;break;case jt.RawAtArgument.Center:S=1;break;case jt.RawAtArgument.Bottom:S=4;break}const D=v.coordinatesConverter.convertModelRangeToViewRange(y);v.revealRange(g.source,!1,D,S,0)}}),d.SelectAll=new class extends Ks{constructor(){super(vu)}runDOMCommand(v){Et&&(v.focus(),v.select()),v.ownerDocument.execCommand("selectAll")}runEditorCommand(v,g,p){const m=g._getViewModel();m&&this.runCoreEditorCommand(m,p)}runCoreEditorCommand(v,g){v.model.pushStackElement(),v.setCursorStates("keyboard",3,[he.selectAll(v,v.getPrimaryCursorState())])}},d.SetSelection=A(new class extends Y{constructor(){super({id:"setSelection",precondition:void 0})}runCoreEditorCommand(v,g){g.selection&&(v.model.pushStackElement(),v.setCursorStates(g.source,3,[rn.fromModelSelection(g.selection)]))}})})(ne||(ne={}));const Cg=ee.and(N.textInputFocus,N.columnSelection);function _i(d,e){gd.registerKeybindingRule({id:d,primary:e,when:Cg,weight:B+1})}_i(ne.CursorColumnSelectLeft.id,1039);_i(ne.CursorColumnSelectRight.id,1041);_i(ne.CursorColumnSelectUp.id,1040);_i(ne.CursorColumnSelectPageUp.id,1035);_i(ne.CursorColumnSelectDown.id,1042);_i(ne.CursorColumnSelectPageDown.id,1036);function Jr(d){return d.register(),d}var ea;(function(d){class e extends ui{runEditorCommand(i,n,s){const o=n._getViewModel();o&&this.runCoreEditingCommand(n,o,s||{})}}d.CoreEditingCommand=e,d.LineBreakInsert=A(new class extends e{constructor(){super({id:"lineBreakInsert",precondition:N.writable,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:0,mac:{primary:301}}})}runCoreEditingCommand(t,i,n){t.pushUndoStop(),t.executeCommands(this.id,Rh.lineBreakInsert(i.cursorConfig,i.model,i.getCursorStates().map(s=>s.modelState.selection)))}}),d.Outdent=A(new class extends e{constructor(){super({id:"outdent",precondition:N.writable,kbOpts:{weight:B,kbExpr:ee.and(N.editorTextFocus,N.tabDoesNotMoveFocus),primary:1026}})}runCoreEditingCommand(t,i,n){t.pushUndoStop(),t.executeCommands(this.id,br.outdent(i.cursorConfig,i.model,i.getCursorStates().map(s=>s.modelState.selection))),t.pushUndoStop()}}),d.Tab=A(new class extends e{constructor(){super({id:"tab",precondition:N.writable,kbOpts:{weight:B,kbExpr:ee.and(N.editorTextFocus,N.tabDoesNotMoveFocus),primary:2}})}runCoreEditingCommand(t,i,n){t.pushUndoStop(),t.executeCommands(this.id,br.tab(i.cursorConfig,i.model,i.getCursorStates().map(s=>s.modelState.selection))),t.pushUndoStop()}}),d.DeleteLeft=A(new class extends e{constructor(){super({id:"deleteLeft",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:1,secondary:[1025],mac:{primary:1,secondary:[1025,294,257]}}})}runCoreEditingCommand(t,i,n){const[s,o]=Lr.deleteLeft(i.getPrevEditOperationType(),i.cursorConfig,i.model,i.getCursorStates().map(r=>r.modelState.selection),i.getCursorAutoClosedCharacters());s&&t.pushUndoStop(),t.executeCommands(this.id,o),i.setPrevEditOperationType(2)}}),d.DeleteRight=A(new class extends e{constructor(){super({id:"deleteRight",precondition:void 0,kbOpts:{weight:B,kbExpr:N.textInputFocus,primary:20,mac:{primary:20,secondary:[290,276]}}})}runCoreEditingCommand(t,i,n){const[s,o]=Lr.deleteRight(i.getPrevEditOperationType(),i.cursorConfig,i.model,i.getCursorStates().map(r=>r.modelState.selection));s&&t.pushUndoStop(),t.executeCommands(this.id,o),i.setPrevEditOperationType(3)}}),d.Undo=new class extends Ks{constructor(){super(Ld)}runDOMCommand(t){t.ownerDocument.execCommand("undo")}runEditorCommand(t,i,n){if(!(!i.hasModel()||i.getOption(92)===!0))return i.getModel().undo()}},d.Redo=new class extends Ks{constructor(){super(yd)}runDOMCommand(t){t.ownerDocument.execCommand("redo")}runEditorCommand(t,i,n){if(!(!i.hasModel()||i.getOption(92)===!0))return i.getModel().redo()}}})(ea||(ea={}));class ta extends cs{constructor(e,t,i){super({id:e,precondition:void 0,metadata:i}),this._handlerId=t}runCommand(e,t){const i=e.get(Ae).getFocusedCodeEditor();i&&i.trigger("keyboard",this._handlerId,t)}}function Wt(d,e){Jr(new ta("default:"+d,d)),Jr(new ta(d,d,e))}Wt("type",{description:"Type",args:[{name:"args",schema:{type:"object",required:["text"],properties:{text:{type:"string"}}}}]});Wt("replacePreviousChar");Wt("compositionType");Wt("compositionStart");Wt("compositionEnd");Wt("paste");Wt("cut");class wg{constructor(e,t,i,n){this.configuration=e,this.viewModel=t,this.userInputEvents=i,this.commandDelegate=n}paste(e,t,i,n){this.commandDelegate.paste(e,t,i,n)}type(e){this.commandDelegate.type(e)}compositionType(e,t,i,n){this.commandDelegate.compositionType(e,t,i,n)}compositionStart(){this.commandDelegate.startComposition()}compositionEnd(){this.commandDelegate.endComposition()}cut(){this.commandDelegate.cut()}setSelection(e){ne.SetSelection.runCoreEditorCommand(this.viewModel,{source:"keyboard",selection:e})}_validateViewColumn(e){const t=this.viewModel.getLineMinColumn(e.lineNumber);return e.column<t?new E(e.lineNumber,t):e}_hasMulticursorModifier(e){switch(this.configuration.options.get(78)){case"altKey":return e.altKey;case"ctrlKey":return e.ctrlKey;case"metaKey":return e.metaKey;default:return!1}}_hasNonMulticursorModifier(e){switch(this.configuration.options.get(78)){case"altKey":return e.ctrlKey||e.metaKey;case"ctrlKey":return e.altKey||e.metaKey;case"metaKey":return e.ctrlKey||e.altKey;default:return!1}}dispatchMouse(e){const t=this.configuration.options,i=Jn&&t.get(108),n=t.get(22);e.middleButton&&!i?this._columnSelect(e.position,e.mouseColumn,e.inSelectionMode):e.startedOnLineNumbers?this._hasMulticursorModifier(e)?e.inSelectionMode?this._lastCursorLineSelect(e.position,e.revealType):this._createCursor(e.position,!0):e.inSelectionMode?this._lineSelectDrag(e.position,e.revealType):this._lineSelect(e.position,e.revealType):e.mouseDownCount>=4?this._selectAll():e.mouseDownCount===3?this._hasMulticursorModifier(e)?e.inSelectionMode?this._lastCursorLineSelectDrag(e.position,e.revealType):this._lastCursorLineSelect(e.position,e.revealType):e.inSelectionMode?this._lineSelectDrag(e.position,e.revealType):this._lineSelect(e.position,e.revealType):e.mouseDownCount===2?e.onInjectedText||(this._hasMulticursorModifier(e)?this._lastCursorWordSelect(e.position,e.revealType):e.inSelectionMode?this._wordSelectDrag(e.position,e.revealType):this._wordSelect(e.position,e.revealType)):this._hasMulticursorModifier(e)?this._hasNonMulticursorModifier(e)||(e.shiftKey?this._columnSelect(e.position,e.mouseColumn,!0):e.inSelectionMode?this._lastCursorMoveToSelect(e.position,e.revealType):this._createCursor(e.position,!1)):e.inSelectionMode?e.altKey?this._columnSelect(e.position,e.mouseColumn,!0):n?this._columnSelect(e.position,e.mouseColumn,!0):this._moveToSelect(e.position,e.revealType):this.moveTo(e.position,e.revealType)}_usualArgs(e,t){return e=this._validateViewColumn(e),{source:"mouse",position:this._convertViewToModelPosition(e),viewPosition:e,revealType:t}}moveTo(e,t){ne.MoveTo.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_moveToSelect(e,t){ne.MoveToSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_columnSelect(e,t,i){e=this._validateViewColumn(e),ne.ColumnSelect.runCoreEditorCommand(this.viewModel,{source:"mouse",position:this._convertViewToModelPosition(e),viewPosition:e,mouseColumn:t,doColumnSelect:i})}_createCursor(e,t){e=this._validateViewColumn(e),ne.CreateCursor.runCoreEditorCommand(this.viewModel,{source:"mouse",position:this._convertViewToModelPosition(e),viewPosition:e,wholeLine:t})}_lastCursorMoveToSelect(e,t){ne.LastCursorMoveToSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_wordSelect(e,t){ne.WordSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_wordSelectDrag(e,t){ne.WordSelectDrag.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_lastCursorWordSelect(e,t){ne.LastCursorWordSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_lineSelect(e,t){ne.LineSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_lineSelectDrag(e,t){ne.LineSelectDrag.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_lastCursorLineSelect(e,t){ne.LastCursorLineSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_lastCursorLineSelectDrag(e,t){ne.LastCursorLineSelectDrag.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_selectAll(){ne.SelectAll.runCoreEditorCommand(this.viewModel,{source:"mouse"})}_convertViewToModelPosition(e){return this.viewModel.coordinatesConverter.convertViewPositionToModelPosition(e)}emitKeyDown(e){this.userInputEvents.emitKeyDown(e)}emitKeyUp(e){this.userInputEvents.emitKeyUp(e)}emitContextMenu(e){this.userInputEvents.emitContextMenu(e)}emitMouseMove(e){this.userInputEvents.emitMouseMove(e)}emitMouseLeave(e){this.userInputEvents.emitMouseLeave(e)}emitMouseUp(e){this.userInputEvents.emitMouseUp(e)}emitMouseDown(e){this.userInputEvents.emitMouseDown(e)}emitMouseDrag(e){this.userInputEvents.emitMouseDrag(e)}emitMouseDrop(e){this.userInputEvents.emitMouseDrop(e)}emitMouseDropCanceled(){this.userInputEvents.emitMouseDropCanceled()}emitMouseWheel(e){this.userInputEvents.emitMouseWheel(e)}}class Id{constructor(e){this._lineFactory=e,this._set(1,[])}flush(){this._set(1,[])}_set(e,t){this._lines=t,this._rendLineNumberStart=e}_get(){return{rendLineNumberStart:this._rendLineNumberStart,lines:this._lines}}getStartLineNumber(){return this._rendLineNumberStart}getEndLineNumber(){return this._rendLineNumberStart+this._lines.length-1}getCount(){return this._lines.length}getLine(e){const t=e-this._rendLineNumberStart;if(t<0||t>=this._lines.length)throw new at("Illegal value for lineNumber");return this._lines[t]}onLinesDeleted(e,t){if(this.getCount()===0)return null;const i=this.getStartLineNumber(),n=this.getEndLineNumber();if(t<i){const a=t-e+1;return this._rendLineNumberStart-=a,null}if(e>n)return null;let s=0,o=0;for(let a=i;a<=n;a++){const l=a-this._rendLineNumberStart;e<=a&&a<=t&&(o===0?(s=l,o=1):o++)}if(e<i){let a=0;t<i?a=t-e+1:a=i-e,this._rendLineNumberStart-=a}return this._lines.splice(s,o)}onLinesChanged(e,t){const i=e+t-1;if(this.getCount()===0)return!1;const n=this.getStartLineNumber(),s=this.getEndLineNumber();let o=!1;for(let r=e;r<=i;r++)r>=n&&r<=s&&(this._lines[r-this._rendLineNumberStart].onContentChanged(),o=!0);return o}onLinesInserted(e,t){if(this.getCount()===0)return null;const i=t-e+1,n=this.getStartLineNumber(),s=this.getEndLineNumber();if(e<=n)return this._rendLineNumberStart+=i,null;if(e>s)return null;if(i+e>s)return this._lines.splice(e-this._rendLineNumberStart,s-e+1);const o=[];for(let c=0;c<i;c++)o[c]=this._lineFactory.createLine();const r=e-this._rendLineNumberStart,a=this._lines.slice(0,r),l=this._lines.slice(r,this._lines.length-i),h=this._lines.slice(this._lines.length-i,this._lines.length);return this._lines=a.concat(o).concat(l),h}onTokensChanged(e){if(this.getCount()===0)return!1;const t=this.getStartLineNumber(),i=this.getEndLineNumber();let n=!1;for(let s=0,o=e.length;s<o;s++){const r=e[s];if(r.toLineNumber<t||r.fromLineNumber>i)continue;const a=Math.max(t,r.fromLineNumber),l=Math.min(i,r.toLineNumber);for(let h=a;h<=l;h++){const c=h-this._rendLineNumberStart;this._lines[c].onTokensChanged(),n=!0}}return n}}class Od{constructor(e){this._lineFactory=e,this.domNode=this._createDomNode(),this._linesCollection=new Id(this._lineFactory)}_createDomNode(){const e=$(document.createElement("div"));return e.setClassName("view-layer"),e.setPosition("absolute"),e.domNode.setAttribute("role","presentation"),e.domNode.setAttribute("aria-hidden","true"),e}onConfigurationChanged(e){return!!e.hasChanged(146)}onFlushed(e){return this._linesCollection.flush(),!0}onLinesChanged(e){return this._linesCollection.onLinesChanged(e.fromLineNumber,e.count)}onLinesDeleted(e){const t=this._linesCollection.onLinesDeleted(e.fromLineNumber,e.toLineNumber);if(t)for(let i=0,n=t.length;i<n;i++){const s=t[i].getDomNode();s==null||s.remove()}return!0}onLinesInserted(e){const t=this._linesCollection.onLinesInserted(e.fromLineNumber,e.toLineNumber);if(t)for(let i=0,n=t.length;i<n;i++){const s=t[i].getDomNode();s==null||s.remove()}return!0}onScrollChanged(e){return e.scrollTopChanged}onTokensChanged(e){return this._linesCollection.onTokensChanged(e.ranges)}onZonesChanged(e){return!0}getStartLineNumber(){return this._linesCollection.getStartLineNumber()}getEndLineNumber(){return this._linesCollection.getEndLineNumber()}getVisibleLine(e){return this._linesCollection.getLine(e)}renderLines(e){const t=this._linesCollection._get(),i=new qs(this.domNode.domNode,this._lineFactory,e),n={rendLineNumberStart:t.rendLineNumberStart,lines:t.lines,linesLength:t.lines.length},s=i.render(n,e.startLineNumber,e.endLineNumber,e.relativeVerticalOffset);this._linesCollection._set(s.rendLineNumberStart,s.lines)}}const Qe=class Qe{constructor(e,t,i){this._domNode=e,this._lineFactory=t,this._viewportData=i}render(e,t,i,n){const s={rendLineNumberStart:e.rendLineNumberStart,lines:e.lines.slice(0),linesLength:e.linesLength};if(s.rendLineNumberStart+s.linesLength-1<t||i<s.rendLineNumberStart){s.rendLineNumberStart=t,s.linesLength=i-t+1,s.lines=[];for(let o=t;o<=i;o++)s.lines[o-t]=this._lineFactory.createLine();return this._finishRendering(s,!0,n),s}if(this._renderUntouchedLines(s,Math.max(t-s.rendLineNumberStart,0),Math.min(i-s.rendLineNumberStart,s.linesLength-1),n,t),s.rendLineNumberStart>t){const o=t,r=Math.min(i,s.rendLineNumberStart-1);o<=r&&(this._insertLinesBefore(s,o,r,n,t),s.linesLength+=r-o+1)}else if(s.rendLineNumberStart<t){const o=Math.min(s.linesLength,t-s.rendLineNumberStart);o>0&&(this._removeLinesBefore(s,o),s.linesLength-=o)}if(s.rendLineNumberStart=t,s.rendLineNumberStart+s.linesLength-1<i){const o=s.rendLineNumberStart+s.linesLength,r=i;o<=r&&(this._insertLinesAfter(s,o,r,n,t),s.linesLength+=r-o+1)}else if(s.rendLineNumberStart+s.linesLength-1>i){const o=Math.max(0,i-s.rendLineNumberStart+1),a=s.linesLength-1-o+1;a>0&&(this._removeLinesAfter(s,a),s.linesLength-=a)}return this._finishRendering(s,!1,n),s}_renderUntouchedLines(e,t,i,n,s){const o=e.rendLineNumberStart,r=e.lines;for(let a=t;a<=i;a++){const l=o+a;r[a].layoutLine(l,n[l-s],this._viewportData.lineHeight)}}_insertLinesBefore(e,t,i,n,s){const o=[];let r=0;for(let a=t;a<=i;a++)o[r++]=this._lineFactory.createLine();e.lines=o.concat(e.lines)}_removeLinesBefore(e,t){for(let i=0;i<t;i++){const n=e.lines[i].getDomNode();n==null||n.remove()}e.lines.splice(0,t)}_insertLinesAfter(e,t,i,n,s){const o=[];let r=0;for(let a=t;a<=i;a++)o[r++]=this._lineFactory.createLine();e.lines=e.lines.concat(o)}_removeLinesAfter(e,t){const i=e.linesLength-t;for(let n=0;n<t;n++){const s=e.lines[i+n].getDomNode();s==null||s.remove()}e.lines.splice(i,t)}_finishRenderingNewLines(e,t,i,n){Qe._ttPolicy&&(i=Qe._ttPolicy.createHTML(i));const s=this._domNode.lastChild;t||!s?this._domNode.innerHTML=i:s.insertAdjacentHTML("afterend",i);let o=this._domNode.lastChild;for(let r=e.linesLength-1;r>=0;r--){const a=e.lines[r];n[r]&&(a.setDomNode(o),o=o.previousSibling)}}_finishRenderingInvalidLines(e,t,i){const n=document.createElement("div");Qe._ttPolicy&&(t=Qe._ttPolicy.createHTML(t)),n.innerHTML=t;for(let s=0;s<e.linesLength;s++){const o=e.lines[s];if(i[s]){const r=n.firstChild,a=o.getDomNode();a.parentNode.replaceChild(r,a),o.setDomNode(r)}}}_finishRendering(e,t,i){const n=Qe._sb,s=e.linesLength,o=e.lines,r=e.rendLineNumberStart,a=[];{n.reset();let l=!1;for(let h=0;h<s;h++){const c=o[h];a[h]=!1,!(c.getDomNode()||!c.renderLine(h+r,i[h],this._viewportData.lineHeight,this._viewportData,n))&&(a[h]=!0,l=!0)}l&&this._finishRenderingNewLines(e,t,n.build(),a)}{n.reset();let l=!1;const h=[];for(let c=0;c<s;c++){const u=o[c];h[c]=!1,!(a[c]||!u.renderLine(c+r,i[c],this._viewportData.lineHeight,this._viewportData,n))&&(h[c]=!0,l=!0)}l&&this._finishRenderingInvalidLines(e,n.build(),h)}}};Qe._ttPolicy=Yi("editorViewLayer",{createHTML:e=>e}),Qe._sb=new Ao(1e5);let qs=Qe;class Ad extends be{constructor(e){super(e),this._dynamicOverlays=[],this._isFocused=!1,this._visibleLines=new Od({createLine:()=>new bg(this._dynamicOverlays)}),this.domNode=this._visibleLines.domNode;const i=this._context.configuration.options.get(50);le(this.domNode,i),this.domNode.setClassName("view-overlays")}shouldRender(){if(super.shouldRender())return!0;for(let e=0,t=this._dynamicOverlays.length;e<t;e++)if(this._dynamicOverlays[e].shouldRender())return!0;return!1}dispose(){super.dispose();for(let e=0,t=this._dynamicOverlays.length;e<t;e++)this._dynamicOverlays[e].dispose();this._dynamicOverlays=[]}getDomNode(){return this.domNode}addDynamicOverlay(e){this._dynamicOverlays.push(e)}onConfigurationChanged(e){this._visibleLines.onConfigurationChanged(e);const i=this._context.configuration.options.get(50);return le(this.domNode,i),!0}onFlushed(e){return this._visibleLines.onFlushed(e)}onFocusChanged(e){return this._isFocused=e.isFocused,!0}onLinesChanged(e){return this._visibleLines.onLinesChanged(e)}onLinesDeleted(e){return this._visibleLines.onLinesDeleted(e)}onLinesInserted(e){return this._visibleLines.onLinesInserted(e)}onScrollChanged(e){return this._visibleLines.onScrollChanged(e)||!0}onTokensChanged(e){return this._visibleLines.onTokensChanged(e)}onZonesChanged(e){return this._visibleLines.onZonesChanged(e)}prepareRender(e){const t=this._dynamicOverlays.filter(i=>i.shouldRender());for(let i=0,n=t.length;i<n;i++){const s=t[i];s.prepareRender(e),s.onDidRender()}}render(e){this._viewOverlaysRender(e),this.domNode.toggleClassName("focused",this._isFocused)}_viewOverlaysRender(e){this._visibleLines.renderLines(e.viewportData)}}class bg{constructor(e){this._dynamicOverlays=e,this._domNode=null,this._renderedContent=null}getDomNode(){return this._domNode?this._domNode.domNode:null}setDomNode(e){this._domNode=$(e)}onContentChanged(){}onTokensChanged(){}renderLine(e,t,i,n,s){let o="";for(let r=0,a=this._dynamicOverlays.length;r<a;r++){const l=this._dynamicOverlays[r];o+=l.render(n.startLineNumber,e)}return this._renderedContent===o?!1:(this._renderedContent=o,s.appendString('<div style="top:'),s.appendString(String(t)),s.appendString("px;height:"),s.appendString(String(i)),s.appendString('px;">'),s.appendString(o),s.appendString("</div>"),!0)}layoutLine(e,t,i){this._domNode&&(this._domNode.setTop(t),this._domNode.setHeight(i))}}class Lg extends Ad{constructor(e){super(e);const i=this._context.configuration.options.get(146);this._contentWidth=i.contentWidth,this.domNode.setHeight(0)}onConfigurationChanged(e){const i=this._context.configuration.options.get(146);return this._contentWidth=i.contentWidth,super.onConfigurationChanged(e)||!0}onScrollChanged(e){return super.onScrollChanged(e)||e.scrollWidthChanged}_viewOverlaysRender(e){super._viewOverlaysRender(e),this.domNode.setWidth(Math.max(e.scrollWidth,this._contentWidth))}}class yg extends Ad{constructor(e){super(e);const t=this._context.configuration.options,i=t.get(146);this._contentLeft=i.contentLeft,this.domNode.setClassName("margin-view-overlays"),this.domNode.setWidth(1),le(this.domNode,t.get(50))}onConfigurationChanged(e){const t=this._context.configuration.options;le(this.domNode,t.get(50));const i=t.get(146);return this._contentLeft=i.contentLeft,super.onConfigurationChanged(e)||!0}onScrollChanged(e){return super.onScrollChanged(e)||e.scrollHeightChanged}_viewOverlaysRender(e){super._viewOverlaysRender(e);const t=Math.min(e.scrollHeight,1e6);this.domNode.setHeight(t),this.domNode.setWidth(this._contentLeft)}}class ms{constructor(e){this.onKeyDown=null,this.onKeyUp=null,this.onContextMenu=null,this.onMouseMove=null,this.onMouseLeave=null,this.onMouseDown=null,this.onMouseUp=null,this.onMouseDrag=null,this.onMouseDrop=null,this.onMouseDropCanceled=null,this.onMouseWheel=null,this._coordinatesConverter=e}emitKeyDown(e){var t;(t=this.onKeyDown)==null||t.call(this,e)}emitKeyUp(e){var t;(t=this.onKeyUp)==null||t.call(this,e)}emitContextMenu(e){var t;(t=this.onContextMenu)==null||t.call(this,this._convertViewToModelMouseEvent(e))}emitMouseMove(e){var t;(t=this.onMouseMove)==null||t.call(this,this._convertViewToModelMouseEvent(e))}emitMouseLeave(e){var t;(t=this.onMouseLeave)==null||t.call(this,this._convertViewToModelMouseEvent(e))}emitMouseDown(e){var t;(t=this.onMouseDown)==null||t.call(this,this._convertViewToModelMouseEvent(e))}emitMouseUp(e){var t;(t=this.onMouseUp)==null||t.call(this,this._convertViewToModelMouseEvent(e))}emitMouseDrag(e){var t;(t=this.onMouseDrag)==null||t.call(this,this._convertViewToModelMouseEvent(e))}emitMouseDrop(e){var t;(t=this.onMouseDrop)==null||t.call(this,this._convertViewToModelMouseEvent(e))}emitMouseDropCanceled(){var e;(e=this.onMouseDropCanceled)==null||e.call(this)}emitMouseWheel(e){var t;(t=this.onMouseWheel)==null||t.call(this,e)}_convertViewToModelMouseEvent(e){return e.target?{event:e.event,target:this._convertViewToModelMouseTarget(e.target)}:e}_convertViewToModelMouseTarget(e){return ms.convertViewToModelMouseTarget(e,this._coordinatesConverter)}static convertViewToModelMouseTarget(e,t){const i={...e};return i.position&&(i.position=t.convertViewPositionToModelPosition(i.position)),i.range&&(i.range=t.convertViewRangeToModelRange(i.range)),(i.type===5||i.type===8)&&(i.detail=this.convertViewToModelViewZoneData(i.detail,t)),i}static convertViewToModelViewZoneData(e,t){return{viewZoneId:e.viewZoneId,positionBefore:e.positionBefore?t.convertViewPositionToModelPosition(e.positionBefore):e.positionBefore,positionAfter:e.positionAfter?t.convertViewPositionToModelPosition(e.positionAfter):e.positionAfter,position:t.convertViewPositionToModelPosition(e.position),afterLineNumber:t.convertViewPositionToModelPosition(new E(e.afterLineNumber,1)).lineNumber}}}class Sg extends be{constructor(e){super(e),this.blocks=[],this.contentWidth=-1,this.contentLeft=0,this.domNode=$(document.createElement("div")),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this.domNode.setClassName("blockDecorations-container"),this.update()}update(){let e=!1;const i=this._context.configuration.options.get(146),n=i.contentWidth-i.verticalScrollbarWidth;this.contentWidth!==n&&(this.contentWidth=n,e=!0);const s=i.contentLeft;return this.contentLeft!==s&&(this.contentLeft=s,e=!0),e}dispose(){super.dispose()}onConfigurationChanged(e){return this.update()}onScrollChanged(e){return e.scrollTopChanged||e.scrollLeftChanged}onDecorationsChanged(e){return!0}onZonesChanged(e){return!0}prepareRender(e){}render(e){let t=0;const i=e.getDecorationsInViewport();for(const n of i){if(!n.options.blockClassName)continue;let s=this.blocks[t];s||(s=this.blocks[t]=$(document.createElement("div")),this.domNode.appendChild(s));let o,r;n.options.blockIsAfterEnd?(o=e.getVerticalOffsetAfterLineNumber(n.range.endLineNumber,!1),r=e.getVerticalOffsetAfterLineNumber(n.range.endLineNumber,!0)):(o=e.getVerticalOffsetForLineNumber(n.range.startLineNumber,!0),r=n.range.isEmpty()&&!n.options.blockDoesNotCollapse?e.getVerticalOffsetForLineNumber(n.range.startLineNumber,!1):e.getVerticalOffsetAfterLineNumber(n.range.endLineNumber,!0));const[a,l,h,c]=n.options.blockPadding??[0,0,0,0];s.setClassName("blockDecorations-block "+n.options.blockClassName),s.setLeft(this.contentLeft-c),s.setWidth(this.contentWidth+c+l),s.setTop(o-e.scrollTop-a),s.setHeight(r-o+a+h),t++}for(let n=t;n<this.blocks.length;n++)this.blocks[n].domNode.remove();this.blocks.length=t}}class Dg extends be{constructor(e,t){super(e),this._viewDomNode=t,this._widgets={},this.domNode=$(document.createElement("div")),Ve.write(this.domNode,1),this.domNode.setClassName("contentWidgets"),this.domNode.setPosition("absolute"),this.domNode.setTop(0),this.overflowingContentWidgetsDomNode=$(document.createElement("div")),Ve.write(this.overflowingContentWidgetsDomNode,2),this.overflowingContentWidgetsDomNode.setClassName("overflowingContentWidgets")}dispose(){super.dispose(),this._widgets={}}onConfigurationChanged(e){const t=Object.keys(this._widgets);for(const i of t)this._widgets[i].onConfigurationChanged(e);return!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLineMappingChanged(e){return this._updateAnchorsViewPositions(),!0}onLinesChanged(e){return this._updateAnchorsViewPositions(),!0}onLinesDeleted(e){return this._updateAnchorsViewPositions(),!0}onLinesInserted(e){return this._updateAnchorsViewPositions(),!0}onScrollChanged(e){return!0}onZonesChanged(e){return!0}_updateAnchorsViewPositions(){const e=Object.keys(this._widgets);for(const t of e)this._widgets[t].updateAnchorViewPosition()}addWidget(e){const t=new Ng(this._context,this._viewDomNode,e);this._widgets[t.id]=t,t.allowEditorOverflow?this.overflowingContentWidgetsDomNode.appendChild(t.domNode):this.domNode.appendChild(t.domNode),this.setShouldRender()}setWidgetPosition(e,t,i,n,s){this._widgets[e.getId()].setPosition(t,i,n,s),this.setShouldRender()}removeWidget(e){const t=e.getId();if(this._widgets.hasOwnProperty(t)){const i=this._widgets[t];delete this._widgets[t];const n=i.domNode.domNode;n.remove(),n.removeAttribute("monaco-visible-content-widget"),this.setShouldRender()}}shouldSuppressMouseDownOnWidget(e){return this._widgets.hasOwnProperty(e)?this._widgets[e].suppressMouseDown:!1}onBeforeRender(e){const t=Object.keys(this._widgets);for(const i of t)this._widgets[i].onBeforeRender(e)}prepareRender(e){const t=Object.keys(this._widgets);for(const i of t)this._widgets[i].prepareRender(e)}render(e){const t=Object.keys(this._widgets);for(const i of t)this._widgets[i].render(e)}}class Ng{constructor(e,t,i){this._primaryAnchor=new yi(null,null),this._secondaryAnchor=new yi(null,null),this._context=e,this._viewDomNode=t,this._actual=i,this.domNode=$(this._actual.getDomNode()),this.id=this._actual.getId(),this.allowEditorOverflow=this._actual.allowEditorOverflow||!1,this.suppressMouseDown=this._actual.suppressMouseDown||!1;const n=this._context.configuration.options,s=n.get(146);this._fixedOverflowWidgets=n.get(42),this._contentWidth=s.contentWidth,this._contentLeft=s.contentLeft,this._lineHeight=n.get(67),this._affinity=null,this._preference=[],this._cachedDomNodeOffsetWidth=-1,this._cachedDomNodeOffsetHeight=-1,this._maxWidth=this._getMaxWidth(),this._isVisible=!1,this._renderData=null,this.domNode.setPosition(this._fixedOverflowWidgets&&this.allowEditorOverflow?"fixed":"absolute"),this.domNode.setDisplay("none"),this.domNode.setVisibility("hidden"),this.domNode.setAttribute("widgetId",this.id),this.domNode.setMaxWidth(this._maxWidth)}onConfigurationChanged(e){const t=this._context.configuration.options;if(this._lineHeight=t.get(67),e.hasChanged(146)){const i=t.get(146);this._contentLeft=i.contentLeft,this._contentWidth=i.contentWidth,this._maxWidth=this._getMaxWidth()}}updateAnchorViewPosition(){this._setPosition(this._affinity,this._primaryAnchor.modelPosition,this._secondaryAnchor.modelPosition)}_setPosition(e,t,i){this._affinity=e,this._primaryAnchor=n(t,this._context.viewModel,this._affinity),this._secondaryAnchor=n(i,this._context.viewModel,this._affinity);function n(s,o,r){if(!s)return new yi(null,null);const a=o.model.validatePosition(s);if(o.coordinatesConverter.modelPositionIsVisible(a)){const l=o.coordinatesConverter.convertModelPositionToViewPosition(a,r??void 0);return new yi(s,l)}return new yi(s,null)}}_getMaxWidth(){const e=this.domNode.domNode.ownerDocument,t=e.defaultView;return this.allowEditorOverflow?(t==null?void 0:t.innerWidth)||e.documentElement.offsetWidth||e.body.offsetWidth:this._contentWidth}setPosition(e,t,i,n){this._setPosition(n,e,t),this._preference=i,this._primaryAnchor.viewPosition&&this._preference&&this._preference.length>0?this.domNode.setDisplay("block"):this.domNode.setDisplay("none"),this._cachedDomNodeOffsetWidth=-1,this._cachedDomNodeOffsetHeight=-1}_layoutBoxInViewport(e,t,i,n){const s=e.top,o=s,r=e.top+e.height,a=n.viewportHeight-r,l=s-i,h=o>=i,c=r,u=a>=i;let _=e.left;return _+t>n.scrollLeft+n.viewportWidth&&(_=n.scrollLeft+n.viewportWidth-t),_<n.scrollLeft&&(_=n.scrollLeft),{fitsAbove:h,aboveTop:l,fitsBelow:u,belowTop:c,left:_}}_layoutHorizontalSegmentInPage(e,t,i,n){const r=Math.max(15,t.left-n),a=Math.min(t.left+t.width+n,e.width-15),h=this._viewDomNode.domNode.ownerDocument.defaultView;let c=t.left+i-((h==null?void 0:h.scrollX)??0);if(c+n>a){const u=c-(a-n);c-=u,i-=u}if(c<r){const u=c-r;c-=u,i-=u}return[i,c]}_layoutBoxInPage(e,t,i,n){const s=e.top-i,o=e.top+e.height,r=Tt(this._viewDomNode.domNode),a=this._viewDomNode.domNode.ownerDocument,l=a.defaultView,h=r.top+s-((l==null?void 0:l.scrollY)??0),c=r.top+o-((l==null?void 0:l.scrollY)??0),u=Ol(a.body),[_,f]=this._layoutHorizontalSegmentInPage(u,r,e.left-n.scrollLeft+this._contentLeft,t),w=22,C=22,v=h>=w,g=c+i<=u.height-C;return this._fixedOverflowWidgets?{fitsAbove:v,aboveTop:Math.max(h,w),fitsBelow:g,belowTop:c,left:f}:{fitsAbove:v,aboveTop:s,fitsBelow:g,belowTop:o,left:_}}_prepareRenderWidgetAtExactPositionOverflowing(e){return new Si(e.top,e.left+this._contentLeft)}_getAnchorsCoordinates(e){var o,r;const t=s(this._primaryAnchor.viewPosition,this._affinity,this._lineHeight),i=((o=this._secondaryAnchor.viewPosition)==null?void 0:o.lineNumber)===((r=this._primaryAnchor.viewPosition)==null?void 0:r.lineNumber)?this._secondaryAnchor.viewPosition:null,n=s(i,this._affinity,this._lineHeight);return{primary:t,secondary:n};function s(a,l,h){if(!a)return null;const c=e.visibleRangeForPosition(a);if(!c)return null;const u=a.column===1&&l===3?0:c.left,_=e.getVerticalOffsetForLineNumber(a.lineNumber)-e.scrollTop;return new ia(_,u,h)}}_reduceAnchorCoordinates(e,t,i){if(!t)return e;const n=this._context.configuration.options.get(50);let s=t.left;return s<e.left?s=Math.max(s,e.left-i+n.typicalFullwidthCharacterWidth):s=Math.min(s,e.left+i-n.typicalFullwidthCharacterWidth),new ia(e.top,s,e.height)}_prepareRenderWidget(e){if(!this._preference||this._preference.length===0)return null;const{primary:t,secondary:i}=this._getAnchorsCoordinates(e);if(!t)return{kind:"offViewport",preserveFocus:this.domNode.domNode.contains(this.domNode.domNode.ownerDocument.activeElement)};if(this._cachedDomNodeOffsetWidth===-1||this._cachedDomNodeOffsetHeight===-1){let o=null;if(typeof this._actual.beforeRender=="function"&&(o=Cs(this._actual.beforeRender,this._actual)),o)this._cachedDomNodeOffsetWidth=o.width,this._cachedDomNodeOffsetHeight=o.height;else{const a=this.domNode.domNode.getBoundingClientRect();this._cachedDomNodeOffsetWidth=Math.round(a.width),this._cachedDomNodeOffsetHeight=Math.round(a.height)}}const n=this._reduceAnchorCoordinates(t,i,this._cachedDomNodeOffsetWidth);let s;this.allowEditorOverflow?s=this._layoutBoxInPage(n,this._cachedDomNodeOffsetWidth,this._cachedDomNodeOffsetHeight,e):s=this._layoutBoxInViewport(n,this._cachedDomNodeOffsetWidth,this._cachedDomNodeOffsetHeight,e);for(let o=1;o<=2;o++)for(const r of this._preference)if(r===1){if(!s)return null;if(o===2||s.fitsAbove)return{kind:"inViewport",coordinate:new Si(s.aboveTop,s.left),position:1}}else if(r===2){if(!s)return null;if(o===2||s.fitsBelow)return{kind:"inViewport",coordinate:new Si(s.belowTop,s.left),position:2}}else return this.allowEditorOverflow?{kind:"inViewport",coordinate:this._prepareRenderWidgetAtExactPositionOverflowing(new Si(n.top,n.left)),position:0}:{kind:"inViewport",coordinate:new Si(n.top,n.left),position:0};return null}onBeforeRender(e){!this._primaryAnchor.viewPosition||!this._preference||this._primaryAnchor.viewPosition.lineNumber<e.startLineNumber||this._primaryAnchor.viewPosition.lineNumber>e.endLineNumber||this.domNode.setMaxWidth(this._maxWidth)}prepareRender(e){this._renderData=this._prepareRenderWidget(e)}render(e){var t;if(!this._renderData||this._renderData.kind==="offViewport"){this._isVisible&&(this.domNode.removeAttribute("monaco-visible-content-widget"),this._isVisible=!1,((t=this._renderData)==null?void 0:t.kind)==="offViewport"&&this._renderData.preserveFocus?this.domNode.setTop(-1e3):this.domNode.setVisibility("hidden")),typeof this._actual.afterRender=="function"&&Cs(this._actual.afterRender,this._actual,null);return}this.allowEditorOverflow?(this.domNode.setTop(this._renderData.coordinate.top),this.domNode.setLeft(this._renderData.coordinate.left)):(this.domNode.setTop(this._renderData.coordinate.top+e.scrollTop-e.bigNumbersDelta),this.domNode.setLeft(this._renderData.coordinate.left)),this._isVisible||(this.domNode.setVisibility("inherit"),this.domNode.setAttribute("monaco-visible-content-widget","true"),this._isVisible=!0),typeof this._actual.afterRender=="function"&&Cs(this._actual.afterRender,this._actual,this._renderData.position)}}class yi{constructor(e,t){this.modelPosition=e,this.viewPosition=t}}class Si{constructor(e,t){this.top=e,this.left=t,this._coordinateBrand=void 0}}class ia{constructor(e,t,i){this.top=e,this.left=t,this.height=i,this._anchorCoordinateBrand=void 0}}function Cs(d,e,...t){try{return d.call(e,...t)}catch{return null}}class Pd extends Pt{constructor(e){super(),this._context=e;const t=this._context.configuration.options,i=t.get(146);this._renderLineHighlight=t.get(97),this._renderLineHighlightOnlyWhenFocus=t.get(98),this._wordWrap=i.isViewportWrapping,this._contentLeft=i.contentLeft,this._contentWidth=i.contentWidth,this._selectionIsEmpty=!0,this._focused=!1,this._cursorLineNumbers=[1],this._selections=[new Me(1,1,1,1)],this._renderData=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),super.dispose()}_readFromSelections(){let e=!1;const t=new Set;for(const s of this._selections)t.add(s.positionLineNumber);const i=Array.from(t);i.sort((s,o)=>s-o),yo(this._cursorLineNumbers,i)||(this._cursorLineNumbers=i,e=!0);const n=this._selections.every(s=>s.isEmpty());return this._selectionIsEmpty!==n&&(this._selectionIsEmpty=n,e=!0),e}onThemeChanged(e){return this._readFromSelections()}onConfigurationChanged(e){const t=this._context.configuration.options,i=t.get(146);return this._renderLineHighlight=t.get(97),this._renderLineHighlightOnlyWhenFocus=t.get(98),this._wordWrap=i.isViewportWrapping,this._contentLeft=i.contentLeft,this._contentWidth=i.contentWidth,!0}onCursorStateChanged(e){return this._selections=e.selections,this._readFromSelections()}onFlushed(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollWidthChanged||e.scrollTopChanged}onZonesChanged(e){return!0}onFocusChanged(e){return this._renderLineHighlightOnlyWhenFocus?(this._focused=e.isFocused,!0):!1}prepareRender(e){if(!this._shouldRenderThis()){this._renderData=null;return}const t=e.visibleRange.startLineNumber,i=e.visibleRange.endLineNumber,n=[];for(let o=t;o<=i;o++){const r=o-t;n[r]=""}if(this._wordWrap){const o=this._renderOne(e,!1);for(const r of this._cursorLineNumbers){const a=this._context.viewModel.coordinatesConverter,l=a.convertViewPositionToModelPosition(new E(r,1)).lineNumber,h=a.convertModelPositionToViewPosition(new E(l,1)).lineNumber,c=a.convertModelPositionToViewPosition(new E(l,this._context.viewModel.model.getLineMaxColumn(l))).lineNumber,u=Math.max(h,t),_=Math.min(c,i);for(let f=u;f<=_;f++){const w=f-t;n[w]=o}}}const s=this._renderOne(e,!0);for(const o of this._cursorLineNumbers){if(o<t||o>i)continue;const r=o-t;n[r]=s}this._renderData=n}render(e,t){if(!this._renderData)return"";const i=t-e;return i>=this._renderData.length?"":this._renderData[i]}_shouldRenderInMargin(){return(this._renderLineHighlight==="gutter"||this._renderLineHighlight==="all")&&(!this._renderLineHighlightOnlyWhenFocus||this._focused)}_shouldRenderInContent(){return(this._renderLineHighlight==="line"||this._renderLineHighlight==="all")&&this._selectionIsEmpty&&(!this._renderLineHighlightOnlyWhenFocus||this._focused)}}class Mg extends Pd{_renderOne(e,t){return`<div class="${"current-line"+(this._shouldRenderInMargin()?" current-line-both":"")+(t?" current-line-exact":"")}" style="width:${Math.max(e.scrollWidth,this._contentWidth)}px;"></div>`}_shouldRenderThis(){return this._shouldRenderInContent()}_shouldRenderOther(){return this._shouldRenderInMargin()}}class Rg extends Pd{_renderOne(e,t){return`<div class="${"current-line"+(this._shouldRenderInMargin()?" current-line-margin":"")+(this._shouldRenderOther()?" current-line-margin-both":"")+(this._shouldRenderInMargin()&&t?" current-line-exact-margin":"")}" style="width:${this._contentLeft}px"></div>`}_shouldRenderThis(){return!0}_shouldRenderOther(){return this._shouldRenderInContent()}}At((d,e)=>{const t=d.getColor(xh);if(t&&(e.addRule(`.monaco-editor .view-overlays .current-line { background-color: ${t}; }`),e.addRule(`.monaco-editor .margin-view-overlays .current-line-margin { background-color: ${t}; border: none; }`)),!t||t.isTransparent()||d.defines(Sr)){const i=d.getColor(Sr);i&&(e.addRule(`.monaco-editor .view-overlays .current-line-exact { border: 2px solid ${i}; }`),e.addRule(`.monaco-editor .margin-view-overlays .current-line-exact-margin { border: 2px solid ${i}; }`),Pi(d.type)&&(e.addRule(".monaco-editor .view-overlays .current-line-exact { border-width: 1px; }"),e.addRule(".monaco-editor .margin-view-overlays .current-line-exact-margin { border-width: 1px; }")))}});class xg extends Pt{constructor(e){super(),this._context=e;const t=this._context.configuration.options;this._typicalHalfwidthCharacterWidth=t.get(50).typicalHalfwidthCharacterWidth,this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){const t=this._context.configuration.options;return this._typicalHalfwidthCharacterWidth=t.get(50).typicalHalfwidthCharacterWidth,!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged||e.scrollWidthChanged}onZonesChanged(e){return!0}prepareRender(e){const t=e.getDecorationsInViewport();let i=[],n=0;for(let a=0,l=t.length;a<l;a++){const h=t[a];h.options.className&&(i[n++]=h)}i=i.sort((a,l)=>{if(a.options.zIndex<l.options.zIndex)return-1;if(a.options.zIndex>l.options.zIndex)return 1;const h=a.options.className,c=l.options.className;return h<c?-1:h>c?1:W.compareRangesUsingStarts(a.range,l.range)});const s=e.visibleRange.startLineNumber,o=e.visibleRange.endLineNumber,r=[];for(let a=s;a<=o;a++){const l=a-s;r[l]=""}this._renderWholeLineDecorations(e,i,r),this._renderNormalDecorations(e,i,r),this._renderResult=r}_renderWholeLineDecorations(e,t,i){const n=e.visibleRange.startLineNumber,s=e.visibleRange.endLineNumber;for(let o=0,r=t.length;o<r;o++){const a=t[o];if(!a.options.isWholeLine)continue;const l='<div class="cdr '+a.options.className+'" style="left:0;width:100%;"></div>',h=Math.max(a.range.startLineNumber,n),c=Math.min(a.range.endLineNumber,s);for(let u=h;u<=c;u++){const _=u-n;i[_]+=l}}}_renderNormalDecorations(e,t,i){const n=e.visibleRange.startLineNumber;let s=null,o=!1,r=null,a=!1;for(let l=0,h=t.length;l<h;l++){const c=t[l];if(c.options.isWholeLine)continue;const u=c.options.className,_=!!c.options.showIfCollapsed;let f=c.range;if(_&&f.endColumn===1&&f.endLineNumber!==f.startLineNumber&&(f=new W(f.startLineNumber,f.startColumn,f.endLineNumber-1,this._context.viewModel.getLineMaxColumn(f.endLineNumber-1))),s===u&&o===_&&W.areIntersectingOrTouching(r,f)){r=W.plusRange(r,f);continue}s!==null&&this._renderNormalDecoration(e,r,s,a,o,n,i),s=u,o=_,r=f,a=c.options.shouldFillLineOnLineBreak??!1}s!==null&&this._renderNormalDecoration(e,r,s,a,o,n,i)}_renderNormalDecoration(e,t,i,n,s,o,r){const a=e.linesVisibleRangesForRange(t,i==="findMatch");if(a)for(let l=0,h=a.length;l<h;l++){const c=a[l];if(c.outsideRenderedLine)continue;const u=c.lineNumber-o;if(s&&c.ranges.length===1){const _=c.ranges[0];if(_.width<this._typicalHalfwidthCharacterWidth){const f=Math.round(_.left+_.width/2),w=Math.max(0,Math.round(f-this._typicalHalfwidthCharacterWidth/2));c.ranges[0]=new fs(w,this._typicalHalfwidthCharacterWidth)}}for(let _=0,f=c.ranges.length;_<f;_++){const w=n&&c.continuesOnNextLine&&f===1,C=c.ranges[_],v='<div class="cdr '+i+'" style="left:'+String(C.left)+"px;width:"+(w?"100%;":String(C.width)+"px;")+'"></div>';r[u]+=v}}}render(e,t){if(!this._renderResult)return"";const i=t-e;return i<0||i>=this._renderResult.length?"":this._renderResult[i]}}class Eg extends be{constructor(e,t,i,n){super(e);const s=this._context.configuration.options,o=s.get(104),r=s.get(75),a=s.get(40),l=s.get(107),h={listenOnDomNode:i.domNode,className:"editor-scrollable "+As(e.theme.type),useShadows:!1,lazyRender:!0,vertical:o.vertical,horizontal:o.horizontal,verticalHasArrows:o.verticalHasArrows,horizontalHasArrows:o.horizontalHasArrows,verticalScrollbarSize:o.verticalScrollbarSize,verticalSliderSize:o.verticalSliderSize,horizontalScrollbarSize:o.horizontalScrollbarSize,horizontalSliderSize:o.horizontalSliderSize,handleMouseWheel:o.handleMouseWheel,alwaysConsumeMouseWheel:o.alwaysConsumeMouseWheel,arrowSize:o.arrowSize,mouseWheelScrollSensitivity:r,fastScrollSensitivity:a,scrollPredominantAxis:l,scrollByPage:o.scrollByPage};this.scrollbar=this._register(new Ka(t.domNode,h,this._context.viewLayout.getScrollable())),Ve.write(this.scrollbar.getDomNode(),6),this.scrollbarDomNode=$(this.scrollbar.getDomNode()),this.scrollbarDomNode.setPosition("absolute"),this._setLayout();const c=(u,_,f)=>{const w={};{const C=u.scrollTop;C&&(w.scrollTop=this._context.viewLayout.getCurrentScrollTop()+C,u.scrollTop=0)}if(f){const C=u.scrollLeft;C&&(w.scrollLeft=this._context.viewLayout.getCurrentScrollLeft()+C,u.scrollLeft=0)}this._context.viewModel.viewLayout.setScrollPosition(w,1)};this._register(P(i.domNode,"scroll",u=>c(i.domNode,!0,!0))),this._register(P(t.domNode,"scroll",u=>c(t.domNode,!0,!1))),this._register(P(n.domNode,"scroll",u=>c(n.domNode,!0,!1))),this._register(P(this.scrollbarDomNode.domNode,"scroll",u=>c(this.scrollbarDomNode.domNode,!0,!1)))}dispose(){super.dispose()}_setLayout(){const e=this._context.configuration.options,t=e.get(146);this.scrollbarDomNode.setLeft(t.contentLeft),e.get(73).side==="right"?this.scrollbarDomNode.setWidth(t.contentWidth+t.minimap.minimapWidth):this.scrollbarDomNode.setWidth(t.contentWidth),this.scrollbarDomNode.setHeight(t.height)}getOverviewRulerLayoutInfo(){return this.scrollbar.getOverviewRulerLayoutInfo()}getDomNode(){return this.scrollbarDomNode}delegateVerticalScrollbarPointerDown(e){this.scrollbar.delegateVerticalScrollbarPointerDown(e)}delegateScrollFromMouseWheelEvent(e){this.scrollbar.delegateScrollFromMouseWheelEvent(e)}onConfigurationChanged(e){if(e.hasChanged(104)||e.hasChanged(75)||e.hasChanged(40)){const t=this._context.configuration.options,i=t.get(104),n=t.get(75),s=t.get(40),o=t.get(107),r={vertical:i.vertical,horizontal:i.horizontal,verticalScrollbarSize:i.verticalScrollbarSize,horizontalScrollbarSize:i.horizontalScrollbarSize,scrollByPage:i.scrollByPage,handleMouseWheel:i.handleMouseWheel,mouseWheelScrollSensitivity:n,fastScrollSensitivity:s,scrollPredominantAxis:o};this.scrollbar.updateOptions(r)}return e.hasChanged(146)&&this._setLayout(),!0}onScrollChanged(e){return!0}onThemeChanged(e){return this.scrollbar.updateClassName("editor-scrollable "+As(this._context.theme.type)),!0}prepareRender(e){}render(e){this.scrollbar.renderNow()}}class Ys{constructor(e,t,i,n,s){this.startLineNumber=e,this.endLineNumber=t,this.className=i,this.tooltip=n,this._decorationToRenderBrand=void 0,this.zIndex=s??0}}class Tg{constructor(e,t,i){this.className=e,this.zIndex=t,this.tooltip=i}}class Ig{constructor(){this.decorations=[]}add(e){this.decorations.push(e)}getDecorations(){return this.decorations}}class Wd extends Pt{_render(e,t,i){const n=[];for(let r=e;r<=t;r++){const a=r-e;n[a]=new Ig}if(i.length===0)return n;i.sort((r,a)=>r.className===a.className?r.startLineNumber===a.startLineNumber?r.endLineNumber-a.endLineNumber:r.startLineNumber-a.startLineNumber:r.className<a.className?-1:1);let s=null,o=0;for(let r=0,a=i.length;r<a;r++){const l=i[r],h=l.className,c=l.zIndex;let u=Math.max(l.startLineNumber,e)-e;const _=Math.min(l.endLineNumber,t)-e;s===h?(u=Math.max(o+1,u),o=Math.max(o,_)):(s=h,o=_);for(let f=u;f<=o;f++)n[f].add(new Tg(h,c,l.tooltip))}return n}}class Og extends be{constructor(e){super(e),this._widgets={},this._context=e;const t=this._context.configuration.options,i=t.get(146);this.domNode=$(document.createElement("div")),this.domNode.setClassName("glyph-margin-widgets"),this.domNode.setPosition("absolute"),this.domNode.setTop(0),this._lineHeight=t.get(67),this._glyphMargin=t.get(57),this._glyphMarginLeft=i.glyphMarginLeft,this._glyphMarginWidth=i.glyphMarginWidth,this._glyphMarginDecorationLaneCount=i.glyphMarginDecorationLaneCount,this._managedDomNodes=[],this._decorationGlyphsToRender=[]}dispose(){this._managedDomNodes=[],this._decorationGlyphsToRender=[],this._widgets={},super.dispose()}getWidgets(){return Object.values(this._widgets)}onConfigurationChanged(e){const t=this._context.configuration.options,i=t.get(146);return this._lineHeight=t.get(67),this._glyphMargin=t.get(57),this._glyphMarginLeft=i.glyphMarginLeft,this._glyphMarginWidth=i.glyphMarginWidth,this._glyphMarginDecorationLaneCount=i.glyphMarginDecorationLaneCount,!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}addWidget(e){const t=$(e.getDomNode());this._widgets[e.getId()]={widget:e,preference:e.getPosition(),domNode:t,renderInfo:null},t.setPosition("absolute"),t.setDisplay("none"),t.setAttribute("widgetId",e.getId()),this.domNode.appendChild(t),this.setShouldRender()}setWidgetPosition(e,t){const i=this._widgets[e.getId()];return i.preference.lane===t.lane&&i.preference.zIndex===t.zIndex&&W.equalsRange(i.preference.range,t.range)?!1:(i.preference=t,this.setShouldRender(),!0)}removeWidget(e){const t=e.getId();if(this._widgets[t]){const n=this._widgets[t].domNode.domNode;delete this._widgets[t],n.remove(),this.setShouldRender()}}_collectDecorationBasedGlyphRenderRequest(e,t){var o;const i=e.visibleRange.startLineNumber,n=e.visibleRange.endLineNumber,s=e.getDecorationsInViewport();for(const r of s){const a=r.options.glyphMarginClassName;if(!a)continue;const l=Math.max(r.range.startLineNumber,i),h=Math.min(r.range.endLineNumber,n),c=((o=r.options.glyphMargin)==null?void 0:o.position)??Po.Center,u=r.options.zIndex??0;for(let _=l;_<=h;_++){const f=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new E(_,0)),w=this._context.viewModel.glyphLanes.getLanesAtLine(f.lineNumber).indexOf(c);t.push(new Ag(_,w,u,a))}}}_collectWidgetBasedGlyphRenderRequest(e,t){const i=e.visibleRange.startLineNumber,n=e.visibleRange.endLineNumber;for(const s of Object.values(this._widgets)){const o=s.preference.range,{startLineNumber:r,endLineNumber:a}=this._context.viewModel.coordinatesConverter.convertModelRangeToViewRange(W.lift(o));if(!r||!a||a<i||r>n)continue;const l=Math.max(r,i),h=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new E(l,0)),c=this._context.viewModel.glyphLanes.getLanesAtLine(h.lineNumber).indexOf(s.preference.lane);t.push(new Pg(l,c,s.preference.zIndex,s))}}_collectSortedGlyphRenderRequests(e){const t=[];return this._collectDecorationBasedGlyphRenderRequest(e,t),this._collectWidgetBasedGlyphRenderRequest(e,t),t.sort((i,n)=>i.lineNumber===n.lineNumber?i.laneIndex===n.laneIndex?i.zIndex===n.zIndex?n.type===i.type?i.type===0&&n.type===0?i.className<n.className?-1:1:0:n.type-i.type:n.zIndex-i.zIndex:i.laneIndex-n.laneIndex:i.lineNumber-n.lineNumber),t}prepareRender(e){if(!this._glyphMargin){this._decorationGlyphsToRender=[];return}for(const n of Object.values(this._widgets))n.renderInfo=null;const t=new vn(this._collectSortedGlyphRenderRequests(e)),i=[];for(;t.length>0;){const n=t.peek();if(!n)break;const s=t.takeWhile(r=>r.lineNumber===n.lineNumber&&r.laneIndex===n.laneIndex);if(!s||s.length===0)break;const o=s[0];if(o.type===0){const r=[];for(const a of s){if(a.zIndex!==o.zIndex||a.type!==o.type)break;(r.length===0||r[r.length-1]!==a.className)&&r.push(a.className)}i.push(o.accept(r.join(" ")))}else o.widget.renderInfo={lineNumber:o.lineNumber,laneIndex:o.laneIndex}}this._decorationGlyphsToRender=i}render(e){if(!this._glyphMargin){for(const i of Object.values(this._widgets))i.domNode.setDisplay("none");for(;this._managedDomNodes.length>0;){const i=this._managedDomNodes.pop();i==null||i.domNode.remove()}return}const t=Math.round(this._glyphMarginWidth/this._glyphMarginDecorationLaneCount);for(const i of Object.values(this._widgets))if(!i.renderInfo)i.domNode.setDisplay("none");else{const n=e.viewportData.relativeVerticalOffset[i.renderInfo.lineNumber-e.viewportData.startLineNumber],s=this._glyphMarginLeft+i.renderInfo.laneIndex*this._lineHeight;i.domNode.setDisplay("block"),i.domNode.setTop(n),i.domNode.setLeft(s),i.domNode.setWidth(t),i.domNode.setHeight(this._lineHeight)}for(let i=0;i<this._decorationGlyphsToRender.length;i++){const n=this._decorationGlyphsToRender[i],s=e.viewportData.relativeVerticalOffset[n.lineNumber-e.viewportData.startLineNumber],o=this._glyphMarginLeft+n.laneIndex*this._lineHeight;let r;i<this._managedDomNodes.length?r=this._managedDomNodes[i]:(r=$(document.createElement("div")),this._managedDomNodes.push(r),this.domNode.appendChild(r)),r.setClassName("cgmr codicon "+n.combinedClassName),r.setPosition("absolute"),r.setTop(s),r.setLeft(o),r.setWidth(t),r.setHeight(this._lineHeight)}for(;this._managedDomNodes.length>this._decorationGlyphsToRender.length;){const i=this._managedDomNodes.pop();i==null||i.domNode.remove()}}}class Ag{constructor(e,t,i,n){this.lineNumber=e,this.laneIndex=t,this.zIndex=i,this.className=n,this.type=0}accept(e){return new Wg(this.lineNumber,this.laneIndex,e)}}class Pg{constructor(e,t,i,n){this.lineNumber=e,this.laneIndex=t,this.zIndex=i,this.widget=n,this.type=1}}class Wg{constructor(e,t,i){this.lineNumber=e,this.laneIndex=t,this.combinedClassName=i}}class Hg extends Pt{constructor(e){super(),this._context=e,this._primaryPosition=null;const t=this._context.configuration.options,i=t.get(147),n=t.get(50);this._spaceWidth=n.spaceWidth,this._maxIndentLeft=i.wrappingColumn===-1?-1:i.wrappingColumn*n.typicalHalfwidthCharacterWidth,this._bracketPairGuideOptions=t.get(16),this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){const t=this._context.configuration.options,i=t.get(147),n=t.get(50);return this._spaceWidth=n.spaceWidth,this._maxIndentLeft=i.wrappingColumn===-1?-1:i.wrappingColumn*n.typicalHalfwidthCharacterWidth,this._bracketPairGuideOptions=t.get(16),!0}onCursorStateChanged(e){var n;const i=e.selections[0].getPosition();return(n=this._primaryPosition)!=null&&n.equals(i)?!1:(this._primaryPosition=i,!0)}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}onLanguageConfigurationChanged(e){return!0}prepareRender(e){var a,l;if(!this._bracketPairGuideOptions.indentation&&this._bracketPairGuideOptions.bracketPairs===!1){this._renderResult=null;return}const t=e.visibleRange.startLineNumber,i=e.visibleRange.endLineNumber,n=e.scrollWidth,s=this._primaryPosition,o=this.getGuidesByLine(t,Math.min(i+1,this._context.viewModel.getLineCount()),s),r=[];for(let h=t;h<=i;h++){const c=h-t,u=o[c];let _="";const f=((a=e.visibleRangeForPosition(new E(h,1)))==null?void 0:a.left)??0;for(const w of u){const C=w.column===-1?f+(w.visibleColumn-1)*this._spaceWidth:e.visibleRangeForPosition(new E(h,w.column)).left;if(C>n||this._maxIndentLeft>0&&C>this._maxIndentLeft)break;const v=w.horizontalLine?w.horizontalLine.top?"horizontal-top":"horizontal-bottom":"vertical",g=w.horizontalLine?(((l=e.visibleRangeForPosition(new E(h,w.horizontalLine.endColumn)))==null?void 0:l.left)??C+this._spaceWidth)-C:this._spaceWidth;_+=`<div class="core-guide ${w.className} ${v}" style="left:${C}px;width:${g}px"></div>`}r[c]=_}this._renderResult=r}getGuidesByLine(e,t,i){const n=this._bracketPairGuideOptions.bracketPairs!==!1?this._context.viewModel.getBracketGuidesInRangeByLine(e,t,i,{highlightActive:this._bracketPairGuideOptions.highlightActiveBracketPair,horizontalGuides:this._bracketPairGuideOptions.bracketPairsHorizontal===!0?_s.Enabled:this._bracketPairGuideOptions.bracketPairsHorizontal==="active"?_s.EnabledForActive:_s.Disabled,includeInactive:this._bracketPairGuideOptions.bracketPairs===!0}):null,s=this._bracketPairGuideOptions.indentation?this._context.viewModel.getLinesIndentGuides(e,t):null;let o=0,r=0,a=0;if(this._bracketPairGuideOptions.highlightActiveIndentation!==!1&&i){const c=this._context.viewModel.getActiveIndentGuide(i.lineNumber,e,t);o=c.startLineNumber,r=c.endLineNumber,a=c.indent}const{indentSize:l}=this._context.viewModel.model.getOptions(),h=[];for(let c=e;c<=t;c++){const u=new Array;h.push(u);const _=n?n[c-e]:[],f=new vn(_),w=s?s[c-e]:0;for(let C=1;C<=w;C++){const v=(C-1)*l+1,g=(this._bracketPairGuideOptions.highlightActiveIndentation==="always"||_.length===0)&&o<=c&&c<=r&&C===a;u.push(...f.takeWhile(m=>m.visibleColumn<v)||[]);const p=f.peek();(!p||p.visibleColumn!==v||p.horizontalLine)&&u.push(new ac(v,-1,`core-guide-indent lvl-${(C-1)%30}`+(g?" indent-active":""),null,-1,-1))}u.push(...f.takeWhile(C=>!0)||[])}return h}render(e,t){if(!this._renderResult)return"";const i=t-e;return i<0||i>=this._renderResult.length?"":this._renderResult[i]}}function Ut(d){if(!(d&&d.isTransparent()))return d}At((d,e)=>{const t=[{bracketColor:Ih,guideColor:Th,guideColorActive:Eh},{bracketColor:Ph,guideColor:Ah,guideColorActive:Oh},{bracketColor:kh,guideColor:Hh,guideColorActive:Wh},{bracketColor:Bh,guideColor:Fh,guideColorActive:Vh},{bracketColor:$h,guideColor:zh,guideColorActive:Uh},{bracketColor:Zh,guideColor:jh,guideColorActive:Gh}],i=new rc,n=[{indentColor:qh,indentColorActive:Kh},{indentColor:Qh,indentColorActive:Yh},{indentColor:Jh,indentColorActive:Xh},{indentColor:tc,indentColorActive:ec},{indentColor:nc,indentColorActive:ic},{indentColor:oc,indentColorActive:sc}],s=t.map(r=>{const a=d.getColor(r.bracketColor),l=d.getColor(r.guideColor),h=d.getColor(r.guideColorActive),c=Ut(Ut(l)??(a==null?void 0:a.transparent(.3))),u=Ut(Ut(h)??a);if(!(!c||!u))return{guideColor:c,guideColorActive:u}}).filter(hi),o=n.map(r=>{const a=d.getColor(r.indentColor),l=d.getColor(r.indentColorActive),h=Ut(a),c=Ut(l);if(!(!h||!c))return{indentColor:h,indentColorActive:c}}).filter(hi);if(s.length>0){for(let r=0;r<30;r++){const a=s[r%s.length];e.addRule(`.monaco-editor .${i.getInlineClassNameOfLevel(r).replace(/ /g,".")} { --guide-color: ${a.guideColor}; --guide-color-active: ${a.guideColorActive}; }`)}e.addRule(".monaco-editor .vertical { box-shadow: 1px 0 0 0 var(--guide-color) inset; }"),e.addRule(".monaco-editor .horizontal-top { border-top: 1px solid var(--guide-color); }"),e.addRule(".monaco-editor .horizontal-bottom { border-bottom: 1px solid var(--guide-color); }"),e.addRule(`.monaco-editor .vertical.${i.activeClassName} { box-shadow: 1px 0 0 0 var(--guide-color-active) inset; }`),e.addRule(`.monaco-editor .horizontal-top.${i.activeClassName} { border-top: 1px solid var(--guide-color-active); }`),e.addRule(`.monaco-editor .horizontal-bottom.${i.activeClassName} { border-bottom: 1px solid var(--guide-color-active); }`)}if(o.length>0){for(let r=0;r<30;r++){const a=o[r%o.length];e.addRule(`.monaco-editor .lines-content .core-guide-indent.lvl-${r} { --indent-color: ${a.indentColor}; --indent-color-active: ${a.indentColorActive}; }`)}e.addRule(".monaco-editor .lines-content .core-guide-indent { box-shadow: 1px 0 0 0 var(--indent-color) inset; }"),e.addRule(".monaco-editor .lines-content .core-guide-indent.indent-active { box-shadow: 1px 0 0 0 var(--indent-color-active) inset; }")}});class ws{get didDomLayout(){return this._didDomLayout}readClientRect(){if(!this._clientRectRead){this._clientRectRead=!0;const e=this._domNode.getBoundingClientRect();this.markDidDomLayout(),this._clientRectDeltaLeft=e.left,this._clientRectScale=e.width/this._domNode.offsetWidth}}get clientRectDeltaLeft(){return this._clientRectRead||this.readClientRect(),this._clientRectDeltaLeft}get clientRectScale(){return this._clientRectRead||this.readClientRect(),this._clientRectScale}constructor(e,t){this._domNode=e,this.endNode=t,this._didDomLayout=!1,this._clientRectDeltaLeft=0,this._clientRectScale=1,this._clientRectRead=!1}markDidDomLayout(){this._didDomLayout=!0}}class kg{constructor(){this._currentVisibleRange=new W(1,1,1,1)}getCurrentVisibleRange(){return this._currentVisibleRange}setCurrentVisibleRange(e){this._currentVisibleRange=e}}class Vg{constructor(e,t,i,n,s,o,r){this.minimalReveal=e,this.lineNumber=t,this.startColumn=i,this.endColumn=n,this.startScrollTop=s,this.stopScrollTop=o,this.scrollType=r,this.type="range",this.minLineNumber=t,this.maxLineNumber=t}}class Fg{constructor(e,t,i,n,s){this.minimalReveal=e,this.selections=t,this.startScrollTop=i,this.stopScrollTop=n,this.scrollType=s,this.type="selections";let o=t[0].startLineNumber,r=t[0].endLineNumber;for(let a=1,l=t.length;a<l;a++){const h=t[a];o=Math.min(o,h.startLineNumber),r=Math.max(r,h.endLineNumber)}this.minLineNumber=o,this.maxLineNumber=r}}const $n=class $n extends be{constructor(e,t){super(e);const i=this._context.configuration,n=this._context.configuration.options,s=n.get(50),o=n.get(147);this._lineHeight=n.get(67),this._typicalHalfwidthCharacterWidth=s.typicalHalfwidthCharacterWidth,this._isViewportWrapping=o.isViewportWrapping,this._revealHorizontalRightPadding=n.get(101),this._cursorSurroundingLines=n.get(29),this._cursorSurroundingLinesStyle=n.get(30),this._canUseLayerHinting=!n.get(32),this._viewLineOptions=new Kr(i,this._context.theme.type),this._linesContent=t,this._textRangeRestingSpot=document.createElement("div"),this._visibleLines=new Od({createLine:()=>new Xe(this._viewLineOptions)}),this.domNode=this._visibleLines.domNode,Ve.write(this.domNode,8),this.domNode.setClassName(`view-lines ${Xt}`),le(this.domNode,s),this._maxLineWidth=0,this._asyncUpdateLineWidths=new ct(()=>{this._updateLineWidthsSlow()},200),this._asyncCheckMonospaceFontAssumptions=new ct(()=>{this._checkMonospaceFontAssumptions()},2e3),this._lastRenderedData=new kg,this._horizontalRevealRequest=null,this._stickyScrollEnabled=n.get(116).enabled,this._maxNumberStickyLines=n.get(116).maxLineCount}dispose(){this._asyncUpdateLineWidths.dispose(),this._asyncCheckMonospaceFontAssumptions.dispose(),super.dispose()}getDomNode(){return this.domNode}onConfigurationChanged(e){this._visibleLines.onConfigurationChanged(e),e.hasChanged(147)&&(this._maxLineWidth=0);const t=this._context.configuration.options,i=t.get(50),n=t.get(147);return this._lineHeight=t.get(67),this._typicalHalfwidthCharacterWidth=i.typicalHalfwidthCharacterWidth,this._isViewportWrapping=n.isViewportWrapping,this._revealHorizontalRightPadding=t.get(101),this._cursorSurroundingLines=t.get(29),this._cursorSurroundingLinesStyle=t.get(30),this._canUseLayerHinting=!t.get(32),this._stickyScrollEnabled=t.get(116).enabled,this._maxNumberStickyLines=t.get(116).maxLineCount,le(this.domNode,i),this._onOptionsMaybeChanged(),e.hasChanged(146)&&(this._maxLineWidth=0),!0}_onOptionsMaybeChanged(){const e=this._context.configuration,t=new Kr(e,this._context.theme.type);if(!this._viewLineOptions.equals(t)){this._viewLineOptions=t;const i=this._visibleLines.getStartLineNumber(),n=this._visibleLines.getEndLineNumber();for(let s=i;s<=n;s++)this._visibleLines.getVisibleLine(s).onOptionsChanged(this._viewLineOptions);return!0}return!1}onCursorStateChanged(e){const t=this._visibleLines.getStartLineNumber(),i=this._visibleLines.getEndLineNumber();let n=!1;for(let s=t;s<=i;s++)n=this._visibleLines.getVisibleLine(s).onSelectionChanged()||n;return n}onDecorationsChanged(e){{const t=this._visibleLines.getStartLineNumber(),i=this._visibleLines.getEndLineNumber();for(let n=t;n<=i;n++)this._visibleLines.getVisibleLine(n).onDecorationsChanged()}return!0}onFlushed(e){const t=this._visibleLines.onFlushed(e);return this._maxLineWidth=0,t}onLinesChanged(e){return this._visibleLines.onLinesChanged(e)}onLinesDeleted(e){return this._visibleLines.onLinesDeleted(e)}onLinesInserted(e){return this._visibleLines.onLinesInserted(e)}onRevealRangeRequest(e){const t=this._computeScrollTopToRevealRange(this._context.viewLayout.getFutureViewport(),e.source,e.minimalReveal,e.range,e.selections,e.verticalType);if(t===-1)return!1;let i=this._context.viewLayout.validateScrollPosition({scrollTop:t});e.revealHorizontal?e.range&&e.range.startLineNumber!==e.range.endLineNumber?i={scrollTop:i.scrollTop,scrollLeft:0}:e.range?this._horizontalRevealRequest=new Vg(e.minimalReveal,e.range.startLineNumber,e.range.startColumn,e.range.endColumn,this._context.viewLayout.getCurrentScrollTop(),i.scrollTop,e.scrollType):e.selections&&e.selections.length>0&&(this._horizontalRevealRequest=new Fg(e.minimalReveal,e.selections,this._context.viewLayout.getCurrentScrollTop(),i.scrollTop,e.scrollType)):this._horizontalRevealRequest=null;const s=Math.abs(this._context.viewLayout.getCurrentScrollTop()-i.scrollTop)<=this._lineHeight?1:e.scrollType;return this._context.viewModel.viewLayout.setScrollPosition(i,s),!0}onScrollChanged(e){if(this._horizontalRevealRequest&&e.scrollLeftChanged&&(this._horizontalRevealRequest=null),this._horizontalRevealRequest&&e.scrollTopChanged){const t=Math.min(this._horizontalRevealRequest.startScrollTop,this._horizontalRevealRequest.stopScrollTop),i=Math.max(this._horizontalRevealRequest.startScrollTop,this._horizontalRevealRequest.stopScrollTop);(e.scrollTop<t||e.scrollTop>i)&&(this._horizontalRevealRequest=null)}return this.domNode.setWidth(e.scrollWidth),this._visibleLines.onScrollChanged(e)||!0}onTokensChanged(e){return this._visibleLines.onTokensChanged(e)}onZonesChanged(e){return this._context.viewModel.viewLayout.setMaxLineWidth(this._maxLineWidth),this._visibleLines.onZonesChanged(e)}onThemeChanged(e){return this._onOptionsMaybeChanged()}getPositionFromDOMInfo(e,t){const i=this._getViewLineDomNode(e);if(i===null)return null;const n=this._getLineNumberFor(i);if(n===-1||n<1||n>this._context.viewModel.getLineCount())return null;if(this._context.viewModel.getLineMaxColumn(n)===1)return new E(n,1);const s=this._visibleLines.getStartLineNumber(),o=this._visibleLines.getEndLineNumber();if(n<s||n>o)return null;let r=this._visibleLines.getVisibleLine(n).getColumnOfNodeOffset(e,t);const a=this._context.viewModel.getLineMinColumn(n);return r<a&&(r=a),new E(n,r)}_getViewLineDomNode(e){for(;e&&e.nodeType===1;){if(e.className===Xe.CLASS_NAME)return e;e=e.parentElement}return null}_getLineNumberFor(e){const t=this._visibleLines.getStartLineNumber(),i=this._visibleLines.getEndLineNumber();for(let n=t;n<=i;n++){const s=this._visibleLines.getVisibleLine(n);if(e===s.getDomNode())return n}return-1}getLineWidth(e){const t=this._visibleLines.getStartLineNumber(),i=this._visibleLines.getEndLineNumber();if(e<t||e>i)return-1;const n=new ws(this.domNode.domNode,this._textRangeRestingSpot),s=this._visibleLines.getVisibleLine(e).getWidth(n);return this._updateLineWidthsSlowIfDomDidLayout(n),s}linesVisibleRangesForRange(e,t){if(this.shouldRender())return null;const i=e.endLineNumber,n=W.intersectRanges(e,this._lastRenderedData.getCurrentVisibleRange());if(!n)return null;const s=[];let o=0;const r=new ws(this.domNode.domNode,this._textRangeRestingSpot);let a=0;t&&(a=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new E(n.startLineNumber,1)).lineNumber);const l=this._visibleLines.getStartLineNumber(),h=this._visibleLines.getEndLineNumber();for(let c=n.startLineNumber;c<=n.endLineNumber;c++){if(c<l||c>h)continue;const u=c===n.startLineNumber?n.startColumn:1,_=c!==n.endLineNumber,f=_?this._context.viewModel.getLineMaxColumn(c):n.endColumn,w=this._visibleLines.getVisibleLine(c).getVisibleRangesForRange(c,u,f,r);if(w){if(t&&c<i){const C=a;a=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new E(c+1,1)).lineNumber,C!==a&&(w.ranges[w.ranges.length-1].width+=this._typicalHalfwidthCharacterWidth)}s[o++]=new Yu(w.outsideRenderedLine,c,fs.from(w.ranges),_)}}return this._updateLineWidthsSlowIfDomDidLayout(r),o===0?null:s}_visibleRangesForLineRange(e,t,i){if(this.shouldRender()||e<this._visibleLines.getStartLineNumber()||e>this._visibleLines.getEndLineNumber())return null;const n=new ws(this.domNode.domNode,this._textRangeRestingSpot),s=this._visibleLines.getVisibleLine(e).getVisibleRangesForRange(e,t,i,n);return this._updateLineWidthsSlowIfDomDidLayout(n),s}visibleRangeForPosition(e){const t=this._visibleRangesForLineRange(e.lineNumber,e.column,e.column);return t?new Qu(t.outsideRenderedLine,t.ranges[0].left):null}_updateLineWidthsFast(){return this._updateLineWidths(!0)}_updateLineWidthsSlow(){this._updateLineWidths(!1)}_updateLineWidthsSlowIfDomDidLayout(e){e.didDomLayout&&(this._asyncUpdateLineWidths.isScheduled()||(this._asyncUpdateLineWidths.cancel(),this._updateLineWidthsSlow()))}_updateLineWidths(e){const t=this._visibleLines.getStartLineNumber(),i=this._visibleLines.getEndLineNumber();let n=1,s=!0;for(let o=t;o<=i;o++){const r=this._visibleLines.getVisibleLine(o);if(e&&!r.getWidthIsFast()){s=!1;continue}n=Math.max(n,r.getWidth(null))}return s&&t===1&&i===this._context.viewModel.getLineCount()&&(this._maxLineWidth=0),this._ensureMaxLineWidth(n),s}_checkMonospaceFontAssumptions(){let e=-1,t=-1;const i=this._visibleLines.getStartLineNumber(),n=this._visibleLines.getEndLineNumber();for(let s=i;s<=n;s++){const o=this._visibleLines.getVisibleLine(s);if(o.needsMonospaceFontCheck()){const r=o.getWidth(null);r>t&&(t=r,e=s)}}if(e!==-1&&!this._visibleLines.getVisibleLine(e).monospaceAssumptionsAreValid())for(let s=i;s<=n;s++)this._visibleLines.getVisibleLine(s).onMonospaceAssumptionsInvalidated()}prepareRender(){throw new Error("Not supported")}render(){throw new Error("Not supported")}renderText(e){if(this._visibleLines.renderLines(e),this._lastRenderedData.setCurrentVisibleRange(e.visibleRange),this.domNode.setWidth(this._context.viewLayout.getScrollWidth()),this.domNode.setHeight(Math.min(this._context.viewLayout.getScrollHeight(),1e6)),this._horizontalRevealRequest){const i=this._horizontalRevealRequest;if(e.startLineNumber<=i.minLineNumber&&i.maxLineNumber<=e.endLineNumber){this._horizontalRevealRequest=null,this.onDidRender();const n=this._computeScrollLeftToReveal(i);n&&(this._isViewportWrapping||this._ensureMaxLineWidth(n.maxHorizontalOffset),this._context.viewModel.viewLayout.setScrollPosition({scrollLeft:n.scrollLeft},i.scrollType))}}if(this._updateLineWidthsFast()?this._asyncUpdateLineWidths.cancel():this._asyncUpdateLineWidths.schedule(),Jn&&!this._asyncCheckMonospaceFontAssumptions.isScheduled()){const i=this._visibleLines.getStartLineNumber(),n=this._visibleLines.getEndLineNumber();for(let s=i;s<=n;s++)if(this._visibleLines.getVisibleLine(s).needsMonospaceFontCheck()){this._asyncCheckMonospaceFontAssumptions.schedule();break}}this._linesContent.setLayerHinting(this._canUseLayerHinting),this._linesContent.setContain("strict");const t=this._context.viewLayout.getCurrentScrollTop()-e.bigNumbersDelta;this._linesContent.setTop(-t),this._linesContent.setLeft(-this._context.viewLayout.getCurrentScrollLeft())}_ensureMaxLineWidth(e){const t=Math.ceil(e);this._maxLineWidth<t&&(this._maxLineWidth=t,this._context.viewModel.viewLayout.setMaxLineWidth(this._maxLineWidth))}_computeScrollTopToRevealRange(e,t,i,n,s,o){const r=e.top,a=e.height,l=r+a;let h,c,u;if(s&&s.length>0){let v=s[0].startLineNumber,g=s[0].endLineNumber;for(let p=1,m=s.length;p<m;p++){const b=s[p];v=Math.min(v,b.startLineNumber),g=Math.max(g,b.endLineNumber)}h=!1,c=this._context.viewLayout.getVerticalOffsetForLineNumber(v),u=this._context.viewLayout.getVerticalOffsetForLineNumber(g)+this._lineHeight}else if(n)h=!0,c=this._context.viewLayout.getVerticalOffsetForLineNumber(n.startLineNumber),u=this._context.viewLayout.getVerticalOffsetForLineNumber(n.endLineNumber)+this._lineHeight;else return-1;const _=(t==="mouse"||i)&&this._cursorSurroundingLinesStyle==="default";let f=0,w=0;if(_)i||(f=this._lineHeight);else{const v=a/this._lineHeight,g=Math.max(this._cursorSurroundingLines,this._stickyScrollEnabled?this._maxNumberStickyLines:0),p=Math.min(v/2,g);f=p*this._lineHeight,w=Math.max(0,p-1)*this._lineHeight}i||(o===0||o===4)&&(w+=this._lineHeight),c-=f,u+=w;let C;if(u-c>a){if(!h)return-1;C=c}else if(o===5||o===6)if(o===6&&r<=c&&u<=l)C=r;else{const v=Math.max(5*this._lineHeight,a*.2),g=c-v,p=u-a;C=Math.max(p,g)}else if(o===1||o===2)if(o===2&&r<=c&&u<=l)C=r;else{const v=(c+u)/2;C=Math.max(0,v-a/2)}else C=this._computeMinimumScrolling(r,l,c,u,o===3,o===4);return C}_computeScrollLeftToReveal(e){const t=this._context.viewLayout.getCurrentViewport(),i=this._context.configuration.options.get(146),n=t.left,s=n+t.width-i.verticalScrollbarWidth;let o=1073741824,r=0;if(e.type==="range"){const l=this._visibleRangesForLineRange(e.lineNumber,e.startColumn,e.endColumn);if(!l)return null;for(const h of l.ranges)o=Math.min(o,Math.round(h.left)),r=Math.max(r,Math.round(h.left+h.width))}else for(const l of e.selections){if(l.startLineNumber!==l.endLineNumber)return null;const h=this._visibleRangesForLineRange(l.startLineNumber,l.startColumn,l.endColumn);if(!h)return null;for(const c of h.ranges)o=Math.min(o,Math.round(c.left)),r=Math.max(r,Math.round(c.left+c.width))}return e.minimalReveal||(o=Math.max(0,o-$n.HORIZONTAL_EXTRA_PX),r+=this._revealHorizontalRightPadding),e.type==="selections"&&r-o>t.width?null:{scrollLeft:this._computeMinimumScrolling(n,s,o,r),maxHorizontalOffset:r}}_computeMinimumScrolling(e,t,i,n,s,o){e=e|0,t=t|0,i=i|0,n=n|0,s=!!s,o=!!o;const r=t-e;if(n-i<r){if(s)return i;if(o)return Math.max(0,n-r);if(i<e)return i;if(n>t)return Math.max(0,n-r)}else return i;return e}};$n.HORIZONTAL_EXTRA_PX=30;let Qs=$n;class Bg extends Wd{constructor(e){super(),this._context=e;const i=this._context.configuration.options.get(146);this._decorationsLeft=i.decorationsLeft,this._decorationsWidth=i.decorationsWidth,this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){const i=this._context.configuration.options.get(146);return this._decorationsLeft=i.decorationsLeft,this._decorationsWidth=i.decorationsWidth,!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}_getDecorations(e){const t=e.getDecorationsInViewport(),i=[];let n=0;for(let s=0,o=t.length;s<o;s++){const r=t[s],a=r.options.linesDecorationsClassName,l=r.options.zIndex;a&&(i[n++]=new Ys(r.range.startLineNumber,r.range.endLineNumber,a,r.options.linesDecorationsTooltip??null,l));const h=r.options.firstLineDecorationClassName;h&&(i[n++]=new Ys(r.range.startLineNumber,r.range.startLineNumber,h,r.options.linesDecorationsTooltip??null,l))}return i}prepareRender(e){const t=e.visibleRange.startLineNumber,i=e.visibleRange.endLineNumber,n=this._render(t,i,this._getDecorations(e)),s=this._decorationsLeft.toString(),o=this._decorationsWidth.toString(),r='" style="left:'+s+"px;width:"+o+'px;"></div>',a=[];for(let l=t;l<=i;l++){const h=l-t,c=n[h].getDecorations();let u="";for(const _ of c){let f='<div class="cldr '+_.className;_.tooltip!==null&&(f+='" title="'+_.tooltip),f+=r,u+=f}a[h]=u}this._renderResult=a}render(e,t){return this._renderResult?this._renderResult[t-e]:""}}class Ug extends Wd{constructor(e){super(),this._context=e,this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){return!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}_getDecorations(e){const t=e.getDecorationsInViewport(),i=[];let n=0;for(let s=0,o=t.length;s<o;s++){const r=t[s],a=r.options.marginClassName,l=r.options.zIndex;a&&(i[n++]=new Ys(r.range.startLineNumber,r.range.endLineNumber,a,null,l))}return i}prepareRender(e){const t=e.visibleRange.startLineNumber,i=e.visibleRange.endLineNumber,n=this._render(t,i,this._getDecorations(e)),s=[];for(let o=t;o<=i;o++){const r=o-t,a=n[r].getDecorations();let l="";for(const h of a)l+='<div class="cmdr '+h.className+'" style=""></div>';s[r]=l}this._renderResult=s}render(e,t){return this._renderResult?this._renderResult[t-e]:""}}const zg=(()=>{const d=[];for(let e=32;e<=126;e++)d.push(e);return d.push(65533),d})(),$g=(d,e)=>(d-=32,d<0||d>96?e<=2?(d+96)%96:95:d);class Gi{constructor(e,t){this.scale=t,this._minimapCharRendererBrand=void 0,this.charDataNormal=Gi.soften(e,12/15),this.charDataLight=Gi.soften(e,50/60)}static soften(e,t){const i=new Uint8ClampedArray(e.length);for(let n=0,s=e.length;n<s;n++)i[n]=qa(e[n]*t);return i}renderChar(e,t,i,n,s,o,r,a,l,h,c){const u=1*this.scale,_=2*this.scale,f=c?1:_;if(t+u>e.width||i+f>e.height){console.warn("bad render request outside image data");return}const w=h?this.charDataLight:this.charDataNormal,C=$g(n,l),v=e.width*4,g=r.r,p=r.g,m=r.b,b=s.r-g,L=s.g-p,y=s.b-m,S=Math.max(o,a),D=e.data;let x=C*u*_,M=i*v+t*4;for(let R=0;R<f;R++){let I=M;for(let F=0;F<u;F++){const k=w[x++]/255*(o/255);D[I++]=g+b*k,D[I++]=p+L*k,D[I++]=m+y*k,D[I++]=S}M+=v}}blockRenderChar(e,t,i,n,s,o,r,a){const l=1*this.scale,h=2*this.scale,c=a?1:h;if(t+l>e.width||i+c>e.height){console.warn("bad render request outside image data");return}const u=e.width*4,_=.5*(s/255),f=o.r,w=o.g,C=o.b,v=n.r-f,g=n.g-w,p=n.b-C,m=f+v*_,b=w+g*_,L=C+p*_,y=Math.max(s,r),S=e.data;let D=i*u+t*4;for(let x=0;x<c;x++){let M=D;for(let R=0;R<l;R++)S[M++]=m,S[M++]=b,S[M++]=L,S[M++]=y;D+=u}}}const na={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15},sa=d=>{const e=new Uint8ClampedArray(d.length/2);for(let t=0;t<d.length;t+=2)e[t>>1]=na[d[t]]<<4|na[d[t+1]]&15;return e},oa={1:xs(()=>sa("0000511D6300CF609C709645A78432005642574171487021003C451900274D35D762755E8B629C5BA856AF57BA649530C167D1512A272A3F6038604460398526BCA2A968DB6F8957C768BE5FBE2FB467CF5D8D5B795DC7625B5DFF50DE64C466DB2FC47CD860A65E9A2EB96CB54CE06DA763AB2EA26860524D3763536601005116008177A8705E53AB738E6A982F88BAA35B5F5B626D9C636B449B737E5B7B678598869A662F6B5B8542706C704C80736A607578685B70594A49715A4522E792")),2:xs(()=>sa("000000000000000055394F383D2800008B8B1F210002000081B1CBCBCC820000847AAF6B9AAF2119BE08B8881AD60000A44FD07DCCF107015338130C00000000385972265F390B406E2437634B4B48031B12B8A0847000001E15B29A402F0000000000004B33460B00007A752C2A0000000000004D3900000084394B82013400ABA5CFC7AD9C0302A45A3E5A98AB000089A43382D97900008BA54AA087A70A0248A6A7AE6DBE0000BF6F94987EA40A01A06DCFA7A7A9030496C32F77891D0000A99FB1A0AFA80603B29AB9CA75930D010C0948354D3900000C0948354F37460D0028BE673D8400000000AF9D7B6E00002B007AA8933400007AA642675C2700007984CFB9C3985B768772A8A6B7B20000CAAECAAFC4B700009F94A6009F840009D09F9BA4CA9C0000CC8FC76DC87F0000C991C472A2000000A894A48CA7B501079BA2C9C69BA20000B19A5D3FA89000005CA6009DA2960901B0A7F0669FB200009D009E00B7890000DAD0F5D092820000D294D4C48BD10000B5A7A4A3B1A50402CAB6CBA6A2000000B5A7A4A3B1A8044FCDADD19D9CB00000B7778F7B8AAE0803C9AB5D3F5D3F00009EA09EA0BAB006039EA0989A8C7900009B9EF4D6B7C00000A9A7816CACA80000ABAC84705D3F000096DA635CDC8C00006F486F266F263D4784006124097B00374F6D2D6D2D6D4A3A95872322000000030000000000008D8939130000000000002E22A5C9CBC70600AB25C0B5C9B400061A2DB04CA67001082AA6BEBEBFC606002321DACBC19E03087AA08B6768380000282FBAC0B8CA7A88AD25BBA5A29900004C396C5894A6000040485A6E356E9442A32CD17EADA70000B4237923628600003E2DE9C1D7B500002F25BBA5A2990000231DB6AFB4A804023025C0B5CAB588062B2CBDBEC0C706882435A75CA20000002326BD6A82A908048B4B9A5A668000002423A09CB4BB060025259C9D8A7900001C1FCAB2C7C700002A2A9387ABA200002626A4A47D6E9D14333163A0C87500004B6F9C2D643A257049364936493647358A34438355497F1A0000A24C1D590000D38DFFBDD4CD3126"))};class Wi{static create(e,t){if(this.lastCreated&&e===this.lastCreated.scale&&t===this.lastFontFamily)return this.lastCreated;let i;return oa[e]?i=new Gi(oa[e](),e):i=Wi.createFromSampleData(Wi.createSampleData(t).data,e),this.lastFontFamily=t,this.lastCreated=i,i}static createSampleData(e){const t=document.createElement("canvas"),i=t.getContext("2d");t.style.height="16px",t.height=16,t.width=96*10,t.style.width=96*10+"px",i.fillStyle="#ffffff",i.font=`bold 16px ${e}`,i.textBaseline="middle";let n=0;for(const s of zg)i.fillText(String.fromCharCode(s),n,16/2),n+=10;return i.getImageData(0,0,96*10,16)}static createFromSampleData(e,t){if(e.length!==61440)throw new Error("Unexpected source in MinimapCharRenderer");const n=Wi._downsample(e,t);return new Gi(n,t)}static _downsampleChar(e,t,i,n,s){const o=1*s,r=2*s;let a=n,l=0;for(let h=0;h<r;h++){const c=h/r*16,u=(h+1)/r*16;for(let _=0;_<o;_++){const f=_/o*10,w=(_+1)/o*10;let C=0,v=0;for(let p=c;p<u;p++){const m=t+Math.floor(p)*3840,b=1-(p-Math.floor(p));for(let L=f;L<w;L++){const y=1-(L-Math.floor(L)),S=m+Math.floor(L)*4,D=y*b;v+=D,C+=e[S]*e[S+3]/255*D}}const g=C/v;l=Math.max(l,g),i[a++]=qa(g)}}return l}static _downsample(e,t){const i=2*t*1*t,n=i*96,s=new Uint8ClampedArray(n);let o=0,r=0,a=0;for(let l=0;l<96;l++)a=Math.max(a,this._downsampleChar(e,r,s,o,t)),o+=i,r+=10*4;if(a>0){const l=255/a;for(let h=0;h<n;h++)s[h]*=l}return s}}const Gg=140,jg=2;class ri{constructor(e,t,i){const n=e.options,s=n.get(144),o=n.get(146),r=o.minimap,a=n.get(50),l=n.get(73);this.renderMinimap=r.renderMinimap,this.size=l.size,this.minimapHeightIsEditorHeight=r.minimapHeightIsEditorHeight,this.scrollBeyondLastLine=n.get(106),this.paddingTop=n.get(84).top,this.paddingBottom=n.get(84).bottom,this.showSlider=l.showSlider,this.autohide=l.autohide,this.pixelRatio=s,this.typicalHalfwidthCharacterWidth=a.typicalHalfwidthCharacterWidth,this.lineHeight=n.get(67),this.minimapLeft=r.minimapLeft,this.minimapWidth=r.minimapWidth,this.minimapHeight=o.height,this.canvasInnerWidth=r.minimapCanvasInnerWidth,this.canvasInnerHeight=r.minimapCanvasInnerHeight,this.canvasOuterWidth=r.minimapCanvasOuterWidth,this.canvasOuterHeight=r.minimapCanvasOuterHeight,this.isSampling=r.minimapIsSampling,this.editorHeight=o.height,this.fontScale=r.minimapScale,this.minimapLineHeight=r.minimapLineHeight,this.minimapCharWidth=1*this.fontScale,this.sectionHeaderFontFamily=Pl,this.sectionHeaderFontSize=l.sectionHeaderFontSize*s,this.sectionHeaderLetterSpacing=l.sectionHeaderLetterSpacing,this.sectionHeaderFontColor=ri._getSectionHeaderColor(t,i.getColor(1)),this.charRenderer=xs(()=>Wi.create(this.fontScale,a.fontFamily)),this.defaultBackgroundColor=i.getColor(2),this.backgroundColor=ri._getMinimapBackground(t,this.defaultBackgroundColor),this.foregroundAlpha=ri._getMinimapForegroundOpacity(t)}static _getMinimapBackground(e,t){const i=e.getColor($c);return i?new un(i.rgba.r,i.rgba.g,i.rgba.b,Math.round(255*i.rgba.a)):t}static _getMinimapForegroundOpacity(e){const t=e.getColor(Gc);return t?un._clamp(Math.round(255*t.rgba.a)):255}static _getSectionHeaderColor(e,t){const i=e.getColor(jc);return i?new un(i.rgba.r,i.rgba.g,i.rgba.b,Math.round(255*i.rgba.a)):t}equals(e){return this.renderMinimap===e.renderMinimap&&this.size===e.size&&this.minimapHeightIsEditorHeight===e.minimapHeightIsEditorHeight&&this.scrollBeyondLastLine===e.scrollBeyondLastLine&&this.paddingTop===e.paddingTop&&this.paddingBottom===e.paddingBottom&&this.showSlider===e.showSlider&&this.autohide===e.autohide&&this.pixelRatio===e.pixelRatio&&this.typicalHalfwidthCharacterWidth===e.typicalHalfwidthCharacterWidth&&this.lineHeight===e.lineHeight&&this.minimapLeft===e.minimapLeft&&this.minimapWidth===e.minimapWidth&&this.minimapHeight===e.minimapHeight&&this.canvasInnerWidth===e.canvasInnerWidth&&this.canvasInnerHeight===e.canvasInnerHeight&&this.canvasOuterWidth===e.canvasOuterWidth&&this.canvasOuterHeight===e.canvasOuterHeight&&this.isSampling===e.isSampling&&this.editorHeight===e.editorHeight&&this.fontScale===e.fontScale&&this.minimapLineHeight===e.minimapLineHeight&&this.minimapCharWidth===e.minimapCharWidth&&this.sectionHeaderFontSize===e.sectionHeaderFontSize&&this.sectionHeaderLetterSpacing===e.sectionHeaderLetterSpacing&&this.defaultBackgroundColor&&this.defaultBackgroundColor.equals(e.defaultBackgroundColor)&&this.backgroundColor&&this.backgroundColor.equals(e.backgroundColor)&&this.foregroundAlpha===e.foregroundAlpha}}class Hi{constructor(e,t,i,n,s,o,r,a,l){this.scrollTop=e,this.scrollHeight=t,this.sliderNeeded=i,this._computedSliderRatio=n,this.sliderTop=s,this.sliderHeight=o,this.topPaddingLineCount=r,this.startLineNumber=a,this.endLineNumber=l}getDesiredScrollTopFromDelta(e){return Math.round(this.scrollTop+e/this._computedSliderRatio)}getDesiredScrollTopFromTouchLocation(e){return Math.round((e-this.sliderHeight/2)/this._computedSliderRatio)}intersectWithViewport(e){const t=Math.max(this.startLineNumber,e.startLineNumber),i=Math.min(this.endLineNumber,e.endLineNumber);return t>i?null:[t,i]}getYForLineNumber(e,t){return+(e-this.startLineNumber+this.topPaddingLineCount)*t}static create(e,t,i,n,s,o,r,a,l,h,c){const u=e.pixelRatio,_=e.minimapLineHeight,f=Math.floor(e.canvasInnerHeight/_),w=e.lineHeight;if(e.minimapHeightIsEditorHeight){let L=a*e.lineHeight+e.paddingTop+e.paddingBottom;e.scrollBeyondLastLine&&(L+=Math.max(0,s-e.lineHeight-e.paddingBottom));const y=Math.max(1,Math.floor(s*s/L)),S=Math.max(0,e.minimapHeight-y),D=S/(h-s),x=l*D,M=S>0,R=Math.floor(e.canvasInnerHeight/e.minimapLineHeight),I=Math.floor(e.paddingTop/e.lineHeight);return new Hi(l,h,M,D,x,y,I,1,Math.min(r,R))}let C;if(o&&i!==r){const L=i-t+1;C=Math.floor(L*_/u)}else{const L=s/w;C=Math.floor(L*_/u)}const v=Math.floor(e.paddingTop/w);let g=Math.floor(e.paddingBottom/w);if(e.scrollBeyondLastLine){const L=s/w;g=Math.max(g,L-1)}let p;if(g>0){const L=s/w;p=(v+r+g-L-1)*_/u}else p=Math.max(0,(v+r)*_/u-C);p=Math.min(e.minimapHeight-C,p);const m=p/(h-s),b=l*m;if(f>=v+r+g){const L=p>0;return new Hi(l,h,L,m,b,C,v,1,r)}else{let L;t>1?L=t+v:L=Math.max(1,l/w);let y,S=Math.max(1,Math.floor(L-b*u/_));S<v?(y=v-S+1,S=1):(y=0,S=Math.max(1,S-v)),c&&c.scrollHeight===h&&(c.scrollTop>l&&(S=Math.min(S,c.startLineNumber),y=Math.max(y,c.topPaddingLineCount)),c.scrollTop<l&&(S=Math.max(S,c.startLineNumber),y=Math.min(y,c.topPaddingLineCount)));const D=Math.min(r,S-y+f-1),x=(l-n)/w;let M;return l>=e.paddingTop?M=(t-S+y+x)*_/u:M=l/e.paddingTop*(y+x)*_/u,new Hi(l,h,!0,m,M,C,y,S,D)}}}const Gn=class Gn{constructor(e){this.dy=e}onContentChanged(){this.dy=-1}onTokensChanged(){this.dy=-1}};Gn.INVALID=new Gn(-1);let xn=Gn;class ra{constructor(e,t,i){this.renderedLayout=e,this._imageData=t,this._renderedLines=new Id({createLine:()=>xn.INVALID}),this._renderedLines._set(e.startLineNumber,i)}linesEquals(e){if(!this.scrollEquals(e))return!1;const i=this._renderedLines._get().lines;for(let n=0,s=i.length;n<s;n++)if(i[n].dy===-1)return!1;return!0}scrollEquals(e){return this.renderedLayout.startLineNumber===e.startLineNumber&&this.renderedLayout.endLineNumber===e.endLineNumber}_get(){const e=this._renderedLines._get();return{imageData:this._imageData,rendLineNumberStart:e.rendLineNumberStart,lines:e.lines}}onLinesChanged(e,t){return this._renderedLines.onLinesChanged(e,t)}onLinesDeleted(e,t){this._renderedLines.onLinesDeleted(e,t)}onLinesInserted(e,t){this._renderedLines.onLinesInserted(e,t)}onTokensChanged(e){return this._renderedLines.onTokensChanged(e)}}class jo{constructor(e,t,i,n){this._backgroundFillData=jo._createBackgroundFillData(t,i,n),this._buffers=[e.createImageData(t,i),e.createImageData(t,i)],this._lastUsedBuffer=0}getBuffer(){this._lastUsedBuffer=1-this._lastUsedBuffer;const e=this._buffers[this._lastUsedBuffer];return e.data.set(this._backgroundFillData),e}static _createBackgroundFillData(e,t,i){const n=i.r,s=i.g,o=i.b,r=i.a,a=new Uint8ClampedArray(e*t*4);let l=0;for(let h=0;h<t;h++)for(let c=0;c<e;c++)a[l]=n,a[l+1]=s,a[l+2]=o,a[l+3]=r,l+=4;return a}}class ji{static compute(e,t,i){if(e.renderMinimap===0||!e.isSampling)return[null,[]];const{minimapLineCount:n}=hc.computeContainedMinimapLineCount({viewLineCount:t,scrollBeyondLastLine:e.scrollBeyondLastLine,paddingTop:e.paddingTop,paddingBottom:e.paddingBottom,height:e.editorHeight,lineHeight:e.lineHeight,pixelRatio:e.pixelRatio}),s=t/n,o=s/2;if(!i||i.minimapLines.length===0){const C=[];if(C[0]=1,n>1){for(let v=0,g=n-1;v<g;v++)C[v]=Math.round(v*s+o);C[n-1]=t}return[new ji(s,C),[]]}const r=i.minimapLines,a=r.length,l=[];let h=0,c=0,u=1;const _=10;let f=[],w=null;for(let C=0;C<n;C++){const v=Math.max(u,Math.round(C*s)),g=Math.max(v,Math.round((C+1)*s));for(;h<a&&r[h]<v;){if(f.length<_){const m=h+1+c;w&&w.type==="deleted"&&w._oldIndex===h-1?w.deleteToLineNumber++:(w={type:"deleted",_oldIndex:h,deleteFromLineNumber:m,deleteToLineNumber:m},f.push(w)),c--}h++}let p;if(h<a&&r[h]<=g)p=r[h],h++;else if(C===0?p=1:C+1===n?p=t:p=Math.round(C*s+o),f.length<_){const m=h+1+c;w&&w.type==="inserted"&&w._i===C-1?w.insertToLineNumber++:(w={type:"inserted",_i:C,insertFromLineNumber:m,insertToLineNumber:m},f.push(w)),c++}l[C]=p,u=p}if(f.length<_)for(;h<a;){const C=h+1+c;w&&w.type==="deleted"&&w._oldIndex===h-1?w.deleteToLineNumber++:(w={type:"deleted",_oldIndex:h,deleteFromLineNumber:C,deleteToLineNumber:C},f.push(w)),c--,h++}else f=[{type:"flush"}];return[new ji(s,l),f]}constructor(e,t){this.samplingRatio=e,this.minimapLines=t}modelLineToMinimapLine(e){return Math.min(this.minimapLines.length,Math.max(1,Math.round(e/this.samplingRatio)))}modelLineRangeToMinimapLineRange(e,t){let i=this.modelLineToMinimapLine(e)-1;for(;i>0&&this.minimapLines[i-1]>=e;)i--;let n=this.modelLineToMinimapLine(t)-1;for(;n+1<this.minimapLines.length&&this.minimapLines[n+1]<=t;)n++;if(i===n){const s=this.minimapLines[i];if(s<e||s>t)return null}return[i+1,n+1]}decorationLineRangeToMinimapLineRange(e,t){let i=this.modelLineToMinimapLine(e),n=this.modelLineToMinimapLine(t);return e!==t&&n===i&&(n===this.minimapLines.length?i>1&&i--:n++),[i,n]}onLinesDeleted(e){const t=e.toLineNumber-e.fromLineNumber+1;let i=this.minimapLines.length,n=0;for(let s=this.minimapLines.length-1;s>=0&&!(this.minimapLines[s]<e.fromLineNumber);s--)this.minimapLines[s]<=e.toLineNumber?(this.minimapLines[s]=Math.max(1,e.fromLineNumber-1),i=Math.min(i,s),n=Math.max(n,s)):this.minimapLines[s]-=t;return[i,n]}onLinesInserted(e){const t=e.toLineNumber-e.fromLineNumber+1;for(let i=this.minimapLines.length-1;i>=0&&!(this.minimapLines[i]<e.fromLineNumber);i--)this.minimapLines[i]+=t}}class Zg extends be{constructor(e){super(e),this._sectionHeaderCache=new Al(10,1.5),this.tokensColorTracker=dc.getInstance(),this._selections=[],this._minimapSelections=null,this.options=new ri(this._context.configuration,this._context.theme,this.tokensColorTracker);const[t]=ji.compute(this.options,this._context.viewModel.getLineCount(),null);this._samplingState=t,this._shouldCheckSampling=!1,this._actual=new Zt(e.theme,this)}dispose(){this._actual.dispose(),super.dispose()}getDomNode(){return this._actual.getDomNode()}_onOptionsMaybeChanged(){const e=new ri(this._context.configuration,this._context.theme,this.tokensColorTracker);return this.options.equals(e)?!1:(this.options=e,this._recreateLineSampling(),this._actual.onDidChangeOptions(),!0)}onConfigurationChanged(e){return this._onOptionsMaybeChanged()}onCursorStateChanged(e){return this._selections=e.selections,this._minimapSelections=null,this._actual.onSelectionChanged()}onDecorationsChanged(e){return e.affectsMinimap?this._actual.onDecorationsChanged():!1}onFlushed(e){return this._samplingState&&(this._shouldCheckSampling=!0),this._actual.onFlushed()}onLinesChanged(e){if(this._samplingState){const t=this._samplingState.modelLineRangeToMinimapLineRange(e.fromLineNumber,e.fromLineNumber+e.count-1);return t?this._actual.onLinesChanged(t[0],t[1]-t[0]+1):!1}else return this._actual.onLinesChanged(e.fromLineNumber,e.count)}onLinesDeleted(e){if(this._samplingState){const[t,i]=this._samplingState.onLinesDeleted(e);return t<=i&&this._actual.onLinesChanged(t+1,i-t+1),this._shouldCheckSampling=!0,!0}else return this._actual.onLinesDeleted(e.fromLineNumber,e.toLineNumber)}onLinesInserted(e){return this._samplingState?(this._samplingState.onLinesInserted(e),this._shouldCheckSampling=!0,!0):this._actual.onLinesInserted(e.fromLineNumber,e.toLineNumber)}onScrollChanged(e){return this._actual.onScrollChanged()}onThemeChanged(e){return this._actual.onThemeChanged(),this._onOptionsMaybeChanged(),!0}onTokensChanged(e){if(this._samplingState){const t=[];for(const i of e.ranges){const n=this._samplingState.modelLineRangeToMinimapLineRange(i.fromLineNumber,i.toLineNumber);n&&t.push({fromLineNumber:n[0],toLineNumber:n[1]})}return t.length?this._actual.onTokensChanged(t):!1}else return this._actual.onTokensChanged(e.ranges)}onTokensColorsChanged(e){return this._onOptionsMaybeChanged(),this._actual.onTokensColorsChanged()}onZonesChanged(e){return this._actual.onZonesChanged()}prepareRender(e){this._shouldCheckSampling&&(this._shouldCheckSampling=!1,this._recreateLineSampling())}render(e){let t=e.visibleRange.startLineNumber,i=e.visibleRange.endLineNumber;this._samplingState&&(t=this._samplingState.modelLineToMinimapLine(t),i=this._samplingState.modelLineToMinimapLine(i));const n={viewportContainsWhitespaceGaps:e.viewportData.whitespaceViewportData.length>0,scrollWidth:e.scrollWidth,scrollHeight:e.scrollHeight,viewportStartLineNumber:t,viewportEndLineNumber:i,viewportStartLineNumberVerticalOffset:e.getVerticalOffsetForLineNumber(t),scrollTop:e.scrollTop,scrollLeft:e.scrollLeft,viewportWidth:e.viewportWidth,viewportHeight:e.viewportHeight};this._actual.render(n)}_recreateLineSampling(){this._minimapSelections=null;const e=!!this._samplingState,[t,i]=ji.compute(this.options,this._context.viewModel.getLineCount(),this._samplingState);if(this._samplingState=t,e&&this._samplingState)for(const n of i)switch(n.type){case"deleted":this._actual.onLinesDeleted(n.deleteFromLineNumber,n.deleteToLineNumber);break;case"inserted":this._actual.onLinesInserted(n.insertFromLineNumber,n.insertToLineNumber);break;case"flush":this._actual.onFlushed();break}}getLineCount(){return this._samplingState?this._samplingState.minimapLines.length:this._context.viewModel.getLineCount()}getRealLineCount(){return this._context.viewModel.getLineCount()}getLineContent(e){return this._samplingState?this._context.viewModel.getLineContent(this._samplingState.minimapLines[e-1]):this._context.viewModel.getLineContent(e)}getLineMaxColumn(e){return this._samplingState?this._context.viewModel.getLineMaxColumn(this._samplingState.minimapLines[e-1]):this._context.viewModel.getLineMaxColumn(e)}getMinimapLinesRenderingData(e,t,i){if(this._samplingState){const n=[];for(let s=0,o=t-e+1;s<o;s++)i[s]?n[s]=this._context.viewModel.getViewLineData(this._samplingState.minimapLines[e+s-1]):n[s]=null;return n}return this._context.viewModel.getMinimapLinesRenderingData(e,t,i).data}getSelections(){if(this._minimapSelections===null)if(this._samplingState){this._minimapSelections=[];for(const e of this._selections){const[t,i]=this._samplingState.decorationLineRangeToMinimapLineRange(e.startLineNumber,e.endLineNumber);this._minimapSelections.push(new Me(t,e.startColumn,i,e.endColumn))}}else this._minimapSelections=this._selections;return this._minimapSelections}getMinimapDecorationsInViewport(e,t){const i=this._getMinimapDecorationsInViewport(e,t).filter(n=>{var s;return!((s=n.options.minimap)!=null&&s.sectionHeaderStyle)});if(this._samplingState){const n=[];for(const s of i){if(!s.options.minimap)continue;const o=s.range,r=this._samplingState.modelLineToMinimapLine(o.startLineNumber),a=this._samplingState.modelLineToMinimapLine(o.endLineNumber);n.push(new lc(new W(r,o.startColumn,a,o.endColumn),s.options))}return n}return i}getSectionHeaderDecorationsInViewport(e,t){const i=this.options.minimapLineHeight,s=this.options.sectionHeaderFontSize/i;return e=Math.floor(Math.max(1,e-s)),this._getMinimapDecorationsInViewport(e,t).filter(o=>{var r;return!!((r=o.options.minimap)!=null&&r.sectionHeaderStyle)})}_getMinimapDecorationsInViewport(e,t){let i;if(this._samplingState){const n=this._samplingState.minimapLines[e-1],s=this._samplingState.minimapLines[t-1];i=new W(n,1,s,this._context.viewModel.getLineMaxColumn(s))}else i=new W(e,1,t,this._context.viewModel.getLineMaxColumn(t));return this._context.viewModel.getMinimapDecorationsInRange(i)}getSectionHeaderText(e,t){var o;const i=(o=e.options.minimap)==null?void 0:o.sectionHeaderText;if(!i)return null;const n=this._sectionHeaderCache.get(i);if(n)return n;const s=t(i);return this._sectionHeaderCache.set(i,s),s}getOptions(){return this._context.viewModel.model.getOptions()}revealLineNumber(e){this._samplingState&&(e=this._samplingState.minimapLines[e-1]),this._context.viewModel.revealRange("mouse",!1,new W(e,1,e,1),1,0)}setScrollTop(e){this._context.viewModel.viewLayout.setScrollPosition({scrollTop:e},1)}}class Zt extends V{constructor(e,t){super(),this._renderDecorations=!1,this._gestureInProgress=!1,this._theme=e,this._model=t,this._lastRenderData=null,this._buffers=null,this._selectionColor=this._theme.getColor(Ar),this._domNode=$(document.createElement("div")),Ve.write(this._domNode,9),this._domNode.setClassName(this._getMinimapDomNodeClassName()),this._domNode.setPosition("absolute"),this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true"),this._shadow=$(document.createElement("div")),this._shadow.setClassName("minimap-shadow-hidden"),this._domNode.appendChild(this._shadow),this._canvas=$(document.createElement("canvas")),this._canvas.setPosition("absolute"),this._canvas.setLeft(0),this._domNode.appendChild(this._canvas),this._decorationsCanvas=$(document.createElement("canvas")),this._decorationsCanvas.setPosition("absolute"),this._decorationsCanvas.setClassName("minimap-decorations-layer"),this._decorationsCanvas.setLeft(0),this._domNode.appendChild(this._decorationsCanvas),this._slider=$(document.createElement("div")),this._slider.setPosition("absolute"),this._slider.setClassName("minimap-slider"),this._slider.setLayerHinting(!0),this._slider.setContain("strict"),this._domNode.appendChild(this._slider),this._sliderHorizontal=$(document.createElement("div")),this._sliderHorizontal.setPosition("absolute"),this._sliderHorizontal.setClassName("minimap-slider-horizontal"),this._slider.appendChild(this._sliderHorizontal),this._applyLayout(),this._pointerDownListener=yt(this._domNode.domNode,Q.POINTER_DOWN,i=>{if(i.preventDefault(),this._model.options.renderMinimap===0||!this._lastRenderData)return;if(this._model.options.size!=="proportional"){if(i.button===0&&this._lastRenderData){const l=Tt(this._slider.domNode),h=l.top+l.height/2;this._startSliderDragging(i,h,this._lastRenderData.renderedLayout)}return}const s=this._model.options.minimapLineHeight,o=this._model.options.canvasInnerHeight/this._model.options.canvasOuterHeight*i.offsetY;let a=Math.floor(o/s)+this._lastRenderData.renderedLayout.startLineNumber-this._lastRenderData.renderedLayout.topPaddingLineCount;a=Math.min(a,this._model.getLineCount()),this._model.revealLineNumber(a)}),this._sliderPointerMoveMonitor=new za,this._sliderPointerDownListener=yt(this._slider.domNode,Q.POINTER_DOWN,i=>{i.preventDefault(),i.stopPropagation(),i.button===0&&this._lastRenderData&&this._startSliderDragging(i,i.pageY,this._lastRenderData.renderedLayout)}),this._gestureDisposable=So.addTarget(this._domNode.domNode),this._sliderTouchStartListener=P(this._domNode.domNode,tt.Start,i=>{i.preventDefault(),i.stopPropagation(),this._lastRenderData&&(this._slider.toggleClassName("active",!0),this._gestureInProgress=!0,this.scrollDueToTouchEvent(i))},{passive:!1}),this._sliderTouchMoveListener=P(this._domNode.domNode,tt.Change,i=>{i.preventDefault(),i.stopPropagation(),this._lastRenderData&&this._gestureInProgress&&this.scrollDueToTouchEvent(i)},{passive:!1}),this._sliderTouchEndListener=yt(this._domNode.domNode,tt.End,i=>{i.preventDefault(),i.stopPropagation(),this._gestureInProgress=!1,this._slider.toggleClassName("active",!1)})}_startSliderDragging(e,t,i){if(!e.target||!(e.target instanceof Element))return;const n=e.pageX;this._slider.toggleClassName("active",!0);const s=(o,r)=>{const a=Tt(this._domNode.domNode),l=Math.min(Math.abs(r-n),Math.abs(r-a.left),Math.abs(r-a.left-a.width));if(ja&&l>Gg){this._model.setScrollTop(i.scrollTop);return}const h=o-t;this._model.setScrollTop(i.getDesiredScrollTopFromDelta(h))};e.pageY!==t&&s(e.pageY,n),this._sliderPointerMoveMonitor.startMonitoring(e.target,e.pointerId,e.buttons,o=>s(o.pageY,o.pageX),()=>{this._slider.toggleClassName("active",!1)})}scrollDueToTouchEvent(e){const t=this._domNode.domNode.getBoundingClientRect().top,i=this._lastRenderData.renderedLayout.getDesiredScrollTopFromTouchLocation(e.pageY-t);this._model.setScrollTop(i)}dispose(){this._pointerDownListener.dispose(),this._sliderPointerMoveMonitor.dispose(),this._sliderPointerDownListener.dispose(),this._gestureDisposable.dispose(),this._sliderTouchStartListener.dispose(),this._sliderTouchMoveListener.dispose(),this._sliderTouchEndListener.dispose(),super.dispose()}_getMinimapDomNodeClassName(){const e=["minimap"];return this._model.options.showSlider==="always"?e.push("slider-always"):e.push("slider-mouseover"),this._model.options.autohide&&e.push("autohide"),e.join(" ")}getDomNode(){return this._domNode}_applyLayout(){this._domNode.setLeft(this._model.options.minimapLeft),this._domNode.setWidth(this._model.options.minimapWidth),this._domNode.setHeight(this._model.options.minimapHeight),this._shadow.setHeight(this._model.options.minimapHeight),this._canvas.setWidth(this._model.options.canvasOuterWidth),this._canvas.setHeight(this._model.options.canvasOuterHeight),this._canvas.domNode.width=this._model.options.canvasInnerWidth,this._canvas.domNode.height=this._model.options.canvasInnerHeight,this._decorationsCanvas.setWidth(this._model.options.canvasOuterWidth),this._decorationsCanvas.setHeight(this._model.options.canvasOuterHeight),this._decorationsCanvas.domNode.width=this._model.options.canvasInnerWidth,this._decorationsCanvas.domNode.height=this._model.options.canvasInnerHeight,this._slider.setWidth(this._model.options.minimapWidth)}_getBuffer(){return this._buffers||this._model.options.canvasInnerWidth>0&&this._model.options.canvasInnerHeight>0&&(this._buffers=new jo(this._canvas.domNode.getContext("2d"),this._model.options.canvasInnerWidth,this._model.options.canvasInnerHeight,this._model.options.backgroundColor)),this._buffers?this._buffers.getBuffer():null}onDidChangeOptions(){this._lastRenderData=null,this._buffers=null,this._applyLayout(),this._domNode.setClassName(this._getMinimapDomNodeClassName())}onSelectionChanged(){return this._renderDecorations=!0,!0}onDecorationsChanged(){return this._renderDecorations=!0,!0}onFlushed(){return this._lastRenderData=null,!0}onLinesChanged(e,t){return this._lastRenderData?this._lastRenderData.onLinesChanged(e,t):!1}onLinesDeleted(e,t){var i;return(i=this._lastRenderData)==null||i.onLinesDeleted(e,t),!0}onLinesInserted(e,t){var i;return(i=this._lastRenderData)==null||i.onLinesInserted(e,t),!0}onScrollChanged(){return this._renderDecorations=!0,!0}onThemeChanged(){return this._selectionColor=this._theme.getColor(Ar),this._renderDecorations=!0,!0}onTokensChanged(e){return this._lastRenderData?this._lastRenderData.onTokensChanged(e):!1}onTokensColorsChanged(){return this._lastRenderData=null,this._buffers=null,!0}onZonesChanged(){return this._lastRenderData=null,!0}render(e){if(this._model.options.renderMinimap===0){this._shadow.setClassName("minimap-shadow-hidden"),this._sliderHorizontal.setWidth(0),this._sliderHorizontal.setHeight(0);return}e.scrollLeft+e.viewportWidth>=e.scrollWidth?this._shadow.setClassName("minimap-shadow-hidden"):this._shadow.setClassName("minimap-shadow-visible");const i=Hi.create(this._model.options,e.viewportStartLineNumber,e.viewportEndLineNumber,e.viewportStartLineNumberVerticalOffset,e.viewportHeight,e.viewportContainsWhitespaceGaps,this._model.getLineCount(),this._model.getRealLineCount(),e.scrollTop,e.scrollHeight,this._lastRenderData?this._lastRenderData.renderedLayout:null);this._slider.setDisplay(i.sliderNeeded?"block":"none"),this._slider.setTop(i.sliderTop),this._slider.setHeight(i.sliderHeight),this._sliderHorizontal.setLeft(0),this._sliderHorizontal.setWidth(this._model.options.minimapWidth),this._sliderHorizontal.setTop(0),this._sliderHorizontal.setHeight(i.sliderHeight),this.renderDecorations(i),this._lastRenderData=this.renderLines(i)}renderDecorations(e){if(this._renderDecorations){this._renderDecorations=!1;const t=this._model.getSelections();t.sort(W.compareRangesUsingStarts);const i=this._model.getMinimapDecorationsInViewport(e.startLineNumber,e.endLineNumber);i.sort((u,_)=>(u.options.zIndex||0)-(_.options.zIndex||0));const{canvasInnerWidth:n,canvasInnerHeight:s}=this._model.options,o=this._model.options.minimapLineHeight,r=this._model.options.minimapCharWidth,a=this._model.getOptions().tabSize,l=this._decorationsCanvas.domNode.getContext("2d");l.clearRect(0,0,n,s);const h=new aa(e.startLineNumber,e.endLineNumber,!1);this._renderSelectionLineHighlights(l,t,h,e,o),this._renderDecorationsLineHighlights(l,i,h,e,o);const c=new aa(e.startLineNumber,e.endLineNumber,null);this._renderSelectionsHighlights(l,t,c,e,o,a,r,n),this._renderDecorationsHighlights(l,i,c,e,o,a,r,n),this._renderSectionHeaders(e)}}_renderSelectionLineHighlights(e,t,i,n,s){if(!this._selectionColor||this._selectionColor.isTransparent())return;e.fillStyle=this._selectionColor.transparent(.5).toString();let o=0,r=0;for(const a of t){const l=n.intersectWithViewport(a);if(!l)continue;const[h,c]=l;for(let f=h;f<=c;f++)i.set(f,!0);const u=n.getYForLineNumber(h,s),_=n.getYForLineNumber(c,s);r>=u||(r>o&&e.fillRect(Ze,o,e.canvas.width,r-o),o=u),r=_}r>o&&e.fillRect(Ze,o,e.canvas.width,r-o)}_renderDecorationsLineHighlights(e,t,i,n,s){const o=new Map;for(let r=t.length-1;r>=0;r--){const a=t[r],l=a.options.minimap;if(!l||l.position!==1)continue;const h=n.intersectWithViewport(a.range);if(!h)continue;const[c,u]=h,_=l.getColor(this._theme.value);if(!_||_.isTransparent())continue;let f=o.get(_.toString());f||(f=_.transparent(.5).toString(),o.set(_.toString(),f)),e.fillStyle=f;for(let w=c;w<=u;w++){if(i.has(w))continue;i.set(w,!0);const C=n.getYForLineNumber(c,s);e.fillRect(Ze,C,e.canvas.width,s)}}}_renderSelectionsHighlights(e,t,i,n,s,o,r,a){if(!(!this._selectionColor||this._selectionColor.isTransparent()))for(const l of t){const h=n.intersectWithViewport(l);if(!h)continue;const[c,u]=h;for(let _=c;_<=u;_++)this.renderDecorationOnLine(e,i,l,this._selectionColor,n,_,s,s,o,r,a)}}_renderDecorationsHighlights(e,t,i,n,s,o,r,a){for(const l of t){const h=l.options.minimap;if(!h)continue;const c=n.intersectWithViewport(l.range);if(!c)continue;const[u,_]=c,f=h.getColor(this._theme.value);if(!(!f||f.isTransparent()))for(let w=u;w<=_;w++)switch(h.position){case 1:this.renderDecorationOnLine(e,i,l.range,f,n,w,s,s,o,r,a);continue;case 2:{const C=n.getYForLineNumber(w,s);this.renderDecoration(e,f,2,C,jg,s);continue}}}}renderDecorationOnLine(e,t,i,n,s,o,r,a,l,h,c){const u=s.getYForLineNumber(o,a);if(u+r<0||u>this._model.options.canvasInnerHeight)return;const{startLineNumber:_,endLineNumber:f}=i,w=_===o?i.startColumn:1,C=f===o?i.endColumn:this._model.getLineMaxColumn(o),v=this.getXOffsetForPosition(t,o,w,l,h,c),g=this.getXOffsetForPosition(t,o,C,l,h,c);this.renderDecoration(e,n,v,u,g-v,r)}getXOffsetForPosition(e,t,i,n,s,o){if(i===1)return Ze;if((i-1)*s>=o)return o;let a=e.get(t);if(!a){const l=this._model.getLineContent(t);a=[Ze];let h=Ze;for(let c=1;c<l.length+1;c++){const u=l.charCodeAt(c-1),_=u===9?n*s:Es(u)?2*s:s,f=h+_;if(f>=o){a[c]=o;break}a[c]=f,h=f}e.set(t,a)}return i-1<a.length?a[i-1]:o}renderDecoration(e,t,i,n,s,o){e.fillStyle=t&&t.toString()||"",e.fillRect(i,n,s,o)}_renderSectionHeaders(e){var w;const t=this._model.options.minimapLineHeight,i=this._model.options.sectionHeaderFontSize,n=this._model.options.sectionHeaderLetterSpacing,s=i*1.5,{canvasInnerWidth:o}=this._model.options,r=this._model.options.backgroundColor,a=`rgb(${r.r} ${r.g} ${r.b} / .7)`,l=this._model.options.sectionHeaderFontColor,h=`rgb(${l.r} ${l.g} ${l.b})`,c=h,u=this._decorationsCanvas.domNode.getContext("2d");u.letterSpacing=n+"px",u.font="500 "+i+"px "+this._model.options.sectionHeaderFontFamily,u.strokeStyle=c,u.lineWidth=.2;const _=this._model.getSectionHeaderDecorationsInViewport(e.startLineNumber,e.endLineNumber);_.sort((C,v)=>C.range.startLineNumber-v.range.startLineNumber);const f=Zt._fitSectionHeader.bind(null,u,o-Ze);for(const C of _){const v=e.getYForLineNumber(C.range.startLineNumber,t)+i,g=v-i,p=g+2,m=this._model.getSectionHeaderText(C,f);Zt._renderSectionLabel(u,m,((w=C.options.minimap)==null?void 0:w.sectionHeaderStyle)===2,a,h,o,g,s,v,p)}}static _fitSectionHeader(e,t,i){if(!i)return i;const n="…",s=e.measureText(i).width,o=e.measureText(n).width;if(s<=t||s<=o)return i;const r=i.length,a=s/i.length,l=Math.floor((t-o)/a)-1;let h=Math.ceil(l/2);for(;h>0&&/\s/.test(i[h-1]);)--h;return i.substring(0,h)+n+i.substring(r-(l-h))}static _renderSectionLabel(e,t,i,n,s,o,r,a,l,h){t&&(e.fillStyle=n,e.fillRect(0,r,o,a),e.fillStyle=s,e.fillText(t,Ze,l)),i&&(e.beginPath(),e.moveTo(0,h),e.lineTo(o,h),e.closePath(),e.stroke())}renderLines(e){const t=e.startLineNumber,i=e.endLineNumber,n=this._model.options.minimapLineHeight;if(this._lastRenderData&&this._lastRenderData.linesEquals(e)){const k=this._lastRenderData._get();return new ra(e,k.imageData,k.lines)}const s=this._getBuffer();if(!s)return null;const[o,r,a]=Zt._renderUntouchedLines(s,e.topPaddingLineCount,t,i,n,this._lastRenderData),l=this._model.getMinimapLinesRenderingData(t,i,a),h=this._model.getOptions().tabSize,c=this._model.options.defaultBackgroundColor,u=this._model.options.backgroundColor,_=this._model.options.foregroundAlpha,f=this._model.tokensColorTracker,w=f.backgroundIsLight(),C=this._model.options.renderMinimap,v=this._model.options.charRenderer(),g=this._model.options.fontScale,p=this._model.options.minimapCharWidth,b=(C===1?2:3)*g,L=n>b?Math.floor((n-b)/2):0,y=u.a/255,S=new un(Math.round((u.r-c.r)*y+c.r),Math.round((u.g-c.g)*y+c.g),Math.round((u.b-c.b)*y+c.b),255);let D=e.topPaddingLineCount*n;const x=[];for(let k=0,K=i-t+1;k<K;k++)a[k]&&Zt._renderLine(s,S,u.a,w,C,p,f,_,v,D,L,h,l[k],g,n),x[k]=new xn(D),D+=n;const M=o===-1?0:o,I=(r===-1?s.height:r)-M;return this._canvas.domNode.getContext("2d").putImageData(s,0,0,0,M,s.width,I),new ra(e,s,x)}static _renderUntouchedLines(e,t,i,n,s,o){const r=[];if(!o){for(let D=0,x=n-i+1;D<x;D++)r[D]=!0;return[-1,-1,r]}const a=o._get(),l=a.imageData.data,h=a.rendLineNumberStart,c=a.lines,u=c.length,_=e.width,f=e.data,w=(n-i+1)*s*_*4;let C=-1,v=-1,g=-1,p=-1,m=-1,b=-1,L=t*s;for(let D=i;D<=n;D++){const x=D-i,M=D-h,R=M>=0&&M<u?c[M].dy:-1;if(R===-1){r[x]=!0,L+=s;continue}const I=R*_*4,F=(R+s)*_*4,k=L*_*4,K=(L+s)*_*4;p===I&&b===k?(p=F,b=K):(g!==-1&&(f.set(l.subarray(g,p),m),C===-1&&g===0&&g===m&&(C=p),v===-1&&p===w&&g===m&&(v=g)),g=I,p=F,m=k,b=K),r[x]=!1,L+=s}g!==-1&&(f.set(l.subarray(g,p),m),C===-1&&g===0&&g===m&&(C=p),v===-1&&p===w&&g===m&&(v=g));const y=C===-1?-1:C/(_*4),S=v===-1?-1:v/(_*4);return[y,S,r]}static _renderLine(e,t,i,n,s,o,r,a,l,h,c,u,_,f,w){const C=_.content,v=_.tokens,g=e.width-o,p=w===1;let m=Ze,b=0,L=0;for(let y=0,S=v.getCount();y<S;y++){const D=v.getEndOffset(y),x=v.getForeground(y),M=r.getColor(x);for(;b<D;b++){if(m>g)return;const R=C.charCodeAt(b);if(R===9){const I=u-(b+L)%u;L+=I-1,m+=I*o}else if(R===32)m+=o;else{const I=Es(R)?2:1;for(let F=0;F<I;F++)if(s===2?l.blockRenderChar(e,m,h+c,M,a,t,i,p):l.renderChar(e,m,h+c,R,M,a,t,i,f,n,p),m+=o,m>g)return}}}}}class aa{constructor(e,t,i){this._startLineNumber=e,this._endLineNumber=t,this._defaultValue=i,this._values=[];for(let n=0,s=this._endLineNumber-this._startLineNumber+1;n<s;n++)this._values[n]=i}has(e){return this.get(e)!==this._defaultValue}set(e,t){e<this._startLineNumber||e>this._endLineNumber||(this._values[e-this._startLineNumber]=t)}get(e){return e<this._startLineNumber||e>this._endLineNumber?this._defaultValue:this._values[e-this._startLineNumber]}}class Kg extends be{constructor(e,t){super(e),this._viewDomNode=t;const n=this._context.configuration.options.get(146);this._widgets={},this._verticalScrollbarWidth=n.verticalScrollbarWidth,this._minimapWidth=n.minimap.minimapWidth,this._horizontalScrollbarHeight=n.horizontalScrollbarHeight,this._editorHeight=n.height,this._editorWidth=n.width,this._viewDomNodeRect={top:0,left:0,width:0,height:0},this._domNode=$(document.createElement("div")),Ve.write(this._domNode,4),this._domNode.setClassName("overlayWidgets"),this.overflowingOverlayWidgetsDomNode=$(document.createElement("div")),Ve.write(this.overflowingOverlayWidgetsDomNode,5),this.overflowingOverlayWidgetsDomNode.setClassName("overflowingOverlayWidgets")}dispose(){super.dispose(),this._widgets={}}getDomNode(){return this._domNode}onConfigurationChanged(e){const i=this._context.configuration.options.get(146);return this._verticalScrollbarWidth=i.verticalScrollbarWidth,this._minimapWidth=i.minimap.minimapWidth,this._horizontalScrollbarHeight=i.horizontalScrollbarHeight,this._editorHeight=i.height,this._editorWidth=i.width,!0}addWidget(e){const t=$(e.getDomNode());this._widgets[e.getId()]={widget:e,preference:null,domNode:t},t.setPosition("absolute"),t.setAttribute("widgetId",e.getId()),e.allowEditorOverflow?this.overflowingOverlayWidgetsDomNode.appendChild(t):this._domNode.appendChild(t),this.setShouldRender(),this._updateMaxMinWidth()}setWidgetPosition(e,t){const i=this._widgets[e.getId()],n=t?t.preference:null,s=t==null?void 0:t.stackOridinal;return i.preference===n&&i.stack===s?(this._updateMaxMinWidth(),!1):(i.preference=n,i.stack=s,this.setShouldRender(),this._updateMaxMinWidth(),!0)}removeWidget(e){const t=e.getId();if(this._widgets.hasOwnProperty(t)){const n=this._widgets[t].domNode.domNode;delete this._widgets[t],n.remove(),this.setShouldRender(),this._updateMaxMinWidth()}}_updateMaxMinWidth(){var i,n;let e=0;const t=Object.keys(this._widgets);for(let s=0,o=t.length;s<o;s++){const r=t[s],l=(n=(i=this._widgets[r].widget).getMinContentWidthInPx)==null?void 0:n.call(i);typeof l<"u"&&(e=Math.max(e,l))}this._context.viewLayout.setOverlayWidgetsMinWidth(e)}_renderWidget(e,t){const i=e.domNode;if(e.preference===null){i.setTop("");return}const n=2*this._verticalScrollbarWidth+this._minimapWidth;if(e.preference===0||e.preference===1){if(e.preference===1){const s=i.domNode.clientHeight;i.setTop(this._editorHeight-s-2*this._horizontalScrollbarHeight)}else i.setTop(0);e.stack!==void 0?(i.setTop(t[e.preference]),t[e.preference]+=i.domNode.clientWidth):i.setRight(n)}else if(e.preference===2)i.domNode.style.right="50%",e.stack!==void 0?(i.setTop(t[2]),t[2]+=i.domNode.clientHeight):i.setTop(0);else{const{top:s,left:o}=e.preference;if(this._context.configuration.options.get(42)&&e.widget.allowEditorOverflow){const a=this._viewDomNodeRect;i.setTop(s+a.top),i.setLeft(o+a.left),i.setPosition("fixed")}else i.setTop(s),i.setLeft(o),i.setPosition("absolute")}}prepareRender(e){this._viewDomNodeRect=Tt(this._viewDomNode.domNode)}render(e){this._domNode.setWidth(this._editorWidth);const t=Object.keys(this._widgets),i=Array.from({length:3},()=>0);t.sort((n,s)=>(this._widgets[n].stack||0)-(this._widgets[s].stack||0));for(let n=0,s=t.length;n<s;n++){const o=t[n];this._renderWidget(this._widgets[o],i)}}}class qg{constructor(e,t){const i=e.options;this.lineHeight=i.get(67),this.pixelRatio=i.get(144),this.overviewRulerLanes=i.get(83),this.renderBorder=i.get(82);const n=t.getColor(cc);this.borderColor=n?n.toString():null,this.hideCursor=i.get(59);const s=t.getColor(hd);this.cursorColorSingle=s?s.transparent(.7).toString():null;const o=t.getColor(cd);this.cursorColorPrimary=o?o.transparent(.7).toString():null;const r=t.getColor(ud);this.cursorColorSecondary=r?r.transparent(.7).toString():null,this.themeType=t.type;const a=i.get(73),l=a.enabled,h=a.side,c=t.getColor(uc),u=Oo.getDefaultBackground();c?this.backgroundColor=c:l&&h==="right"?this.backgroundColor=u:this.backgroundColor=null;const f=i.get(146).overviewRuler;this.top=f.top,this.right=f.right,this.domWidth=f.width,this.domHeight=f.height,this.overviewRulerLanes===0?(this.canvasWidth=0,this.canvasHeight=0):(this.canvasWidth=this.domWidth*this.pixelRatio|0,this.canvasHeight=this.domHeight*this.pixelRatio|0);const[w,C]=this._initLanes(1,this.canvasWidth,this.overviewRulerLanes);this.x=w,this.w=C}_initLanes(e,t,i){const n=t-e;if(i>=3){const s=Math.floor(n/3),o=Math.floor(n/3),r=n-s-o,a=e,l=a+s,h=a+s+r;return[[0,a,l,a,h,a,l,a],[0,s,r,s+r,o,s+r+o,r+o,s+r+o]]}else if(i===2){const s=Math.floor(n/2),o=n-s,r=e,a=r+s;return[[0,r,r,r,a,r,r,r],[0,s,s,s,o,s+o,s+o,s+o]]}else{const s=e,o=n;return[[0,s,s,s,s,s,s,s],[0,o,o,o,o,o,o,o]]}}equals(e){return this.lineHeight===e.lineHeight&&this.pixelRatio===e.pixelRatio&&this.overviewRulerLanes===e.overviewRulerLanes&&this.renderBorder===e.renderBorder&&this.borderColor===e.borderColor&&this.hideCursor===e.hideCursor&&this.cursorColorSingle===e.cursorColorSingle&&this.cursorColorPrimary===e.cursorColorPrimary&&this.cursorColorSecondary===e.cursorColorSecondary&&this.themeType===e.themeType&&Ai.equals(this.backgroundColor,e.backgroundColor)&&this.top===e.top&&this.right===e.right&&this.domWidth===e.domWidth&&this.domHeight===e.domHeight&&this.canvasWidth===e.canvasWidth&&this.canvasHeight===e.canvasHeight}}class Yg extends be{constructor(e){super(e),this._actualShouldRender=0,this._renderedDecorations=[],this._renderedCursorPositions=[],this._domNode=$(document.createElement("canvas")),this._domNode.setClassName("decorationsOverviewRuler"),this._domNode.setPosition("absolute"),this._domNode.setLayerHinting(!0),this._domNode.setContain("strict"),this._domNode.setAttribute("aria-hidden","true"),this._updateSettings(!1),this._tokensColorTrackerListener=Oo.onDidChange(t=>{t.changedColorMap&&this._updateSettings(!0)}),this._cursorPositions=[{position:new E(1,1),color:this._settings.cursorColorSingle}]}dispose(){super.dispose(),this._tokensColorTrackerListener.dispose()}_updateSettings(e){const t=new qg(this._context.configuration,this._context.theme);return this._settings&&this._settings.equals(t)?!1:(this._settings=t,this._domNode.setTop(this._settings.top),this._domNode.setRight(this._settings.right),this._domNode.setWidth(this._settings.domWidth),this._domNode.setHeight(this._settings.domHeight),this._domNode.domNode.width=this._settings.canvasWidth,this._domNode.domNode.height=this._settings.canvasHeight,e&&this._render(),!0)}_markRenderingIsNeeded(){return this._actualShouldRender=2,!0}_markRenderingIsMaybeNeeded(){return this._actualShouldRender=1,!0}onConfigurationChanged(e){return this._updateSettings(!1)?this._markRenderingIsNeeded():!1}onCursorStateChanged(e){this._cursorPositions=[];for(let t=0,i=e.selections.length;t<i;t++){let n=this._settings.cursorColorSingle;i>1&&(n=t===0?this._settings.cursorColorPrimary:this._settings.cursorColorSecondary),this._cursorPositions.push({position:e.selections[t].getPosition(),color:n})}return this._cursorPositions.sort((t,i)=>E.compare(t.position,i.position)),this._markRenderingIsMaybeNeeded()}onDecorationsChanged(e){return e.affectsOverviewRuler?this._markRenderingIsMaybeNeeded():!1}onFlushed(e){return this._markRenderingIsNeeded()}onScrollChanged(e){return e.scrollHeightChanged?this._markRenderingIsNeeded():!1}onZonesChanged(e){return this._markRenderingIsNeeded()}onThemeChanged(e){return this._updateSettings(!1)?this._markRenderingIsNeeded():!1}getDomNode(){return this._domNode.domNode}prepareRender(e){}render(e){this._render(),this._actualShouldRender=0}_render(){const e=this._settings.backgroundColor;if(this._settings.overviewRulerLanes===0){this._domNode.setBackgroundColor(e?Ai.Format.CSS.formatHexA(e):""),this._domNode.setDisplay("none");return}const t=this._context.viewModel.getAllOverviewRulerDecorations(this._context.theme);if(t.sort(Dr.compareByRenderingProps),this._actualShouldRender===1&&!Dr.equalsArr(this._renderedDecorations,t)&&(this._actualShouldRender=2),this._actualShouldRender===1&&!yo(this._renderedCursorPositions,this._cursorPositions,(f,w)=>f.position.lineNumber===w.position.lineNumber&&f.color===w.color)&&(this._actualShouldRender=2),this._actualShouldRender===1)return;this._renderedDecorations=t,this._renderedCursorPositions=this._cursorPositions,this._domNode.setDisplay("block");const i=this._settings.canvasWidth,n=this._settings.canvasHeight,s=this._settings.lineHeight,o=this._context.viewLayout,r=this._context.viewLayout.getScrollHeight(),a=n/r,l=6*this._settings.pixelRatio|0,h=l/2|0,c=this._domNode.domNode.getContext("2d");e?e.isOpaque()?(c.fillStyle=Ai.Format.CSS.formatHexA(e),c.fillRect(0,0,i,n)):(c.clearRect(0,0,i,n),c.fillStyle=Ai.Format.CSS.formatHexA(e),c.fillRect(0,0,i,n)):c.clearRect(0,0,i,n);const u=this._settings.x,_=this._settings.w;for(const f of t){const w=f.color,C=f.data;c.fillStyle=w;let v=0,g=0,p=0;for(let m=0,b=C.length/3;m<b;m++){const L=C[3*m],y=C[3*m+1],S=C[3*m+2];let D=o.getVerticalOffsetForLineNumber(y)*a|0,x=(o.getVerticalOffsetForLineNumber(S)+s)*a|0;if(x-D<l){let R=(D+x)/2|0;R<h?R=h:R+h>n&&(R=n-h),D=R-h,x=R+h}D>p+1||L!==v?(m!==0&&c.fillRect(u[v],g,_[v],p-g),v=L,g=D,p=x):x>p&&(p=x)}c.fillRect(u[v],g,_[v],p-g)}if(!this._settings.hideCursor){const f=2*this._settings.pixelRatio|0,w=f/2|0,C=this._settings.x[7],v=this._settings.w[7];let g=-100,p=-100,m=null;for(let b=0,L=this._cursorPositions.length;b<L;b++){const y=this._cursorPositions[b].color;if(!y)continue;const S=this._cursorPositions[b].position;let D=o.getVerticalOffsetForLineNumber(S.lineNumber)*a|0;D<w?D=w:D+w>n&&(D=n-w);const x=D-w,M=x+f;x>p+1||y!==m?(b!==0&&m&&c.fillRect(C,g,v,p-g),g=x,p=M):M>p&&(p=M),m=y,c.fillStyle=y}m&&c.fillRect(C,g,v,p-g)}this._settings.renderBorder&&this._settings.borderColor&&this._settings.overviewRulerLanes>0&&(c.beginPath(),c.lineWidth=1,c.strokeStyle=this._settings.borderColor,c.moveTo(0,0),c.lineTo(0,n),c.moveTo(1,0),c.lineTo(i,0),c.stroke())}}class Qg extends Xi{constructor(e,t){super(),this._context=e;const i=this._context.configuration.options;this._domNode=$(document.createElement("canvas")),this._domNode.setClassName(t),this._domNode.setPosition("absolute"),this._domNode.setLayerHinting(!0),this._domNode.setContain("strict"),this._zoneManager=new gc(n=>this._context.viewLayout.getVerticalOffsetForLineNumber(n)),this._zoneManager.setDOMWidth(0),this._zoneManager.setDOMHeight(0),this._zoneManager.setOuterHeight(this._context.viewLayout.getScrollHeight()),this._zoneManager.setLineHeight(i.get(67)),this._zoneManager.setPixelRatio(i.get(144)),this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),super.dispose()}onConfigurationChanged(e){const t=this._context.configuration.options;return e.hasChanged(67)&&(this._zoneManager.setLineHeight(t.get(67)),this._render()),e.hasChanged(144)&&(this._zoneManager.setPixelRatio(t.get(144)),this._domNode.setWidth(this._zoneManager.getDOMWidth()),this._domNode.setHeight(this._zoneManager.getDOMHeight()),this._domNode.domNode.width=this._zoneManager.getCanvasWidth(),this._domNode.domNode.height=this._zoneManager.getCanvasHeight(),this._render()),!0}onFlushed(e){return this._render(),!0}onScrollChanged(e){return e.scrollHeightChanged&&(this._zoneManager.setOuterHeight(e.scrollHeight),this._render()),!0}onZonesChanged(e){return this._render(),!0}getDomNode(){return this._domNode.domNode}setLayout(e){this._domNode.setTop(e.top),this._domNode.setRight(e.right);let t=!1;t=this._zoneManager.setDOMWidth(e.width)||t,t=this._zoneManager.setDOMHeight(e.height)||t,t&&(this._domNode.setWidth(this._zoneManager.getDOMWidth()),this._domNode.setHeight(this._zoneManager.getDOMHeight()),this._domNode.domNode.width=this._zoneManager.getCanvasWidth(),this._domNode.domNode.height=this._zoneManager.getCanvasHeight(),this._render())}setZones(e){this._zoneManager.setZones(e),this._render()}_render(){if(this._zoneManager.getOuterHeight()===0)return!1;const e=this._zoneManager.getCanvasWidth(),t=this._zoneManager.getCanvasHeight(),i=this._zoneManager.resolveColorZones(),n=this._zoneManager.getId2Color(),s=this._domNode.domNode.getContext("2d");return s.clearRect(0,0,e,t),i.length>0&&this._renderOneLane(s,i,n,e),!0}_renderOneLane(e,t,i,n){let s=0,o=0,r=0;for(const a of t){const l=a.colorId,h=a.from,c=a.to;l!==s?(e.fillRect(0,o,n,r-o),s=l,e.fillStyle=i[s],o=h,r=c):r>=h?r=Math.max(r,c):(e.fillRect(0,o,n,r-o),o=h,r=c)}e.fillRect(0,o,n,r-o)}}class Xg extends be{constructor(e){super(e),this.domNode=$(document.createElement("div")),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this.domNode.setClassName("view-rulers"),this._renderedRulers=[];const t=this._context.configuration.options;this._rulers=t.get(103),this._typicalHalfwidthCharacterWidth=t.get(50).typicalHalfwidthCharacterWidth}dispose(){super.dispose()}onConfigurationChanged(e){const t=this._context.configuration.options;return this._rulers=t.get(103),this._typicalHalfwidthCharacterWidth=t.get(50).typicalHalfwidthCharacterWidth,!0}onScrollChanged(e){return e.scrollHeightChanged}prepareRender(e){}_ensureRulersCount(){const e=this._renderedRulers.length,t=this._rulers.length;if(e===t)return;if(e<t){const{tabSize:n}=this._context.viewModel.model.getOptions(),s=n;let o=t-e;for(;o>0;){const r=$(document.createElement("div"));r.setClassName("view-ruler"),r.setWidth(s),this.domNode.appendChild(r),this._renderedRulers.push(r),o--}return}let i=e-t;for(;i>0;){const n=this._renderedRulers.pop();this.domNode.removeChild(n),i--}}render(e){this._ensureRulersCount();for(let t=0,i=this._rulers.length;t<i;t++){const n=this._renderedRulers[t],s=this._rulers[t];n.setBoxShadow(s.color?`1px 0 0 0 ${s.color} inset`:""),n.setHeight(Math.min(e.scrollHeight,1e6)),n.setLeft(s.column*this._typicalHalfwidthCharacterWidth)}}}class Jg extends be{constructor(e){super(e),this._scrollTop=0,this._width=0,this._updateWidth(),this._shouldShow=!1;const i=this._context.configuration.options.get(104);this._useShadows=i.useShadows,this._domNode=$(document.createElement("div")),this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true")}dispose(){super.dispose()}_updateShouldShow(){const e=this._useShadows&&this._scrollTop>0;return this._shouldShow!==e?(this._shouldShow=e,!0):!1}getDomNode(){return this._domNode}_updateWidth(){const t=this._context.configuration.options.get(146);t.minimap.renderMinimap===0||t.minimap.minimapWidth>0&&t.minimap.minimapLeft===0?this._width=t.width:this._width=t.width-t.verticalScrollbarWidth}onConfigurationChanged(e){const i=this._context.configuration.options.get(104);return this._useShadows=i.useShadows,this._updateWidth(),this._updateShouldShow(),!0}onScrollChanged(e){return this._scrollTop=e.scrollTop,this._updateShouldShow()}prepareRender(e){}render(e){this._domNode.setWidth(this._width),this._domNode.setClassName(this._shouldShow?"scroll-decoration":"")}}class ef{constructor(e){this.left=e.left,this.width=e.width,this.startStyle=null,this.endStyle=null}}class tf{constructor(e,t){this.lineNumber=e,this.ranges=t}}function nf(d){return new ef(d)}function sf(d){return new tf(d.lineNumber,d.ranges.map(nf))}const J=class J extends Pt{constructor(e){super(),this._previousFrameVisibleRangesWithStyle=[],this._context=e;const t=this._context.configuration.options;this._roundedSelection=t.get(102),this._typicalHalfwidthCharacterWidth=t.get(50).typicalHalfwidthCharacterWidth,this._selections=[],this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){const t=this._context.configuration.options;return this._roundedSelection=t.get(102),this._typicalHalfwidthCharacterWidth=t.get(50).typicalHalfwidthCharacterWidth,!0}onCursorStateChanged(e){return this._selections=e.selections.slice(0),!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}_visibleRangesHaveGaps(e){for(let t=0,i=e.length;t<i;t++)if(e[t].ranges.length>1)return!0;return!1}_enrichVisibleRangesWithStyle(e,t,i){const n=this._typicalHalfwidthCharacterWidth/4;let s=null,o=null;if(i&&i.length>0&&t.length>0){const r=t[0].lineNumber;if(r===e.startLineNumber)for(let l=0;!s&&l<i.length;l++)i[l].lineNumber===r&&(s=i[l].ranges[0]);const a=t[t.length-1].lineNumber;if(a===e.endLineNumber)for(let l=i.length-1;!o&&l>=0;l--)i[l].lineNumber===a&&(o=i[l].ranges[0]);s&&!s.startStyle&&(s=null),o&&!o.startStyle&&(o=null)}for(let r=0,a=t.length;r<a;r++){const l=t[r].ranges[0],h=l.left,c=l.left+l.width,u={top:0,bottom:0},_={top:0,bottom:0};if(r>0){const f=t[r-1].ranges[0].left,w=t[r-1].ranges[0].left+t[r-1].ranges[0].width;ln(h-f)<n?u.top=2:h>f&&(u.top=1),ln(c-w)<n?_.top=2:f<c&&c<w&&(_.top=1)}else s&&(u.top=s.startStyle.top,_.top=s.endStyle.top);if(r+1<a){const f=t[r+1].ranges[0].left,w=t[r+1].ranges[0].left+t[r+1].ranges[0].width;ln(h-f)<n?u.bottom=2:f<h&&h<w&&(u.bottom=1),ln(c-w)<n?_.bottom=2:c<w&&(_.bottom=1)}else o&&(u.bottom=o.startStyle.bottom,_.bottom=o.endStyle.bottom);l.startStyle=u,l.endStyle=_}}_getVisibleRangesWithStyle(e,t,i){const s=(t.linesVisibleRangesForRange(e,!0)||[]).map(sf);return!this._visibleRangesHaveGaps(s)&&this._roundedSelection&&this._enrichVisibleRangesWithStyle(t.visibleRange,s,i),s}_createSelectionPiece(e,t,i,n,s){return'<div class="cslr '+i+'" style="top:'+e.toString()+"px;bottom:"+t.toString()+"px;left:"+n.toString()+"px;width:"+s.toString()+'px;"></div>'}_actualRenderOneSelection(e,t,i,n){if(n.length===0)return;const s=!!n[0].ranges[0].startStyle,o=n[0].lineNumber,r=n[n.length-1].lineNumber;for(let a=0,l=n.length;a<l;a++){const h=n[a],c=h.lineNumber,u=c-t,_=i&&c===o?1:0,f=i&&c!==o&&c===r?1:0;let w="",C="";for(let v=0,g=h.ranges.length;v<g;v++){const p=h.ranges[v];if(s){const b=p.startStyle,L=p.endStyle;if(b.top===1||b.bottom===1){w+=this._createSelectionPiece(_,f,J.SELECTION_CLASS_NAME,p.left-J.ROUNDED_PIECE_WIDTH,J.ROUNDED_PIECE_WIDTH);let y=J.EDITOR_BACKGROUND_CLASS_NAME;b.top===1&&(y+=" "+J.SELECTION_TOP_RIGHT),b.bottom===1&&(y+=" "+J.SELECTION_BOTTOM_RIGHT),w+=this._createSelectionPiece(_,f,y,p.left-J.ROUNDED_PIECE_WIDTH,J.ROUNDED_PIECE_WIDTH)}if(L.top===1||L.bottom===1){w+=this._createSelectionPiece(_,f,J.SELECTION_CLASS_NAME,p.left+p.width,J.ROUNDED_PIECE_WIDTH);let y=J.EDITOR_BACKGROUND_CLASS_NAME;L.top===1&&(y+=" "+J.SELECTION_TOP_LEFT),L.bottom===1&&(y+=" "+J.SELECTION_BOTTOM_LEFT),w+=this._createSelectionPiece(_,f,y,p.left+p.width,J.ROUNDED_PIECE_WIDTH)}}let m=J.SELECTION_CLASS_NAME;if(s){const b=p.startStyle,L=p.endStyle;b.top===0&&(m+=" "+J.SELECTION_TOP_LEFT),b.bottom===0&&(m+=" "+J.SELECTION_BOTTOM_LEFT),L.top===0&&(m+=" "+J.SELECTION_TOP_RIGHT),L.bottom===0&&(m+=" "+J.SELECTION_BOTTOM_RIGHT)}C+=this._createSelectionPiece(_,f,m,p.left,p.width)}e[u][0]+=w,e[u][1]+=C}}prepareRender(e){const t=[],i=e.visibleRange.startLineNumber,n=e.visibleRange.endLineNumber;for(let o=i;o<=n;o++){const r=o-i;t[r]=["",""]}const s=[];for(let o=0,r=this._selections.length;o<r;o++){const a=this._selections[o];if(a.isEmpty()){s[o]=null;continue}const l=this._getVisibleRangesWithStyle(a,e,this._previousFrameVisibleRangesWithStyle[o]);s[o]=l,this._actualRenderOneSelection(t,i,this._selections.length>1,l)}this._previousFrameVisibleRangesWithStyle=s,this._renderResult=t.map(([o,r])=>o+r)}render(e,t){if(!this._renderResult)return"";const i=t-e;return i<0||i>=this._renderResult.length?"":this._renderResult[i]}};J.SELECTION_CLASS_NAME="selected-text",J.SELECTION_TOP_LEFT="top-left-radius",J.SELECTION_BOTTOM_LEFT="bottom-left-radius",J.SELECTION_TOP_RIGHT="top-right-radius",J.SELECTION_BOTTOM_RIGHT="bottom-right-radius",J.EDITOR_BACKGROUND_CLASS_NAME="monaco-editor-background",J.ROUNDED_PIECE_WIDTH=10;let Xs=J;At((d,e)=>{const t=d.getColor(Zc);t&&!t.isTransparent()&&e.addRule(`.monaco-editor .view-line span.inline-selected-text { color: ${t}; }`)});function ln(d){return d<0?-d:d}class da{constructor(e,t,i,n,s,o,r){this.top=e,this.left=t,this.paddingLeft=i,this.width=n,this.height=s,this.textContent=o,this.textContentClassName=r}}var Je;(function(d){d[d.Single=0]="Single",d[d.MultiPrimary=1]="MultiPrimary",d[d.MultiSecondary=2]="MultiSecondary"})(Je||(Je={}));class la{constructor(e,t){this._context=e;const i=this._context.configuration.options,n=i.get(50);this._cursorStyle=i.get(28),this._lineHeight=i.get(67),this._typicalHalfwidthCharacterWidth=n.typicalHalfwidthCharacterWidth,this._lineCursorWidth=Math.min(i.get(31),this._typicalHalfwidthCharacterWidth),this._isVisible=!0,this._domNode=$(document.createElement("div")),this._domNode.setClassName(`cursor ${Xt}`),this._domNode.setHeight(this._lineHeight),this._domNode.setTop(0),this._domNode.setLeft(0),le(this._domNode,n),this._domNode.setDisplay("none"),this._position=new E(1,1),this._pluralityClass="",this.setPlurality(t),this._lastRenderedContent="",this._renderData=null}getDomNode(){return this._domNode}getPosition(){return this._position}setPlurality(e){switch(e){default:case Je.Single:this._pluralityClass="";break;case Je.MultiPrimary:this._pluralityClass="cursor-primary";break;case Je.MultiSecondary:this._pluralityClass="cursor-secondary";break}}show(){this._isVisible||(this._domNode.setVisibility("inherit"),this._isVisible=!0)}hide(){this._isVisible&&(this._domNode.setVisibility("hidden"),this._isVisible=!1)}onConfigurationChanged(e){const t=this._context.configuration.options,i=t.get(50);return this._cursorStyle=t.get(28),this._lineHeight=t.get(67),this._typicalHalfwidthCharacterWidth=i.typicalHalfwidthCharacterWidth,this._lineCursorWidth=Math.min(t.get(31),this._typicalHalfwidthCharacterWidth),le(this._domNode,i),!0}onCursorPositionChanged(e,t){return t?this._domNode.domNode.style.transitionProperty="none":this._domNode.domNode.style.transitionProperty="",this._position=e,!0}_getGraphemeAwarePosition(){const{lineNumber:e,column:t}=this._position,i=this._context.viewModel.getLineContent(e),[n,s]=Wl(i,t-1);return[new E(e,n+1),i.substring(n,s)]}_prepareRender(e){let t="",i="";const[n,s]=this._getGraphemeAwarePosition();if(this._cursorStyle===Te.Line||this._cursorStyle===Te.LineThin){const u=e.visibleRangeForPosition(n);if(!u||u.outsideRenderedLine)return null;const _=j(this._domNode.domNode);let f;this._cursorStyle===Te.Line?(f=gr(_,this._lineCursorWidth>0?this._lineCursorWidth:2),f>2&&(t=s,i=this._getTokenClassName(n))):f=gr(_,1);let w=u.left,C=0;f>=2&&w>=1&&(C=1,w-=C);const v=e.getVerticalOffsetForLineNumber(n.lineNumber)-e.bigNumbersDelta;return new da(v,w,C,f,this._lineHeight,t,i)}const o=e.linesVisibleRangesForRange(new W(n.lineNumber,n.column,n.lineNumber,n.column+s.length),!1);if(!o||o.length===0)return null;const r=o[0];if(r.outsideRenderedLine||r.ranges.length===0)return null;const a=r.ranges[0],l=s==="	"?this._typicalHalfwidthCharacterWidth:a.width<1?this._typicalHalfwidthCharacterWidth:a.width;this._cursorStyle===Te.Block&&(t=s,i=this._getTokenClassName(n));let h=e.getVerticalOffsetForLineNumber(n.lineNumber)-e.bigNumbersDelta,c=this._lineHeight;return(this._cursorStyle===Te.Underline||this._cursorStyle===Te.UnderlineThin)&&(h+=this._lineHeight-2,c=2),new da(h,a.left,0,l,c,t,i)}_getTokenClassName(e){const t=this._context.viewModel.getViewLineData(e.lineNumber),i=t.tokens.findTokenIndexAtOffset(e.column-1);return t.tokens.getClassName(i)}prepareRender(e){this._renderData=this._prepareRender(e)}render(e){return this._renderData?(this._lastRenderedContent!==this._renderData.textContent&&(this._lastRenderedContent=this._renderData.textContent,this._domNode.domNode.textContent=this._lastRenderedContent),this._domNode.setClassName(`cursor ${this._pluralityClass} ${Xt} ${this._renderData.textContentClassName}`),this._domNode.setDisplay("block"),this._domNode.setTop(this._renderData.top),this._domNode.setLeft(this._renderData.left),this._domNode.setPaddingLeft(this._renderData.paddingLeft),this._domNode.setWidth(this._renderData.width),this._domNode.setLineHeight(this._renderData.height),this._domNode.setHeight(this._renderData.height),{domNode:this._domNode.domNode,position:this._position,contentLeft:this._renderData.left,height:this._renderData.height,width:2}):(this._domNode.setDisplay("none"),null)}}const ki=class ki extends be{constructor(e){super(e);const t=this._context.configuration.options;this._readOnly=t.get(92),this._cursorBlinking=t.get(26),this._cursorStyle=t.get(28),this._cursorSmoothCaretAnimation=t.get(27),this._selectionIsEmpty=!0,this._isComposingInput=!1,this._isVisible=!1,this._primaryCursor=new la(this._context,Je.Single),this._secondaryCursors=[],this._renderData=[],this._domNode=$(document.createElement("div")),this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true"),this._updateDomClassName(),this._domNode.appendChild(this._primaryCursor.getDomNode()),this._startCursorBlinkAnimation=new Ba,this._cursorFlatBlinkInterval=new ka,this._blinkingEnabled=!1,this._editorHasFocus=!1,this._updateBlinking()}dispose(){super.dispose(),this._startCursorBlinkAnimation.dispose(),this._cursorFlatBlinkInterval.dispose()}getDomNode(){return this._domNode}onCompositionStart(e){return this._isComposingInput=!0,this._updateBlinking(),!0}onCompositionEnd(e){return this._isComposingInput=!1,this._updateBlinking(),!0}onConfigurationChanged(e){const t=this._context.configuration.options;this._readOnly=t.get(92),this._cursorBlinking=t.get(26),this._cursorStyle=t.get(28),this._cursorSmoothCaretAnimation=t.get(27),this._updateBlinking(),this._updateDomClassName(),this._primaryCursor.onConfigurationChanged(e);for(let i=0,n=this._secondaryCursors.length;i<n;i++)this._secondaryCursors[i].onConfigurationChanged(e);return!0}_onCursorPositionChanged(e,t,i){const n=this._secondaryCursors.length!==t.length||this._cursorSmoothCaretAnimation==="explicit"&&i!==3;if(this._primaryCursor.setPlurality(t.length?Je.MultiPrimary:Je.Single),this._primaryCursor.onCursorPositionChanged(e,n),this._updateBlinking(),this._secondaryCursors.length<t.length){const s=t.length-this._secondaryCursors.length;for(let o=0;o<s;o++){const r=new la(this._context,Je.MultiSecondary);this._domNode.domNode.insertBefore(r.getDomNode().domNode,this._primaryCursor.getDomNode().domNode.nextSibling),this._secondaryCursors.push(r)}}else if(this._secondaryCursors.length>t.length){const s=this._secondaryCursors.length-t.length;for(let o=0;o<s;o++)this._domNode.removeChild(this._secondaryCursors[0].getDomNode()),this._secondaryCursors.splice(0,1)}for(let s=0;s<t.length;s++)this._secondaryCursors[s].onCursorPositionChanged(t[s],n)}onCursorStateChanged(e){const t=[];for(let n=0,s=e.selections.length;n<s;n++)t[n]=e.selections[n].getPosition();this._onCursorPositionChanged(t[0],t.slice(1),e.reason);const i=e.selections[0].isEmpty();return this._selectionIsEmpty!==i&&(this._selectionIsEmpty=i,this._updateDomClassName()),!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onFocusChanged(e){return this._editorHasFocus=e.isFocused,this._updateBlinking(),!1}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return!0}onTokensChanged(e){const t=i=>{for(let n=0,s=e.ranges.length;n<s;n++)if(e.ranges[n].fromLineNumber<=i.lineNumber&&i.lineNumber<=e.ranges[n].toLineNumber)return!0;return!1};if(t(this._primaryCursor.getPosition()))return!0;for(const i of this._secondaryCursors)if(t(i.getPosition()))return!0;return!1}onZonesChanged(e){return!0}_getCursorBlinking(){return this._isComposingInput||!this._editorHasFocus?0:this._readOnly?5:this._cursorBlinking}_updateBlinking(){this._startCursorBlinkAnimation.cancel(),this._cursorFlatBlinkInterval.cancel();const e=this._getCursorBlinking(),t=e===0,i=e===5;t?this._hide():this._show(),this._blinkingEnabled=!1,this._updateDomClassName(),!t&&!i&&(e===1?this._cursorFlatBlinkInterval.cancelAndSet(()=>{this._isVisible?this._hide():this._show()},ki.BLINK_INTERVAL,j(this._domNode.domNode)):this._startCursorBlinkAnimation.setIfNotSet(()=>{this._blinkingEnabled=!0,this._updateDomClassName()},ki.BLINK_INTERVAL))}_updateDomClassName(){this._domNode.setClassName(this._getClassName())}_getClassName(){let e="cursors-layer";switch(this._selectionIsEmpty||(e+=" has-selection"),this._cursorStyle){case Te.Line:e+=" cursor-line-style";break;case Te.Block:e+=" cursor-block-style";break;case Te.Underline:e+=" cursor-underline-style";break;case Te.LineThin:e+=" cursor-line-thin-style";break;case Te.BlockOutline:e+=" cursor-block-outline-style";break;case Te.UnderlineThin:e+=" cursor-underline-thin-style";break;default:e+=" cursor-line-style"}if(this._blinkingEnabled)switch(this._getCursorBlinking()){case 1:e+=" cursor-blink";break;case 2:e+=" cursor-smooth";break;case 3:e+=" cursor-phase";break;case 4:e+=" cursor-expand";break;case 5:e+=" cursor-solid";break;default:e+=" cursor-solid"}else e+=" cursor-solid";return(this._cursorSmoothCaretAnimation==="on"||this._cursorSmoothCaretAnimation==="explicit")&&(e+=" cursor-smooth-caret-animation"),e}_show(){this._primaryCursor.show();for(let e=0,t=this._secondaryCursors.length;e<t;e++)this._secondaryCursors[e].show();this._isVisible=!0}_hide(){this._primaryCursor.hide();for(let e=0,t=this._secondaryCursors.length;e<t;e++)this._secondaryCursors[e].hide();this._isVisible=!1}prepareRender(e){this._primaryCursor.prepareRender(e);for(let t=0,i=this._secondaryCursors.length;t<i;t++)this._secondaryCursors[t].prepareRender(e)}render(e){const t=[];let i=0;const n=this._primaryCursor.render(e);n&&(t[i++]=n);for(let s=0,o=this._secondaryCursors.length;s<o;s++){const r=this._secondaryCursors[s].render(e);r&&(t[i++]=r)}this._renderData=t}getLastRenderData(){return this._renderData}};ki.BLINK_INTERVAL=500;let Js=ki;At((d,e)=>{const t=[{class:".cursor",foreground:hd,background:fc},{class:".cursor-primary",foreground:cd,background:mc},{class:".cursor-secondary",foreground:ud,background:_c}];for(const i of t){const n=d.getColor(i.foreground);if(n){let s=d.getColor(i.background);s||(s=n.opposite()),e.addRule(`.monaco-editor .cursors-layer ${i.class} { background-color: ${n}; border-color: ${n}; color: ${s}; }`),Pi(d.type)&&e.addRule(`.monaco-editor .cursors-layer.has-selection ${i.class} { border-left: 1px solid ${s}; border-right: 1px solid ${s}; }`)}}});const bs=()=>{throw new Error("Invalid change accessor")};class of extends be{constructor(e){super(e);const t=this._context.configuration.options,i=t.get(146);this._lineHeight=t.get(67),this._contentWidth=i.contentWidth,this._contentLeft=i.contentLeft,this.domNode=$(document.createElement("div")),this.domNode.setClassName("view-zones"),this.domNode.setPosition("absolute"),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this.marginDomNode=$(document.createElement("div")),this.marginDomNode.setClassName("margin-view-zones"),this.marginDomNode.setPosition("absolute"),this.marginDomNode.setAttribute("role","presentation"),this.marginDomNode.setAttribute("aria-hidden","true"),this._zones={}}dispose(){super.dispose(),this._zones={}}_recomputeWhitespacesProps(){const e=this._context.viewLayout.getWhitespaces(),t=new Map;for(const n of e)t.set(n.id,n);let i=!1;return this._context.viewModel.changeWhitespace(n=>{const s=Object.keys(this._zones);for(let o=0,r=s.length;o<r;o++){const a=s[o],l=this._zones[a],h=this._computeWhitespaceProps(l.delegate);l.isInHiddenArea=h.isInHiddenArea;const c=t.get(a);c&&(c.afterLineNumber!==h.afterViewLineNumber||c.height!==h.heightInPx)&&(n.changeOneWhitespace(a,h.afterViewLineNumber,h.heightInPx),this._safeCallOnComputedHeight(l.delegate,h.heightInPx),i=!0)}}),i}onConfigurationChanged(e){const t=this._context.configuration.options,i=t.get(146);return this._lineHeight=t.get(67),this._contentWidth=i.contentWidth,this._contentLeft=i.contentLeft,e.hasChanged(67)&&this._recomputeWhitespacesProps(),!0}onLineMappingChanged(e){return this._recomputeWhitespacesProps()}onLinesDeleted(e){return!0}onScrollChanged(e){return e.scrollTopChanged||e.scrollWidthChanged}onZonesChanged(e){return!0}onLinesInserted(e){return!0}_getZoneOrdinal(e){return e.ordinal??e.afterColumn??1e4}_computeWhitespaceProps(e){if(e.afterLineNumber===0)return{isInHiddenArea:!1,afterViewLineNumber:0,heightInPx:this._heightInPixels(e),minWidthInPx:this._minWidthInPixels(e)};let t;if(typeof e.afterColumn<"u")t=this._context.viewModel.model.validatePosition({lineNumber:e.afterLineNumber,column:e.afterColumn});else{const o=this._context.viewModel.model.validatePosition({lineNumber:e.afterLineNumber,column:1}).lineNumber;t=new E(o,this._context.viewModel.model.getLineMaxColumn(o))}let i;t.column===this._context.viewModel.model.getLineMaxColumn(t.lineNumber)?i=this._context.viewModel.model.validatePosition({lineNumber:t.lineNumber+1,column:1}):i=this._context.viewModel.model.validatePosition({lineNumber:t.lineNumber,column:t.column+1});const n=this._context.viewModel.coordinatesConverter.convertModelPositionToViewPosition(t,e.afterColumnAffinity,!0),s=e.showInHiddenAreas||this._context.viewModel.coordinatesConverter.modelPositionIsVisible(i);return{isInHiddenArea:!s,afterViewLineNumber:n.lineNumber,heightInPx:s?this._heightInPixels(e):0,minWidthInPx:this._minWidthInPixels(e)}}changeViewZones(e){let t=!1;return this._context.viewModel.changeWhitespace(i=>{const n={addZone:s=>(t=!0,this._addZone(i,s)),removeZone:s=>{s&&(t=this._removeZone(i,s)||t)},layoutZone:s=>{s&&(t=this._layoutZone(i,s)||t)}};rf(e,n),n.addZone=bs,n.removeZone=bs,n.layoutZone=bs}),t}_addZone(e,t){const i=this._computeWhitespaceProps(t),s={whitespaceId:e.insertWhitespace(i.afterViewLineNumber,this._getZoneOrdinal(t),i.heightInPx,i.minWidthInPx),delegate:t,isInHiddenArea:i.isInHiddenArea,isVisible:!1,domNode:$(t.domNode),marginDomNode:t.marginDomNode?$(t.marginDomNode):null};return this._safeCallOnComputedHeight(s.delegate,i.heightInPx),s.domNode.setPosition("absolute"),s.domNode.domNode.style.width="100%",s.domNode.setDisplay("none"),s.domNode.setAttribute("monaco-view-zone",s.whitespaceId),this.domNode.appendChild(s.domNode),s.marginDomNode&&(s.marginDomNode.setPosition("absolute"),s.marginDomNode.domNode.style.width="100%",s.marginDomNode.setDisplay("none"),s.marginDomNode.setAttribute("monaco-view-zone",s.whitespaceId),this.marginDomNode.appendChild(s.marginDomNode)),this._zones[s.whitespaceId]=s,this.setShouldRender(),s.whitespaceId}_removeZone(e,t){if(this._zones.hasOwnProperty(t)){const i=this._zones[t];return delete this._zones[t],e.removeWhitespace(i.whitespaceId),i.domNode.removeAttribute("monaco-visible-view-zone"),i.domNode.removeAttribute("monaco-view-zone"),i.domNode.domNode.remove(),i.marginDomNode&&(i.marginDomNode.removeAttribute("monaco-visible-view-zone"),i.marginDomNode.removeAttribute("monaco-view-zone"),i.marginDomNode.domNode.remove()),this.setShouldRender(),!0}return!1}_layoutZone(e,t){if(this._zones.hasOwnProperty(t)){const i=this._zones[t],n=this._computeWhitespaceProps(i.delegate);return i.isInHiddenArea=n.isInHiddenArea,e.changeOneWhitespace(i.whitespaceId,n.afterViewLineNumber,n.heightInPx),this._safeCallOnComputedHeight(i.delegate,n.heightInPx),this.setShouldRender(),!0}return!1}shouldSuppressMouseDownOnViewZone(e){return this._zones.hasOwnProperty(e)?!!this._zones[e].delegate.suppressMouseDown:!1}_heightInPixels(e){return typeof e.heightInPx=="number"?e.heightInPx:typeof e.heightInLines=="number"?this._lineHeight*e.heightInLines:this._lineHeight}_minWidthInPixels(e){return typeof e.minWidthInPx=="number"?e.minWidthInPx:0}_safeCallOnComputedHeight(e,t){if(typeof e.onComputedHeight=="function")try{e.onComputedHeight(t)}catch(i){Oe(i)}}_safeCallOnDomNodeTop(e,t){if(typeof e.onDomNodeTop=="function")try{e.onDomNodeTop(t)}catch(i){Oe(i)}}prepareRender(e){}render(e){const t=e.viewportData.whitespaceViewportData,i={};let n=!1;for(const o of t)this._zones[o.id].isInHiddenArea||(i[o.id]=o,n=!0);const s=Object.keys(this._zones);for(let o=0,r=s.length;o<r;o++){const a=s[o],l=this._zones[a];let h=0,c=0,u="none";i.hasOwnProperty(a)?(h=i[a].verticalOffset-e.bigNumbersDelta,c=i[a].height,u="block",l.isVisible||(l.domNode.setAttribute("monaco-visible-view-zone","true"),l.isVisible=!0),this._safeCallOnDomNodeTop(l.delegate,e.getScrolledTopFromAbsoluteTop(i[a].verticalOffset))):(l.isVisible&&(l.domNode.removeAttribute("monaco-visible-view-zone"),l.isVisible=!1),this._safeCallOnDomNodeTop(l.delegate,e.getScrolledTopFromAbsoluteTop(-1e6))),l.domNode.setTop(h),l.domNode.setHeight(c),l.domNode.setDisplay(u),l.marginDomNode&&(l.marginDomNode.setTop(h),l.marginDomNode.setHeight(c),l.marginDomNode.setDisplay(u))}n&&(this.domNode.setWidth(Math.max(e.scrollWidth,this._contentWidth)),this.marginDomNode.setWidth(this._contentLeft))}}function rf(d,e){try{return d(e)}catch(t){Oe(t)}}class af extends Pt{constructor(e){super(),this._context=e,this._options=new ha(this._context.configuration),this._selection=[],this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){const t=new ha(this._context.configuration);return this._options.equals(t)?e.hasChanged(146):(this._options=t,!0)}onCursorStateChanged(e){return this._selection=e.selections,this._options.renderWhitespace==="selection"}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}prepareRender(e){if(this._options.renderWhitespace==="none"){this._renderResult=null;return}const t=e.visibleRange.startLineNumber,n=e.visibleRange.endLineNumber-t+1,s=new Array(n);for(let r=0;r<n;r++)s[r]=!0;const o=this._context.viewModel.getMinimapLinesRenderingData(e.viewportData.startLineNumber,e.viewportData.endLineNumber,s);this._renderResult=[];for(let r=e.viewportData.startLineNumber;r<=e.viewportData.endLineNumber;r++){const a=r-e.viewportData.startLineNumber,l=o.data[a];let h=null;if(this._options.renderWhitespace==="selection"){const c=this._selection;for(const u of c){if(u.endLineNumber<r||u.startLineNumber>r)continue;const _=u.startLineNumber===r?u.startColumn:l.minColumn,f=u.endLineNumber===r?u.endColumn:l.maxColumn;_<f&&(h||(h=[]),h.push(new rd(_-1,f-1)))}}this._renderResult[a]=this._applyRenderWhitespace(e,r,h,l)}}_applyRenderWhitespace(e,t,i,n){if(this._options.renderWhitespace==="selection"&&!i||this._options.renderWhitespace==="trailing"&&n.continuesWithWrappedLine)return"";const s=this._context.theme.getColor(pc),o=this._options.renderWithSVG,r=n.content,a=this._options.stopRenderingLineAfter===-1?r.length:Math.min(this._options.stopRenderingLineAfter,r.length),l=n.continuesWithWrappedLine,h=n.minColumn-1,c=this._options.renderWhitespace==="boundary",u=this._options.renderWhitespace==="trailing",_=this._options.lineHeight,f=this._options.middotWidth,w=this._options.wsmiddotWidth,C=this._options.spaceWidth,v=Math.abs(w-C),g=Math.abs(f-C),p=v<g?11825:183,m=this._options.canUseHalfwidthRightwardsArrow;let b="",L=!1,y=Ya(r),S;y===-1?(L=!0,y=a,S=a):S=Hl(r);let D=0,x=i&&i[D],M=0;for(let R=h;R<a;R++){const I=r.charCodeAt(R);if(x&&R>=x.endOffset&&(D++,x=i&&i[D]),I!==9&&I!==32||u&&!L&&R<=S)continue;if(c&&R>=y&&R<=S&&I===32){const k=R-1>=0?r.charCodeAt(R-1):0,K=R+1<a?r.charCodeAt(R+1):0;if(k!==32&&K!==32)continue}if(c&&l&&R===a-1){const k=R-1>=0?r.charCodeAt(R-1):0;if(I===32&&k!==32&&k!==9)continue}if(i&&(!x||x.startOffset>R||x.endOffset<=R))continue;const F=e.visibleRangeForPosition(new E(t,R+1));F&&(o?(M=Math.max(M,F.left),I===9?b+=this._renderArrow(_,C,F.left):b+=`<circle cx="${(F.left+C/2).toFixed(2)}" cy="${(_/2).toFixed(2)}" r="${(C/7).toFixed(2)}" />`):I===9?b+=`<div class="mwh" style="left:${F.left}px;height:${_}px;">${m?"￫":"→"}</div>`:b+=`<div class="mwh" style="left:${F.left}px;height:${_}px;">${String.fromCharCode(p)}</div>`)}return o?(M=Math.round(M+C),`<svg style="bottom:0;position:absolute;width:${M}px;height:${_}px" viewBox="0 0 ${M} ${_}" xmlns="http://www.w3.org/2000/svg" fill="${s}">`+b+"</svg>"):b}_renderArrow(e,t,i){const n=t/7,s=t,o=e/2,r=i,a={x:0,y:n/2},l={x:100/125*s,y:a.y},h={x:l.x-.2*l.x,y:l.y+.2*l.x},c={x:h.x+.1*l.x,y:h.y+.1*l.x},u={x:c.x+.35*l.x,y:c.y-.35*l.x},_={x:u.x,y:-u.y},f={x:c.x,y:-c.y},w={x:h.x,y:-h.y},C={x:l.x,y:-l.y},v={x:a.x,y:-a.y};return`<path d="M ${[a,l,h,c,u,_,f,w,C,v].map(m=>`${(r+m.x).toFixed(2)} ${(o+m.y).toFixed(2)}`).join(" L ")}" />`}render(e,t){if(!this._renderResult)return"";const i=t-e;return i<0||i>=this._renderResult.length?"":this._renderResult[i]}}class ha{constructor(e){const t=e.options,i=t.get(50),n=t.get(38);n==="off"?(this.renderWhitespace="none",this.renderWithSVG=!1):n==="svg"?(this.renderWhitespace=t.get(100),this.renderWithSVG=!0):(this.renderWhitespace=t.get(100),this.renderWithSVG=!1),this.spaceWidth=i.spaceWidth,this.middotWidth=i.middotWidth,this.wsmiddotWidth=i.wsmiddotWidth,this.canUseHalfwidthRightwardsArrow=i.canUseHalfwidthRightwardsArrow,this.lineHeight=t.get(67),this.stopRenderingLineAfter=t.get(118)}equals(e){return this.renderWhitespace===e.renderWhitespace&&this.renderWithSVG===e.renderWithSVG&&this.spaceWidth===e.spaceWidth&&this.middotWidth===e.middotWidth&&this.wsmiddotWidth===e.wsmiddotWidth&&this.canUseHalfwidthRightwardsArrow===e.canUseHalfwidthRightwardsArrow&&this.lineHeight===e.lineHeight&&this.stopRenderingLineAfter===e.stopRenderingLineAfter}}var df=function(d,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(d,e,t,i);else for(var r=d.length-1;r>=0;r--)(o=d[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},lf=function(d,e){return function(t,i){e(t,i,d)}};let eo=class extends Xi{constructor(e,t,i,n,s,o,r){super(),this._instantiationService=r,this._shouldRecomputeGlyphMarginLanes=!1,this._selections=[new Me(1,1,1,1)],this._renderAnimationFrame=null;const a=new wg(t,n,s,e);this._context=new vc(t,i,n),this._context.addEventHandler(this),this._viewParts=[],this._textAreaHandler=this._instantiationService.createInstance(Zs,this._context,a,this._createTextAreaHandlerHelper()),this._viewParts.push(this._textAreaHandler),this._linesContent=$(document.createElement("div")),this._linesContent.setClassName("lines-content monaco-editor-background"),this._linesContent.setPosition("absolute"),this.domNode=$(document.createElement("div")),this.domNode.setClassName(this._getEditorClassName()),this.domNode.setAttribute("role","code"),this._overflowGuardContainer=$(document.createElement("div")),Ve.write(this._overflowGuardContainer,3),this._overflowGuardContainer.setClassName("overflow-guard"),this._scrollbar=new Eg(this._context,this._linesContent,this.domNode,this._overflowGuardContainer),this._viewParts.push(this._scrollbar),this._viewLines=new Qs(this._context,this._linesContent),this._viewZones=new of(this._context),this._viewParts.push(this._viewZones);const l=new Yg(this._context);this._viewParts.push(l);const h=new Jg(this._context);this._viewParts.push(h);const c=new Lg(this._context);this._viewParts.push(c),c.addDynamicOverlay(new Mg(this._context)),c.addDynamicOverlay(new Xs(this._context)),c.addDynamicOverlay(new Hg(this._context)),c.addDynamicOverlay(new xg(this._context)),c.addDynamicOverlay(new af(this._context));const u=new yg(this._context);this._viewParts.push(u),u.addDynamicOverlay(new Rg(this._context)),u.addDynamicOverlay(new Ug(this._context)),u.addDynamicOverlay(new Bg(this._context)),u.addDynamicOverlay(new Mn(this._context)),this._glyphMarginWidgets=new Og(this._context),this._viewParts.push(this._glyphMarginWidgets);const _=new Rn(this._context);_.getDomNode().appendChild(this._viewZones.marginDomNode),_.getDomNode().appendChild(u.getDomNode()),_.getDomNode().appendChild(this._glyphMarginWidgets.domNode),this._viewParts.push(_),this._contentWidgets=new Dg(this._context,this.domNode),this._viewParts.push(this._contentWidgets),this._viewCursors=new Js(this._context),this._viewParts.push(this._viewCursors),this._overlayWidgets=new Kg(this._context,this.domNode),this._viewParts.push(this._overlayWidgets);const f=new Xg(this._context);this._viewParts.push(f);const w=new Sg(this._context);this._viewParts.push(w);const C=new Zg(this._context);if(this._viewParts.push(C),l){const v=this._scrollbar.getOverviewRulerLayoutInfo();v.parent.insertBefore(l.getDomNode(),v.insertBefore)}this._linesContent.appendChild(c.getDomNode()),this._linesContent.appendChild(f.domNode),this._linesContent.appendChild(this._viewZones.domNode),this._linesContent.appendChild(this._viewLines.getDomNode()),this._linesContent.appendChild(this._contentWidgets.domNode),this._linesContent.appendChild(this._viewCursors.getDomNode()),this._overflowGuardContainer.appendChild(_.getDomNode()),this._overflowGuardContainer.appendChild(this._scrollbar.getDomNode()),this._overflowGuardContainer.appendChild(h.getDomNode()),this._overflowGuardContainer.appendChild(this._textAreaHandler.textArea),this._overflowGuardContainer.appendChild(this._textAreaHandler.textAreaCover),this._overflowGuardContainer.appendChild(this._overlayWidgets.getDomNode()),this._overflowGuardContainer.appendChild(C.getDomNode()),this._overflowGuardContainer.appendChild(w.domNode),this.domNode.appendChild(this._overflowGuardContainer),o?(o.appendChild(this._contentWidgets.overflowingContentWidgetsDomNode.domNode),o.appendChild(this._overlayWidgets.overflowingOverlayWidgetsDomNode.domNode)):(this.domNode.appendChild(this._contentWidgets.overflowingContentWidgetsDomNode),this.domNode.appendChild(this._overlayWidgets.overflowingOverlayWidgetsDomNode)),this._applyLayout(),this._pointerHandler=this._register(new mg(this._context,a,this._createPointerHandlerHelper()))}_computeGlyphMarginLanes(){const e=this._context.viewModel.model,t=this._context.viewModel.glyphLanes;let i=[],n=0;i=i.concat(e.getAllMarginDecorations().map(s=>{var r,a;const o=((r=s.options.glyphMargin)==null?void 0:r.position)??Po.Center;return n=Math.max(n,s.range.endLineNumber),{range:s.range,lane:o,persist:(a=s.options.glyphMargin)==null?void 0:a.persistLane}})),i=i.concat(this._glyphMarginWidgets.getWidgets().map(s=>{const o=e.validateRange(s.preference.range);return n=Math.max(n,o.endLineNumber),{range:o,lane:s.preference.lane}})),i.sort((s,o)=>W.compareRangesUsingStarts(s.range,o.range)),t.reset(n);for(const s of i)t.push(s.lane,s.range,s.persist);return t}_createPointerHandlerHelper(){return{viewDomNode:this.domNode.domNode,linesContentDomNode:this._linesContent.domNode,viewLinesDomNode:this._viewLines.getDomNode().domNode,focusTextArea:()=>{this.focus()},dispatchTextAreaEvent:e=>{this._textAreaHandler.textArea.domNode.dispatchEvent(e)},getLastRenderData:()=>{const e=this._viewCursors.getLastRenderData()||[],t=this._textAreaHandler.getLastRenderData();return new ig(e,t)},renderNow:()=>{this.render(!0,!1)},shouldSuppressMouseDownOnViewZone:e=>this._viewZones.shouldSuppressMouseDownOnViewZone(e),shouldSuppressMouseDownOnWidget:e=>this._contentWidgets.shouldSuppressMouseDownOnWidget(e),getPositionFromDOMInfo:(e,t)=>(this._flushAccumulatedAndRenderNow(),this._viewLines.getPositionFromDOMInfo(e,t)),visibleRangeForPosition:(e,t)=>(this._flushAccumulatedAndRenderNow(),this._viewLines.visibleRangeForPosition(new E(e,t))),getLineWidth:e=>(this._flushAccumulatedAndRenderNow(),this._viewLines.getLineWidth(e))}}_createTextAreaHandlerHelper(){return{visibleRangeForPosition:e=>(this._flushAccumulatedAndRenderNow(),this._viewLines.visibleRangeForPosition(e))}}_applyLayout(){const t=this._context.configuration.options.get(146);this.domNode.setWidth(t.width),this.domNode.setHeight(t.height),this._overflowGuardContainer.setWidth(t.width),this._overflowGuardContainer.setHeight(t.height),this._linesContent.setWidth(16777216),this._linesContent.setHeight(16777216)}_getEditorClassName(){const e=this._textAreaHandler.isFocused()?" focused":"";return this._context.configuration.options.get(143)+" "+As(this._context.theme.type)+e}handleEvents(e){super.handleEvents(e),this._scheduleRender()}onConfigurationChanged(e){return this.domNode.setClassName(this._getEditorClassName()),this._applyLayout(),!1}onCursorStateChanged(e){return this._selections=e.selections,!1}onDecorationsChanged(e){return e.affectsGlyphMargin&&(this._shouldRecomputeGlyphMarginLanes=!0),!1}onFocusChanged(e){return this.domNode.setClassName(this._getEditorClassName()),!1}onThemeChanged(e){return this._context.theme.update(e.theme),this.domNode.setClassName(this._getEditorClassName()),!1}dispose(){this._renderAnimationFrame!==null&&(this._renderAnimationFrame.dispose(),this._renderAnimationFrame=null),this._contentWidgets.overflowingContentWidgetsDomNode.domNode.remove(),this._context.removeEventHandler(this),this._viewLines.dispose();for(const e of this._viewParts)e.dispose();super.dispose()}_scheduleRender(){var e;if(this._store.isDisposed)throw new at;if(this._renderAnimationFrame===null){const t=this._createCoordinatedRendering();this._renderAnimationFrame=to.INSTANCE.scheduleCoordinatedRendering({window:j((e=this.domNode)==null?void 0:e.domNode),prepareRenderText:()=>{if(this._store.isDisposed)throw new at;try{return t.prepareRenderText()}finally{this._renderAnimationFrame=null}},renderText:()=>{if(this._store.isDisposed)throw new at;return t.renderText()},prepareRender:(i,n)=>{if(this._store.isDisposed)throw new at;return t.prepareRender(i,n)},render:(i,n)=>{if(this._store.isDisposed)throw new at;return t.render(i,n)}})}}_flushAccumulatedAndRenderNow(){const e=this._createCoordinatedRendering();lt(()=>e.prepareRenderText());const t=lt(()=>e.renderText());if(t){const[i,n]=t;lt(()=>e.prepareRender(i,n)),lt(()=>e.render(i,n))}}_getViewPartsToRender(){const e=[];let t=0;for(const i of this._viewParts)i.shouldRender()&&(e[t++]=i);return e}_createCoordinatedRendering(){return{prepareRenderText:()=>{if(this._shouldRecomputeGlyphMarginLanes){this._shouldRecomputeGlyphMarginLanes=!1;const e=this._computeGlyphMarginLanes();this._context.configuration.setGlyphMarginDecorationLaneCount(e.requiredLanes)}$t.onRenderStart()},renderText:()=>{if(!this.domNode.domNode.isConnected)return null;let e=this._getViewPartsToRender();if(!this._viewLines.shouldRender()&&e.length===0)return null;const t=this._context.viewLayout.getLinesViewportData();this._context.viewModel.setViewport(t.startLineNumber,t.endLineNumber,t.centeredLineNumber);const i=new Cc(this._selections,t,this._context.viewLayout.getWhitespaceViewportData(),this._context.viewModel);return this._contentWidgets.shouldRender()&&this._contentWidgets.onBeforeRender(i),this._viewLines.shouldRender()&&(this._viewLines.renderText(i),this._viewLines.onDidRender(),e=this._getViewPartsToRender()),[e,new qu(this._context.viewLayout,i,this._viewLines)]},prepareRender:(e,t)=>{for(const i of e)i.prepareRender(t)},render:(e,t)=>{for(const i of e)i.render(t),i.onDidRender()}}}delegateVerticalScrollbarPointerDown(e){this._scrollbar.delegateVerticalScrollbarPointerDown(e)}delegateScrollFromMouseWheelEvent(e){this._scrollbar.delegateScrollFromMouseWheelEvent(e)}restoreState(e){this._context.viewModel.viewLayout.setScrollPosition({scrollTop:e.scrollTop,scrollLeft:e.scrollLeft},1),this._context.viewModel.visibleLinesStabilized()}getOffsetForColumn(e,t){const i=this._context.viewModel.model.validatePosition({lineNumber:e,column:t}),n=this._context.viewModel.coordinatesConverter.convertModelPositionToViewPosition(i);this._flushAccumulatedAndRenderNow();const s=this._viewLines.visibleRangeForPosition(new E(n.lineNumber,n.column));return s?s.left:-1}getTargetAtClientPoint(e,t){const i=this._pointerHandler.getTargetAtClientPoint(e,t);return i?ms.convertViewToModelMouseTarget(i,this._context.viewModel.coordinatesConverter):null}createOverviewRuler(e){return new Qg(this._context,e)}change(e){this._viewZones.changeViewZones(e),this._scheduleRender()}render(e,t){if(t){this._viewLines.forceShouldRender();for(const i of this._viewParts)i.forceShouldRender()}e?this._flushAccumulatedAndRenderNow():this._scheduleRender()}writeScreenReaderContent(e){this._textAreaHandler.writeScreenReaderContent(e)}focus(){this._textAreaHandler.focusTextArea()}isFocused(){return this._textAreaHandler.isFocused()}setAriaOptions(e){this._textAreaHandler.setAriaOptions(e)}addContentWidget(e){this._contentWidgets.addWidget(e.widget),this.layoutContentWidget(e),this._scheduleRender()}layoutContentWidget(e){var t,i,n,s;this._contentWidgets.setWidgetPosition(e.widget,((t=e.position)==null?void 0:t.position)??null,((i=e.position)==null?void 0:i.secondaryPosition)??null,((n=e.position)==null?void 0:n.preference)??null,((s=e.position)==null?void 0:s.positionAffinity)??null),this._scheduleRender()}removeContentWidget(e){this._contentWidgets.removeWidget(e.widget),this._scheduleRender()}addOverlayWidget(e){this._overlayWidgets.addWidget(e.widget),this.layoutOverlayWidget(e),this._scheduleRender()}layoutOverlayWidget(e){this._overlayWidgets.setWidgetPosition(e.widget,e.position)&&this._scheduleRender()}removeOverlayWidget(e){this._overlayWidgets.removeWidget(e.widget),this._scheduleRender()}addGlyphMarginWidget(e){this._glyphMarginWidgets.addWidget(e.widget),this._shouldRecomputeGlyphMarginLanes=!0,this._scheduleRender()}layoutGlyphMarginWidget(e){const t=e.position;this._glyphMarginWidgets.setWidgetPosition(e.widget,t)&&(this._shouldRecomputeGlyphMarginLanes=!0,this._scheduleRender())}removeGlyphMarginWidget(e){this._glyphMarginWidgets.removeWidget(e.widget),this._shouldRecomputeGlyphMarginLanes=!0,this._scheduleRender()}};eo=df([lf(6,ve)],eo);function lt(d){try{return d()}catch(e){return Oe(e),null}}const jn=class jn{constructor(){this._coordinatedRenderings=[],this._animationFrameRunners=new Map}scheduleCoordinatedRendering(e){return this._coordinatedRenderings.push(e),this._scheduleRender(e.window),{dispose:()=>{const t=this._coordinatedRenderings.indexOf(e);if(t!==-1&&(this._coordinatedRenderings.splice(t,1),this._coordinatedRenderings.length===0)){for(const[i,n]of this._animationFrameRunners)n.dispose();this._animationFrameRunners.clear()}}}}_scheduleRender(e){if(!this._animationFrameRunners.has(e)){const t=()=>{this._animationFrameRunners.delete(e),this._onRenderScheduled()};this._animationFrameRunners.set(e,kl(e,t,100))}}_onRenderScheduled(){const e=this._coordinatedRenderings.slice(0);this._coordinatedRenderings=[];for(const i of e)lt(()=>i.prepareRenderText());const t=[];for(let i=0,n=e.length;i<n;i++){const s=e[i];t[i]=lt(()=>s.renderText())}for(let i=0,n=e.length;i<n;i++){const s=e[i],o=t[i];if(!o)continue;const[r,a]=o;lt(()=>s.prepareRender(r,a))}for(let i=0,n=e.length;i<n;i++){const s=e[i],o=t[i];if(!o)continue;const[r,a]=o;lt(()=>s.render(r,a))}}};jn.INSTANCE=new jn;let to=jn;const Ls=Yi("domLineBreaksComputer",{createHTML:d=>d});class Zo{static create(e){return new Zo(new WeakRef(e))}constructor(e){this.targetWindow=e}createLineBreaksComputer(e,t,i,n,s){const o=[],r=[];return{addRequest:(a,l,h)=>{o.push(a),r.push(l)},finalize:()=>hf(Qa(this.targetWindow.deref()),o,e,t,i,n,s,r)}}}function hf(d,e,t,i,n,s,o,r){function a(D){const x=r[D];if(x){const M=Nr.applyInjectedText(e[D],x),R=x.map(F=>F.options),I=x.map(F=>F.column-1);return new Mr(I,R,[M.length],[],0)}else return null}if(n===-1){const D=[];for(let x=0,M=e.length;x<M;x++)D[x]=a(x);return D}const l=Math.round(n*t.typicalHalfwidthCharacterWidth),c=Math.round(i*(s===3?2:s===2?1:0)),u=Math.ceil(t.spaceWidth*c),_=document.createElement("div");le(_,t);const f=new Ao(1e4),w=[],C=[],v=[],g=[],p=[];for(let D=0;D<e.length;D++){const x=Nr.applyInjectedText(e[D],r[D]);let M=0,R=0,I=l;if(s!==0)if(M=Ya(x),M===-1)M=0;else{for(let se=0;se<M;se++){const ie=x.charCodeAt(se)===9?i-R%i:1;R+=ie}const K=Math.ceil(t.spaceWidth*R);K+t.typicalFullwidthCharacterWidth>l?(M=0,R=0):I=l-K}const F=x.substr(M),k=cf(F,R,i,I,f,u);w[D]=M,C[D]=R,v[D]=F,g[D]=k[0],p[D]=k[1]}const m=f.build(),b=(Ls==null?void 0:Ls.createHTML(m))??m;_.innerHTML=b,_.style.position="absolute",_.style.top="10000",o==="keepAll"?(_.style.wordBreak="keep-all",_.style.overflowWrap="anywhere"):(_.style.wordBreak="inherit",_.style.overflowWrap="break-word"),d.document.body.appendChild(_);const L=document.createRange(),y=Array.prototype.slice.call(_.children,0),S=[];for(let D=0;D<e.length;D++){const x=y[D],M=uf(L,x,v[D],g[D]);if(M===null){S[D]=a(D);continue}const R=w[D],I=C[D]+c,F=p[D],k=[];for(let q=0,Se=M.length;q<Se;q++)k[q]=F[M[q]];if(R!==0)for(let q=0,Se=M.length;q<Se;q++)M[q]+=R;let K,se;const ie=r[D];ie?(K=ie.map(q=>q.options),se=ie.map(q=>q.column-1)):(K=null,se=null),S[D]=new Mr(se,K,M,k,I)}return _.remove(),S}function cf(d,e,t,i,n,s){if(s!==0){const u=String(s);n.appendString('<div style="text-indent: -'),n.appendString(u),n.appendString("px; padding-left: "),n.appendString(u),n.appendString("px; box-sizing: border-box; width:")}else n.appendString('<div style="width:');n.appendString(String(i)),n.appendString('px;">');const o=d.length;let r=e,a=0;const l=[],h=[];let c=0<o?d.charCodeAt(0):0;n.appendString("<span>");for(let u=0;u<o;u++){u!==0&&u%16384===0&&n.appendString("</span><span>"),l[u]=a,h[u]=r;const _=c;c=u+1<o?d.charCodeAt(u+1):0;let f=1,w=1;switch(_){case 9:f=t-r%t,w=f;for(let C=1;C<=f;C++)C<f?n.appendCharCode(160):n.appendASCIICharCode(32);break;case 32:c===32?n.appendCharCode(160):n.appendASCIICharCode(32);break;case 60:n.appendString("&lt;");break;case 62:n.appendString("&gt;");break;case 38:n.appendString("&amp;");break;case 0:n.appendString("&#00;");break;case 65279:case 8232:case 8233:case 133:n.appendCharCode(65533);break;default:Es(_)&&w++,_<32?n.appendCharCode(9216+_):n.appendCharCode(_)}a+=f,r+=w}return n.appendString("</span>"),l[d.length]=a,h[d.length]=r,n.appendString("</div>"),[l,h]}function uf(d,e,t,i){if(t.length<=1)return null;const n=Array.prototype.slice.call(e.children,0),s=[];try{io(d,n,i,0,null,t.length-1,null,s)}catch(o){return console.log(o),null}return s.length===0?null:(s.push(t.length),s)}function io(d,e,t,i,n,s,o,r){if(i===s||(n=n||ys(d,e,t[i],t[i+1]),o=o||ys(d,e,t[s],t[s+1]),Math.abs(n[0].top-o[0].top)<=.1))return;if(i+1===s){r.push(s);return}const a=i+(s-i)/2|0,l=ys(d,e,t[a],t[a+1]);io(d,e,t,i,n,a,l,r),io(d,e,t,a,l,s,o,r)}function ys(d,e,t,i){return d.setStart(e[t/16384|0].firstChild,t%16384),d.setEnd(e[i/16384|0].firstChild,i%16384),d.getClientRects()}class gf extends V{constructor(){super(),this._editor=null,this._instantiationService=null,this._instances=this._register(new Vl),this._pending=new Map,this._finishedInstantiation=[],this._finishedInstantiation[0]=!1,this._finishedInstantiation[1]=!1,this._finishedInstantiation[2]=!1,this._finishedInstantiation[3]=!1}initialize(e,t,i){this._editor=e,this._instantiationService=i;for(const n of t){if(this._pending.has(n.id)){Oe(new Error(`Cannot have two contributions with the same id ${n.id}`));continue}this._pending.set(n.id,n)}this._instantiateSome(0),this._register(sn(j(this._editor.getDomNode()),()=>{this._instantiateSome(1)})),this._register(sn(j(this._editor.getDomNode()),()=>{this._instantiateSome(2)})),this._register(sn(j(this._editor.getDomNode()),()=>{this._instantiateSome(3)},5e3))}saveViewState(){const e={};for(const[t,i]of this._instances)typeof i.saveViewState=="function"&&(e[t]=i.saveViewState());return e}restoreViewState(e){for(const[t,i]of this._instances)typeof i.restoreViewState=="function"&&i.restoreViewState(e[t])}get(e){return this._instantiateById(e),this._instances.get(e)||null}onBeforeInteractionEvent(){this._instantiateSome(2)}onAfterModelAttached(){var e;return sn(j((e=this._editor)==null?void 0:e.getDomNode()),()=>{this._instantiateSome(1)},50)}_instantiateSome(e){if(this._finishedInstantiation[e])return;this._finishedInstantiation[e]=!0;const t=this._findPendingContributionsByInstantiation(e);for(const i of t)this._instantiateById(i.id)}_findPendingContributionsByInstantiation(e){const t=[];for(const[,i]of this._pending)i.instantiation===e&&t.push(i);return t}_instantiateById(e){const t=this._pending.get(e);if(t){if(this._pending.delete(e),!this._instantiationService||!this._editor)throw new Error("Cannot instantiate contributions before being initialized!");try{const i=this._instantiationService.createInstance(t.ctor,this._editor);this._instances.set(t.id,i),typeof i.restoreViewState=="function"&&t.instantiation!==0&&console.warn(`Editor contribution '${t.id}' should be eager instantiated because it uses saveViewState / restoreViewState.`)}catch(i){Oe(i)}}}}var ff=function(d,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(d,e,t,i);else for(var r=d.length-1;r>=0;r--)(o=d[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},qe=function(d,e){return function(t,i){e(t,i,d)}},mt,Nt;let En=(Nt=class extends V{get isSimpleWidget(){return this._configuration.isSimpleWidget}get contextMenuId(){return this._configuration.contextMenuId}constructor(e,t,i,n,s,o,r,a,l,h,c,u){super(),this.languageConfigurationService=c,this._deliveryQueue=Fl(),this._contributions=this._register(new gf),this._onDidDispose=this._register(new H),this.onDidDispose=this._onDidDispose.event,this._onDidChangeModelContent=this._register(new H({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelContent=this._onDidChangeModelContent.event,this._onDidChangeModelLanguage=this._register(new H({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelLanguage=this._onDidChangeModelLanguage.event,this._onDidChangeModelLanguageConfiguration=this._register(new H({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelLanguageConfiguration=this._onDidChangeModelLanguageConfiguration.event,this._onDidChangeModelOptions=this._register(new H({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelOptions=this._onDidChangeModelOptions.event,this._onDidChangeModelDecorations=this._register(new H({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelDecorations=this._onDidChangeModelDecorations.event,this._onDidChangeModelTokens=this._register(new H({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelTokens=this._onDidChangeModelTokens.event,this._onDidChangeConfiguration=this._register(new H({deliveryQueue:this._deliveryQueue})),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this._onWillChangeModel=this._register(new H({deliveryQueue:this._deliveryQueue})),this.onWillChangeModel=this._onWillChangeModel.event,this._onDidChangeModel=this._register(new H({deliveryQueue:this._deliveryQueue})),this.onDidChangeModel=this._onDidChangeModel.event,this._onDidChangeCursorPosition=this._register(new H({deliveryQueue:this._deliveryQueue})),this.onDidChangeCursorPosition=this._onDidChangeCursorPosition.event,this._onDidChangeCursorSelection=this._register(new H({deliveryQueue:this._deliveryQueue})),this.onDidChangeCursorSelection=this._onDidChangeCursorSelection.event,this._onDidAttemptReadOnlyEdit=this._register(new ue(this._contributions,this._deliveryQueue)),this.onDidAttemptReadOnlyEdit=this._onDidAttemptReadOnlyEdit.event,this._onDidLayoutChange=this._register(new H({deliveryQueue:this._deliveryQueue})),this.onDidLayoutChange=this._onDidLayoutChange.event,this._editorTextFocus=this._register(new ca({deliveryQueue:this._deliveryQueue})),this.onDidFocusEditorText=this._editorTextFocus.onDidChangeToTrue,this.onDidBlurEditorText=this._editorTextFocus.onDidChangeToFalse,this._editorWidgetFocus=this._register(new ca({deliveryQueue:this._deliveryQueue})),this.onDidFocusEditorWidget=this._editorWidgetFocus.onDidChangeToTrue,this.onDidBlurEditorWidget=this._editorWidgetFocus.onDidChangeToFalse,this._onWillType=this._register(new ue(this._contributions,this._deliveryQueue)),this.onWillType=this._onWillType.event,this._onDidType=this._register(new ue(this._contributions,this._deliveryQueue)),this.onDidType=this._onDidType.event,this._onDidCompositionStart=this._register(new ue(this._contributions,this._deliveryQueue)),this.onDidCompositionStart=this._onDidCompositionStart.event,this._onDidCompositionEnd=this._register(new ue(this._contributions,this._deliveryQueue)),this.onDidCompositionEnd=this._onDidCompositionEnd.event,this._onDidPaste=this._register(new ue(this._contributions,this._deliveryQueue)),this.onDidPaste=this._onDidPaste.event,this._onMouseUp=this._register(new ue(this._contributions,this._deliveryQueue)),this.onMouseUp=this._onMouseUp.event,this._onMouseDown=this._register(new ue(this._contributions,this._deliveryQueue)),this.onMouseDown=this._onMouseDown.event,this._onMouseDrag=this._register(new ue(this._contributions,this._deliveryQueue)),this.onMouseDrag=this._onMouseDrag.event,this._onMouseDrop=this._register(new ue(this._contributions,this._deliveryQueue)),this.onMouseDrop=this._onMouseDrop.event,this._onMouseDropCanceled=this._register(new ue(this._contributions,this._deliveryQueue)),this.onMouseDropCanceled=this._onMouseDropCanceled.event,this._onDropIntoEditor=this._register(new ue(this._contributions,this._deliveryQueue)),this.onDropIntoEditor=this._onDropIntoEditor.event,this._onContextMenu=this._register(new ue(this._contributions,this._deliveryQueue)),this.onContextMenu=this._onContextMenu.event,this._onMouseMove=this._register(new ue(this._contributions,this._deliveryQueue)),this.onMouseMove=this._onMouseMove.event,this._onMouseLeave=this._register(new ue(this._contributions,this._deliveryQueue)),this.onMouseLeave=this._onMouseLeave.event,this._onMouseWheel=this._register(new ue(this._contributions,this._deliveryQueue)),this.onMouseWheel=this._onMouseWheel.event,this._onKeyUp=this._register(new ue(this._contributions,this._deliveryQueue)),this.onKeyUp=this._onKeyUp.event,this._onKeyDown=this._register(new ue(this._contributions,this._deliveryQueue)),this.onKeyDown=this._onKeyDown.event,this._onDidContentSizeChange=this._register(new H({deliveryQueue:this._deliveryQueue})),this.onDidContentSizeChange=this._onDidContentSizeChange.event,this._onDidScrollChange=this._register(new H({deliveryQueue:this._deliveryQueue})),this.onDidScrollChange=this._onDidScrollChange.event,this._onDidChangeViewZones=this._register(new H({deliveryQueue:this._deliveryQueue})),this.onDidChangeViewZones=this._onDidChangeViewZones.event,this._onDidChangeHiddenAreas=this._register(new H({deliveryQueue:this._deliveryQueue})),this.onDidChangeHiddenAreas=this._onDidChangeHiddenAreas.event,this._updateCounter=0,this._onBeginUpdate=this._register(new H),this.onBeginUpdate=this._onBeginUpdate.event,this._onEndUpdate=this._register(new H),this.onEndUpdate=this._onEndUpdate.event,this._actions=new Map,this._bannerDomNode=null,this._dropIntoEditorDecorations=this.createDecorationsCollection(),s.willCreateCodeEditor();const _={...t};this._domElement=e,this._overflowWidgetsDomNode=_.overflowWidgetsDomNode,delete _.overflowWidgetsDomNode,this._id=++mf,this._decorationTypeKeysToIds={},this._decorationTypeSubtypes={},this._telemetryData=i.telemetryData,this._configuration=this._register(this._createConfiguration(i.isSimpleWidget||!1,i.contextMenuId??(i.isSimpleWidget?de.SimpleEditorContext:de.EditorContext),_,h)),this._register(this._configuration.onDidChange(C=>{this._onDidChangeConfiguration.fire(C);const v=this._configuration.options;if(C.hasChanged(146)){const g=v.get(146);this._onDidLayoutChange.fire(g)}})),this._contextKeyService=this._register(r.createScoped(this._domElement)),this._notificationService=l,this._codeEditorService=s,this._commandService=o,this._themeService=a,this._register(new pf(this,this._contextKeyService)),this._register(new vf(this,this._contextKeyService,u)),this._instantiationService=this._register(n.createChild(new hs([Re,this._contextKeyService]))),this._modelData=null,this._focusTracker=new Cf(e,this._overflowWidgetsDomNode),this._register(this._focusTracker.onChange(()=>{this._editorWidgetFocus.setValue(this._focusTracker.hasFocus())})),this._contentWidgets={},this._overlayWidgets={},this._glyphMarginWidgets={};let f;Array.isArray(i.contributions)?f=i.contributions:f=ii.getEditorContributions(),this._contributions.initialize(this,f,this._instantiationService);for(const C of ii.getEditorActions()){if(this._actions.has(C.id)){Oe(new Error(`Cannot have two actions with the same id ${C.id}`));continue}const v=new wc(C.id,C.label,C.alias,C.metadata,C.precondition??void 0,g=>this._instantiationService.invokeFunction(p=>Promise.resolve(C.runEditorCommand(p,this,g))),this._contextKeyService);this._actions.set(v.id,v)}const w=()=>!this._configuration.options.get(92)&&this._configuration.options.get(36).enabled;this._register(new Bl(this._domElement,{onDragOver:C=>{if(!w())return;const v=this.getTargetAtClientPoint(C.clientX,C.clientY);v!=null&&v.position&&this.showDropIndicatorAt(v.position)},onDrop:async C=>{if(!w()||(this.removeDropIndicator(),!C.dataTransfer))return;const v=this.getTargetAtClientPoint(C.clientX,C.clientY);v!=null&&v.position&&this._onDropIntoEditor.fire({position:v.position,event:C})},onDragLeave:()=>{this.removeDropIndicator()},onDragEnd:()=>{this.removeDropIndicator()}})),this._codeEditorService.addCodeEditor(this)}writeScreenReaderContent(e){var t;(t=this._modelData)==null||t.view.writeScreenReaderContent(e)}_createConfiguration(e,t,i,n){return new zs(e,t,i,this._domElement,n)}getId(){return this.getEditorType()+":"+this._id}getEditorType(){return ns.ICodeEditor}dispose(){this._codeEditorService.removeCodeEditor(this),this._focusTracker.dispose(),this._actions.clear(),this._contentWidgets={},this._overlayWidgets={},this._removeDecorationTypes(),this._postDetachModelCleanup(this._detachModel()),this._onDidDispose.fire(),super.dispose()}invokeWithinContext(e){return this._instantiationService.invokeFunction(e)}updateOptions(e){this._configuration.updateOptions(e||{})}getOptions(){return this._configuration.options}getOption(e){return this._configuration.options.get(e)}getRawOptions(){return this._configuration.getRawOptions()}getOverflowWidgetsDomNode(){return this._overflowWidgetsDomNode}getConfiguredWordAtPosition(e){return this._modelData?bc.getWordAtPosition(this._modelData.model,this._configuration.options.get(132),this._configuration.options.get(131),e):null}getValue(e=null){if(!this._modelData)return"";const t=!!(e&&e.preserveBOM);let i=0;return e&&e.lineEnding&&e.lineEnding===`
`?i=1:e&&e.lineEnding&&e.lineEnding===`\r
`&&(i=2),this._modelData.model.getValue(i,t)}setValue(e){try{if(this._beginUpdate(),!this._modelData)return;this._modelData.model.setValue(e)}finally{this._endUpdate()}}getModel(){return this._modelData?this._modelData.model:null}setModel(e=null){var t;try{this._beginUpdate();const i=e;if(this._modelData===null&&i===null||this._modelData&&this._modelData.model===i)return;const n={oldModelUrl:((t=this._modelData)==null?void 0:t.model.uri)||null,newModelUrl:(i==null?void 0:i.uri)||null};this._onWillChangeModel.fire(n);const s=this.hasTextFocus(),o=this._detachModel();this._attachModel(i),s&&this.hasModel()&&this.focus(),this._removeDecorationTypes(),this._onDidChangeModel.fire(n),this._postDetachModelCleanup(o),this._contributionsDisposable=this._contributions.onAfterModelAttached()}finally{this._endUpdate()}}_removeDecorationTypes(){if(this._decorationTypeKeysToIds={},this._decorationTypeSubtypes){for(const e in this._decorationTypeSubtypes){const t=this._decorationTypeSubtypes[e];for(const i in t)this._removeDecorationType(e+"-"+i)}this._decorationTypeSubtypes={}}}getVisibleRanges(){return this._modelData?this._modelData.viewModel.getVisibleRanges():[]}getVisibleRangesPlusViewportAboveBelow(){return this._modelData?this._modelData.viewModel.getVisibleRangesPlusViewportAboveBelow():[]}getWhitespaces(){return this._modelData?this._modelData.viewModel.viewLayout.getWhitespaces():[]}static _getVerticalOffsetAfterPosition(e,t,i,n){const s=e.model.validatePosition({lineNumber:t,column:i}),o=e.viewModel.coordinatesConverter.convertModelPositionToViewPosition(s);return e.viewModel.viewLayout.getVerticalOffsetAfterLineNumber(o.lineNumber,n)}getTopForLineNumber(e,t=!1){return this._modelData?mt._getVerticalOffsetForPosition(this._modelData,e,1,t):-1}getTopForPosition(e,t){return this._modelData?mt._getVerticalOffsetForPosition(this._modelData,e,t,!1):-1}static _getVerticalOffsetForPosition(e,t,i,n=!1){const s=e.model.validatePosition({lineNumber:t,column:i}),o=e.viewModel.coordinatesConverter.convertModelPositionToViewPosition(s);return e.viewModel.viewLayout.getVerticalOffsetForLineNumber(o.lineNumber,n)}getBottomForLineNumber(e,t=!1){if(!this._modelData)return-1;const i=this._modelData.model.getLineMaxColumn(e);return mt._getVerticalOffsetAfterPosition(this._modelData,e,i,t)}setHiddenAreas(e,t){var i;(i=this._modelData)==null||i.viewModel.setHiddenAreas(e.map(n=>W.lift(n)),t)}getVisibleColumnFromPosition(e){if(!this._modelData)return e.column;const t=this._modelData.model.validatePosition(e),i=this._modelData.model.getOptions().tabSize;return dd.visibleColumnFromColumn(this._modelData.model.getLineContent(t.lineNumber),t.column,i)+1}getPosition(){return this._modelData?this._modelData.viewModel.getPosition():null}setPosition(e,t="api"){if(this._modelData){if(!E.isIPosition(e))throw new Error("Invalid arguments");this._modelData.viewModel.setSelections(t,[{selectionStartLineNumber:e.lineNumber,selectionStartColumn:e.column,positionLineNumber:e.lineNumber,positionColumn:e.column}])}}_sendRevealRange(e,t,i,n){if(!this._modelData)return;if(!W.isIRange(e))throw new Error("Invalid arguments");const s=this._modelData.model.validateRange(e),o=this._modelData.viewModel.coordinatesConverter.convertModelRangeToViewRange(s);this._modelData.viewModel.revealRange("api",i,o,t,n)}revealLine(e,t=0){this._revealLine(e,0,t)}revealLineInCenter(e,t=0){this._revealLine(e,1,t)}revealLineInCenterIfOutsideViewport(e,t=0){this._revealLine(e,2,t)}revealLineNearTop(e,t=0){this._revealLine(e,5,t)}_revealLine(e,t,i){if(typeof e!="number")throw new Error("Invalid arguments");this._sendRevealRange(new W(e,1,e,1),t,!1,i)}revealPosition(e,t=0){this._revealPosition(e,0,!0,t)}revealPositionInCenter(e,t=0){this._revealPosition(e,1,!0,t)}revealPositionInCenterIfOutsideViewport(e,t=0){this._revealPosition(e,2,!0,t)}revealPositionNearTop(e,t=0){this._revealPosition(e,5,!0,t)}_revealPosition(e,t,i,n){if(!E.isIPosition(e))throw new Error("Invalid arguments");this._sendRevealRange(new W(e.lineNumber,e.column,e.lineNumber,e.column),t,i,n)}getSelection(){return this._modelData?this._modelData.viewModel.getSelection():null}getSelections(){return this._modelData?this._modelData.viewModel.getSelections():null}setSelection(e,t="api"){const i=Me.isISelection(e),n=W.isIRange(e);if(!i&&!n)throw new Error("Invalid arguments");if(i)this._setSelectionImpl(e,t);else if(n){const s={selectionStartLineNumber:e.startLineNumber,selectionStartColumn:e.startColumn,positionLineNumber:e.endLineNumber,positionColumn:e.endColumn};this._setSelectionImpl(s,t)}}_setSelectionImpl(e,t){if(!this._modelData)return;const i=new Me(e.selectionStartLineNumber,e.selectionStartColumn,e.positionLineNumber,e.positionColumn);this._modelData.viewModel.setSelections(t,[i])}revealLines(e,t,i=0){this._revealLines(e,t,0,i)}revealLinesInCenter(e,t,i=0){this._revealLines(e,t,1,i)}revealLinesInCenterIfOutsideViewport(e,t,i=0){this._revealLines(e,t,2,i)}revealLinesNearTop(e,t,i=0){this._revealLines(e,t,5,i)}_revealLines(e,t,i,n){if(typeof e!="number"||typeof t!="number")throw new Error("Invalid arguments");this._sendRevealRange(new W(e,1,t,1),i,!1,n)}revealRange(e,t=0,i=!1,n=!0){this._revealRange(e,i?1:0,n,t)}revealRangeInCenter(e,t=0){this._revealRange(e,1,!0,t)}revealRangeInCenterIfOutsideViewport(e,t=0){this._revealRange(e,2,!0,t)}revealRangeNearTop(e,t=0){this._revealRange(e,5,!0,t)}revealRangeNearTopIfOutsideViewport(e,t=0){this._revealRange(e,6,!0,t)}revealRangeAtTop(e,t=0){this._revealRange(e,3,!0,t)}_revealRange(e,t,i,n){if(!W.isIRange(e))throw new Error("Invalid arguments");this._sendRevealRange(W.lift(e),t,i,n)}setSelections(e,t="api",i=0){if(this._modelData){if(!e||e.length===0)throw new Error("Invalid arguments");for(let n=0,s=e.length;n<s;n++)if(!Me.isISelection(e[n]))throw new Error("Invalid arguments");this._modelData.viewModel.setSelections(t,e,i)}}getContentWidth(){return this._modelData?this._modelData.viewModel.viewLayout.getContentWidth():-1}getScrollWidth(){return this._modelData?this._modelData.viewModel.viewLayout.getScrollWidth():-1}getScrollLeft(){return this._modelData?this._modelData.viewModel.viewLayout.getCurrentScrollLeft():-1}getContentHeight(){return this._modelData?this._modelData.viewModel.viewLayout.getContentHeight():-1}getScrollHeight(){return this._modelData?this._modelData.viewModel.viewLayout.getScrollHeight():-1}getScrollTop(){return this._modelData?this._modelData.viewModel.viewLayout.getCurrentScrollTop():-1}setScrollLeft(e,t=1){if(this._modelData){if(typeof e!="number")throw new Error("Invalid arguments");this._modelData.viewModel.viewLayout.setScrollPosition({scrollLeft:e},t)}}setScrollTop(e,t=1){if(this._modelData){if(typeof e!="number")throw new Error("Invalid arguments");this._modelData.viewModel.viewLayout.setScrollPosition({scrollTop:e},t)}}setScrollPosition(e,t=1){this._modelData&&this._modelData.viewModel.viewLayout.setScrollPosition(e,t)}hasPendingScrollAnimation(){return this._modelData?this._modelData.viewModel.viewLayout.hasPendingScrollAnimation():!1}saveViewState(){if(!this._modelData)return null;const e=this._contributions.saveViewState(),t=this._modelData.viewModel.saveCursorState(),i=this._modelData.viewModel.saveState();return{cursorState:t,viewState:i,contributionsState:e}}restoreViewState(e){if(!this._modelData||!this._modelData.hasRealView)return;const t=e;if(t&&t.cursorState&&t.viewState){const i=t.cursorState;Array.isArray(i)?i.length>0&&this._modelData.viewModel.restoreCursorState(i):this._modelData.viewModel.restoreCursorState([i]),this._contributions.restoreViewState(t.contributionsState||{});const n=this._modelData.viewModel.reduceRestoreState(t.viewState);this._modelData.view.restoreState(n)}}handleInitialized(){var e;(e=this._getViewModel())==null||e.visibleLinesStabilized()}getContribution(e){return this._contributions.get(e)}getActions(){return Array.from(this._actions.values())}getSupportedActions(){let e=this.getActions();return e=e.filter(t=>t.isSupported()),e}getAction(e){return this._actions.get(e)||null}trigger(e,t,i){i=i||{};try{switch(this._beginUpdate(),t){case"compositionStart":this._startComposition();return;case"compositionEnd":this._endComposition(e);return;case"type":{const s=i;this._type(e,s.text||"");return}case"replacePreviousChar":{const s=i;this._compositionType(e,s.text||"",s.replaceCharCnt||0,0,0);return}case"compositionType":{const s=i;this._compositionType(e,s.text||"",s.replacePrevCharCnt||0,s.replaceNextCharCnt||0,s.positionDelta||0);return}case"paste":{const s=i;this._paste(e,s.text||"",s.pasteOnNewLine||!1,s.multicursorText||null,s.mode||null,s.clipboardEvent);return}case"cut":this._cut(e);return}const n=this.getAction(t);if(n){Promise.resolve(n.run(i)).then(void 0,Oe);return}if(!this._modelData||this._triggerEditorCommand(e,t,i))return;this._triggerCommand(t,i)}finally{this._endUpdate()}}_triggerCommand(e,t){this._commandService.executeCommand(e,t)}_startComposition(){this._modelData&&(this._modelData.viewModel.startComposition(),this._onDidCompositionStart.fire())}_endComposition(e){this._modelData&&(this._modelData.viewModel.endComposition(e),this._onDidCompositionEnd.fire())}_type(e,t){!this._modelData||t.length===0||(e==="keyboard"&&this._onWillType.fire(t),this._modelData.viewModel.type(t,e),e==="keyboard"&&this._onDidType.fire(t))}_compositionType(e,t,i,n,s){this._modelData&&this._modelData.viewModel.compositionType(t,i,n,s,e)}_paste(e,t,i,n,s,o){if(!this._modelData)return;const r=this._modelData.viewModel,a=r.getSelection().getStartPosition();r.paste(t,i,n,e);const l=r.getSelection().getStartPosition();e==="keyboard"&&this._onDidPaste.fire({clipboardEvent:o,range:new W(a.lineNumber,a.column,l.lineNumber,l.column),languageId:s})}_cut(e){this._modelData&&this._modelData.viewModel.cut(e)}_triggerEditorCommand(e,t,i){const n=ii.getEditorCommand(t);return n?(i=i||{},i.source=e,this._instantiationService.invokeFunction(s=>{Promise.resolve(n.runEditorCommand(s,this,i)).then(void 0,Oe)}),!0):!1}_getViewModel(){return this._modelData?this._modelData.viewModel:null}pushUndoStop(){return!this._modelData||this._configuration.options.get(92)?!1:(this._modelData.model.pushStackElement(),!0)}popUndoStop(){return!this._modelData||this._configuration.options.get(92)?!1:(this._modelData.model.popStackElement(),!0)}executeEdits(e,t,i){if(!this._modelData||this._configuration.options.get(92))return!1;let n;return i?Array.isArray(i)?n=()=>i:n=i:n=()=>null,this._modelData.viewModel.executeEdits(e,t,n),!0}executeCommand(e,t){this._modelData&&this._modelData.viewModel.executeCommand(t,e)}executeCommands(e,t){this._modelData&&this._modelData.viewModel.executeCommands(t,e)}createDecorationsCollection(e){return new wf(this,e)}changeDecorations(e){return this._modelData?this._modelData.model.changeDecorations(e,this._id):null}getLineDecorations(e){return this._modelData?this._modelData.model.getLineDecorations(e,this._id,Rr(this._configuration.options)):null}getDecorationsInRange(e){return this._modelData?this._modelData.model.getDecorationsInRange(e,this._id,Rr(this._configuration.options)):null}deltaDecorations(e,t){return this._modelData?e.length===0&&t.length===0?e:this._modelData.model.deltaDecorations(e,t,this._id):[]}removeDecorations(e){!this._modelData||e.length===0||this._modelData.model.changeDecorations(t=>{t.deltaDecorations(e,[])})}removeDecorationsByType(e){const t=this._decorationTypeKeysToIds[e];t&&this.changeDecorations(i=>i.deltaDecorations(t,[])),this._decorationTypeKeysToIds.hasOwnProperty(e)&&delete this._decorationTypeKeysToIds[e],this._decorationTypeSubtypes.hasOwnProperty(e)&&delete this._decorationTypeSubtypes[e]}getLayoutInfo(){return this._configuration.options.get(146)}createOverviewRuler(e){return!this._modelData||!this._modelData.hasRealView?null:this._modelData.view.createOverviewRuler(e)}getContainerDomNode(){return this._domElement}getDomNode(){return!this._modelData||!this._modelData.hasRealView?null:this._modelData.view.domNode.domNode}delegateVerticalScrollbarPointerDown(e){!this._modelData||!this._modelData.hasRealView||this._modelData.view.delegateVerticalScrollbarPointerDown(e)}delegateScrollFromMouseWheelEvent(e){!this._modelData||!this._modelData.hasRealView||this._modelData.view.delegateScrollFromMouseWheelEvent(e)}layout(e,t=!1){this._configuration.observeContainer(e),t||this.render()}focus(){!this._modelData||!this._modelData.hasRealView||this._modelData.view.focus()}hasTextFocus(){return!this._modelData||!this._modelData.hasRealView?!1:this._modelData.view.isFocused()}hasWidgetFocus(){return this._focusTracker&&this._focusTracker.hasFocus()}addContentWidget(e){const t={widget:e,position:e.getPosition()};this._contentWidgets.hasOwnProperty(e.getId())&&console.warn("Overwriting a content widget with the same id:"+e.getId()),this._contentWidgets[e.getId()]=t,this._modelData&&this._modelData.hasRealView&&this._modelData.view.addContentWidget(t)}layoutContentWidget(e){const t=e.getId();if(this._contentWidgets.hasOwnProperty(t)){const i=this._contentWidgets[t];i.position=e.getPosition(),this._modelData&&this._modelData.hasRealView&&this._modelData.view.layoutContentWidget(i)}}removeContentWidget(e){const t=e.getId();if(this._contentWidgets.hasOwnProperty(t)){const i=this._contentWidgets[t];delete this._contentWidgets[t],this._modelData&&this._modelData.hasRealView&&this._modelData.view.removeContentWidget(i)}}addOverlayWidget(e){const t={widget:e,position:e.getPosition()};this._overlayWidgets.hasOwnProperty(e.getId())&&console.warn("Overwriting an overlay widget with the same id."),this._overlayWidgets[e.getId()]=t,this._modelData&&this._modelData.hasRealView&&this._modelData.view.addOverlayWidget(t)}layoutOverlayWidget(e){const t=e.getId();if(this._overlayWidgets.hasOwnProperty(t)){const i=this._overlayWidgets[t];i.position=e.getPosition(),this._modelData&&this._modelData.hasRealView&&this._modelData.view.layoutOverlayWidget(i)}}removeOverlayWidget(e){const t=e.getId();if(this._overlayWidgets.hasOwnProperty(t)){const i=this._overlayWidgets[t];delete this._overlayWidgets[t],this._modelData&&this._modelData.hasRealView&&this._modelData.view.removeOverlayWidget(i)}}addGlyphMarginWidget(e){const t={widget:e,position:e.getPosition()};this._glyphMarginWidgets.hasOwnProperty(e.getId())&&console.warn("Overwriting a glyph margin widget with the same id."),this._glyphMarginWidgets[e.getId()]=t,this._modelData&&this._modelData.hasRealView&&this._modelData.view.addGlyphMarginWidget(t)}layoutGlyphMarginWidget(e){const t=e.getId();if(this._glyphMarginWidgets.hasOwnProperty(t)){const i=this._glyphMarginWidgets[t];i.position=e.getPosition(),this._modelData&&this._modelData.hasRealView&&this._modelData.view.layoutGlyphMarginWidget(i)}}removeGlyphMarginWidget(e){const t=e.getId();if(this._glyphMarginWidgets.hasOwnProperty(t)){const i=this._glyphMarginWidgets[t];delete this._glyphMarginWidgets[t],this._modelData&&this._modelData.hasRealView&&this._modelData.view.removeGlyphMarginWidget(i)}}changeViewZones(e){!this._modelData||!this._modelData.hasRealView||this._modelData.view.change(e)}getTargetAtClientPoint(e,t){return!this._modelData||!this._modelData.hasRealView?null:this._modelData.view.getTargetAtClientPoint(e,t)}getScrolledVisiblePosition(e){if(!this._modelData||!this._modelData.hasRealView)return null;const t=this._modelData.model.validatePosition(e),i=this._configuration.options,n=i.get(146),s=mt._getVerticalOffsetForPosition(this._modelData,t.lineNumber,t.column)-this.getScrollTop(),o=this._modelData.view.getOffsetForColumn(t.lineNumber,t.column)+n.glyphMarginWidth+n.lineNumbersWidth+n.decorationsWidth-this.getScrollLeft();return{top:s,left:o,height:i.get(67)}}getOffsetForColumn(e,t){return!this._modelData||!this._modelData.hasRealView?-1:this._modelData.view.getOffsetForColumn(e,t)}render(e=!1){!this._modelData||!this._modelData.hasRealView||this._modelData.viewModel.batchEvents(()=>{this._modelData.view.render(!0,e)})}setAriaOptions(e){!this._modelData||!this._modelData.hasRealView||this._modelData.view.setAriaOptions(e)}applyFontInfo(e){le(e,this._configuration.options.get(50))}setBanner(e,t){this._bannerDomNode&&this._domElement.contains(this._bannerDomNode)&&this._bannerDomNode.remove(),this._bannerDomNode=e,this._configuration.setReservedHeight(e?t:0),this._bannerDomNode&&this._domElement.prepend(this._bannerDomNode)}_attachModel(e){if(!e){this._modelData=null;return}const t=[];this._domElement.setAttribute("data-mode-id",e.getLanguageId()),this._configuration.setIsDominatedByLongLines(e.isDominatedByLongLines()),this._configuration.setModelLineCount(e.getLineCount());const i=e.onBeforeAttached(),n=new Lc(this._id,this._configuration,e,Zo.create(j(this._domElement)),yc.create(this._configuration.options),r=>Ui(j(this._domElement),r),this.languageConfigurationService,this._themeService,i,{batchChanges:r=>{try{return this._beginUpdate(),r()}finally{this._endUpdate()}}});t.push(e.onWillDispose(()=>this.setModel(null))),t.push(n.onEvent(r=>{switch(r.kind){case 0:this._onDidContentSizeChange.fire(r);break;case 1:this._editorTextFocus.setValue(r.hasFocus);break;case 2:this._onDidScrollChange.fire(r);break;case 3:this._onDidChangeViewZones.fire();break;case 4:this._onDidChangeHiddenAreas.fire();break;case 5:this._onDidAttemptReadOnlyEdit.fire();break;case 6:{if(r.reachedMaxCursorCount){const c=this.getOption(80),u=T("cursors.maximum","The number of cursors has been limited to {0}. Consider using [find and replace](https://code.visualstudio.com/docs/editor/codebasics#_find-and-replace) for larger changes or increase the editor multi cursor limit setting.",c);this._notificationService.prompt(Kc.Warning,u,[{label:"Find and Replace",run:()=>{this._commandService.executeCommand("editor.action.startFindReplaceAction")}},{label:T("goToSetting","Increase Multi Cursor Limit"),run:()=>{this._commandService.executeCommand("workbench.action.openSettings2",{query:"editor.multiCursorLimit"})}}])}const a=[];for(let c=0,u=r.selections.length;c<u;c++)a[c]=r.selections[c].getPosition();const l={position:a[0],secondaryPositions:a.slice(1),reason:r.reason,source:r.source};this._onDidChangeCursorPosition.fire(l);const h={selection:r.selections[0],secondarySelections:r.selections.slice(1),modelVersionId:r.modelVersionId,oldSelections:r.oldSelections,oldModelVersionId:r.oldModelVersionId,source:r.source,reason:r.reason};this._onDidChangeCursorSelection.fire(h);break}case 7:this._onDidChangeModelDecorations.fire(r.event);break;case 8:this._domElement.setAttribute("data-mode-id",e.getLanguageId()),this._onDidChangeModelLanguage.fire(r.event);break;case 9:this._onDidChangeModelLanguageConfiguration.fire(r.event);break;case 10:this._onDidChangeModelContent.fire(r.event);break;case 11:this._onDidChangeModelOptions.fire(r.event);break;case 12:this._onDidChangeModelTokens.fire(r.event);break}}));const[s,o]=this._createView(n);if(o){this._domElement.appendChild(s.domNode.domNode);let r=Object.keys(this._contentWidgets);for(let a=0,l=r.length;a<l;a++){const h=r[a];s.addContentWidget(this._contentWidgets[h])}r=Object.keys(this._overlayWidgets);for(let a=0,l=r.length;a<l;a++){const h=r[a];s.addOverlayWidget(this._overlayWidgets[h])}r=Object.keys(this._glyphMarginWidgets);for(let a=0,l=r.length;a<l;a++){const h=r[a];s.addGlyphMarginWidget(this._glyphMarginWidgets[h])}s.render(!1,!0),s.domNode.domNode.setAttribute("data-uri",e.uri.toString())}this._modelData=new _f(e,n,s,o,t,i)}_createView(e){let t;this.isSimpleWidget?t={paste:(s,o,r,a)=>{this._paste("keyboard",s,o,r,a)},type:s=>{this._type("keyboard",s)},compositionType:(s,o,r,a)=>{this._compositionType("keyboard",s,o,r,a)},startComposition:()=>{this._startComposition()},endComposition:()=>{this._endComposition("keyboard")},cut:()=>{this._cut("keyboard")}}:t={paste:(s,o,r,a)=>{const l={text:s,pasteOnNewLine:o,multicursorText:r,mode:a};this._commandService.executeCommand("paste",l)},type:s=>{const o={text:s};this._commandService.executeCommand("type",o)},compositionType:(s,o,r,a)=>{if(r||a){const l={text:s,replacePrevCharCnt:o,replaceNextCharCnt:r,positionDelta:a};this._commandService.executeCommand("compositionType",l)}else{const l={text:s,replaceCharCnt:o};this._commandService.executeCommand("replacePreviousChar",l)}},startComposition:()=>{this._commandService.executeCommand("compositionStart",{})},endComposition:()=>{this._commandService.executeCommand("compositionEnd",{})},cut:()=>{this._commandService.executeCommand("cut",{})}};const i=new ms(e.coordinatesConverter);return i.onKeyDown=s=>this._onKeyDown.fire(s),i.onKeyUp=s=>this._onKeyUp.fire(s),i.onContextMenu=s=>this._onContextMenu.fire(s),i.onMouseMove=s=>this._onMouseMove.fire(s),i.onMouseLeave=s=>this._onMouseLeave.fire(s),i.onMouseDown=s=>this._onMouseDown.fire(s),i.onMouseUp=s=>this._onMouseUp.fire(s),i.onMouseDrag=s=>this._onMouseDrag.fire(s),i.onMouseDrop=s=>this._onMouseDrop.fire(s),i.onMouseDropCanceled=s=>this._onMouseDropCanceled.fire(s),i.onMouseWheel=s=>this._onMouseWheel.fire(s),[new eo(t,this._configuration,this._themeService.getColorTheme(),e,i,this._overflowWidgetsDomNode,this._instantiationService),!0]}_postDetachModelCleanup(e){e==null||e.removeAllDecorationsWithOwnerId(this._id)}_detachModel(){var i;if((i=this._contributionsDisposable)==null||i.dispose(),this._contributionsDisposable=void 0,!this._modelData)return null;const e=this._modelData.model,t=this._modelData.hasRealView?this._modelData.view.domNode.domNode:null;return this._modelData.dispose(),this._modelData=null,this._domElement.removeAttribute("data-mode-id"),t&&this._domElement.contains(t)&&t.remove(),this._bannerDomNode&&this._domElement.contains(this._bannerDomNode)&&this._bannerDomNode.remove(),e}_removeDecorationType(e){this._codeEditorService.removeDecorationType(e)}hasModel(){return this._modelData!==null}showDropIndicatorAt(e){const t=[{range:new W(e.lineNumber,e.column,e.lineNumber,e.column),options:mt.dropIntoEditorDecorationOptions}];this._dropIntoEditorDecorations.set(t),this.revealPosition(e,1)}removeDropIndicator(){this._dropIntoEditorDecorations.clear()}setContextValue(e,t){this._contextKeyService.createKey(e,t)}_beginUpdate(){this._updateCounter++,this._updateCounter===1&&this._onBeginUpdate.fire()}_endUpdate(){this._updateCounter--,this._updateCounter===0&&this._onEndUpdate.fire()}},mt=Nt,Nt.dropIntoEditorDecorationOptions=Fe.register({description:"workbench-dnd-target",className:"dnd-target"}),Nt);En=mt=ff([qe(3,ve),qe(4,Ae),qe(5,ls),qe(6,Re),qe(7,rs),qe(8,vd),qe(9,Ot),qe(10,xo),qe(11,Eo)],En);let mf=0;class _f{constructor(e,t,i,n,s,o){this.model=e,this.viewModel=t,this.view=i,this.hasRealView=n,this.listenersToRemove=s,this.attachedView=o}dispose(){Ul(this.listenersToRemove),this.model.onBeforeDetached(this.attachedView),this.hasRealView&&this.view.dispose(),this.viewModel.dispose()}}class ca extends V{constructor(e){super(),this._emitterOptions=e,this._onDidChangeToTrue=this._register(new H(this._emitterOptions)),this.onDidChangeToTrue=this._onDidChangeToTrue.event,this._onDidChangeToFalse=this._register(new H(this._emitterOptions)),this.onDidChangeToFalse=this._onDidChangeToFalse.event,this._value=0}setValue(e){const t=e?2:1;this._value!==t&&(this._value=t,this._value===2?this._onDidChangeToTrue.fire():this._value===1&&this._onDidChangeToFalse.fire())}}class ue extends H{constructor(e,t){super({deliveryQueue:t}),this._contributions=e}fire(e){this._contributions.onBeforeInteractionEvent(),super.fire(e)}}class pf extends V{constructor(e,t){super(),this._editor=e,t.createKey("editorId",e.getId()),this._editorSimpleInput=N.editorSimpleInput.bindTo(t),this._editorFocus=N.focus.bindTo(t),this._textInputFocus=N.textInputFocus.bindTo(t),this._editorTextFocus=N.editorTextFocus.bindTo(t),this._tabMovesFocus=N.tabMovesFocus.bindTo(t),this._editorReadonly=N.readOnly.bindTo(t),this._inDiffEditor=N.inDiffEditor.bindTo(t),this._editorColumnSelection=N.columnSelection.bindTo(t),this._hasMultipleSelections=N.hasMultipleSelections.bindTo(t),this._hasNonEmptySelection=N.hasNonEmptySelection.bindTo(t),this._canUndo=N.canUndo.bindTo(t),this._canRedo=N.canRedo.bindTo(t),this._register(this._editor.onDidChangeConfiguration(()=>this._updateFromConfig())),this._register(this._editor.onDidChangeCursorSelection(()=>this._updateFromSelection())),this._register(this._editor.onDidFocusEditorWidget(()=>this._updateFromFocus())),this._register(this._editor.onDidBlurEditorWidget(()=>this._updateFromFocus())),this._register(this._editor.onDidFocusEditorText(()=>this._updateFromFocus())),this._register(this._editor.onDidBlurEditorText(()=>this._updateFromFocus())),this._register(this._editor.onDidChangeModel(()=>this._updateFromModel())),this._register(this._editor.onDidChangeConfiguration(()=>this._updateFromModel())),this._register(Sn.onDidChangeTabFocus(i=>this._tabMovesFocus.set(i))),this._updateFromConfig(),this._updateFromSelection(),this._updateFromFocus(),this._updateFromModel(),this._editorSimpleInput.set(this._editor.isSimpleWidget)}_updateFromConfig(){const e=this._editor.getOptions();this._tabMovesFocus.set(Sn.getTabFocusMode()),this._editorReadonly.set(e.get(92)),this._inDiffEditor.set(e.get(61)),this._editorColumnSelection.set(e.get(22))}_updateFromSelection(){const e=this._editor.getSelections();e?(this._hasMultipleSelections.set(e.length>1),this._hasNonEmptySelection.set(e.some(t=>!t.isEmpty()))):(this._hasMultipleSelections.reset(),this._hasNonEmptySelection.reset())}_updateFromFocus(){this._editorFocus.set(this._editor.hasWidgetFocus()&&!this._editor.isSimpleWidget),this._editorTextFocus.set(this._editor.hasTextFocus()&&!this._editor.isSimpleWidget),this._textInputFocus.set(this._editor.hasTextFocus())}_updateFromModel(){const e=this._editor.getModel();this._canUndo.set(!!(e&&e.canUndo())),this._canRedo.set(!!(e&&e.canRedo()))}}class vf extends V{constructor(e,t,i){super(),this._editor=e,this._contextKeyService=t,this._languageFeaturesService=i,this._langId=N.languageId.bindTo(t),this._hasCompletionItemProvider=N.hasCompletionItemProvider.bindTo(t),this._hasCodeActionsProvider=N.hasCodeActionsProvider.bindTo(t),this._hasCodeLensProvider=N.hasCodeLensProvider.bindTo(t),this._hasDefinitionProvider=N.hasDefinitionProvider.bindTo(t),this._hasDeclarationProvider=N.hasDeclarationProvider.bindTo(t),this._hasImplementationProvider=N.hasImplementationProvider.bindTo(t),this._hasTypeDefinitionProvider=N.hasTypeDefinitionProvider.bindTo(t),this._hasHoverProvider=N.hasHoverProvider.bindTo(t),this._hasDocumentHighlightProvider=N.hasDocumentHighlightProvider.bindTo(t),this._hasDocumentSymbolProvider=N.hasDocumentSymbolProvider.bindTo(t),this._hasReferenceProvider=N.hasReferenceProvider.bindTo(t),this._hasRenameProvider=N.hasRenameProvider.bindTo(t),this._hasSignatureHelpProvider=N.hasSignatureHelpProvider.bindTo(t),this._hasInlayHintsProvider=N.hasInlayHintsProvider.bindTo(t),this._hasDocumentFormattingProvider=N.hasDocumentFormattingProvider.bindTo(t),this._hasDocumentSelectionFormattingProvider=N.hasDocumentSelectionFormattingProvider.bindTo(t),this._hasMultipleDocumentFormattingProvider=N.hasMultipleDocumentFormattingProvider.bindTo(t),this._hasMultipleDocumentSelectionFormattingProvider=N.hasMultipleDocumentSelectionFormattingProvider.bindTo(t),this._isInEmbeddedEditor=N.isInEmbeddedEditor.bindTo(t);const n=()=>this._update();this._register(e.onDidChangeModel(n)),this._register(e.onDidChangeModelLanguage(n)),this._register(i.completionProvider.onDidChange(n)),this._register(i.codeActionProvider.onDidChange(n)),this._register(i.codeLensProvider.onDidChange(n)),this._register(i.definitionProvider.onDidChange(n)),this._register(i.declarationProvider.onDidChange(n)),this._register(i.implementationProvider.onDidChange(n)),this._register(i.typeDefinitionProvider.onDidChange(n)),this._register(i.hoverProvider.onDidChange(n)),this._register(i.documentHighlightProvider.onDidChange(n)),this._register(i.documentSymbolProvider.onDidChange(n)),this._register(i.referenceProvider.onDidChange(n)),this._register(i.renameProvider.onDidChange(n)),this._register(i.documentFormattingEditProvider.onDidChange(n)),this._register(i.documentRangeFormattingEditProvider.onDidChange(n)),this._register(i.signatureHelpProvider.onDidChange(n)),this._register(i.inlayHintsProvider.onDidChange(n)),n()}dispose(){super.dispose()}reset(){this._contextKeyService.bufferChangeEvents(()=>{this._langId.reset(),this._hasCompletionItemProvider.reset(),this._hasCodeActionsProvider.reset(),this._hasCodeLensProvider.reset(),this._hasDefinitionProvider.reset(),this._hasDeclarationProvider.reset(),this._hasImplementationProvider.reset(),this._hasTypeDefinitionProvider.reset(),this._hasHoverProvider.reset(),this._hasDocumentHighlightProvider.reset(),this._hasDocumentSymbolProvider.reset(),this._hasReferenceProvider.reset(),this._hasRenameProvider.reset(),this._hasDocumentFormattingProvider.reset(),this._hasDocumentSelectionFormattingProvider.reset(),this._hasSignatureHelpProvider.reset(),this._isInEmbeddedEditor.reset()})}_update(){const e=this._editor.getModel();if(!e){this.reset();return}this._contextKeyService.bufferChangeEvents(()=>{this._langId.set(e.getLanguageId()),this._hasCompletionItemProvider.set(this._languageFeaturesService.completionProvider.has(e)),this._hasCodeActionsProvider.set(this._languageFeaturesService.codeActionProvider.has(e)),this._hasCodeLensProvider.set(this._languageFeaturesService.codeLensProvider.has(e)),this._hasDefinitionProvider.set(this._languageFeaturesService.definitionProvider.has(e)),this._hasDeclarationProvider.set(this._languageFeaturesService.declarationProvider.has(e)),this._hasImplementationProvider.set(this._languageFeaturesService.implementationProvider.has(e)),this._hasTypeDefinitionProvider.set(this._languageFeaturesService.typeDefinitionProvider.has(e)),this._hasHoverProvider.set(this._languageFeaturesService.hoverProvider.has(e)),this._hasDocumentHighlightProvider.set(this._languageFeaturesService.documentHighlightProvider.has(e)),this._hasDocumentSymbolProvider.set(this._languageFeaturesService.documentSymbolProvider.has(e)),this._hasReferenceProvider.set(this._languageFeaturesService.referenceProvider.has(e)),this._hasRenameProvider.set(this._languageFeaturesService.renameProvider.has(e)),this._hasSignatureHelpProvider.set(this._languageFeaturesService.signatureHelpProvider.has(e)),this._hasInlayHintsProvider.set(this._languageFeaturesService.inlayHintsProvider.has(e)),this._hasDocumentFormattingProvider.set(this._languageFeaturesService.documentFormattingEditProvider.has(e)||this._languageFeaturesService.documentRangeFormattingEditProvider.has(e)),this._hasDocumentSelectionFormattingProvider.set(this._languageFeaturesService.documentRangeFormattingEditProvider.has(e)),this._hasMultipleDocumentFormattingProvider.set(this._languageFeaturesService.documentFormattingEditProvider.all(e).length+this._languageFeaturesService.documentRangeFormattingEditProvider.all(e).length>1),this._hasMultipleDocumentSelectionFormattingProvider.set(this._languageFeaturesService.documentRangeFormattingEditProvider.all(e).length>1),this._isInEmbeddedEditor.set(e.uri.scheme===Ge.walkThroughSnippet||e.uri.scheme===Ge.vscodeChatCodeBlock)})}}class Cf extends V{constructor(e,t){super(),this._onChange=this._register(new H),this.onChange=this._onChange.event,this._hadFocus=void 0,this._hasDomElementFocus=!1,this._domFocusTracker=this._register(fr(e)),this._overflowWidgetsDomNodeHasFocus=!1,this._register(this._domFocusTracker.onDidFocus(()=>{this._hasDomElementFocus=!0,this._update()})),this._register(this._domFocusTracker.onDidBlur(()=>{this._hasDomElementFocus=!1,this._update()})),t&&(this._overflowWidgetsDomNode=this._register(fr(t)),this._register(this._overflowWidgetsDomNode.onDidFocus(()=>{this._overflowWidgetsDomNodeHasFocus=!0,this._update()})),this._register(this._overflowWidgetsDomNode.onDidBlur(()=>{this._overflowWidgetsDomNodeHasFocus=!1,this._update()})))}_update(){const e=this._hasDomElementFocus||this._overflowWidgetsDomNodeHasFocus;this._hadFocus!==e&&(this._hadFocus=e,this._onChange.fire(void 0))}hasFocus(){return this._hadFocus??!1}}class wf{get length(){return this._decorationIds.length}constructor(e,t){this._editor=e,this._decorationIds=[],this._isChangingDecorations=!1,Array.isArray(t)&&t.length>0&&this.set(t)}onDidChange(e,t,i){return this._editor.onDidChangeModelDecorations(n=>{this._isChangingDecorations||e.call(t,n)},i)}getRange(e){return!this._editor.hasModel()||e>=this._decorationIds.length?null:this._editor.getModel().getDecorationRange(this._decorationIds[e])}getRanges(){if(!this._editor.hasModel())return[];const e=this._editor.getModel(),t=[];for(const i of this._decorationIds){const n=e.getDecorationRange(i);n&&t.push(n)}return t}has(e){return this._decorationIds.includes(e.id)}clear(){this._decorationIds.length!==0&&this.set([])}set(e){try{this._isChangingDecorations=!0,this._editor.changeDecorations(t=>{this._decorationIds=t.deltaDecorations(this._decorationIds,e)})}finally{this._isChangingDecorations=!1}return this._decorationIds}append(e){let t=[];try{this._isChangingDecorations=!0,this._editor.changeDecorations(i=>{t=i.deltaDecorations([],e),this._decorationIds=this._decorationIds.concat(t)})}finally{this._isChangingDecorations=!1}return t}}const bf=encodeURIComponent("<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 6 3' enable-background='new 0 0 6 3' height='3' width='6'><g fill='"),Lf=encodeURIComponent("'><polygon points='5.5,0 2.5,3 1.1,3 4.1,0'/><polygon points='4,0 6,2 6,0.6 5.4,0'/><polygon points='0,2 1,3 2.4,3 0,0.6'/></g></svg>");function Ss(d){return bf+encodeURIComponent(d.toString())+Lf}const yf=encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" height="3" width="12"><g fill="'),Sf=encodeURIComponent('"><circle cx="1" cy="1" r="1"/><circle cx="5" cy="1" r="1"/><circle cx="9" cy="1" r="1"/></g></svg>');function Df(d){return yf+encodeURIComponent(d.toString())+Sf}At((d,e)=>{const t=d.getColor(qc);t&&e.addRule(`.monaco-editor .squiggly-error { background: url("data:image/svg+xml,${Ss(t)}") repeat-x bottom left; }`);const i=d.getColor(Yc);i&&e.addRule(`.monaco-editor .squiggly-warning { background: url("data:image/svg+xml,${Ss(i)}") repeat-x bottom left; }`);const n=d.getColor(Qc);n&&e.addRule(`.monaco-editor .squiggly-info { background: url("data:image/svg+xml,${Ss(n)}") repeat-x bottom left; }`);const s=d.getColor(Xc);s&&e.addRule(`.monaco-editor .squiggly-hint { background: url("data:image/svg+xml,${Df(s)}") no-repeat bottom left; }`);const o=d.getColor(Sc);o&&e.addRule(`.monaco-editor.showUnused .squiggly-inline-unnecessary { opacity: ${o.rgba.a}; }`)});class Tn{static capture(e){if(e.getScrollTop()===0||e.hasPendingScrollAnimation())return new Tn(e.getScrollTop(),e.getContentHeight(),null,0,null);let t=null,i=0;const n=e.getVisibleRanges();if(n.length>0){t=n[0].getStartPosition();const s=e.getTopForPosition(t.lineNumber,t.column);i=e.getScrollTop()-s}return new Tn(e.getScrollTop(),e.getContentHeight(),t,i,e.getPosition())}constructor(e,t,i,n,s){this._initialScrollTop=e,this._initialContentHeight=t,this._visiblePosition=i,this._visiblePositionScrollDelta=n,this._cursorPosition=s}restore(e){if(!(this._initialContentHeight===e.getContentHeight()&&this._initialScrollTop===e.getScrollTop())&&this._visiblePosition){const t=e.getTopForPosition(this._visiblePosition.lineNumber,this._visiblePosition.column);e.setScrollTop(t+this._visiblePositionScrollDelta)}}restoreRelativeVerticalPositionOfCursor(e){if(this._initialContentHeight===e.getContentHeight()&&this._initialScrollTop===e.getScrollTop())return;const t=e.getPosition();if(!this._cursorPosition||!t)return;const i=e.getTopForLineNumber(t.lineNumber)-e.getTopForLineNumber(this._cursorPosition.lineNumber);e.setScrollTop(e.getScrollTop()+i,1)}}function Nf(d,e,t,i){if(d.length===0)return e;if(e.length===0)return d;const n=[];let s=0,o=0;for(;s<d.length&&o<e.length;){const r=d[s],a=e[o],l=t(r),h=t(a);l<h?(n.push(r),s++):l>h?(n.push(a),o++):(n.push(i(r,a)),s++,o++)}for(;s<d.length;)n.push(d[s]),s++;for(;o<e.length;)n.push(e[o]),o++;return n}function In(d,e){const t=new Ne,i=d.createDecorationsCollection();return t.add(Xa({debugName:()=>`Apply decorations from ${e.debugName}`},n=>{const s=e.read(n);i.set(s)})),t.add({dispose:()=>{i.clear()}}),t}function Ei(d,e){return d.appendChild(e),ye(()=>{e.remove()})}function Mf(d,e){return d.prepend(e),ye(()=>{e.remove()})}class Hd extends V{get width(){return this._width}get height(){return this._height}get automaticLayout(){return this._automaticLayout}constructor(e,t){super(),this._automaticLayout=!1,this.elementSizeObserver=this._register(new Nd(e,t)),this._width=z(this,this.elementSizeObserver.getWidth()),this._height=z(this,this.elementSizeObserver.getHeight()),this._register(this.elementSizeObserver.onDidChange(i=>ae(n=>{this._width.set(this.elementSizeObserver.getWidth(),n),this._height.set(this.elementSizeObserver.getHeight(),n)})))}observe(e){this.elementSizeObserver.observe(e)}setAutomaticLayout(e){this._automaticLayout=e,e?this.elementSizeObserver.startObserving():this.elementSizeObserver.stopObserving()}}function ua(d,e,t){let i=e.get(),n=i,s=i;const o=z("animatedValue",i);let r=-1;const a=300;let l;t.add(es({createEmptyChangeSummary:()=>({animate:!1}),handleChange:(c,u)=>(c.didChange(e)&&(u.animate=u.animate||c.change),!0)},(c,u)=>{l!==void 0&&(d.cancelAnimationFrame(l),l=void 0),n=s,i=e.read(c),r=Date.now()-(u.animate?0:a),h()}));function h(){const c=Date.now()-r;s=Math.floor(Rf(c,n,i-n,a)),c<a?l=d.requestAnimationFrame(h):s=i,o.set(s,void 0)}return o}function Rf(d,e,t,i){return d===i?e+t:t*(-Math.pow(2,-10*d/i)+1)+e}class Ko extends V{constructor(e,t,i){super(),this._register(new no(e,i)),this._register(gt(i,{height:t.actualHeight,top:t.actualTop}))}}class Kt{get afterLineNumber(){return this._afterLineNumber.get()}constructor(e,t){this._afterLineNumber=e,this.heightInPx=t,this.domNode=document.createElement("div"),this._actualTop=z(this,void 0),this._actualHeight=z(this,void 0),this.actualTop=this._actualTop,this.actualHeight=this._actualHeight,this.showInHiddenAreas=!0,this.onChange=this._afterLineNumber,this.onDomNodeTop=i=>{this._actualTop.set(i,void 0)},this.onComputedHeight=i=>{this._actualHeight.set(i,void 0)}}}const Zn=class Zn{constructor(e,t){this._editor=e,this._domElement=t,this._overlayWidgetId=`managedOverlayWidget-${Zn._counter++}`,this._overlayWidget={getId:()=>this._overlayWidgetId,getDomNode:()=>this._domElement,getPosition:()=>null},this._editor.addOverlayWidget(this._overlayWidget)}dispose(){this._editor.removeOverlayWidget(this._overlayWidget)}};Zn._counter=0;let no=Zn;function gt(d,e){return G(t=>{for(let[i,n]of Object.entries(e))n&&typeof n=="object"&&"read"in n&&(n=n.read(t)),typeof n=="number"&&(n=`${n}px`),i=i.replace(/[A-Z]/g,s=>"-"+s.toLowerCase()),d.style[i]=n})}function On(d,e,t,i){const n=new Ne,s=[];return n.add(ke((o,r)=>{const a=e.read(o),l=new Map,h=new Map;t&&t(!0),d.changeViewZones(c=>{for(const u of s)c.removeZone(u),i==null||i.delete(u);s.length=0;for(const u of a){const _=c.addZone(u);u.setZoneId&&u.setZoneId(_),s.push(_),i==null||i.add(_),l.set(u,_)}}),t&&t(!1),r.add(es({createEmptyChangeSummary(){return{zoneIds:[]}},handleChange(c,u){const _=h.get(c.changedObservable);return _!==void 0&&u.zoneIds.push(_),!0}},(c,u)=>{for(const _ of a)_.onChange&&(h.set(_.onChange,l.get(_)),_.onChange.read(c));t&&t(!0),d.changeViewZones(_=>{for(const f of u.zoneIds)_.layoutZone(f)}),t&&t(!1)}))})),n.add({dispose(){t&&t(!0),d.changeViewZones(o=>{for(const r of s)o.removeZone(r)}),i==null||i.clear(),t&&t(!1)}}),n}class d_ extends Lo{dispose(){super.dispose(!0)}}function ga(d,e){const t=Ts(e,n=>n.original.startLineNumber<=d.lineNumber);if(!t)return W.fromPositions(d);if(t.original.endLineNumberExclusive<=d.lineNumber){const n=d.lineNumber-t.original.endLineNumberExclusive+t.modified.endLineNumberExclusive;return W.fromPositions(new E(n,d.column))}if(!t.innerChanges)return W.fromPositions(new E(t.modified.startLineNumber,1));const i=Ts(t.innerChanges,n=>n.originalRange.getStartPosition().isBeforeOrEqual(d));if(!i){const n=d.lineNumber-t.original.startLineNumber+t.modified.startLineNumber;return W.fromPositions(new E(n,d.column))}if(i.originalRange.containsPosition(d))return i.modifiedRange;{const n=xf(i.originalRange.getEndPosition(),d);return W.fromPositions(n.addToPosition(i.modifiedRange.getEndPosition()))}}function xf(d,e){return d.lineNumber===e.lineNumber?new xr(0,e.column-d.column):new xr(e.lineNumber-d.lineNumber,e.column-1)}function Ef(d,e){let t;return d.filter(i=>{const n=e(i,t);return t=i,n})}class An{static create(e,t=void 0){return new fa(e,e,t)}static createWithDisposable(e,t,i=void 0){const n=new Ne;return n.add(t),n.add(e),new fa(e,n,i)}}class fa extends An{constructor(e,t,i){super(),this.object=e,this._disposable=t,this._debugOwner=i,this._refCount=1,this._isDisposed=!1,this._owners=[],i&&this._addOwner(i)}_addOwner(e){e&&this._owners.push(e)}createNewRef(e){return this._refCount++,e&&this._addOwner(e),new Tf(this,e)}dispose(){this._isDisposed||(this._isDisposed=!0,this._decreaseRefCount(this._debugOwner))}_decreaseRefCount(e){if(this._refCount--,this._refCount===0&&this._disposable.dispose(),e){const t=this._owners.indexOf(e);t!==-1&&this._owners.splice(t,1)}}}class Tf extends An{constructor(e,t){super(),this._base=e,this._debugOwner=t,this._isDisposed=!1}get object(){return this._base.object}createNewRef(e){return this._base.createNewRef(e)}dispose(){this._isDisposed||(this._isDisposed=!0,this._base._decreaseRefCount(this._debugOwner))}}var qo=function(d,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(d,e,t,i);else for(var r=d.length-1;r>=0;r--)(o=d[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},Yo=function(d,e){return function(t,i){e(t,i,d)}};const If=Ji("diff-review-insert",oe.add,T("accessibleDiffViewerInsertIcon","Icon for 'Insert' in accessible diff viewer.")),Of=Ji("diff-review-remove",oe.remove,T("accessibleDiffViewerRemoveIcon","Icon for 'Remove' in accessible diff viewer.")),Af=Ji("diff-review-close",oe.close,T("accessibleDiffViewerCloseIcon","Icon for 'Close' in accessible diff viewer."));var li;let bt=(li=class extends V{constructor(e,t,i,n,s,o,r,a,l){super(),this._parentNode=e,this._visible=t,this._setVisible=i,this._canClose=n,this._width=s,this._height=o,this._diffs=r,this._models=a,this._instantiationService=l,this._state=fi(this,(h,c)=>{const u=this._visible.read(h);if(this._parentNode.style.visibility=u?"visible":"hidden",!u)return null;const _=c.add(this._instantiationService.createInstance(so,this._diffs,this._models,this._setVisible,this._canClose)),f=c.add(this._instantiationService.createInstance(oo,this._parentNode,_,this._width,this._height,this._models));return{model:_,view:f}}).recomputeInitiallyAndOnChange(this._store)}next(){ae(e=>{const t=this._visible.get();this._setVisible(!0,e),t&&this._state.get().model.nextGroup(e)})}prev(){ae(e=>{this._setVisible(!0,e),this._state.get().model.previousGroup(e)})}close(){ae(e=>{this._setVisible(!1,e)})}},li._ttPolicy=Yi("diffReview",{createHTML:e=>e}),li);bt=qo([Yo(8,ve)],bt);let so=class extends V{constructor(e,t,i,n,s){super(),this._diffs=e,this._models=t,this._setVisible=i,this.canClose=n,this._accessibilitySignalService=s,this._groups=z(this,[]),this._currentGroupIdx=z(this,0),this._currentElementIdx=z(this,0),this.groups=this._groups,this.currentGroup=this._currentGroupIdx.map((o,r)=>this._groups.read(r)[o]),this.currentGroupIndex=this._currentGroupIdx,this.currentElement=this._currentElementIdx.map((o,r)=>{var a;return(a=this.currentGroup.read(r))==null?void 0:a.lines[o]}),this._register(G(o=>{const r=this._diffs.read(o);if(!r){this._groups.set([],void 0);return}const a=Pf(r,this._models.getOriginalModel().getLineCount(),this._models.getModifiedModel().getLineCount());ae(l=>{const h=this._models.getModifiedPosition();if(h){const c=a.findIndex(u=>(h==null?void 0:h.lineNumber)<u.range.modified.endLineNumberExclusive);c!==-1&&this._currentGroupIdx.set(c,l)}this._groups.set(a,l)})})),this._register(G(o=>{const r=this.currentElement.read(o);(r==null?void 0:r.type)===pe.Deleted?this._accessibilitySignalService.playSignal(ot.diffLineDeleted,{source:"accessibleDiffViewer.currentElementChanged"}):(r==null?void 0:r.type)===pe.Added&&this._accessibilitySignalService.playSignal(ot.diffLineInserted,{source:"accessibleDiffViewer.currentElementChanged"})})),this._register(G(o=>{const r=this.currentElement.read(o);if(r&&r.type!==pe.Header){const a=r.modifiedLineNumber??r.diff.modified.startLineNumber;this._models.modifiedSetSelection(W.fromPositions(new E(a,1)))}}))}_goToGroupDelta(e,t){const i=this.groups.get();!i||i.length<=1||Ja(t,n=>{this._currentGroupIdx.set(He.ofLength(i.length).clipCyclic(this._currentGroupIdx.get()+e),n),this._currentElementIdx.set(0,n)})}nextGroup(e){this._goToGroupDelta(1,e)}previousGroup(e){this._goToGroupDelta(-1,e)}_goToLineDelta(e){const t=this.currentGroup.get();!t||t.lines.length<=1||ae(i=>{this._currentElementIdx.set(He.ofLength(t.lines.length).clip(this._currentElementIdx.get()+e),i)})}goToNextLine(){this._goToLineDelta(1)}goToPreviousLine(){this._goToLineDelta(-1)}goToLine(e){const t=this.currentGroup.get();if(!t)return;const i=t.lines.indexOf(e);i!==-1&&ae(n=>{this._currentElementIdx.set(i,n)})}revealCurrentElementInEditor(){if(!this.canClose.get())return;this._setVisible(!1,void 0);const e=this.currentElement.get();e&&(e.type===pe.Deleted?this._models.originalReveal(W.fromPositions(new E(e.originalLineNumber,1))):this._models.modifiedReveal(e.type!==pe.Header?W.fromPositions(new E(e.modifiedLineNumber,1)):void 0))}close(){this.canClose.get()&&(this._setVisible(!1,void 0),this._models.modifiedFocus())}};so=qo([Yo(4,Cd)],so);const Di=3;function Pf(d,e,t){const i=[];for(const n of td(d,(s,o)=>o.modified.startLineNumber-s.modified.endLineNumberExclusive<2*Di)){const s=[];s.push(new Hf);const o=new X(Math.max(1,n[0].original.startLineNumber-Di),Math.min(n[n.length-1].original.endLineNumberExclusive+Di,e+1)),r=new X(Math.max(1,n[0].modified.startLineNumber-Di),Math.min(n[n.length-1].modified.endLineNumberExclusive+Di,t+1));$l(n,(h,c)=>{const u=new X(h?h.original.endLineNumberExclusive:o.startLineNumber,c?c.original.startLineNumber:o.endLineNumberExclusive),_=new X(h?h.modified.endLineNumberExclusive:r.startLineNumber,c?c.modified.startLineNumber:r.endLineNumberExclusive);u.forEach(f=>{s.push(new Ff(f,_.startLineNumber+(f-u.startLineNumber)))}),c&&(c.original.forEach(f=>{s.push(new kf(c,f))}),c.modified.forEach(f=>{s.push(new Vf(c,f))}))});const a=n[0].modified.join(n[n.length-1].modified),l=n[0].original.join(n[n.length-1].original);i.push(new Wf(new ti(a,l),s))}return i}var pe;(function(d){d[d.Header=0]="Header",d[d.Unchanged=1]="Unchanged",d[d.Deleted=2]="Deleted",d[d.Added=3]="Added"})(pe||(pe={}));class Wf{constructor(e,t){this.range=e,this.lines=t}}class Hf{constructor(){this.type=pe.Header}}class kf{constructor(e,t){this.diff=e,this.originalLineNumber=t,this.type=pe.Deleted,this.modifiedLineNumber=void 0}}class Vf{constructor(e,t){this.diff=e,this.modifiedLineNumber=t,this.type=pe.Added,this.originalLineNumber=void 0}}class Ff{constructor(e,t){this.originalLineNumber=e,this.modifiedLineNumber=t,this.type=pe.Unchanged}}let oo=class extends V{constructor(e,t,i,n,s,o){super(),this._element=e,this._model=t,this._width=i,this._height=n,this._models=s,this._languageService=o,this.domNode=this._element,this.domNode.className="monaco-component diff-review monaco-editor-background";const r=document.createElement("div");r.className="diff-review-actions",this._actionBar=this._register(new ed(r)),this._register(G(a=>{this._actionBar.clear(),this._model.canClose.read(a)&&this._actionBar.push(new Jt("diffreview.close",T("label.close","Close"),"close-diff-review "+nt.asClassName(Af),!0,async()=>t.close()),{label:!1,icon:!0})})),this._content=document.createElement("div"),this._content.className="diff-review-content",this._content.setAttribute("role","code"),this._scrollbar=this._register(new zl(this._content,{})),ei(this.domNode,this._scrollbar.getDomNode(),r),this._register(G(a=>{this._height.read(a),this._width.read(a),this._scrollbar.scanDomNode()})),this._register(ye(()=>{ei(this.domNode)})),this._register(gt(this.domNode,{width:this._width,height:this._height})),this._register(gt(this._content,{width:this._width,height:this._height})),this._register(ke((a,l)=>{this._model.currentGroup.read(a),this._render(l)})),this._register(yt(this.domNode,"keydown",a=>{(a.equals(18)||a.equals(2066)||a.equals(530))&&(a.preventDefault(),this._model.goToNextLine()),(a.equals(16)||a.equals(2064)||a.equals(528))&&(a.preventDefault(),this._model.goToPreviousLine()),(a.equals(9)||a.equals(2057)||a.equals(521)||a.equals(1033))&&(a.preventDefault(),this._model.close()),(a.equals(10)||a.equals(3))&&(a.preventDefault(),this._model.revealCurrentElementInEditor())}))}_render(e){const t=this._models.getOriginalOptions(),i=this._models.getModifiedOptions(),n=document.createElement("div");n.className="diff-review-table",n.setAttribute("role","list"),n.setAttribute("aria-label",T("ariaLabel","Accessible Diff Viewer. Use arrow up and down to navigate.")),le(n,i.get(50)),ei(this._content,n);const s=this._models.getOriginalModel(),o=this._models.getModifiedModel();if(!s||!o)return;const r=s.getOptions(),a=o.getOptions(),l=i.get(67),h=this._model.currentGroup.get();for(const c of(h==null?void 0:h.lines)||[]){if(!h)break;let u;if(c.type===pe.Header){const f=document.createElement("div");f.className="diff-review-row",f.setAttribute("role","listitem");const w=h.range,C=this._model.currentGroupIndex.get(),v=this._model.groups.get().length,g=L=>L===0?T("no_lines_changed","no lines changed"):L===1?T("one_line_changed","1 line changed"):T("more_lines_changed","{0} lines changed",L),p=g(w.original.length),m=g(w.modified.length);f.setAttribute("aria-label",T({key:"header",comment:["This is the ARIA label for a git diff header.","A git diff header looks like this: @@ -154,12 +159,39 @@.","That encodes that at original line 154 (which is now line 159), 12 lines were removed/changed with 39 lines.","Variables 0 and 1 refer to the diff index out of total number of diffs.","Variables 2 and 4 will be numbers (a line number).",'Variables 3 and 5 will be "no lines changed", "1 line changed" or "X lines changed", localized separately.']},"Difference {0} of {1}: original line {2}, {3}, modified line {4}, {5}",C+1,v,w.original.startLineNumber,p,w.modified.startLineNumber,m));const b=document.createElement("div");b.className="diff-review-cell diff-review-summary",b.appendChild(document.createTextNode(`${C+1}/${v}: @@ -${w.original.startLineNumber},${w.original.length} +${w.modified.startLineNumber},${w.modified.length} @@`)),f.appendChild(b),u=f}else u=this._createRow(c,l,this._width.get(),t,s,r,i,o,a);n.appendChild(u);const _=O(f=>this._model.currentElement.read(f)===c);e.add(G(f=>{const w=_.read(f);u.tabIndex=w?0:-1,w&&u.focus()})),e.add(P(u,"focus",()=>{this._model.goToLine(c)}))}this._scrollbar.scanDomNode()}_createRow(e,t,i,n,s,o,r,a,l){const h=n.get(146),c=h.glyphMarginWidth+h.lineNumbersWidth,u=r.get(146),_=10+u.glyphMarginWidth+u.lineNumbersWidth;let f="diff-review-row",w="";const C="diff-review-spacer";let v=null;switch(e.type){case pe.Added:f="diff-review-row line-insert",w=" char-insert",v=If;break;case pe.Deleted:f="diff-review-row line-delete",w=" char-delete",v=Of;break}const g=document.createElement("div");g.style.minWidth=i+"px",g.className=f,g.setAttribute("role","listitem"),g.ariaLevel="";const p=document.createElement("div");p.className="diff-review-cell",p.style.height=`${t}px`,g.appendChild(p);const m=document.createElement("span");m.style.width=c+"px",m.style.minWidth=c+"px",m.className="diff-review-line-number"+w,e.originalLineNumber!==void 0?m.appendChild(document.createTextNode(String(e.originalLineNumber))):m.innerText=" ",p.appendChild(m);const b=document.createElement("span");b.style.width=_+"px",b.style.minWidth=_+"px",b.style.paddingRight="10px",b.className="diff-review-line-number"+w,e.modifiedLineNumber!==void 0?b.appendChild(document.createTextNode(String(e.modifiedLineNumber))):b.innerText=" ",p.appendChild(b);const L=document.createElement("span");if(L.className=C,v){const D=document.createElement("span");D.className=nt.asClassName(v),D.innerText="  ",L.appendChild(D)}else L.innerText="  ";p.appendChild(L);let y;if(e.modifiedLineNumber!==void 0){let D=this._getLineHtml(a,r,l.tabSize,e.modifiedLineNumber,this._languageService.languageIdCodec);bt._ttPolicy&&(D=bt._ttPolicy.createHTML(D)),p.insertAdjacentHTML("beforeend",D),y=a.getLineContent(e.modifiedLineNumber)}else{let D=this._getLineHtml(s,n,o.tabSize,e.originalLineNumber,this._languageService.languageIdCodec);bt._ttPolicy&&(D=bt._ttPolicy.createHTML(D)),p.insertAdjacentHTML("beforeend",D),y=s.getLineContent(e.originalLineNumber)}y.length===0&&(y=T("blankLine","blank"));let S="";switch(e.type){case pe.Unchanged:e.originalLineNumber===e.modifiedLineNumber?S=T({key:"unchangedLine",comment:["The placeholders are contents of the line and should not be translated."]},"{0} unchanged line {1}",y,e.originalLineNumber):S=T("equalLine","{0} original line {1} modified line {2}",y,e.originalLineNumber,e.modifiedLineNumber);break;case pe.Added:S=T("insertLine","+ {0} modified line {1}",y,e.modifiedLineNumber);break;case pe.Deleted:S=T("deleteLine","- {0} original line {1}",y,e.originalLineNumber);break}return g.setAttribute("aria-label",S),g}_getLineHtml(e,t,i,n,s){const o=e.getLineContent(n),r=t.get(50),a=Dc.createEmpty(o,s),l=bn.isBasicASCII(o,e.mightContainNonBasicASCII()),h=bn.containsRTL(o,l,e.mightContainRTL());return Nc(new Io(r.isMonospace&&!t.get(33),r.canUseHalfwidthRightwardsArrow,o,!1,l,h,0,a,[],i,0,r.spaceWidth,r.middotWidth,r.wsmiddotWidth,t.get(118),t.get(100),t.get(95),t.get(51)!==ts.OFF,null)).html}};oo=qo([Yo(5,od)],oo);class Bf{constructor(e){this.editors=e}getOriginalModel(){return this.editors.original.getModel()}getOriginalOptions(){return this.editors.original.getOptions()}originalReveal(e){this.editors.original.revealRange(e),this.editors.original.setSelection(e),this.editors.original.focus()}getModifiedModel(){return this.editors.modified.getModel()}getModifiedOptions(){return this.editors.modified.getOptions()}modifiedReveal(e){e&&(this.editors.modified.revealRange(e),this.editors.modified.setSelection(e)),this.editors.modified.focus()}modifiedSetSelection(e){this.editors.modified.setSelection(e)}modifiedFocus(){this.editors.modified.focus()}getModifiedPosition(){return this.editors.modified.getPosition()??void 0}}mi("diffEditor.move.border","#8b8b8b9c",T("diffEditor.move.border","The border color for text that got moved in the diff editor."));mi("diffEditor.moveActive.border","#FFA500",T("diffEditor.moveActive.border","The active border color for text that got moved in the diff editor."));mi("diffEditor.unchangedRegionShadow",{dark:"#000000",light:"#737373BF",hcDark:"#000000",hcLight:"#737373BF"},T("diffEditor.unchangedRegionShadow","The color of the shadow around unchanged region widgets."));const Uf=Ji("diff-insert",oe.add,T("diffInsertIcon","Line decoration for inserts in the diff editor.")),kd=Ji("diff-remove",oe.remove,T("diffRemoveIcon","Line decoration for removals in the diff editor.")),ma=Fe.register({className:"line-insert",description:"line-insert",isWholeLine:!0,linesDecorationsClassName:"insert-sign "+nt.asClassName(Uf),marginClassName:"gutter-insert"}),_a=Fe.register({className:"line-delete",description:"line-delete",isWholeLine:!0,linesDecorationsClassName:"delete-sign "+nt.asClassName(kd),marginClassName:"gutter-delete"}),pa=Fe.register({className:"line-insert",description:"line-insert",isWholeLine:!0,marginClassName:"gutter-insert"}),va=Fe.register({className:"line-delete",description:"line-delete",isWholeLine:!0,marginClassName:"gutter-delete"}),Ca=Fe.register({className:"char-insert",description:"char-insert",shouldFillLineOnLineBreak:!0}),zf=Fe.register({className:"char-insert",description:"char-insert",isWholeLine:!0}),$f=Fe.register({className:"char-insert diff-range-empty",description:"char-insert diff-range-empty"}),ro=Fe.register({className:"char-delete",description:"char-delete",shouldFillLineOnLineBreak:!0}),Gf=Fe.register({className:"char-delete",description:"char-delete",isWholeLine:!0}),jf=Fe.register({className:"char-delete diff-range-empty",description:"char-delete diff-range-empty"});var Vd=function(d,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(d,e,t,i);else for(var r=d.length-1;r>=0;r--)(o=d[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},ao=function(d,e){return function(t,i){e(t,i,d)}},_t;const Fd=Ho("diffProviderFactoryService");let lo=class{constructor(e){this.instantiationService=e}createDiffProvider(e){return this.instantiationService.createInstance(ho,e)}};lo=Vd([ao(0,ve)],lo);pd(Fd,lo,1);var Mt;let ho=(Mt=class{constructor(e,t,i){this.editorWorkerService=t,this.telemetryService=i,this.onDidChangeEventEmitter=new H,this.onDidChange=this.onDidChangeEventEmitter.event,this.diffAlgorithm="advanced",this.diffAlgorithmOnDidChangeSubscription=void 0,this.setOptions(e)}dispose(){var e;(e=this.diffAlgorithmOnDidChangeSubscription)==null||e.dispose()}async computeDiff(e,t,i,n){if(typeof this.diffAlgorithm!="string")return this.diffAlgorithm.computeDiff(e,t,i,n);if(e.isDisposed()||t.isDisposed())return{changes:[],identical:!0,quitEarly:!1,moves:[]};if(e.getLineCount()===1&&e.getLineMaxColumn(1)===1)return t.getLineCount()===1&&t.getLineMaxColumn(1)===1?{changes:[],identical:!0,quitEarly:!1,moves:[]}:{changes:[new Qi(new X(1,2),new X(1,t.getLineCount()+1),[new To(e.getFullModelRange(),t.getFullModelRange())])],identical:!1,quitEarly:!1,moves:[]};const s=JSON.stringify([e.uri.toString(),t.uri.toString()]),o=JSON.stringify([e.id,t.id,e.getAlternativeVersionId(),t.getAlternativeVersionId(),JSON.stringify(i)]),r=_t.diffCache.get(s);if(r&&r.context===o)return r.result;const a=Ha.create(),l=await this.editorWorkerService.computeDiff(e.uri,t.uri,i,this.diffAlgorithm),h=a.elapsed();if(this.telemetryService.publicLog2("diffEditor.computeDiff",{timeMs:h,timedOut:(l==null?void 0:l.quitEarly)??!0,detectedMoves:i.computeMoves?(l==null?void 0:l.moves.length)??0:-1}),n.isCancellationRequested)return{changes:[],identical:!1,quitEarly:!0,moves:[]};if(!l)throw new Error("no diff result available");return _t.diffCache.size>10&&_t.diffCache.delete(_t.diffCache.keys().next().value),_t.diffCache.set(s,{result:l,context:o}),l}setOptions(e){var i;let t=!1;e.diffAlgorithm&&this.diffAlgorithm!==e.diffAlgorithm&&((i=this.diffAlgorithmOnDidChangeSubscription)==null||i.dispose(),this.diffAlgorithmOnDidChangeSubscription=void 0,this.diffAlgorithm=e.diffAlgorithm,typeof e.diffAlgorithm!="string"&&(this.diffAlgorithmOnDidChangeSubscription=e.diffAlgorithm.onDidChange(()=>this.onDidChangeEventEmitter.fire())),t=!0),t&&this.onDidChangeEventEmitter.fire()}},_t=Mt,Mt.diffCache=new Map,Mt);ho=_t=Vd([ao(1,Mc),ao(2,fd)],ho);var Zf=function(d,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(d,e,t,i);else for(var r=d.length-1;r>=0;r--)(o=d[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},Kf=function(d,e){return function(t,i){e(t,i,d)}};let co=class extends V{setActiveMovedText(e){this._activeMovedText.set(e,void 0)}constructor(e,t,i){super(),this.model=e,this._options=t,this._diffProviderFactoryService=i,this._isDiffUpToDate=z(this,!1),this.isDiffUpToDate=this._isDiffUpToDate,this._diff=z(this,void 0),this.diff=this._diff,this._unchangedRegions=z(this,void 0),this.unchangedRegions=O(this,r=>{var a;return this._options.hideUnchangedRegions.read(r)?((a=this._unchangedRegions.read(r))==null?void 0:a.regions)??[]:(ae(l=>{var h;for(const c of((h=this._unchangedRegions.get())==null?void 0:h.regions)||[])c.collapseAll(l)}),[])}),this.movedTextToCompare=z(this,void 0),this._activeMovedText=z(this,void 0),this._hoveredMovedText=z(this,void 0),this.activeMovedText=O(this,r=>this.movedTextToCompare.read(r)??this._hoveredMovedText.read(r)??this._activeMovedText.read(r)),this._cancellationTokenSource=new Lo,this._diffProvider=O(this,r=>{const a=this._diffProviderFactoryService.createDiffProvider({diffAlgorithm:this._options.diffAlgorithm.read(r)}),l=Ie("onDidChange",a.onDidChange);return{diffProvider:a,onChangeSignal:l}}),this._register(ye(()=>this._cancellationTokenSource.cancel()));const n=Do("contentChangedSignal"),s=this._register(new ct(()=>n.trigger(void 0),200));this._register(G(r=>{const a=this._unchangedRegions.read(r);if(!a||a.regions.some(f=>f.isDragged.read(r)))return;const l=a.originalDecorationIds.map(f=>e.original.getDecorationRange(f)).map(f=>f?X.fromRangeInclusive(f):void 0),h=a.modifiedDecorationIds.map(f=>e.modified.getDecorationRange(f)).map(f=>f?X.fromRangeInclusive(f):void 0),c=a.regions.map((f,w)=>!l[w]||!h[w]?void 0:new ht(l[w].startLineNumber,h[w].startLineNumber,l[w].length,f.visibleLineCountTop.read(r),f.visibleLineCountBottom.read(r))).filter(hi),u=[];let _=!1;for(const f of td(c,(w,C)=>w.getHiddenModifiedRange(r).endLineNumberExclusive===C.getHiddenModifiedRange(r).startLineNumber))if(f.length>1){_=!0;const w=f.reduce((v,g)=>v+g.lineCount,0),C=new ht(f[0].originalLineNumber,f[0].modifiedLineNumber,w,f[0].visibleLineCountTop.get(),f[f.length-1].visibleLineCountBottom.get());u.push(C)}else u.push(f[0]);if(_){const f=e.original.deltaDecorations(a.originalDecorationIds,u.map(C=>({range:C.originalUnchangedRange.toInclusiveRange(),options:{description:"unchanged"}}))),w=e.modified.deltaDecorations(a.modifiedDecorationIds,u.map(C=>({range:C.modifiedUnchangedRange.toInclusiveRange(),options:{description:"unchanged"}})));ae(C=>{this._unchangedRegions.set({regions:u,originalDecorationIds:f,modifiedDecorationIds:w},C)})}}));const o=(r,a,l)=>{const h=ht.fromDiffs(r.changes,e.original.getLineCount(),e.modified.getLineCount(),this._options.hideUnchangedRegionsMinimumLineCount.read(l),this._options.hideUnchangedRegionsContextLineCount.read(l));let c;const u=this._unchangedRegions.get();if(u){const C=u.originalDecorationIds.map(m=>e.original.getDecorationRange(m)).map(m=>m?X.fromRangeInclusive(m):void 0),v=u.modifiedDecorationIds.map(m=>e.modified.getDecorationRange(m)).map(m=>m?X.fromRangeInclusive(m):void 0);let p=Ef(u.regions.map((m,b)=>{if(!C[b]||!v[b])return;const L=C[b].length;return new ht(C[b].startLineNumber,v[b].startLineNumber,L,Math.min(m.visibleLineCountTop.get(),L),Math.min(m.visibleLineCountBottom.get(),L-m.visibleLineCountTop.get()))}).filter(hi),(m,b)=>!b||m.modifiedLineNumber>=b.modifiedLineNumber+b.lineCount&&m.originalLineNumber>=b.originalLineNumber+b.lineCount).map(m=>new ti(m.getHiddenOriginalRange(l),m.getHiddenModifiedRange(l)));p=ti.clip(p,X.ofLength(1,e.original.getLineCount()),X.ofLength(1,e.modified.getLineCount())),c=ti.inverse(p,e.original.getLineCount(),e.modified.getLineCount())}const _=[];if(c)for(const C of h){const v=c.filter(g=>g.original.intersectsStrict(C.originalUnchangedRange)&&g.modified.intersectsStrict(C.modifiedUnchangedRange));_.push(...C.setVisibleRanges(v,a))}else _.push(...h);const f=e.original.deltaDecorations((u==null?void 0:u.originalDecorationIds)||[],_.map(C=>({range:C.originalUnchangedRange.toInclusiveRange(),options:{description:"unchanged"}}))),w=e.modified.deltaDecorations((u==null?void 0:u.modifiedDecorationIds)||[],_.map(C=>({range:C.modifiedUnchangedRange.toInclusiveRange(),options:{description:"unchanged"}})));this._unchangedRegions.set({regions:_,originalDecorationIds:f,modifiedDecorationIds:w},a)};this._register(e.modified.onDidChangeContent(r=>{if(this._diff.get()){const l=an.fromModelContentChanges(r.changes);this._lastDiff,e.original,e.modified}this._isDiffUpToDate.set(!1,void 0),s.schedule()})),this._register(e.original.onDidChangeContent(r=>{if(this._diff.get()){const l=an.fromModelContentChanges(r.changes);this._lastDiff,e.original,e.modified}this._isDiffUpToDate.set(!1,void 0),s.schedule()})),this._register(ke(async(r,a)=>{this._options.hideUnchangedRegionsMinimumLineCount.read(r),this._options.hideUnchangedRegionsContextLineCount.read(r),s.cancel(),n.read(r);const l=this._diffProvider.read(r);l.onChangeSignal.read(r),Ee(Rc,r),Ee(xc,r),this._isDiffUpToDate.set(!1,void 0);let h=[];a.add(e.original.onDidChangeContent(_=>{const f=an.fromModelContentChanges(_.changes);h=Er(h,f)}));let c=[];a.add(e.modified.onDidChangeContent(_=>{const f=an.fromModelContentChanges(_.changes);c=Er(c,f)}));let u=await l.diffProvider.computeDiff(e.original,e.modified,{ignoreTrimWhitespace:this._options.ignoreTrimWhitespace.read(r),maxComputationTimeMs:this._options.maxComputationTimeMs.read(r),computeMoves:this._options.showMoves.read(r)},this._cancellationTokenSource.token);this._cancellationTokenSource.token.isCancellationRequested||e.original.isDisposed()||e.modified.isDisposed()||(u=qf(u,e.original,e.modified),u=(e.original,e.modified,void 0)??u,u=(e.original,e.modified,void 0)??u,ae(_=>{o(u,_),this._lastDiff=u;const f=Qo.fromDiffResult(u);this._diff.set(f,_),this._isDiffUpToDate.set(!0,_);const w=this.movedTextToCompare.get();this.movedTextToCompare.set(w?this._lastDiff.moves.find(C=>C.lineRangeMapping.modified.intersect(w.lineRangeMapping.modified)):void 0,_)}))}))}ensureModifiedLineIsVisible(e,t,i){var s,o;if(((s=this.diff.get())==null?void 0:s.mappings.length)===0)return;const n=((o=this._unchangedRegions.get())==null?void 0:o.regions)||[];for(const r of n)if(r.getHiddenModifiedRange(void 0).contains(e)){r.showModifiedLine(e,t,i);return}}ensureOriginalLineIsVisible(e,t,i){var s,o;if(((s=this.diff.get())==null?void 0:s.mappings.length)===0)return;const n=((o=this._unchangedRegions.get())==null?void 0:o.regions)||[];for(const r of n)if(r.getHiddenOriginalRange(void 0).contains(e)){r.showOriginalLine(e,t,i);return}}async waitForDiff(){await Gl(this.isDiffUpToDate,e=>e)}serializeState(){const e=this._unchangedRegions.get();return{collapsedRegions:e==null?void 0:e.regions.map(t=>({range:t.getHiddenModifiedRange(void 0).serialize()}))}}restoreSerializedState(e){var n;const t=(n=e.collapsedRegions)==null?void 0:n.map(s=>X.deserialize(s.range)),i=this._unchangedRegions.get();!i||!t||ae(s=>{for(const o of i.regions)for(const r of t)if(o.modifiedUnchangedRange.intersect(r)){o.setHiddenModifiedRange(r,s);break}})}};co=Zf([Kf(2,Fd)],co);function qf(d,e,t){return{changes:d.changes.map(i=>new Qi(i.original,i.modified,i.innerChanges?i.innerChanges.map(n=>Yf(n,e,t)):void 0)),moves:d.moves,identical:d.identical,quitEarly:d.quitEarly}}function Yf(d,e,t){let i=d.originalRange,n=d.modifiedRange;return i.startColumn===1&&n.startColumn===1&&(i.endColumn!==1||n.endColumn!==1)&&i.endColumn===e.getLineMaxColumn(i.endLineNumber)&&n.endColumn===t.getLineMaxColumn(n.endLineNumber)&&i.endLineNumber<e.getLineCount()&&n.endLineNumber<t.getLineCount()&&(i=i.setEndPosition(i.endLineNumber+1,1),n=n.setEndPosition(n.endLineNumber+1,1)),new To(i,n)}class Qo{static fromDiffResult(e){return new Qo(e.changes.map(t=>new Bd(t)),e.moves||[],e.identical,e.quitEarly)}constructor(e,t,i,n){this.mappings=e,this.movedTexts=t,this.identical=i,this.quitEarly=n}}class Bd{constructor(e){this.lineRangeMapping=e}}class ht{static fromDiffs(e,t,i,n,s){const o=Qi.inverse(e,t,i),r=[];for(const a of o){let l=a.original.startLineNumber,h=a.modified.startLineNumber,c=a.original.length;const u=l===1&&h===1,_=l+c===t+1&&h+c===i+1;(u||_)&&c>=s+n?(u&&!_&&(c-=s),_&&!u&&(l+=s,h+=s,c-=s),r.push(new ht(l,h,c,0,0))):c>=s*2+n&&(l+=s,h+=s,c-=s*2,r.push(new ht(l,h,c,0,0)))}return r}get originalUnchangedRange(){return X.ofLength(this.originalLineNumber,this.lineCount)}get modifiedUnchangedRange(){return X.ofLength(this.modifiedLineNumber,this.lineCount)}constructor(e,t,i,n,s){this.originalLineNumber=e,this.modifiedLineNumber=t,this.lineCount=i,this._visibleLineCountTop=z(this,0),this.visibleLineCountTop=this._visibleLineCountTop,this._visibleLineCountBottom=z(this,0),this.visibleLineCountBottom=this._visibleLineCountBottom,this._shouldHideControls=O(this,a=>this.visibleLineCountTop.read(a)+this.visibleLineCountBottom.read(a)===this.lineCount&&!this.isDragged.read(a)),this.isDragged=z(this,void 0);const o=Math.max(Math.min(n,this.lineCount),0),r=Math.max(Math.min(s,this.lineCount-n),0);mr(n===o),mr(s===r),this._visibleLineCountTop.set(o,void 0),this._visibleLineCountBottom.set(r,void 0)}setVisibleRanges(e,t){const i=[],n=new Wo(e.map(a=>a.modified)).subtractFrom(this.modifiedUnchangedRange);let s=this.originalLineNumber,o=this.modifiedLineNumber;const r=this.modifiedLineNumber+this.lineCount;if(n.ranges.length===0)this.showAll(t),i.push(this);else{let a=0;for(const l of n.ranges){const h=a===n.ranges.length-1;a++;const c=(h?r:l.endLineNumberExclusive)-o,u=new ht(s,o,c,0,0);u.setHiddenModifiedRange(l,t),i.push(u),s=u.originalUnchangedRange.endLineNumberExclusive,o=u.modifiedUnchangedRange.endLineNumberExclusive}}return i}shouldHideControls(e){return this._shouldHideControls.read(e)}getHiddenOriginalRange(e){return X.ofLength(this.originalLineNumber+this._visibleLineCountTop.read(e),this.lineCount-this._visibleLineCountTop.read(e)-this._visibleLineCountBottom.read(e))}getHiddenModifiedRange(e){return X.ofLength(this.modifiedLineNumber+this._visibleLineCountTop.read(e),this.lineCount-this._visibleLineCountTop.read(e)-this._visibleLineCountBottom.read(e))}setHiddenModifiedRange(e,t){const i=e.startLineNumber-this.modifiedLineNumber,n=this.modifiedLineNumber+this.lineCount-e.endLineNumberExclusive;this.setState(i,n,t)}getMaxVisibleLineCountTop(){return this.lineCount-this._visibleLineCountBottom.get()}getMaxVisibleLineCountBottom(){return this.lineCount-this._visibleLineCountTop.get()}showMoreAbove(e=10,t){const i=this.getMaxVisibleLineCountTop();this._visibleLineCountTop.set(Math.min(this._visibleLineCountTop.get()+e,i),t)}showMoreBelow(e=10,t){const i=this.lineCount-this._visibleLineCountTop.get();this._visibleLineCountBottom.set(Math.min(this._visibleLineCountBottom.get()+e,i),t)}showAll(e){this._visibleLineCountBottom.set(this.lineCount-this._visibleLineCountTop.get(),e)}showModifiedLine(e,t,i){const n=e+1-(this.modifiedLineNumber+this._visibleLineCountTop.get()),s=this.modifiedLineNumber-this._visibleLineCountBottom.get()+this.lineCount-e;t===0&&n<s||t===1?this._visibleLineCountTop.set(this._visibleLineCountTop.get()+n,i):this._visibleLineCountBottom.set(this._visibleLineCountBottom.get()+s,i)}showOriginalLine(e,t,i){const n=e-this.originalLineNumber,s=this.originalLineNumber+this.lineCount-e;t===0&&n<s||t===1?this._visibleLineCountTop.set(Math.min(this._visibleLineCountTop.get()+s-n,this.getMaxVisibleLineCountTop()),i):this._visibleLineCountBottom.set(Math.min(this._visibleLineCountBottom.get()+n-s,this.getMaxVisibleLineCountBottom()),i)}collapseAll(e){this._visibleLineCountTop.set(0,e),this._visibleLineCountBottom.set(0,e)}setState(e,t,i){e=Math.max(Math.min(e,this.lineCount),0),t=Math.max(Math.min(t,this.lineCount-e),0),this._visibleLineCountTop.set(e,i),this._visibleLineCountBottom.set(t,i)}}class Qf extends V{get visibility(){return this._visibility}set visibility(e){this._visibility!==e&&(this._visibility=e,this._diffActions.style.visibility=e?"visible":"hidden")}constructor(e,t,i,n,s,o,r,a,l){super(),this._getViewZoneId=e,this._marginDomNode=t,this._modifiedEditor=i,this._diff=n,this._editor=s,this._viewLineCounts=o,this._originalTextModel=r,this._contextMenuService=a,this._clipboardService=l,this._visibility=!1,this._marginDomNode.style.zIndex="10",this._diffActions=document.createElement("div"),this._diffActions.className=nt.asClassName(oe.lightBulb)+" lightbulb-glyph",this._diffActions.style.position="absolute";const h=this._modifiedEditor.getOption(67);this._diffActions.style.right="0px",this._diffActions.style.visibility="hidden",this._diffActions.style.height=`${h}px`,this._diffActions.style.lineHeight=`${h}px`,this._marginDomNode.appendChild(this._diffActions);let c=0;const u=i.getOption(128)&&!Ga,_=(f,w)=>{this._contextMenuService.showContextMenu({domForShadowRoot:u?i.getDomNode()??void 0:void 0,getAnchor:()=>({x:f,y:w}),getActions:()=>{const C=[],v=n.modified.isEmpty;return C.push(new Jt("diff.clipboard.copyDeletedContent",v?n.original.length>1?T("diff.clipboard.copyDeletedLinesContent.label","Copy deleted lines"):T("diff.clipboard.copyDeletedLinesContent.single.label","Copy deleted line"):n.original.length>1?T("diff.clipboard.copyChangedLinesContent.label","Copy changed lines"):T("diff.clipboard.copyChangedLinesContent.single.label","Copy changed line"),void 0,!0,async()=>{const p=this._originalTextModel.getValueInRange(n.original.toExclusiveRange());await this._clipboardService.writeText(p)})),n.original.length>1&&C.push(new Jt("diff.clipboard.copyDeletedLineContent",v?T("diff.clipboard.copyDeletedLineContent.label","Copy deleted line ({0})",n.original.startLineNumber+c):T("diff.clipboard.copyChangedLineContent.label","Copy changed line ({0})",n.original.startLineNumber+c),void 0,!0,async()=>{let p=this._originalTextModel.getLineContent(n.original.startLineNumber+c);p===""&&(p=this._originalTextModel.getEndOfLineSequence()===0?`
`:`\r
`),await this._clipboardService.writeText(p)})),i.getOption(92)||C.push(new Jt("diff.inline.revertChange",T("diff.inline.revertChange.label","Revert this change"),void 0,!0,async()=>{this._editor.revert(this._diff)})),C},autoSelectFirstItem:!0})};this._register(yt(this._diffActions,"mousedown",f=>{if(!f.leftButton)return;const{top:w,height:C}=Tt(this._diffActions),v=Math.floor(h/3);f.preventDefault(),_(f.posx,w+C+v)})),this._register(i.onMouseMove(f=>{(f.target.type===8||f.target.type===5)&&f.target.detail.viewZoneId===this._getViewZoneId()?(c=this._updateLightBulbPosition(this._marginDomNode,f.event.browserEvent.y,h),this.visibility=!0):this.visibility=!1})),this._register(i.onMouseDown(f=>{f.event.leftButton&&(f.target.type===8||f.target.type===5)&&f.target.detail.viewZoneId===this._getViewZoneId()&&(f.event.preventDefault(),c=this._updateLightBulbPosition(this._marginDomNode,f.event.browserEvent.y,h),_(f.event.posx,f.event.posy+h))}))}_updateLightBulbPosition(e,t,i){const{top:n}=Tt(e),s=t-n,o=Math.floor(s/i),r=o*i;if(this._diffActions.style.top=`${r}px`,this._viewLineCounts){let a=0;for(let l=0;l<this._viewLineCounts.length;l++)if(a+=this._viewLineCounts[l],o<a)return l}return o}}const wa=Yi("diffEditorWidget",{createHTML:d=>d});function Xf(d,e,t,i){le(i,e.fontInfo);const n=t.length>0,s=new Ao(1e4);let o=0,r=0;const a=[];for(let u=0;u<d.lineTokens.length;u++){const _=u+1,f=d.lineTokens[u],w=d.lineBreakData[u],C=wn.filter(t,_,1,Number.MAX_SAFE_INTEGER);if(w){let v=0;for(const g of w.breakOffsets){const p=f.sliceAndInflate(v,g,0);o=Math.max(o,ba(r,p,wn.extractWrapped(C,v,g),n,d.mightContainNonBasicASCII,d.mightContainRTL,e,s)),r++,v=g}a.push(w.breakOffsets.length)}else a.push(1),o=Math.max(o,ba(r,f,C,n,d.mightContainNonBasicASCII,d.mightContainRTL,e,s)),r++}o+=e.scrollBeyondLastColumn;const l=s.build(),h=wa?wa.createHTML(l):l;i.innerHTML=h;const c=o*e.typicalHalfwidthCharacterWidth;return{heightInLines:r,minWidthInPx:c,viewLineCounts:a}}class Jf{constructor(e,t,i,n){this.lineTokens=e,this.lineBreakData=t,this.mightContainNonBasicASCII=i,this.mightContainRTL=n}}class Xo{static fromEditor(e){var s;const t=e.getOptions(),i=t.get(50),n=t.get(146);return new Xo(((s=e.getModel())==null?void 0:s.getOptions().tabSize)||0,i,t.get(33),i.typicalHalfwidthCharacterWidth,t.get(105),t.get(67),n.decorationsWidth,t.get(118),t.get(100),t.get(95),t.get(51))}constructor(e,t,i,n,s,o,r,a,l,h,c){this.tabSize=e,this.fontInfo=t,this.disableMonospaceOptimizations=i,this.typicalHalfwidthCharacterWidth=n,this.scrollBeyondLastColumn=s,this.lineHeight=o,this.lineDecorationsWidth=r,this.stopRenderingLineAfter=a,this.renderWhitespace=l,this.renderControlCharacters=h,this.fontLigatures=c}}function ba(d,e,t,i,n,s,o,r){r.appendString('<div class="view-line'),i||r.appendString(" char-delete"),r.appendString('" style="top:'),r.appendString(String(d*o.lineHeight)),r.appendString('px;width:1000000px;">');const a=e.getLineContent(),l=bn.isBasicASCII(a,n),h=bn.containsRTL(a,l,s),c=ad(new Io(o.fontInfo.isMonospace&&!o.disableMonospaceOptimizations,o.fontInfo.canUseHalfwidthRightwardsArrow,a,!1,l,h,0,e,t,o.tabSize,0,o.fontInfo.spaceWidth,o.fontInfo.middotWidth,o.fontInfo.wsmiddotWidth,o.stopRenderingLineAfter,o.renderWhitespace,o.renderControlCharacters,o.fontLigatures!==ts.OFF,null),r);return r.appendString("</div>"),c.characterMapping.getHorizontalOffset(c.characterMapping.length)}var em=function(d,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(d,e,t,i);else for(var r=d.length-1;r>=0;r--)(o=d[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},La=function(d,e){return function(t,i){e(t,i,d)}};let uo=class extends V{constructor(e,t,i,n,s,o,r,a,l,h){super(),this._targetWindow=e,this._editors=t,this._diffModel=i,this._options=n,this._diffEditorWidget=s,this._canIgnoreViewZoneUpdateEvent=o,this._origViewZonesToIgnore=r,this._modViewZonesToIgnore=a,this._clipboardService=l,this._contextMenuService=h,this._originalTopPadding=z(this,0),this._originalScrollOffset=z(this,0),this._originalScrollOffsetAnimated=ua(this._targetWindow,this._originalScrollOffset,this._store),this._modifiedTopPadding=z(this,0),this._modifiedScrollOffset=z(this,0),this._modifiedScrollOffsetAnimated=ua(this._targetWindow,this._modifiedScrollOffset,this._store);const c=z("invalidateAlignmentsState",0),u=this._register(new ct(()=>{c.set(c.get()+1,void 0)},0));this._register(this._editors.original.onDidChangeViewZones(p=>{this._canIgnoreViewZoneUpdateEvent()||u.schedule()})),this._register(this._editors.modified.onDidChangeViewZones(p=>{this._canIgnoreViewZoneUpdateEvent()||u.schedule()})),this._register(this._editors.original.onDidChangeConfiguration(p=>{(p.hasChanged(147)||p.hasChanged(67))&&u.schedule()})),this._register(this._editors.modified.onDidChangeConfiguration(p=>{(p.hasChanged(147)||p.hasChanged(67))&&u.schedule()}));const _=this._diffModel.map(p=>p?te(this,p.model.original.onDidChangeTokens,()=>p.model.original.tokenization.backgroundTokenizationState===2):void 0).map((p,m)=>p==null?void 0:p.read(m)),f=O(p=>{const m=this._diffModel.read(p),b=m==null?void 0:m.diff.read(p);if(!m||!b)return null;c.read(p);const y=this._options.renderSideBySide.read(p);return ya(this._editors.original,this._editors.modified,b.mappings,this._origViewZonesToIgnore,this._modViewZonesToIgnore,y)}),w=O(p=>{var L;const m=(L=this._diffModel.read(p))==null?void 0:L.movedTextToCompare.read(p);if(!m)return null;c.read(p);const b=m.changes.map(y=>new Bd(y));return ya(this._editors.original,this._editors.modified,b,this._origViewZonesToIgnore,this._modViewZonesToIgnore,!0)});function C(){const p=document.createElement("div");return p.className="diagonal-fill",p}const v=this._register(new Ne);this.viewZones=fi(this,(p,m)=>{var q,Se,nn,tr;v.clear();const b=f.read(p)||[],L=[],y=[],S=this._modifiedTopPadding.read(p);S>0&&y.push({afterLineNumber:0,domNode:document.createElement("div"),heightInPx:S,showInHiddenAreas:!0,suppressMouseDown:!0});const D=this._originalTopPadding.read(p);D>0&&L.push({afterLineNumber:0,domNode:document.createElement("div"),heightInPx:D,showInHiddenAreas:!0,suppressMouseDown:!0});const x=this._options.renderSideBySide.read(p),M=x||(q=this._editors.modified._getViewModel())==null?void 0:q.createLineBreaksComputer();if(M){const Z=this._editors.original.getModel();for(const Le of b)if(Le.diff)for(let Ue=Le.originalRange.startLineNumber;Ue<Le.originalRange.endLineNumberExclusive;Ue++){if(Ue>Z.getLineCount())return{orig:L,mod:y};M==null||M.addRequest(Z.getLineContent(Ue),null,null)}}const R=(M==null?void 0:M.finalize())??[];let I=0;const F=this._editors.modified.getOption(67),k=(Se=this._diffModel.read(p))==null?void 0:Se.movedTextToCompare.read(p),K=((nn=this._editors.original.getModel())==null?void 0:nn.mightContainNonBasicASCII())??!1,se=((tr=this._editors.original.getModel())==null?void 0:tr.mightContainRTL())??!1,ie=Xo.fromEditor(this._editors.modified);for(const Z of b)if(Z.diff&&!x&&(!this._options.useTrueInlineDiffRendering.read(p)||!Jo(Z.diff))){if(!Z.originalRange.isEmpty){_.read(p);const Ue=document.createElement("div");Ue.classList.add("view-lines","line-delete","monaco-mouse-cursor-text");const vi=this._editors.original.getModel();if(Z.originalRange.endLineNumberExclusive-1>vi.getLineCount())return{orig:L,mod:y};const Ht=new Jf(Z.originalRange.mapToLineArray(Ce=>vi.tokenization.getLineTokens(Ce)),Z.originalRange.mapToLineArray(Ce=>R[I++]),K,se),kt=[];for(const Ce of Z.diff.innerChanges||[])kt.push(new Ec(Ce.originalRange.delta(-(Z.diff.original.startLineNumber-1)),ro.className,0));const Vt=Xf(Ht,ie,kt,Ue),Ci=document.createElement("div");if(Ci.className="inline-deleted-margin-view-zone",le(Ci,ie.fontInfo),this._options.renderIndicators.read(p))for(let Ce=0;Ce<Vt.heightInLines;Ce++){const Ft=document.createElement("div");Ft.className=`delete-sign ${nt.asClassName(kd)}`,Ft.setAttribute("style",`position:absolute;top:${Ce*F}px;width:${ie.lineDecorationsWidth}px;height:${F}px;right:0;`),Ci.appendChild(Ft)}let ir;v.add(new Qf(()=>Qa(ir),Ci,this._editors.modified,Z.diff,this._diffEditorWidget,Vt.viewLineCounts,this._editors.original.getModel(),this._contextMenuService,this._clipboardService));for(let Ce=0;Ce<Vt.viewLineCounts.length;Ce++){const Ft=Vt.viewLineCounts[Ce];Ft>1&&L.push({afterLineNumber:Z.originalRange.startLineNumber+Ce,domNode:C(),heightInPx:(Ft-1)*F,showInHiddenAreas:!0,suppressMouseDown:!0})}y.push({afterLineNumber:Z.modifiedRange.startLineNumber-1,domNode:Ue,heightInPx:Vt.heightInLines*F,minWidthInPx:Vt.minWidthInPx,marginDomNode:Ci,setZoneId(Ce){ir=Ce},showInHiddenAreas:!0,suppressMouseDown:!0})}const Le=document.createElement("div");Le.className="gutter-delete",L.push({afterLineNumber:Z.originalRange.endLineNumberExclusive-1,domNode:C(),heightInPx:Z.modifiedHeightInPx,marginDomNode:Le,showInHiddenAreas:!0,suppressMouseDown:!0})}else{const Le=Z.modifiedHeightInPx-Z.originalHeightInPx;if(Le>0){if(k!=null&&k.lineRangeMapping.original.delta(-1).deltaLength(2).contains(Z.originalRange.endLineNumberExclusive-1))continue;L.push({afterLineNumber:Z.originalRange.endLineNumberExclusive-1,domNode:C(),heightInPx:Le,showInHiddenAreas:!0,suppressMouseDown:!0})}else{let Ue=function(){const Ht=document.createElement("div");return Ht.className="arrow-revert-change "+nt.asClassName(oe.arrowRight),m.add(P(Ht,"mousedown",kt=>kt.stopPropagation())),m.add(P(Ht,"click",kt=>{kt.stopPropagation(),s.revert(Z.diff)})),Ti("div",{},Ht)};if(k!=null&&k.lineRangeMapping.modified.delta(-1).deltaLength(2).contains(Z.modifiedRange.endLineNumberExclusive-1))continue;let vi;Z.diff&&Z.diff.modified.isEmpty&&this._options.shouldRenderOldRevertArrows.read(p)&&(vi=Ue()),y.push({afterLineNumber:Z.modifiedRange.endLineNumberExclusive-1,domNode:C(),heightInPx:-Le,marginDomNode:vi,showInHiddenAreas:!0,suppressMouseDown:!0})}}for(const Z of w.read(p)??[]){if(!(k!=null&&k.lineRangeMapping.original.intersect(Z.originalRange))||!(k!=null&&k.lineRangeMapping.modified.intersect(Z.modifiedRange)))continue;const Le=Z.modifiedHeightInPx-Z.originalHeightInPx;Le>0?L.push({afterLineNumber:Z.originalRange.endLineNumberExclusive-1,domNode:C(),heightInPx:Le,showInHiddenAreas:!0,suppressMouseDown:!0}):y.push({afterLineNumber:Z.modifiedRange.endLineNumberExclusive-1,domNode:C(),heightInPx:-Le,showInHiddenAreas:!0,suppressMouseDown:!0})}return{orig:L,mod:y}});let g=!1;this._register(this._editors.original.onDidScrollChange(p=>{p.scrollLeftChanged&&!g&&(g=!0,this._editors.modified.setScrollLeft(p.scrollLeft),g=!1)})),this._register(this._editors.modified.onDidScrollChange(p=>{p.scrollLeftChanged&&!g&&(g=!0,this._editors.original.setScrollLeft(p.scrollLeft),g=!1)})),this._originalScrollTop=te(this._editors.original.onDidScrollChange,()=>this._editors.original.getScrollTop()),this._modifiedScrollTop=te(this._editors.modified.onDidScrollChange,()=>this._editors.modified.getScrollTop()),this._register(G(p=>{const m=this._originalScrollTop.read(p)-(this._originalScrollOffsetAnimated.get()-this._modifiedScrollOffsetAnimated.read(p))-(this._originalTopPadding.get()-this._modifiedTopPadding.read(p));m!==this._editors.modified.getScrollTop()&&this._editors.modified.setScrollTop(m,1)})),this._register(G(p=>{const m=this._modifiedScrollTop.read(p)-(this._modifiedScrollOffsetAnimated.get()-this._originalScrollOffsetAnimated.read(p))-(this._modifiedTopPadding.get()-this._originalTopPadding.read(p));m!==this._editors.original.getScrollTop()&&this._editors.original.setScrollTop(m,1)})),this._register(G(p=>{var L;const m=(L=this._diffModel.read(p))==null?void 0:L.movedTextToCompare.read(p);let b=0;if(m){const y=this._editors.original.getTopForLineNumber(m.lineRangeMapping.original.startLineNumber,!0)-this._originalTopPadding.get();b=this._editors.modified.getTopForLineNumber(m.lineRangeMapping.modified.startLineNumber,!0)-this._modifiedTopPadding.get()-y}b>0?(this._modifiedTopPadding.set(0,void 0),this._originalTopPadding.set(b,void 0)):b<0?(this._modifiedTopPadding.set(-b,void 0),this._originalTopPadding.set(0,void 0)):setTimeout(()=>{this._modifiedTopPadding.set(0,void 0),this._originalTopPadding.set(0,void 0)},400),this._editors.modified.hasTextFocus()?this._originalScrollOffset.set(this._modifiedScrollOffset.get()-b,void 0,!0):this._modifiedScrollOffset.set(this._originalScrollOffset.get()+b,void 0,!0)}))}};uo=em([La(8,Jc),La(9,_d)],uo);function ya(d,e,t,i,n,s){const o=new vn(Sa(d,i)),r=new vn(Sa(e,n)),a=d.getOption(67),l=e.getOption(67),h=[];let c=0,u=0;function _(f,w){for(;;){let C=o.peek(),v=r.peek();if(C&&C.lineNumber>=f&&(C=void 0),v&&v.lineNumber>=w&&(v=void 0),!C&&!v)break;const g=C?C.lineNumber-c:Number.MAX_VALUE,p=v?v.lineNumber-u:Number.MAX_VALUE;g<p?(o.dequeue(),v={lineNumber:C.lineNumber-c+u,heightInPx:0}):g>p?(r.dequeue(),C={lineNumber:v.lineNumber-u+c,heightInPx:0}):(o.dequeue(),r.dequeue()),h.push({originalRange:X.ofLength(C.lineNumber,1),modifiedRange:X.ofLength(v.lineNumber,1),originalHeightInPx:a+C.heightInPx,modifiedHeightInPx:l+v.heightInPx,diff:void 0})}}for(const f of t){let p=function(m,b,L=!1){var M,R;if(m<g||b<v)return;if(C)C=!1;else if(!L&&(m===g||b===v))return;const y=new X(g,m),S=new X(v,b);if(y.isEmpty&&S.isEmpty)return;const D=((M=o.takeWhile(I=>I.lineNumber<m))==null?void 0:M.reduce((I,F)=>I+F.heightInPx,0))??0,x=((R=r.takeWhile(I=>I.lineNumber<b))==null?void 0:R.reduce((I,F)=>I+F.heightInPx,0))??0;h.push({originalRange:y,modifiedRange:S,originalHeightInPx:y.length*a+D,modifiedHeightInPx:S.length*l+x,diff:f.lineRangeMapping}),g=m,v=b};const w=f.lineRangeMapping;_(w.original.startLineNumber,w.modified.startLineNumber);let C=!0,v=w.modified.startLineNumber,g=w.original.startLineNumber;if(s)for(const m of w.innerChanges||[]){m.originalRange.startColumn>1&&m.modifiedRange.startColumn>1&&p(m.originalRange.startLineNumber,m.modifiedRange.startLineNumber);const b=d.getModel(),L=m.originalRange.endLineNumber<=b.getLineCount()?b.getLineMaxColumn(m.originalRange.endLineNumber):Number.MAX_SAFE_INTEGER;m.originalRange.endColumn<L&&p(m.originalRange.endLineNumber,m.modifiedRange.endLineNumber)}p(w.original.endLineNumberExclusive,w.modified.endLineNumberExclusive,!0),c=w.original.endLineNumberExclusive,u=w.modified.endLineNumberExclusive}return _(Number.MAX_VALUE,Number.MAX_VALUE),h}function Sa(d,e){const t=[],i=[],n=d.getOption(147).wrappingColumn!==-1,s=d._getViewModel().coordinatesConverter,o=d.getOption(67);if(n)for(let a=1;a<=d.getModel().getLineCount();a++){const l=s.getModelLineViewLineCount(a);l>1&&i.push({lineNumber:a,heightInPx:o*(l-1)})}for(const a of d.getWhitespaces()){if(e.has(a.id))continue;const l=a.afterLineNumber===0?0:s.convertViewPositionToModelPosition(new E(a.afterLineNumber,1)).lineNumber;t.push({lineNumber:l,heightInPx:a.height})}return Nf(t,i,a=>a.lineNumber,(a,l)=>({lineNumber:a.lineNumber,heightInPx:a.heightInPx+l.heightInPx}))}function Jo(d){return d.innerChanges?d.innerChanges.every(e=>Da(e.modifiedRange)&&Da(e.originalRange)||e.originalRange.equalsRange(new W(1,1,1,1))):!1}function Da(d){return d.startLineNumber===d.endLineNumber}const Vi=class Vi extends V{constructor(e,t,i,n,s){super(),this._rootElement=e,this._diffModel=t,this._originalEditorLayoutInfo=i,this._modifiedEditorLayoutInfo=n,this._editors=s,this._originalScrollTop=te(this,this._editors.original.onDidScrollChange,()=>this._editors.original.getScrollTop()),this._modifiedScrollTop=te(this,this._editors.modified.onDidScrollChange,()=>this._editors.modified.getScrollTop()),this._viewZonesChanged=Ie("onDidChangeViewZones",this._editors.modified.onDidChangeViewZones),this.width=z(this,0),this._modifiedViewZonesChangedSignal=Ie("modified.onDidChangeViewZones",this._editors.modified.onDidChangeViewZones),this._originalViewZonesChangedSignal=Ie("original.onDidChangeViewZones",this._editors.original.onDidChangeViewZones),this._state=fi(this,(h,c)=>{var y;this._element.replaceChildren();const u=this._diffModel.read(h),_=(y=u==null?void 0:u.diff.read(h))==null?void 0:y.movedTexts;if(!_||_.length===0){this.width.set(0,void 0);return}this._viewZonesChanged.read(h);const f=this._originalEditorLayoutInfo.read(h),w=this._modifiedEditorLayoutInfo.read(h);if(!f||!w){this.width.set(0,void 0);return}this._modifiedViewZonesChangedSignal.read(h),this._originalViewZonesChangedSignal.read(h);const C=_.map(S=>{function D(ie,q){const Se=q.getTopForLineNumber(ie.startLineNumber,!0),nn=q.getTopForLineNumber(ie.endLineNumberExclusive,!0);return(Se+nn)/2}const x=D(S.lineRangeMapping.original,this._editors.original),M=this._originalScrollTop.read(h),R=D(S.lineRangeMapping.modified,this._editors.modified),I=this._modifiedScrollTop.read(h),F=x-M,k=R-I,K=Math.min(x,R),se=Math.max(x,R);return{range:new He(K,se),from:F,to:k,fromWithoutScroll:x,toWithoutScroll:R,move:S}});C.sort(jl(Cn(S=>S.fromWithoutScroll>S.toWithoutScroll,Kl),Cn(S=>S.fromWithoutScroll>S.toWithoutScroll?S.fromWithoutScroll:-S.toWithoutScroll,Mo)));const v=er.compute(C.map(S=>S.range)),g=10,p=f.verticalScrollbarWidth,m=(v.getTrackCount()-1)*10+g*2,b=p+m+(w.contentLeft-Vi.movedCodeBlockPadding);let L=0;for(const S of C){const D=v.getTrack(L),x=p+g+D*10,M=15,R=15,I=b,F=w.glyphMarginWidth+w.lineNumbersWidth,k=18,K=document.createElementNS("http://www.w3.org/2000/svg","rect");K.classList.add("arrow-rectangle"),K.setAttribute("x",`${I-F}`),K.setAttribute("y",`${S.to-k/2}`),K.setAttribute("width",`${F}`),K.setAttribute("height",`${k}`),this._element.appendChild(K);const se=document.createElementNS("http://www.w3.org/2000/svg","g"),ie=document.createElementNS("http://www.w3.org/2000/svg","path");ie.setAttribute("d",`M 0 ${S.from} L ${x} ${S.from} L ${x} ${S.to} L ${I-R} ${S.to}`),ie.setAttribute("fill","none"),se.appendChild(ie);const q=document.createElementNS("http://www.w3.org/2000/svg","polygon");q.classList.add("arrow"),c.add(G(Se=>{ie.classList.toggle("currentMove",S.move===u.activeMovedText.read(Se)),q.classList.toggle("currentMove",S.move===u.activeMovedText.read(Se))})),q.setAttribute("points",`${I-R},${S.to-M/2} ${I},${S.to} ${I-R},${S.to+M/2}`),se.appendChild(q),this._element.appendChild(se),L++}this.width.set(m,void 0)}),this._element=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._element.setAttribute("class","moved-blocks-lines"),this._rootElement.appendChild(this._element),this._register(ye(()=>this._element.remove())),this._register(G(h=>{const c=this._originalEditorLayoutInfo.read(h),u=this._modifiedEditorLayoutInfo.read(h);!c||!u||(this._element.style.left=`${c.width-c.verticalScrollbarWidth}px`,this._element.style.height=`${c.height}px`,this._element.style.width=`${c.verticalScrollbarWidth+c.contentLeft-Vi.movedCodeBlockPadding+this.width.read(h)}px`)})),this._register(No(this._state));const o=O(h=>{const c=this._diffModel.read(h),u=c==null?void 0:c.diff.read(h);return u?u.movedTexts.map(_=>({move:_,original:new Kt(_r(_.lineRangeMapping.original.startLineNumber-1),18),modified:new Kt(_r(_.lineRangeMapping.modified.startLineNumber-1),18)})):[]});this._register(On(this._editors.original,o.map(h=>h.map(c=>c.original)))),this._register(On(this._editors.modified,o.map(h=>h.map(c=>c.modified)))),this._register(ke((h,c)=>{const u=o.read(h);for(const _ of u)c.add(new Na(this._editors.original,_.original,_.move,"original",this._diffModel.get())),c.add(new Na(this._editors.modified,_.modified,_.move,"modified",this._diffModel.get()))}));const r=Ie("original.onDidFocusEditorWidget",h=>this._editors.original.onDidFocusEditorWidget(()=>setTimeout(()=>h(void 0),0))),a=Ie("modified.onDidFocusEditorWidget",h=>this._editors.modified.onDidFocusEditorWidget(()=>setTimeout(()=>h(void 0),0)));let l="modified";this._register(es({createEmptyChangeSummary:()=>{},handleChange:(h,c)=>(h.didChange(r)&&(l="original"),h.didChange(a)&&(l="modified"),!0)},h=>{r.read(h),a.read(h);const c=this._diffModel.read(h);if(!c)return;const u=c.diff.read(h);let _;if(u&&l==="original"){const f=this._editors.originalCursor.read(h);f&&(_=u.movedTexts.find(w=>w.lineRangeMapping.original.contains(f.lineNumber)))}if(u&&l==="modified"){const f=this._editors.modifiedCursor.read(h);f&&(_=u.movedTexts.find(w=>w.lineRangeMapping.modified.contains(f.lineNumber)))}_!==c.movedTextToCompare.get()&&c.movedTextToCompare.set(void 0,void 0),c.setActiveMovedText(_)}))}};Vi.movedCodeBlockPadding=4;let ai=Vi;class er{static compute(e){const t=[],i=[];for(const n of e){let s=t.findIndex(o=>!o.intersectsStrict(n));s===-1&&(t.length>=6?s=Zl(t,Cn(r=>r.intersectWithRangeLength(n),Mo)):(s=t.length,t.push(new Tc))),t[s].addRange(n),i.push(s)}return new er(t.length,i)}constructor(e,t){this._trackCount=e,this.trackPerLineIdx=t}getTrack(e){return this.trackPerLineIdx[e]}getTrackCount(){return this._trackCount}}class Na extends Ko{constructor(e,t,i,n,s){const o=U("div.diff-hidden-lines-widget");super(e,t,o.root),this._editor=e,this._move=i,this._kind=n,this._diffModel=s,this._nodes=U("div.diff-moved-code-block",{style:{marginRight:"4px"}},[U("div.text-content@textContent"),U("div.action-bar@actionBar")]),o.root.appendChild(this._nodes.root);const r=te(this._editor.onDidLayoutChange,()=>this._editor.getLayoutInfo());this._register(gt(this._nodes.root,{paddingRight:r.map(u=>u.verticalScrollbarWidth)}));let a;i.changes.length>0?a=this._kind==="original"?T("codeMovedToWithChanges","Code moved with changes to line {0}-{1}",this._move.lineRangeMapping.modified.startLineNumber,this._move.lineRangeMapping.modified.endLineNumberExclusive-1):T("codeMovedFromWithChanges","Code moved with changes from line {0}-{1}",this._move.lineRangeMapping.original.startLineNumber,this._move.lineRangeMapping.original.endLineNumberExclusive-1):a=this._kind==="original"?T("codeMovedTo","Code moved to line {0}-{1}",this._move.lineRangeMapping.modified.startLineNumber,this._move.lineRangeMapping.modified.endLineNumberExclusive-1):T("codeMovedFrom","Code moved from line {0}-{1}",this._move.lineRangeMapping.original.startLineNumber,this._move.lineRangeMapping.original.endLineNumberExclusive-1);const l=this._register(new ed(this._nodes.actionBar,{highlightToggledItems:!0})),h=new Jt("",a,"",!1);l.push(h,{icon:!1,label:!0});const c=new Jt("","Compare",nt.asClassName(oe.compareChanges),!0,()=>{this._editor.focus(),this._diffModel.movedTextToCompare.set(this._diffModel.movedTextToCompare.get()===i?void 0:this._move,void 0)});this._register(G(u=>{const _=this._diffModel.movedTextToCompare.read(u)===i;c.checked=_})),l.push(c,{icon:!1,label:!0})}}class tm extends V{constructor(e,t,i,n){super(),this._editors=e,this._diffModel=t,this._options=i,this._decorations=O(this,s=>{const o=this._diffModel.read(s),r=o==null?void 0:o.diff.read(s);if(!r)return null;const a=this._diffModel.read(s).movedTextToCompare.read(s),l=this._options.renderIndicators.read(s),h=this._options.showEmptyDecorations.read(s),c=[],u=[];if(!a)for(const f of r.mappings)if(f.lineRangeMapping.original.isEmpty||c.push({range:f.lineRangeMapping.original.toInclusiveRange(),options:l?_a:va}),f.lineRangeMapping.modified.isEmpty||u.push({range:f.lineRangeMapping.modified.toInclusiveRange(),options:l?ma:pa}),f.lineRangeMapping.modified.isEmpty||f.lineRangeMapping.original.isEmpty)f.lineRangeMapping.original.isEmpty||c.push({range:f.lineRangeMapping.original.toInclusiveRange(),options:Gf}),f.lineRangeMapping.modified.isEmpty||u.push({range:f.lineRangeMapping.modified.toInclusiveRange(),options:zf});else{const w=this._options.useTrueInlineDiffRendering.read(s)&&Jo(f.lineRangeMapping);for(const C of f.lineRangeMapping.innerChanges||[])if(f.lineRangeMapping.original.contains(C.originalRange.startLineNumber)&&c.push({range:C.originalRange,options:C.originalRange.isEmpty()&&h?jf:ro}),f.lineRangeMapping.modified.contains(C.modifiedRange.startLineNumber)&&u.push({range:C.modifiedRange,options:C.modifiedRange.isEmpty()&&h&&!w?$f:Ca}),w){const v=o.model.original.getValueInRange(C.originalRange);u.push({range:C.modifiedRange,options:{description:"deleted-text",before:{content:v,inlineClassName:"inline-deleted-text"},zIndex:1e5,showIfCollapsed:!0}})}}if(a)for(const f of a.changes){const w=f.original.toInclusiveRange();w&&c.push({range:w,options:l?_a:va});const C=f.modified.toInclusiveRange();C&&u.push({range:C,options:l?ma:pa});for(const v of f.innerChanges||[])c.push({range:v.originalRange,options:ro}),u.push({range:v.modifiedRange,options:Ca})}const _=this._diffModel.read(s).activeMovedText.read(s);for(const f of r.movedTexts)c.push({range:f.lineRangeMapping.original.toInclusiveRange(),options:{description:"moved",blockClassName:"movedOriginal"+(f===_?" currentMove":""),blockPadding:[ai.movedCodeBlockPadding,0,ai.movedCodeBlockPadding,ai.movedCodeBlockPadding]}}),u.push({range:f.lineRangeMapping.modified.toInclusiveRange(),options:{description:"moved",blockClassName:"movedModified"+(f===_?" currentMove":""),blockPadding:[4,0,4,4]}});return{originalDecorations:c,modifiedDecorations:u}}),this._register(In(this._editors.original,this._decorations.map(s=>(s==null?void 0:s.originalDecorations)||[]))),this._register(In(this._editors.modified,this._decorations.map(s=>(s==null?void 0:s.modifiedDecorations)||[])))}}class im{resetSash(){this._sashRatio.set(void 0,void 0)}constructor(e,t){this._options=e,this.dimensions=t,this.sashLeft=Ro(this,i=>{const n=this._sashRatio.read(i)??this._options.splitViewDefaultRatio.read(i);return this._computeSashLeft(n,i)},(i,n)=>{const s=this.dimensions.width.get();this._sashRatio.set(i/s,n)}),this._sashRatio=z(this,void 0)}_computeSashLeft(e,t){const i=this.dimensions.width.read(t),n=Math.floor(this._options.splitViewDefaultRatio.read(t)*i),s=this._options.enableSplitViewResizing.read(t)?Math.floor(e*i):n,o=100;return i<=o*2?n:s<o?o:s>i-o?i-o:s}}class Ud extends V{constructor(e,t,i,n,s,o){super(),this._domNode=e,this._dimensions=t,this._enabled=i,this._boundarySashes=n,this.sashLeft=s,this._resetSash=o,this._sash=this._register(new ql(this._domNode,{getVerticalSashTop:r=>0,getVerticalSashLeft:r=>this.sashLeft.get(),getVerticalSashHeight:r=>this._dimensions.height.get()},{orientation:0})),this._startSashPosition=void 0,this._register(this._sash.onDidStart(()=>{this._startSashPosition=this.sashLeft.get()})),this._register(this._sash.onDidChange(r=>{this.sashLeft.set(this._startSashPosition+(r.currentX-r.startX),void 0)})),this._register(this._sash.onDidEnd(()=>this._sash.layout())),this._register(this._sash.onDidReset(()=>this._resetSash())),this._register(G(r=>{const a=this._boundarySashes.read(r);a&&(this._sash.orthogonalEndSash=a.bottom)})),this._register(G(r=>{const a=this._enabled.read(r);this._sash.state=a?3:0,this.sashLeft.read(r),this._dimensions.height.read(r),this._sash.layout()}))}}class nm extends V{constructor(e,t,i){super(),this._editor=e,this._domNode=t,this.itemProvider=i,this.scrollTop=te(this,this._editor.onDidScrollChange,o=>this._editor.getScrollTop()),this.isScrollTopZero=this.scrollTop.map(o=>o===0),this.modelAttached=te(this,this._editor.onDidChangeModel,o=>this._editor.hasModel()),this.editorOnDidChangeViewZones=Ie("onDidChangeViewZones",this._editor.onDidChangeViewZones),this.editorOnDidContentSizeChange=Ie("onDidContentSizeChange",this._editor.onDidContentSizeChange),this.domNodeSizeChanged=Do("domNodeSizeChanged"),this.views=new Map,this._domNode.className="gutter monaco-editor";const n=this._domNode.appendChild(U("div.scroll-decoration",{role:"presentation",ariaHidden:"true",style:{width:"100%"}}).root),s=new ResizeObserver(()=>{ae(o=>{this.domNodeSizeChanged.trigger(o)})});s.observe(this._domNode),this._register(ye(()=>s.disconnect())),this._register(G(o=>{n.className=this.isScrollTopZero.read(o)?"":"scroll-decoration"})),this._register(G(o=>this.render(o)))}dispose(){super.dispose(),ei(this._domNode)}render(e){if(!this.modelAttached.read(e))return;this.domNodeSizeChanged.read(e),this.editorOnDidChangeViewZones.read(e),this.editorOnDidContentSizeChange.read(e);const t=this.scrollTop.read(e),i=this._editor.getVisibleRanges(),n=new Set(this.views.keys()),s=He.ofStartAndLength(0,this._domNode.clientHeight);if(!s.isEmpty)for(const o of i){const r=new X(o.startLineNumber,o.endLineNumber+1),a=this.itemProvider.getIntersectingGutterItems(r,e);ae(l=>{for(const h of a){if(!h.range.intersect(r))continue;n.delete(h.id);let c=this.views.get(h.id);if(c)c.item.set(h,l);else{const w=document.createElement("div");this._domNode.appendChild(w);const C=z("item",h),v=this.itemProvider.createView(C,w);c=new sm(C,v,w),this.views.set(h.id,c)}const u=h.range.startLineNumber<=this._editor.getModel().getLineCount()?this._editor.getTopForLineNumber(h.range.startLineNumber,!0)-t:this._editor.getBottomForLineNumber(h.range.startLineNumber-1,!1)-t,f=(h.range.endLineNumberExclusive===1?Math.max(u,this._editor.getTopForLineNumber(h.range.startLineNumber,!1)-t):Math.max(u,this._editor.getBottomForLineNumber(h.range.endLineNumberExclusive-1,!0)-t))-u;c.domNode.style.top=`${u}px`,c.domNode.style.height=`${f}px`,c.gutterItemView.layout(He.ofStartAndLength(u,f),s)}})}for(const o of n){const r=this.views.get(o);r.gutterItemView.dispose(),r.domNode.remove(),this.views.delete(o)}}}class sm{constructor(e,t,i){this.item=e,this.gutterItemView=t,this.domNode=i}}class zd extends Yl{constructor(e){super(),this._getContext=e}runAction(e,t){const i=this._getContext();return super.runAction(e,i)}}var $d=function(d,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(d,e,t,i);else for(var r=d.length-1;r>=0;r--)(o=d[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},fn=function(d,e){return function(t,i){e(t,i,d)}};const Ds=[],hn=35;let go=class extends V{constructor(e,t,i,n,s,o,r,a,l){super(),this._diffModel=t,this._editors=i,this._options=n,this._sashLayout=s,this._boundarySashes=o,this._instantiationService=r,this._contextKeyService=a,this._menuService=l,this._menu=this._register(this._menuService.createMenu(de.DiffEditorHunkToolbar,this._contextKeyService)),this._actions=te(this,this._menu.onDidChange,()=>this._menu.getActions()),this._hasActions=this._actions.map(h=>h.length>0),this._showSash=O(this,h=>this._options.renderSideBySide.read(h)&&this._hasActions.read(h)),this.width=O(this,h=>this._hasActions.read(h)?hn:0),this.elements=U("div.gutter@gutter",{style:{position:"absolute",height:"100%",width:hn+"px"}},[]),this._currentDiff=O(this,h=>{var f;const c=this._diffModel.read(h);if(!c)return;const u=(f=c.diff.read(h))==null?void 0:f.mappings,_=this._editors.modifiedCursor.read(h);if(_)return u==null?void 0:u.find(w=>w.lineRangeMapping.modified.contains(_.lineNumber))}),this._selectedDiffs=O(this,h=>{const c=this._diffModel.read(h),u=c==null?void 0:c.diff.read(h);if(!u)return Ds;const _=this._editors.modifiedSelections.read(h);if(_.every(v=>v.isEmpty()))return Ds;const f=new Wo(_.map(v=>X.fromRangeInclusive(v))),C=u.mappings.filter(v=>v.lineRangeMapping.innerChanges&&f.intersects(v.lineRangeMapping.modified)).map(v=>({mapping:v,rangeMappings:v.lineRangeMapping.innerChanges.filter(g=>_.some(p=>W.areIntersecting(g.modifiedRange,p)))}));return C.length===0||C.every(v=>v.rangeMappings.length===0)?Ds:C}),this._register(Mf(e,this.elements.root)),this._register(P(this.elements.root,"click",()=>{this._editors.modified.focus()})),this._register(gt(this.elements.root,{display:this._hasActions.map(h=>h?"block":"none")})),$e(this,h=>this._showSash.read(h)?new Ud(e,this._sashLayout.dimensions,this._options.enableSplitViewResizing,this._boundarySashes,Ro(this,u=>this._sashLayout.sashLeft.read(u)-hn,(u,_)=>this._sashLayout.sashLeft.set(u+hn,_)),()=>this._sashLayout.resetSash()):void 0).recomputeInitiallyAndOnChange(this._store),this._register(new nm(this._editors.modified,this.elements.root,{getIntersectingGutterItems:(h,c)=>{const u=this._diffModel.read(c);if(!u)return[];const _=u.diff.read(c);if(!_)return[];const f=this._selectedDiffs.read(c);if(f.length>0){const C=Qi.fromRangeMappings(f.flatMap(v=>v.rangeMappings));return[new Ma(C,!0,de.DiffEditorSelectionToolbar,void 0,u.model.original.uri,u.model.modified.uri)]}const w=this._currentDiff.read(c);return _.mappings.map(C=>new Ma(C.lineRangeMapping.withInnerChangesFromLineRanges(),C.lineRangeMapping===(w==null?void 0:w.lineRangeMapping),de.DiffEditorHunkToolbar,void 0,u.model.original.uri,u.model.modified.uri))},createView:(h,c)=>this._instantiationService.createInstance(fo,h,c,this)})),this._register(P(this.elements.gutter,Q.MOUSE_WHEEL,h=>{this._editors.modified.getOption(104).handleMouseWheel&&this._editors.modified.delegateScrollFromMouseWheelEvent(h)},{passive:!1}))}computeStagedValue(e){const t=e.innerChanges??[],i=new Tr(this._editors.modifiedModel.get()),n=new Tr(this._editors.original.getModel());return new Ic(t.map(r=>r.toTextEdit(i))).apply(n)}layout(e){this.elements.gutter.style.left=e+"px"}};go=$d([fn(6,ve),fn(7,Re),fn(8,eu)],go);class Ma{constructor(e,t,i,n,s,o){this.mapping=e,this.showAlways=t,this.menuId=i,this.rangeOverride=n,this.originalUri=s,this.modifiedUri=o}get id(){return this.mapping.modified.toString()}get range(){return this.rangeOverride??this.mapping.modified}}let fo=class extends V{constructor(e,t,i,n){super(),this._item=e,this._elements=U("div.gutterItem",{style:{height:"20px",width:"34px"}},[U("div.background@background",{},[]),U("div.buttons@buttons",{},[])]),this._showAlways=this._item.map(this,o=>o.showAlways),this._menuId=this._item.map(this,o=>o.menuId),this._isSmall=z(this,!1),this._lastItemRange=void 0,this._lastViewRange=void 0;const s=this._register(n.createInstance(tu,"element",!0,{position:{hoverPosition:1}}));this._register(Ei(t,this._elements.root)),this._register(G(o=>{const r=this._showAlways.read(o);this._elements.root.classList.toggle("noTransition",!0),this._elements.root.classList.toggle("showAlways",r),setTimeout(()=>{this._elements.root.classList.toggle("noTransition",!1)},0)})),this._register(ke((o,r)=>{this._elements.buttons.replaceChildren();const a=r.add(n.createInstance(wd,this._elements.buttons,this._menuId.read(o),{orientation:1,hoverDelegate:s,toolbarOptions:{primaryGroup:l=>l.startsWith("primary")},overflowBehavior:{maxItems:this._isSmall.read(o)?1:3},hiddenItemStrategy:0,actionRunner:new zd(()=>{const l=this._item.get(),h=l.mapping;return{mapping:h,originalWithModifiedChanges:i.computeStagedValue(h),originalUri:l.originalUri,modifiedUri:l.modifiedUri}}),menuOptions:{shouldForwardArgs:!0}}));r.add(a.onDidChangeMenuItems(()=>{this._lastItemRange&&this.layout(this._lastItemRange,this._lastViewRange)}))}))}layout(e,t){this._lastItemRange=e,this._lastViewRange=t;let i=this._elements.buttons.clientHeight;this._isSmall.set(this._item.get().mapping.original.startLineNumber===1&&e.length<30,void 0),i=this._elements.buttons.clientHeight;const n=e.length/2-i/2,s=i;let o=e.start+n;const r=He.tryCreate(s,t.endExclusive-s-i),a=He.tryCreate(e.start+s,e.endExclusive-i-s);a&&r&&a.start<a.endExclusive&&(o=r.clip(o),o=a.clip(o)),this._elements.buttons.style.top=`${o-e.start}px`}};fo=$d([fn(3,ve)],fo);function Zi(d){return mo.get(d)}const rt=class rt extends V{static get(e){let t=rt._map.get(e);if(!t){t=new rt(e),rt._map.set(e,t);const i=e.onDidDispose(()=>{const n=rt._map.get(e);n&&(rt._map.delete(e),n.dispose(),i.dispose())})}return t}_beginUpdate(){this._updateCounter++,this._updateCounter===1&&(this._currentTransaction=new Ql(()=>{}))}_endUpdate(){if(this._updateCounter--,this._updateCounter===0){const e=this._currentTransaction;this._currentTransaction=void 0,e.finish()}}constructor(e){var t;super(),this.editor=e,this._updateCounter=0,this._currentTransaction=void 0,this._model=z(this,this.editor.getModel()),this.model=this._model,this.isReadonly=te(this,this.editor.onDidChangeConfiguration,()=>this.editor.getOption(92)),this._versionId=pr({owner:this,lazy:!0},((t=this.editor.getModel())==null?void 0:t.getVersionId())??null),this.versionId=this._versionId,this._selections=pr({owner:this,equalsFn:vr(Xl(Me.selectionsEqual)),lazy:!0},this.editor.getSelections()??null),this.selections=this._selections,this.isFocused=te(this,i=>{const n=this.editor.onDidFocusEditorWidget(i),s=this.editor.onDidBlurEditorWidget(i);return{dispose(){n.dispose(),s.dispose()}}},()=>this.editor.hasWidgetFocus()),this.value=Ro(this,i=>{var n;return this.versionId.read(i),((n=this.model.read(i))==null?void 0:n.getValue())??""},(i,n)=>{const s=this.model.get();s!==null&&i!==s.getValue()&&s.setValue(i)}),this.valueIsEmpty=O(this,i=>{var n;return this.versionId.read(i),((n=this.editor.getModel())==null?void 0:n.getValueLength())===0}),this.cursorSelection=id({owner:this,equalsFn:vr(Me.selectionsEqual)},i=>{var n;return((n=this.selections.read(i))==null?void 0:n[0])??null}),this.onDidType=Do(this),this.scrollTop=te(this.editor.onDidScrollChange,()=>this.editor.getScrollTop()),this.scrollLeft=te(this.editor.onDidScrollChange,()=>this.editor.getScrollLeft()),this.layoutInfo=te(this.editor.onDidLayoutChange,()=>this.editor.getLayoutInfo()),this.layoutInfoContentLeft=this.layoutInfo.map(i=>i.contentLeft),this.layoutInfoDecorationsLeft=this.layoutInfo.map(i=>i.decorationsLeft),this.contentWidth=te(this.editor.onDidContentSizeChange,()=>this.editor.getContentWidth()),this._overlayWidgetCounter=0,this._register(this.editor.onBeginUpdate(()=>this._beginUpdate())),this._register(this.editor.onEndUpdate(()=>this._endUpdate())),this._register(this.editor.onDidChangeModel(()=>{this._beginUpdate();try{this._model.set(this.editor.getModel(),this._currentTransaction),this._forceUpdate()}finally{this._endUpdate()}})),this._register(this.editor.onDidType(i=>{this._beginUpdate();try{this._forceUpdate(),this.onDidType.trigger(this._currentTransaction,i)}finally{this._endUpdate()}})),this._register(this.editor.onDidChangeModelContent(i=>{var n;this._beginUpdate();try{this._versionId.set(((n=this.editor.getModel())==null?void 0:n.getVersionId())??null,this._currentTransaction,i),this._forceUpdate()}finally{this._endUpdate()}})),this._register(this.editor.onDidChangeCursorSelection(i=>{this._beginUpdate();try{this._selections.set(this.editor.getSelections(),this._currentTransaction,i),this._forceUpdate()}finally{this._endUpdate()}}))}forceUpdate(e){this._beginUpdate();try{return this._forceUpdate(),e?e(this._currentTransaction):void 0}finally{this._endUpdate()}}_forceUpdate(){var e;this._beginUpdate();try{this._model.set(this.editor.getModel(),this._currentTransaction),this._versionId.set(((e=this.editor.getModel())==null?void 0:e.getVersionId())??null,this._currentTransaction,void 0),this._selections.set(this.editor.getSelections(),this._currentTransaction,void 0)}finally{this._endUpdate()}}getOption(e){return te(this,t=>this.editor.onDidChangeConfiguration(i=>{i.hasChanged(e)&&t(void 0)}),()=>this.editor.getOption(e))}setDecorations(e){const t=new Ne,i=this.editor.createDecorationsCollection();return t.add(Xa({owner:this,debugName:()=>`Apply decorations from ${e.debugName}`},n=>{const s=e.read(n);i.set(s)})),t.add({dispose:()=>{i.clear()}}),t}createOverlayWidget(e){const t="observableOverlayWidget"+this._overlayWidgetCounter++,i={getDomNode:()=>e.domNode,getPosition:()=>e.position.get(),getId:()=>t,allowEditorOverflow:e.allowEditorOverflow,getMinContentWidthInPx:()=>e.minContentWidthInPx.get()};this.editor.addOverlayWidget(i);const n=G(s=>{e.position.read(s),e.minContentWidthInPx.read(s),this.editor.layoutOverlayWidget(i)});return ye(()=>{n.dispose(),this.editor.removeOverlayWidget(i)})}};rt._map=new Map;let mo=rt;function om(d,e){return Jl({createEmptyChangeSummary:()=>({deltas:[],didChange:!1}),handleChange:(t,i)=>{if(t.didChange(d)){const n=t.change;n!==void 0&&i.deltas.push(n),i.didChange=!0}return!0}},(t,i)=>{const n=d.read(t);i.didChange&&e(n,i.deltas)})}function __(d,e){const t=new Ne,i=om(d,(n,s)=>{t.clear(),e(n,s,t)});return{dispose(){i.dispose(),t.dispose()}}}var rm=function(d,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(d,e,t,i);else for(var r=d.length-1;r>=0;r--)(o=d[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},am=function(d,e){return function(t,i){e(t,i,d)}},mn,Rt;let _o=(Rt=class extends V{static setBreadcrumbsSourceFactory(e){this._breadcrumbsSourceFactory.set(e,void 0)}get isUpdatingHiddenAreas(){return this._isUpdatingHiddenAreas}constructor(e,t,i,n){super(),this._editors=e,this._diffModel=t,this._options=i,this._instantiationService=n,this._modifiedOutlineSource=$e(this,a=>{const l=this._editors.modifiedModel.read(a),h=mn._breadcrumbsSourceFactory.read(a);return!l||!h?void 0:h(l,this._instantiationService)}),this._isUpdatingHiddenAreas=!1,this._register(this._editors.original.onDidChangeCursorPosition(a=>{if(a.reason===1)return;const l=this._diffModel.get();ae(h=>{for(const c of this._editors.original.getSelections()||[])l==null||l.ensureOriginalLineIsVisible(c.getStartPosition().lineNumber,0,h),l==null||l.ensureOriginalLineIsVisible(c.getEndPosition().lineNumber,0,h)})})),this._register(this._editors.modified.onDidChangeCursorPosition(a=>{if(a.reason===1)return;const l=this._diffModel.get();ae(h=>{for(const c of this._editors.modified.getSelections()||[])l==null||l.ensureModifiedLineIsVisible(c.getStartPosition().lineNumber,0,h),l==null||l.ensureModifiedLineIsVisible(c.getEndPosition().lineNumber,0,h)})}));const s=this._diffModel.map((a,l)=>{var c;const h=(a==null?void 0:a.unchangedRegions.read(l))??[];return h.length===1&&h[0].modifiedLineNumber===1&&h[0].lineCount===((c=this._editors.modifiedModel.read(l))==null?void 0:c.getLineCount())?[]:h});this.viewZones=fi(this,(a,l)=>{const h=this._modifiedOutlineSource.read(a);if(!h)return{origViewZones:[],modViewZones:[]};const c=[],u=[],_=this._options.renderSideBySide.read(a),f=this._options.compactMode.read(a),w=s.read(a);for(let C=0;C<w.length;C++){const v=w[C];if(!v.shouldHideControls(a)&&!(f&&(C===0||C===w.length-1)))if(f){{const g=O(this,m=>v.getHiddenOriginalRange(m).startLineNumber-1),p=new Kt(g,12);c.push(p),l.add(new Ra(this._editors.original,p,v,!_))}{const g=O(this,m=>v.getHiddenModifiedRange(m).startLineNumber-1),p=new Kt(g,12);u.push(p),l.add(new Ra(this._editors.modified,p,v))}}else{{const g=O(this,m=>v.getHiddenOriginalRange(m).startLineNumber-1),p=new Kt(g,24);c.push(p),l.add(new xa(this._editors.original,p,v,v.originalUnchangedRange,!_,h,m=>this._diffModel.get().ensureModifiedLineIsVisible(m,2,void 0),this._options))}{const g=O(this,m=>v.getHiddenModifiedRange(m).startLineNumber-1),p=new Kt(g,24);u.push(p),l.add(new xa(this._editors.modified,p,v,v.modifiedUnchangedRange,!1,h,m=>this._diffModel.get().ensureModifiedLineIsVisible(m,2,void 0),this._options))}}}return{origViewZones:c,modViewZones:u}});const o={description:"unchanged lines",className:"diff-unchanged-lines",isWholeLine:!0},r={description:"Fold Unchanged",glyphMarginHoverMessage:new eh(void 0,{isTrusted:!0,supportThemeIcons:!0}).appendMarkdown(T("foldUnchanged","Fold Unchanged Region")),glyphMarginClassName:"fold-unchanged "+nt.asClassName(oe.fold),zIndex:10001};this._register(In(this._editors.original,O(this,a=>{const l=s.read(a),h=l.map(c=>({range:c.originalUnchangedRange.toInclusiveRange(),options:o}));for(const c of l)c.shouldHideControls(a)&&h.push({range:W.fromPositions(new E(c.originalLineNumber,1)),options:r});return h}))),this._register(In(this._editors.modified,O(this,a=>{const l=s.read(a),h=l.map(c=>({range:c.modifiedUnchangedRange.toInclusiveRange(),options:o}));for(const c of l)c.shouldHideControls(a)&&h.push({range:X.ofLength(c.modifiedLineNumber,1).toInclusiveRange(),options:r});return h}))),this._register(G(a=>{const l=s.read(a);this._isUpdatingHiddenAreas=!0;try{this._editors.original.setHiddenAreas(l.map(h=>h.getHiddenOriginalRange(a).toInclusiveRange()).filter(hi)),this._editors.modified.setHiddenAreas(l.map(h=>h.getHiddenModifiedRange(a).toInclusiveRange()).filter(hi))}finally{this._isUpdatingHiddenAreas=!1}})),this._register(this._editors.modified.onMouseUp(a=>{var l;if(!a.event.rightButton&&a.target.position&&((l=a.target.element)!=null&&l.className.includes("fold-unchanged"))){const h=a.target.position.lineNumber,c=this._diffModel.get();if(!c)return;const u=c.unchangedRegions.get().find(_=>_.modifiedUnchangedRange.includes(h));if(!u)return;u.collapseAll(void 0),a.event.stopPropagation(),a.event.preventDefault()}})),this._register(this._editors.original.onMouseUp(a=>{var l;if(!a.event.rightButton&&a.target.position&&((l=a.target.element)!=null&&l.className.includes("fold-unchanged"))){const h=a.target.position.lineNumber,c=this._diffModel.get();if(!c)return;const u=c.unchangedRegions.get().find(_=>_.originalUnchangedRange.includes(h));if(!u)return;u.collapseAll(void 0),a.event.stopPropagation(),a.event.preventDefault()}}))}},mn=Rt,Rt._breadcrumbsSourceFactory=z(mn,()=>({dispose(){},getBreadcrumbItems(e,t){return[]}})),Rt);_o=mn=rm([am(3,ve)],_o);class Ra extends Ko{constructor(e,t,i,n=!1){const s=U("div.diff-hidden-lines-widget");super(e,t,s.root),this._unchangedRegion=i,this._hide=n,this._nodes=U("div.diff-hidden-lines-compact",[U("div.line-left",[]),U("div.text@text",[]),U("div.line-right",[])]),s.root.appendChild(this._nodes.root),this._hide&&this._nodes.root.replaceChildren(),this._register(G(o=>{if(!this._hide){const r=this._unchangedRegion.getHiddenModifiedRange(o).length,a=T("hiddenLines","{0} hidden lines",r);this._nodes.text.innerText=a}}))}}class xa extends Ko{constructor(e,t,i,n,s,o,r,a){const l=U("div.diff-hidden-lines-widget");super(e,t,l.root),this._editor=e,this._unchangedRegion=i,this._unchangedRegionRange=n,this._hide=s,this._modifiedOutlineSource=o,this._revealModifiedHiddenLine=r,this._options=a,this._nodes=U("div.diff-hidden-lines",[U("div.top@top",{title:T("diff.hiddenLines.top","Click or drag to show more above")}),U("div.center@content",{style:{display:"flex"}},[U("div@first",{style:{display:"flex",justifyContent:"center",alignItems:"center",flexShrink:"0"}},[Ti("a",{title:T("showUnchangedRegion","Show Unchanged Region"),role:"button",onclick:()=>{this._unchangedRegion.showAll(void 0)}},...th("$(unfold)"))]),U("div@others",{style:{display:"flex",justifyContent:"center",alignItems:"center"}})]),U("div.bottom@bottom",{title:T("diff.bottom","Click or drag to show more below"),role:"button"})]),l.root.appendChild(this._nodes.root),this._hide?ei(this._nodes.first):this._register(gt(this._nodes.first,{width:Zi(this._editor).layoutInfoContentLeft})),this._register(G(c=>{const u=this._unchangedRegion.visibleLineCountTop.read(c)+this._unchangedRegion.visibleLineCountBottom.read(c)===this._unchangedRegion.lineCount;this._nodes.bottom.classList.toggle("canMoveTop",!u),this._nodes.bottom.classList.toggle("canMoveBottom",this._unchangedRegion.visibleLineCountBottom.read(c)>0),this._nodes.top.classList.toggle("canMoveTop",this._unchangedRegion.visibleLineCountTop.read(c)>0),this._nodes.top.classList.toggle("canMoveBottom",!u);const _=this._unchangedRegion.isDragged.read(c),f=this._editor.getDomNode();f&&(f.classList.toggle("draggingUnchangedRegion",!!_),_==="top"?(f.classList.toggle("canMoveTop",this._unchangedRegion.visibleLineCountTop.read(c)>0),f.classList.toggle("canMoveBottom",!u)):_==="bottom"?(f.classList.toggle("canMoveTop",!u),f.classList.toggle("canMoveBottom",this._unchangedRegion.visibleLineCountBottom.read(c)>0)):(f.classList.toggle("canMoveTop",!1),f.classList.toggle("canMoveBottom",!1)))}));const h=this._editor;this._register(P(this._nodes.top,"mousedown",c=>{if(c.button!==0)return;this._nodes.top.classList.toggle("dragging",!0),this._nodes.root.classList.toggle("dragging",!0),c.preventDefault();const u=c.clientY;let _=!1;const f=this._unchangedRegion.visibleLineCountTop.get();this._unchangedRegion.isDragged.set("top",void 0);const w=j(this._nodes.top),C=P(w,"mousemove",g=>{const m=g.clientY-u;_=_||Math.abs(m)>2;const b=Math.round(m/h.getOption(67)),L=Math.max(0,Math.min(f+b,this._unchangedRegion.getMaxVisibleLineCountTop()));this._unchangedRegion.visibleLineCountTop.set(L,void 0)}),v=P(w,"mouseup",g=>{_||this._unchangedRegion.showMoreAbove(this._options.hideUnchangedRegionsRevealLineCount.get(),void 0),this._nodes.top.classList.toggle("dragging",!1),this._nodes.root.classList.toggle("dragging",!1),this._unchangedRegion.isDragged.set(void 0,void 0),C.dispose(),v.dispose()})})),this._register(P(this._nodes.bottom,"mousedown",c=>{if(c.button!==0)return;this._nodes.bottom.classList.toggle("dragging",!0),this._nodes.root.classList.toggle("dragging",!0),c.preventDefault();const u=c.clientY;let _=!1;const f=this._unchangedRegion.visibleLineCountBottom.get();this._unchangedRegion.isDragged.set("bottom",void 0);const w=j(this._nodes.bottom),C=P(w,"mousemove",g=>{const m=g.clientY-u;_=_||Math.abs(m)>2;const b=Math.round(m/h.getOption(67)),L=Math.max(0,Math.min(f-b,this._unchangedRegion.getMaxVisibleLineCountBottom())),y=this._unchangedRegionRange.endLineNumberExclusive>h.getModel().getLineCount()?h.getContentHeight():h.getTopForLineNumber(this._unchangedRegionRange.endLineNumberExclusive);this._unchangedRegion.visibleLineCountBottom.set(L,void 0);const S=this._unchangedRegionRange.endLineNumberExclusive>h.getModel().getLineCount()?h.getContentHeight():h.getTopForLineNumber(this._unchangedRegionRange.endLineNumberExclusive);h.setScrollTop(h.getScrollTop()+(S-y))}),v=P(w,"mouseup",g=>{if(this._unchangedRegion.isDragged.set(void 0,void 0),!_){const p=h.getTopForLineNumber(this._unchangedRegionRange.endLineNumberExclusive);this._unchangedRegion.showMoreBelow(this._options.hideUnchangedRegionsRevealLineCount.get(),void 0);const m=h.getTopForLineNumber(this._unchangedRegionRange.endLineNumberExclusive);h.setScrollTop(h.getScrollTop()+(m-p))}this._nodes.bottom.classList.toggle("dragging",!1),this._nodes.root.classList.toggle("dragging",!1),C.dispose(),v.dispose()})})),this._register(G(c=>{const u=[];if(!this._hide){const _=i.getHiddenModifiedRange(c).length,f=T("hiddenLines","{0} hidden lines",_),w=Ti("span",{title:T("diff.hiddenLines.expandAll","Double click to unfold")},f);w.addEventListener("dblclick",g=>{g.button===0&&(g.preventDefault(),this._unchangedRegion.showAll(void 0))}),u.push(w);const C=this._unchangedRegion.getHiddenModifiedRange(c),v=this._modifiedOutlineSource.getBreadcrumbItems(C,c);if(v.length>0){u.push(Ti("span",void 0,"  |  "));for(let g=0;g<v.length;g++){const p=v[g],m=Oc.toIcon(p.kind),b=U("div.breadcrumb-item",{style:{display:"flex",alignItems:"center"}},[Is(m)," ",p.name,...g===v.length-1?[]:[Is(oe.chevronRight)]]).root;u.push(b),b.onclick=()=>{this._revealModifiedHiddenLine(p.startLineNumber)}}}}ei(this._nodes.others,...u)}))}}var dm=function(d,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(d,e,t,i);else for(var r=d.length-1;r>=0;r--)(o=d[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},lm=function(d,e){return function(t,i){e(t,i,d)}},We,et;let Ki=(et=class extends V{constructor(e,t,i,n,s,o,r){super(),this._editors=e,this._rootElement=t,this._diffModel=i,this._rootWidth=n,this._rootHeight=s,this._modifiedEditorLayoutInfo=o,this._themeService=r,this.width=We.ENTIRE_DIFF_OVERVIEW_WIDTH;const a=te(this._themeService.onDidColorThemeChange,()=>this._themeService.getColorTheme()),l=O(u=>{const _=a.read(u),f=_.getColor(iu)||(_.getColor(su)||nu).transparent(2),w=_.getColor(ou)||(_.getColor(au)||ru).transparent(2);return{insertColor:f,removeColor:w}}),h=$(document.createElement("div"));h.setClassName("diffViewport"),h.setPosition("absolute");const c=U("div.diffOverview",{style:{position:"absolute",top:"0px",width:We.ENTIRE_DIFF_OVERVIEW_WIDTH+"px"}}).root;this._register(Ei(c,h.domNode)),this._register(yt(c,Q.POINTER_DOWN,u=>{this._editors.modified.delegateVerticalScrollbarPointerDown(u)})),this._register(P(c,Q.MOUSE_WHEEL,u=>{this._editors.modified.delegateScrollFromMouseWheelEvent(u)},{passive:!1})),this._register(Ei(this._rootElement,c)),this._register(ke((u,_)=>{const f=this._diffModel.read(u),w=this._editors.original.createOverviewRuler("original diffOverviewRuler");w&&(_.add(w),_.add(Ei(c,w.getDomNode())));const C=this._editors.modified.createOverviewRuler("modified diffOverviewRuler");if(C&&(_.add(C),_.add(Ei(c,C.getDomNode()))),!w||!C)return;const v=Ie("viewZoneChanged",this._editors.original.onDidChangeViewZones),g=Ie("viewZoneChanged",this._editors.modified.onDidChangeViewZones),p=Ie("hiddenRangesChanged",this._editors.original.onDidChangeHiddenAreas),m=Ie("hiddenRangesChanged",this._editors.modified.onDidChangeHiddenAreas);_.add(G(b=>{var M;v.read(b),g.read(b),p.read(b),m.read(b);const L=l.read(b),y=(M=f==null?void 0:f.diff.read(b))==null?void 0:M.mappings;function S(R,I,F){const k=F._getViewModel();return k?R.filter(K=>K.length>0).map(K=>{const se=k.coordinatesConverter.convertModelPositionToViewPosition(new E(K.startLineNumber,1)),ie=k.coordinatesConverter.convertModelPositionToViewPosition(new E(K.endLineNumberExclusive,1)),q=ie.lineNumber-se.lineNumber;return new Ac(se.lineNumber,ie.lineNumber,q,I.toString())}):[]}const D=S((y||[]).map(R=>R.lineRangeMapping.original),L.removeColor,this._editors.original),x=S((y||[]).map(R=>R.lineRangeMapping.modified),L.insertColor,this._editors.modified);w==null||w.setZones(D),C==null||C.setZones(x)})),_.add(G(b=>{const L=this._rootHeight.read(b),y=this._rootWidth.read(b),S=this._modifiedEditorLayoutInfo.read(b);if(S){const D=We.ENTIRE_DIFF_OVERVIEW_WIDTH-2*We.ONE_OVERVIEW_WIDTH;w.setLayout({top:0,height:L,right:D+We.ONE_OVERVIEW_WIDTH,width:We.ONE_OVERVIEW_WIDTH}),C.setLayout({top:0,height:L,right:0,width:We.ONE_OVERVIEW_WIDTH});const x=this._editors.modifiedScrollTop.read(b),M=this._editors.modifiedScrollHeight.read(b),R=this._editors.modified.getOption(104),I=new ih(R.verticalHasArrows?R.arrowSize:0,R.verticalScrollbarSize,0,S.height,M,x);h.setTop(I.getSliderPosition()),h.setHeight(I.getSliderSize())}else h.setTop(0),h.setHeight(0);c.style.height=L+"px",c.style.left=y-We.ENTIRE_DIFF_OVERVIEW_WIDTH+"px",h.setWidth(We.ENTIRE_DIFF_OVERVIEW_WIDTH)}))}))}},We=et,et.ONE_OVERVIEW_WIDTH=15,et.ENTIRE_DIFF_OVERVIEW_WIDTH=et.ONE_OVERVIEW_WIDTH*2,et);Ki=We=dm([lm(6,rs)],Ki);const Ns=[];class hm extends V{constructor(e,t,i,n){super(),this._editors=e,this._diffModel=t,this._options=i,this._widget=n,this._selectedDiffs=O(this,s=>{const o=this._diffModel.read(s),r=o==null?void 0:o.diff.read(s);if(!r)return Ns;const a=this._editors.modifiedSelections.read(s);if(a.every(u=>u.isEmpty()))return Ns;const l=new Wo(a.map(u=>X.fromRangeInclusive(u))),c=r.mappings.filter(u=>u.lineRangeMapping.innerChanges&&l.intersects(u.lineRangeMapping.modified)).map(u=>({mapping:u,rangeMappings:u.lineRangeMapping.innerChanges.filter(_=>a.some(f=>W.areIntersecting(_.modifiedRange,f)))}));return c.length===0||c.every(u=>u.rangeMappings.length===0)?Ns:c}),this._register(ke((s,o)=>{if(!this._options.shouldRenderOldRevertArrows.read(s))return;const r=this._diffModel.read(s),a=r==null?void 0:r.diff.read(s);if(!r||!a||r.movedTextToCompare.read(s))return;const l=[],h=this._selectedDiffs.read(s),c=new Set(h.map(u=>u.mapping));if(h.length>0){const u=this._editors.modifiedSelections.read(s),_=o.add(new Pn(u[u.length-1].positionLineNumber,this._widget,h.flatMap(f=>f.rangeMappings),!0));this._editors.modified.addGlyphMarginWidget(_),l.push(_)}for(const u of a.mappings)if(!c.has(u)&&!u.lineRangeMapping.modified.isEmpty&&u.lineRangeMapping.innerChanges){const _=o.add(new Pn(u.lineRangeMapping.modified.startLineNumber,this._widget,u.lineRangeMapping,!1));this._editors.modified.addGlyphMarginWidget(_),l.push(_)}o.add(ye(()=>{for(const u of l)this._editors.modified.removeGlyphMarginWidget(u)}))}))}}const Kn=class Kn extends V{getId(){return this._id}constructor(e,t,i,n){super(),this._lineNumber=e,this._widget=t,this._diffs=i,this._revertSelection=n,this._id=`revertButton${Kn.counter++}`,this._domNode=U("div.revertButton",{title:this._revertSelection?T("revertSelectedChanges","Revert Selected Changes"):T("revertChange","Revert Change")},[Is(oe.arrowRight)]).root,this._register(P(this._domNode,Q.MOUSE_DOWN,s=>{s.button!==2&&(s.stopPropagation(),s.preventDefault())})),this._register(P(this._domNode,Q.MOUSE_UP,s=>{s.stopPropagation(),s.preventDefault()})),this._register(P(this._domNode,Q.CLICK,s=>{this._diffs instanceof ti?this._widget.revert(this._diffs):this._widget.revertRangeMappings(this._diffs),s.stopPropagation(),s.preventDefault()}))}getDomNode(){return this._domNode}getPosition(){return{lane:Po.Right,range:{startColumn:1,startLineNumber:this._lineNumber,endColumn:1,endLineNumber:this._lineNumber},zIndex:10001}}};Kn.counter=0;let Pn=Kn;var cm=function(d,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(d,e,t,i);else for(var r=d.length-1;r>=0;r--)(o=d[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},Ea=function(d,e){return function(t,i){e(t,i,d)}};let po=class extends V{get onDidContentSizeChange(){return this._onDidContentSizeChange.event}constructor(e,t,i,n,s,o,r){super(),this.originalEditorElement=e,this.modifiedEditorElement=t,this._options=i,this._argCodeEditorWidgetOptions=n,this._createInnerEditor=s,this._instantiationService=o,this._keybindingService=r,this.original=this._register(this._createLeftHandSideEditor(this._options.editorOptions.get(),this._argCodeEditorWidgetOptions.originalEditor||{})),this.modified=this._register(this._createRightHandSideEditor(this._options.editorOptions.get(),this._argCodeEditorWidgetOptions.modifiedEditor||{})),this._onDidContentSizeChange=this._register(new H),this.modifiedScrollTop=te(this,this.modified.onDidScrollChange,()=>this.modified.getScrollTop()),this.modifiedScrollHeight=te(this,this.modified.onDidScrollChange,()=>this.modified.getScrollHeight()),this.modifiedObs=Zi(this.modified),this.originalObs=Zi(this.original),this.modifiedModel=this.modifiedObs.model,this.modifiedSelections=te(this,this.modified.onDidChangeCursorSelection,()=>this.modified.getSelections()??[]),this.modifiedCursor=id({owner:this,equalsFn:E.equals},a=>{var l;return((l=this.modifiedSelections.read(a)[0])==null?void 0:l.getPosition())??new E(1,1)}),this.originalCursor=te(this,this.original.onDidChangeCursorPosition,()=>this.original.getPosition()??new E(1,1)),this._argCodeEditorWidgetOptions=null,this._register(es({createEmptyChangeSummary:()=>({}),handleChange:(a,l)=>(a.didChange(i.editorOptions)&&Object.assign(l,a.change.changedOptions),!0)},(a,l)=>{i.editorOptions.read(a),this._options.renderSideBySide.read(a),this.modified.updateOptions(this._adjustOptionsForRightHandSide(a,l)),this.original.updateOptions(this._adjustOptionsForLeftHandSide(a,l))}))}_createLeftHandSideEditor(e,t){const i=this._adjustOptionsForLeftHandSide(void 0,e),n=this._constructInnerEditor(this._instantiationService,this.originalEditorElement,i,t);return n.setContextValue("isInDiffLeftEditor",!0),n}_createRightHandSideEditor(e,t){const i=this._adjustOptionsForRightHandSide(void 0,e),n=this._constructInnerEditor(this._instantiationService,this.modifiedEditorElement,i,t);return n.setContextValue("isInDiffRightEditor",!0),n}_constructInnerEditor(e,t,i,n){const s=this._createInnerEditor(e,t,i,n);return this._register(s.onDidContentSizeChange(o=>{const r=this.original.getContentWidth()+this.modified.getContentWidth()+Ki.ENTIRE_DIFF_OVERVIEW_WIDTH,a=Math.max(this.modified.getContentHeight(),this.original.getContentHeight());this._onDidContentSizeChange.fire({contentHeight:a,contentWidth:r,contentHeightChanged:o.contentHeightChanged,contentWidthChanged:o.contentWidthChanged})})),s}_adjustOptionsForLeftHandSide(e,t){const i=this._adjustOptionsForSubEditor(t);return this._options.renderSideBySide.get()?(i.unicodeHighlight=this._options.editorOptions.get().unicodeHighlight||{},i.wordWrapOverride1=this._options.diffWordWrap.get()):(i.wordWrapOverride1="off",i.wordWrapOverride2="off",i.stickyScroll={enabled:!1},i.unicodeHighlight={nonBasicASCII:!1,ambiguousCharacters:!1,invisibleCharacters:!1}),i.glyphMargin=this._options.renderSideBySide.get(),t.originalAriaLabel&&(i.ariaLabel=t.originalAriaLabel),i.ariaLabel=this._updateAriaLabel(i.ariaLabel),i.readOnly=!this._options.originalEditable.get(),i.dropIntoEditor={enabled:!i.readOnly},i.extraEditorClassName="original-in-monaco-diff-editor",i}_adjustOptionsForRightHandSide(e,t){const i=this._adjustOptionsForSubEditor(t);return t.modifiedAriaLabel&&(i.ariaLabel=t.modifiedAriaLabel),i.ariaLabel=this._updateAriaLabel(i.ariaLabel),i.wordWrapOverride1=this._options.diffWordWrap.get(),i.revealHorizontalRightPadding=ld.revealHorizontalRightPadding.defaultValue+Ki.ENTIRE_DIFF_OVERVIEW_WIDTH,i.scrollbar.verticalHasArrows=!1,i.extraEditorClassName="modified-in-monaco-diff-editor",i}_adjustOptionsForSubEditor(e){const t={...e,dimension:{height:0,width:0}};return t.inDiffEditor=!0,t.automaticLayout=!1,t.scrollbar={...t.scrollbar||{}},t.folding=!1,t.codeLens=this._options.diffCodeLens.get(),t.fixedOverflowWidgets=!0,t.minimap={...t.minimap||{}},t.minimap.enabled=!1,this._options.hideUnchangedRegions.get()?t.stickyScroll={enabled:!1}:t.stickyScroll=this._options.editorOptions.get().stickyScroll,t}_updateAriaLabel(e){var i;e||(e="");const t=T("diff-aria-navigation-tip"," use {0} to open the accessibility help.",(i=this._keybindingService.lookupKeybinding("editor.action.accessibilityHelp"))==null?void 0:i.getAriaLabel());return this._options.accessibilityVerbose.get()?e+t:e?e.replaceAll(t,""):""}};po=cm([Ea(5,ve),Ea(6,as)],po);const qn=class qn extends V{constructor(){super(...arguments),this._id=++qn.idCounter,this._onDidDispose=this._register(new H),this.onDidDispose=this._onDidDispose.event}getId(){return this.getEditorType()+":v2:"+this._id}getVisibleColumnFromPosition(e){return this._targetEditor.getVisibleColumnFromPosition(e)}getPosition(){return this._targetEditor.getPosition()}setPosition(e,t="api"){this._targetEditor.setPosition(e,t)}revealLine(e,t=0){this._targetEditor.revealLine(e,t)}revealLineInCenter(e,t=0){this._targetEditor.revealLineInCenter(e,t)}revealLineInCenterIfOutsideViewport(e,t=0){this._targetEditor.revealLineInCenterIfOutsideViewport(e,t)}revealLineNearTop(e,t=0){this._targetEditor.revealLineNearTop(e,t)}revealPosition(e,t=0){this._targetEditor.revealPosition(e,t)}revealPositionInCenter(e,t=0){this._targetEditor.revealPositionInCenter(e,t)}revealPositionInCenterIfOutsideViewport(e,t=0){this._targetEditor.revealPositionInCenterIfOutsideViewport(e,t)}revealPositionNearTop(e,t=0){this._targetEditor.revealPositionNearTop(e,t)}getSelection(){return this._targetEditor.getSelection()}getSelections(){return this._targetEditor.getSelections()}setSelection(e,t="api"){this._targetEditor.setSelection(e,t)}setSelections(e,t="api"){this._targetEditor.setSelections(e,t)}revealLines(e,t,i=0){this._targetEditor.revealLines(e,t,i)}revealLinesInCenter(e,t,i=0){this._targetEditor.revealLinesInCenter(e,t,i)}revealLinesInCenterIfOutsideViewport(e,t,i=0){this._targetEditor.revealLinesInCenterIfOutsideViewport(e,t,i)}revealLinesNearTop(e,t,i=0){this._targetEditor.revealLinesNearTop(e,t,i)}revealRange(e,t=0,i=!1,n=!0){this._targetEditor.revealRange(e,t,i,n)}revealRangeInCenter(e,t=0){this._targetEditor.revealRangeInCenter(e,t)}revealRangeInCenterIfOutsideViewport(e,t=0){this._targetEditor.revealRangeInCenterIfOutsideViewport(e,t)}revealRangeNearTop(e,t=0){this._targetEditor.revealRangeNearTop(e,t)}revealRangeNearTopIfOutsideViewport(e,t=0){this._targetEditor.revealRangeNearTopIfOutsideViewport(e,t)}revealRangeAtTop(e,t=0){this._targetEditor.revealRangeAtTop(e,t)}getSupportedActions(){return this._targetEditor.getSupportedActions()}focus(){this._targetEditor.focus()}trigger(e,t,i){this._targetEditor.trigger(e,t,i)}createDecorationsCollection(e){return this._targetEditor.createDecorationsCollection(e)}changeDecorations(e){return this._targetEditor.changeDecorations(e)}};qn.idCounter=0;let vo=qn;var um=function(d,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(d,e,t,i);else for(var r=d.length-1;r>=0;r--)(o=d[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},gm=function(d,e){return function(t,i){e(t,i,d)}};let Co=class{get editorOptions(){return this._options}constructor(e,t){this._accessibilityService=t,this._diffEditorWidth=z(this,0),this._screenReaderMode=te(this,this._accessibilityService.onDidChangeScreenReaderOptimized,()=>this._accessibilityService.isScreenReaderOptimized()),this.couldShowInlineViewBecauseOfSize=O(this,n=>this._options.read(n).renderSideBySide&&this._diffEditorWidth.read(n)<=this._options.read(n).renderSideBySideInlineBreakpoint),this.renderOverviewRuler=O(this,n=>this._options.read(n).renderOverviewRuler),this.renderSideBySide=O(this,n=>this.compactMode.read(n)&&this.shouldRenderInlineViewInSmartMode.read(n)?!1:this._options.read(n).renderSideBySide&&!(this._options.read(n).useInlineViewWhenSpaceIsLimited&&this.couldShowInlineViewBecauseOfSize.read(n)&&!this._screenReaderMode.read(n))),this.readOnly=O(this,n=>this._options.read(n).readOnly),this.shouldRenderOldRevertArrows=O(this,n=>!(!this._options.read(n).renderMarginRevertIcon||!this.renderSideBySide.read(n)||this.readOnly.read(n)||this.shouldRenderGutterMenu.read(n))),this.shouldRenderGutterMenu=O(this,n=>this._options.read(n).renderGutterMenu),this.renderIndicators=O(this,n=>this._options.read(n).renderIndicators),this.enableSplitViewResizing=O(this,n=>this._options.read(n).enableSplitViewResizing),this.splitViewDefaultRatio=O(this,n=>this._options.read(n).splitViewDefaultRatio),this.ignoreTrimWhitespace=O(this,n=>this._options.read(n).ignoreTrimWhitespace),this.maxComputationTimeMs=O(this,n=>this._options.read(n).maxComputationTime),this.showMoves=O(this,n=>this._options.read(n).experimental.showMoves&&this.renderSideBySide.read(n)),this.isInEmbeddedEditor=O(this,n=>this._options.read(n).isInEmbeddedEditor),this.diffWordWrap=O(this,n=>this._options.read(n).diffWordWrap),this.originalEditable=O(this,n=>this._options.read(n).originalEditable),this.diffCodeLens=O(this,n=>this._options.read(n).diffCodeLens),this.accessibilityVerbose=O(this,n=>this._options.read(n).accessibilityVerbose),this.diffAlgorithm=O(this,n=>this._options.read(n).diffAlgorithm),this.showEmptyDecorations=O(this,n=>this._options.read(n).experimental.showEmptyDecorations),this.onlyShowAccessibleDiffViewer=O(this,n=>this._options.read(n).onlyShowAccessibleDiffViewer),this.compactMode=O(this,n=>this._options.read(n).compactMode),this.trueInlineDiffRenderingEnabled=O(this,n=>this._options.read(n).experimental.useTrueInlineView),this.useTrueInlineDiffRendering=O(this,n=>!this.renderSideBySide.read(n)&&this.trueInlineDiffRenderingEnabled.read(n)),this.hideUnchangedRegions=O(this,n=>this._options.read(n).hideUnchangedRegions.enabled),this.hideUnchangedRegionsRevealLineCount=O(this,n=>this._options.read(n).hideUnchangedRegions.revealLineCount),this.hideUnchangedRegionsContextLineCount=O(this,n=>this._options.read(n).hideUnchangedRegions.contextLineCount),this.hideUnchangedRegionsMinimumLineCount=O(this,n=>this._options.read(n).hideUnchangedRegions.minimumLineCount),this._model=z(this,void 0),this.shouldRenderInlineViewInSmartMode=this._model.map(this,n=>nh(this,s=>{const o=n==null?void 0:n.diff.read(s);return o?fm(o,this.trueInlineDiffRenderingEnabled.read(s)):void 0})).flatten().map(this,n=>!!n),this.inlineViewHideOriginalLineNumbers=this.compactMode;const i={...e,...Ta(e,Wc)};this._options=z(this,i)}updateOptions(e){const t=Ta(e,this._options.get()),i={...this._options.get(),...e,...t};this._options.set(i,void 0,{changedOptions:e})}setWidth(e){this._diffEditorWidth.set(e,void 0)}setModel(e){this._model.set(e,void 0)}};Co=um([gm(1,Ot)],Co);function fm(d,e){return d.mappings.every(t=>mm(t.lineRangeMapping)||_m(t.lineRangeMapping)||e&&Jo(t.lineRangeMapping))}function mm(d){return d.original.length===0}function _m(d){return d.modified.length===0}function Ta(d,e){var t,i,n,s,o,r,a,l;return{enableSplitViewResizing:ce(d.enableSplitViewResizing,e.enableSplitViewResizing),splitViewDefaultRatio:Pc(d.splitViewDefaultRatio,.5,.1,.9),renderSideBySide:ce(d.renderSideBySide,e.renderSideBySide),renderMarginRevertIcon:ce(d.renderMarginRevertIcon,e.renderMarginRevertIcon),maxComputationTime:Bt(d.maxComputationTime,e.maxComputationTime,0,1073741824),maxFileSize:Bt(d.maxFileSize,e.maxFileSize,0,1073741824),ignoreTrimWhitespace:ce(d.ignoreTrimWhitespace,e.ignoreTrimWhitespace),renderIndicators:ce(d.renderIndicators,e.renderIndicators),originalEditable:ce(d.originalEditable,e.originalEditable),diffCodeLens:ce(d.diffCodeLens,e.diffCodeLens),renderOverviewRuler:ce(d.renderOverviewRuler,e.renderOverviewRuler),diffWordWrap:Ir(d.diffWordWrap,e.diffWordWrap,["off","on","inherit"]),diffAlgorithm:Ir(d.diffAlgorithm,e.diffAlgorithm,["legacy","advanced"],{smart:"legacy",experimental:"advanced"}),accessibilityVerbose:ce(d.accessibilityVerbose,e.accessibilityVerbose),experimental:{showMoves:ce((t=d.experimental)==null?void 0:t.showMoves,e.experimental.showMoves),showEmptyDecorations:ce((i=d.experimental)==null?void 0:i.showEmptyDecorations,e.experimental.showEmptyDecorations),useTrueInlineView:ce((n=d.experimental)==null?void 0:n.useTrueInlineView,e.experimental.useTrueInlineView)},hideUnchangedRegions:{enabled:ce(((s=d.hideUnchangedRegions)==null?void 0:s.enabled)??((o=d.experimental)==null?void 0:o.collapseUnchangedRegions),e.hideUnchangedRegions.enabled),contextLineCount:Bt((r=d.hideUnchangedRegions)==null?void 0:r.contextLineCount,e.hideUnchangedRegions.contextLineCount,0,1073741824),minimumLineCount:Bt((a=d.hideUnchangedRegions)==null?void 0:a.minimumLineCount,e.hideUnchangedRegions.minimumLineCount,0,1073741824),revealLineCount:Bt((l=d.hideUnchangedRegions)==null?void 0:l.revealLineCount,e.hideUnchangedRegions.revealLineCount,0,1073741824)},isInEmbeddedEditor:ce(d.isInEmbeddedEditor,e.isInEmbeddedEditor),onlyShowAccessibleDiffViewer:ce(d.onlyShowAccessibleDiffViewer,e.onlyShowAccessibleDiffViewer),renderSideBySideInlineBreakpoint:Bt(d.renderSideBySideInlineBreakpoint,e.renderSideBySideInlineBreakpoint,0,1073741824),useInlineViewWhenSpaceIsLimited:ce(d.useInlineViewWhenSpaceIsLimited,e.useInlineViewWhenSpaceIsLimited),renderGutterMenu:ce(d.renderGutterMenu,e.renderGutterMenu),compactMode:ce(d.compactMode,e.compactMode)}}var pm=function(d,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(d,e,t,i);else for(var r=d.length-1;r>=0;r--)(o=d[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},Ni=function(d,e){return function(t,i){e(t,i,d)}};let ft=class extends vo{get onDidContentSizeChange(){return this._editors.onDidContentSizeChange}constructor(e,t,i,n,s,o,r,a){super(),this._domElement=e,this._parentContextKeyService=n,this._parentInstantiationService=s,this._accessibilitySignalService=r,this._editorProgressService=a,this.elements=U("div.monaco-diff-editor.side-by-side",{style:{position:"relative",height:"100%"}},[U("div.editor.original@original",{style:{position:"absolute",height:"100%"}}),U("div.editor.modified@modified",{style:{position:"absolute",height:"100%"}}),U("div.accessibleDiffViewer@accessibleDiffViewer",{style:{position:"absolute",height:"100%"}})]),this._diffModelSrc=this._register(nd(this,void 0)),this._diffModel=O(this,m=>{var b;return(b=this._diffModelSrc.read(m))==null?void 0:b.object}),this.onDidChangeModel=Ri.fromObservableLight(this._diffModel),this._contextKeyService=this._register(this._parentContextKeyService.createScoped(this._domElement)),this._instantiationService=this._register(this._parentInstantiationService.createChild(new hs([Re,this._contextKeyService]))),this._boundarySashes=z(this,void 0),this._accessibleDiffViewerShouldBeVisible=z(this,!1),this._accessibleDiffViewerVisible=O(this,m=>this._options.onlyShowAccessibleDiffViewer.read(m)?!0:this._accessibleDiffViewerShouldBeVisible.read(m)),this._movedBlocksLinesPart=z(this,void 0),this._layoutInfo=O(this,m=>{var se,ie;const b=this._rootSizeObserver.width.read(m),L=this._rootSizeObserver.height.read(m);this._rootSizeObserver.automaticLayout?this.elements.root.style.height="100%":this.elements.root.style.height=L+"px";const y=this._sash.read(m),S=this._gutter.read(m),D=(S==null?void 0:S.width.read(m))??0,x=((se=this._overviewRulerPart.read(m))==null?void 0:se.width)??0;let M,R,I,F,k;if(!!y){const q=y.sashLeft.read(m),Se=((ie=this._movedBlocksLinesPart.read(m))==null?void 0:ie.width.read(m))??0;M=0,R=q-D-Se,k=q-D,I=q,F=b-I-x}else{k=0;const q=this._options.inlineViewHideOriginalLineNumbers.read(m);M=D,q?R=0:R=Math.max(5,this._editors.originalObs.layoutInfoDecorationsLeft.read(m)),I=D+R,F=b-I-x}return this.elements.original.style.left=M+"px",this.elements.original.style.width=R+"px",this._editors.original.layout({width:R,height:L},!0),S==null||S.layout(k),this.elements.modified.style.left=I+"px",this.elements.modified.style.width=F+"px",this._editors.modified.layout({width:F,height:L},!0),{modifiedEditor:this._editors.modified.getLayoutInfo(),originalEditor:this._editors.original.getLayoutInfo()}}),this._diffValue=this._diffModel.map((m,b)=>m==null?void 0:m.diff.read(b)),this.onDidUpdateDiff=Ri.fromObservableLight(this._diffValue),o.willCreateDiffEditor(),this._contextKeyService.createKey("isInDiffEditor",!0),this._domElement.appendChild(this.elements.root),this._register(ye(()=>this.elements.root.remove())),this._rootSizeObserver=this._register(new Hd(this.elements.root,t.dimension)),this._rootSizeObserver.setAutomaticLayout(t.automaticLayout??!1),this._options=this._instantiationService.createInstance(Co,t),this._register(G(m=>{this._options.setWidth(this._rootSizeObserver.width.read(m))})),this._contextKeyService.createKey(N.isEmbeddedDiffEditor.key,!1),this._register(Ke(N.isEmbeddedDiffEditor,this._contextKeyService,m=>this._options.isInEmbeddedEditor.read(m))),this._register(Ke(N.comparingMovedCode,this._contextKeyService,m=>{var b;return!!((b=this._diffModel.read(m))!=null&&b.movedTextToCompare.read(m))})),this._register(Ke(N.diffEditorRenderSideBySideInlineBreakpointReached,this._contextKeyService,m=>this._options.couldShowInlineViewBecauseOfSize.read(m))),this._register(Ke(N.diffEditorInlineMode,this._contextKeyService,m=>!this._options.renderSideBySide.read(m))),this._register(Ke(N.hasChanges,this._contextKeyService,m=>{var b,L;return(((L=(b=this._diffModel.read(m))==null?void 0:b.diff.read(m))==null?void 0:L.mappings.length)??0)>0})),this._editors=this._register(this._instantiationService.createInstance(po,this.elements.original,this.elements.modified,this._options,i,(m,b,L,y)=>this._createInnerEditor(m,b,L,y))),this._register(Ke(N.diffEditorOriginalWritable,this._contextKeyService,m=>this._options.originalEditable.read(m))),this._register(Ke(N.diffEditorModifiedWritable,this._contextKeyService,m=>!this._options.readOnly.read(m))),this._register(Ke(N.diffEditorOriginalUri,this._contextKeyService,m=>{var b;return((b=this._diffModel.read(m))==null?void 0:b.model.original.uri.toString())??""})),this._register(Ke(N.diffEditorModifiedUri,this._contextKeyService,m=>{var b;return((b=this._diffModel.read(m))==null?void 0:b.model.modified.uri.toString())??""})),this._overviewRulerPart=$e(this,m=>this._options.renderOverviewRuler.read(m)?this._instantiationService.createInstance(Ee(Ki,m),this._editors,this.elements.root,this._diffModel,this._rootSizeObserver.width,this._rootSizeObserver.height,this._layoutInfo.map(b=>b.modifiedEditor)):void 0).recomputeInitiallyAndOnChange(this._store);const l={height:this._rootSizeObserver.height,width:this._rootSizeObserver.width.map((m,b)=>{var L;return m-(((L=this._overviewRulerPart.read(b))==null?void 0:L.width)??0)})};this._sashLayout=new im(this._options,l),this._sash=$e(this,m=>{const b=this._options.renderSideBySide.read(m);return this.elements.root.classList.toggle("side-by-side",b),b?new Ud(this.elements.root,l,this._options.enableSplitViewResizing,this._boundarySashes,this._sashLayout.sashLeft,()=>this._sashLayout.resetSash()):void 0}).recomputeInitiallyAndOnChange(this._store);const h=$e(this,m=>this._instantiationService.createInstance(Ee(_o,m),this._editors,this._diffModel,this._options)).recomputeInitiallyAndOnChange(this._store);$e(this,m=>this._instantiationService.createInstance(Ee(tm,m),this._editors,this._diffModel,this._options,this)).recomputeInitiallyAndOnChange(this._store);const c=new Set,u=new Set;let _=!1;const f=$e(this,m=>this._instantiationService.createInstance(Ee(uo,m),j(this._domElement),this._editors,this._diffModel,this._options,this,()=>_||h.get().isUpdatingHiddenAreas,c,u)).recomputeInitiallyAndOnChange(this._store),w=O(this,m=>{const b=f.read(m).viewZones.read(m).orig,L=h.read(m).viewZones.read(m).origViewZones;return b.concat(L)}),C=O(this,m=>{const b=f.read(m).viewZones.read(m).mod,L=h.read(m).viewZones.read(m).modViewZones;return b.concat(L)});this._register(On(this._editors.original,w,m=>{_=m},c));let v;this._register(On(this._editors.modified,C,m=>{_=m,_?v=Tn.capture(this._editors.modified):(v==null||v.restore(this._editors.modified),v=void 0)},u)),this._accessibleDiffViewer=$e(this,m=>this._instantiationService.createInstance(Ee(bt,m),this.elements.accessibleDiffViewer,this._accessibleDiffViewerVisible,(b,L)=>this._accessibleDiffViewerShouldBeVisible.set(b,L),this._options.onlyShowAccessibleDiffViewer.map(b=>!b),this._rootSizeObserver.width,this._rootSizeObserver.height,this._diffModel.map((b,L)=>{var y;return(y=b==null?void 0:b.diff.read(L))==null?void 0:y.mappings.map(S=>S.lineRangeMapping)}),new Bf(this._editors))).recomputeInitiallyAndOnChange(this._store);const g=this._accessibleDiffViewerVisible.map(m=>m?"hidden":"visible");this._register(gt(this.elements.modified,{visibility:g})),this._register(gt(this.elements.original,{visibility:g})),this._createDiffEditorContributions(),o.addDiffEditor(this),this._gutter=$e(this,m=>this._options.shouldRenderGutterMenu.read(m)?this._instantiationService.createInstance(Ee(go,m),this.elements.root,this._diffModel,this._editors,this._options,this._sashLayout,this._boundarySashes):void 0),this._register(No(this._layoutInfo)),$e(this,m=>new(Ee(ai,m))(this.elements.root,this._diffModel,this._layoutInfo.map(b=>b.originalEditor),this._layoutInfo.map(b=>b.modifiedEditor),this._editors)).recomputeInitiallyAndOnChange(this._store,m=>{this._movedBlocksLinesPart.set(m,void 0)}),this._register(Ri.runAndSubscribe(this._editors.modified.onDidChangeCursorPosition,m=>this._handleCursorPositionChange(m,!0))),this._register(Ri.runAndSubscribe(this._editors.original.onDidChangeCursorPosition,m=>this._handleCursorPositionChange(m,!1)));const p=this._diffModel.map(this,(m,b)=>{if(m)return m.diff.read(b)===void 0&&!m.isDiffUpToDate.read(b)});this._register(ke((m,b)=>{if(p.read(m)===!0){const L=this._editorProgressService.show(!0,1e3);b.add(ye(()=>L.done()))}})),this._register(ke((m,b)=>{b.add(new(Ee(hm,m))(this._editors,this._diffModel,this._options,this))})),this._register(ke((m,b)=>{const L=this._diffModel.read(m);if(L)for(const y of[L.model.original,L.model.modified])b.add(y.onWillDispose(S=>{Oe(new at("TextModel got disposed before DiffEditorWidget model got reset")),this.setModel(null)}))})),this._register(G(m=>{this._options.setModel(this._diffModel.read(m))}))}_createInnerEditor(e,t,i,n){return e.createInstance(En,t,i,n)}_createDiffEditorContributions(){const e=ii.getDiffEditorContributions();for(const t of e)try{this._register(this._instantiationService.createInstance(t.ctor,this))}catch(i){Oe(i)}}get _targetEditor(){return this._editors.modified}getEditorType(){return ns.IDiffEditor}layout(e){this._rootSizeObserver.observe(e)}hasTextFocus(){return this._editors.original.hasTextFocus()||this._editors.modified.hasTextFocus()}saveViewState(){var i;const e=this._editors.original.saveViewState(),t=this._editors.modified.saveViewState();return{original:e,modified:t,modelState:(i=this._diffModel.get())==null?void 0:i.serializeState()}}restoreViewState(e){var t;if(e&&e.original&&e.modified){const i=e;this._editors.original.restoreViewState(i.original),this._editors.modified.restoreViewState(i.modified),i.modelState&&((t=this._diffModel.get())==null||t.restoreSerializedState(i.modelState))}}handleInitialized(){this._editors.original.handleInitialized(),this._editors.modified.handleInitialized()}createViewModel(e){return this._instantiationService.createInstance(co,e,this._options)}getModel(){var e;return((e=this._diffModel.get())==null?void 0:e.model)??null}setModel(e){const t=e?"model"in e?An.create(e).createNewRef(this):An.create(this.createViewModel(e),this):null;this.setDiffModel(t)}setDiffModel(e,t){const i=this._diffModel.get();!e&&i&&this._accessibleDiffViewer.get().close(),this._diffModel.get()!==(e==null?void 0:e.object)&&Ja(t,n=>{var r;const s=e==null?void 0:e.object;te.batchEventsGlobally(n,()=>{this._editors.original.setModel(s?s.model.original:null),this._editors.modified.setModel(s?s.model.modified:null)});const o=(r=this._diffModelSrc.get())==null?void 0:r.createNewRef(this);this._diffModelSrc.set(e==null?void 0:e.createNewRef(this),n),setTimeout(()=>{o==null||o.dispose()},0)})}updateOptions(e){this._options.updateOptions(e)}getContainerDomNode(){return this._domElement}getOriginalEditor(){return this._editors.original}getModifiedEditor(){return this._editors.modified}getLineChanges(){var t;const e=(t=this._diffModel.get())==null?void 0:t.diff.get();return e?vm(e):null}revert(e){const t=this._diffModel.get();!t||!t.isDiffUpToDate.get()||this._editors.modified.executeEdits("diffEditor",[{range:e.modified.toExclusiveRange(),text:t.model.original.getValueInRange(e.original.toExclusiveRange())}])}revertRangeMappings(e){const t=this._diffModel.get();if(!t||!t.isDiffUpToDate.get())return;const i=e.map(n=>({range:n.modifiedRange,text:t.model.original.getValueInRange(n.originalRange)}));this._editors.modified.executeEdits("diffEditor",i)}_goTo(e){this._editors.modified.setPosition(new E(e.lineRangeMapping.modified.startLineNumber,1)),this._editors.modified.revealRangeInCenter(e.lineRangeMapping.modified.toExclusiveRange())}goToDiff(e){var s,o;const t=(o=(s=this._diffModel.get())==null?void 0:s.diff.get())==null?void 0:o.mappings;if(!t||t.length===0)return;const i=this._editors.modified.getPosition().lineNumber;let n;e==="next"?n=t.find(r=>r.lineRangeMapping.modified.startLineNumber>i)??t[0]:n=Ts(t,r=>r.lineRangeMapping.modified.startLineNumber<i)??t[t.length-1],this._goTo(n),n.lineRangeMapping.modified.isEmpty?this._accessibilitySignalService.playSignal(ot.diffLineDeleted,{source:"diffEditor.goToDiff"}):n.lineRangeMapping.original.isEmpty?this._accessibilitySignalService.playSignal(ot.diffLineInserted,{source:"diffEditor.goToDiff"}):n&&this._accessibilitySignalService.playSignal(ot.diffLineModified,{source:"diffEditor.goToDiff"})}revealFirstDiff(){const e=this._diffModel.get();e&&this.waitForDiff().then(()=>{var i;const t=(i=e.diff.get())==null?void 0:i.mappings;!t||t.length===0||this._goTo(t[0])})}accessibleDiffViewerNext(){this._accessibleDiffViewer.get().next()}accessibleDiffViewerPrev(){this._accessibleDiffViewer.get().prev()}async waitForDiff(){const e=this._diffModel.get();e&&await e.waitForDiff()}mapToOtherSide(){var o,r;const e=this._editors.modified.hasWidgetFocus(),t=e?this._editors.modified:this._editors.original,i=e?this._editors.original:this._editors.modified;let n;const s=t.getSelection();if(s){const a=(r=(o=this._diffModel.get())==null?void 0:o.diff.get())==null?void 0:r.mappings.map(l=>e?l.lineRangeMapping.flip():l.lineRangeMapping);if(a){const l=ga(s.getStartPosition(),a),h=ga(s.getEndPosition(),a);n=W.plusRange(l,h)}}return{destination:i,destinationSelection:n}}switchSide(){const{destination:e,destinationSelection:t}=this.mapToOtherSide();e.focus(),t&&e.setSelection(t)}exitCompareMove(){const e=this._diffModel.get();e&&e.movedTextToCompare.set(void 0,void 0)}collapseAllUnchangedRegions(){var t;const e=(t=this._diffModel.get())==null?void 0:t.unchangedRegions.get();e&&ae(i=>{for(const n of e)n.collapseAll(i)})}showAllUnchangedRegions(){var t;const e=(t=this._diffModel.get())==null?void 0:t.unchangedRegions.get();e&&ae(i=>{for(const n of e)n.showAll(i)})}_handleCursorPositionChange(e,t){var i,n;if((e==null?void 0:e.reason)===3){const s=(n=(i=this._diffModel.get())==null?void 0:i.diff.get())==null?void 0:n.mappings.find(o=>t?o.lineRangeMapping.modified.contains(e.position.lineNumber):o.lineRangeMapping.original.contains(e.position.lineNumber));s!=null&&s.lineRangeMapping.modified.isEmpty?this._accessibilitySignalService.playSignal(ot.diffLineDeleted,{source:"diffEditor.cursorPositionChanged"}):s!=null&&s.lineRangeMapping.original.isEmpty?this._accessibilitySignalService.playSignal(ot.diffLineInserted,{source:"diffEditor.cursorPositionChanged"}):s&&this._accessibilitySignalService.playSignal(ot.diffLineModified,{source:"diffEditor.cursorPositionChanged"})}}};ft=pm([Ni(3,Re),Ni(4,ve),Ni(5,Ae),Ni(6,Cd),Ni(7,du)],ft);function vm(d){return d.mappings.map(e=>{const t=e.lineRangeMapping;let i,n,s,o,r=t.innerChanges;return t.original.isEmpty?(i=t.original.startLineNumber-1,n=0,r=void 0):(i=t.original.startLineNumber,n=t.original.endLineNumberExclusive-1),t.modified.isEmpty?(s=t.modified.startLineNumber-1,o=0,r=void 0):(s=t.modified.startLineNumber,o=t.modified.endLineNumberExclusive-1),{originalStartLineNumber:i,originalEndLineNumber:n,modifiedStartLineNumber:s,modifiedEndLineNumber:o,charChanges:r==null?void 0:r.map(a=>({originalStartLineNumber:a.originalRange.startLineNumber,originalStartColumn:a.originalRange.startColumn,originalEndLineNumber:a.originalRange.endLineNumber,originalEndColumn:a.originalRange.endColumn,modifiedStartLineNumber:a.modifiedRange.startLineNumber,modifiedStartColumn:a.modifiedRange.startColumn,modifiedEndLineNumber:a.modifiedRange.endLineNumber,modifiedEndColumn:a.modifiedRange.endColumn}))}})}var Cm=function(d,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(d,e,t,i);else for(var r=d.length-1;r>=0;r--)(o=d[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},Ia=function(d,e){return function(t,i){e(t,i,d)}};class wm{constructor(e,t){this.viewModel=e,this.deltaScrollVertical=t}getId(){return this.viewModel}}let Wn=class extends V{constructor(e,t,i,n,s){super(),this._container=e,this._overflowWidgetsDomNode=t,this._workbenchUIElementFactory=i,this._instantiationService=n,this._viewModel=z(this,void 0),this._collapsed=O(this,a=>{var l;return(l=this._viewModel.read(a))==null?void 0:l.collapsed.read(a)}),this._editorContentHeight=z(this,500),this.contentHeight=O(this,a=>(this._collapsed.read(a)?0:this._editorContentHeight.read(a))+this._outerEditorHeight),this._modifiedContentWidth=z(this,0),this._modifiedWidth=z(this,0),this._originalContentWidth=z(this,0),this._originalWidth=z(this,0),this.maxScroll=O(this,a=>{const l=this._modifiedContentWidth.read(a)-this._modifiedWidth.read(a),h=this._originalContentWidth.read(a)-this._originalWidth.read(a);return l>h?{maxScroll:l,width:this._modifiedWidth.read(a)}:{maxScroll:h,width:this._originalWidth.read(a)}}),this._elements=U("div.multiDiffEntry",[U("div.header@header",[U("div.header-content",[U("div.collapse-button@collapseButton"),U("div.file-path",[U("div.title.modified.show-file-icons@primaryPath",[]),U("div.status.deleted@status",["R"]),U("div.title.original.show-file-icons@secondaryPath",[])]),U("div.actions@actions")])]),U("div.editorParent",[U("div.editorContainer@editor")])]),this.editor=this._register(this._instantiationService.createInstance(ft,this._elements.editor,{overflowWidgetsDomNode:this._overflowWidgetsDomNode},{})),this.isModifedFocused=Zi(this.editor.getModifiedEditor()).isFocused,this.isOriginalFocused=Zi(this.editor.getOriginalEditor()).isFocused,this.isFocused=O(this,a=>this.isModifedFocused.read(a)||this.isOriginalFocused.read(a)),this._resourceLabel=this._workbenchUIElementFactory.createResourceLabel?this._register(this._workbenchUIElementFactory.createResourceLabel(this._elements.primaryPath)):void 0,this._resourceLabel2=this._workbenchUIElementFactory.createResourceLabel?this._register(this._workbenchUIElementFactory.createResourceLabel(this._elements.secondaryPath)):void 0,this._dataStore=this._register(new Ne),this._headerHeight=40,this._lastScrollTop=-1,this._isSettingScrollTop=!1;const o=new sh(this._elements.collapseButton,{});this._register(G(a=>{o.element.className="",o.icon=this._collapsed.read(a)?oe.chevronRight:oe.chevronDown})),this._register(o.onDidClick(()=>{var a;(a=this._viewModel.get())==null||a.collapsed.set(!this._collapsed.get(),void 0)})),this._register(G(a=>{this._elements.editor.style.display=this._collapsed.read(a)?"none":"block"})),this._register(this.editor.getModifiedEditor().onDidLayoutChange(a=>{const l=this.editor.getModifiedEditor().getLayoutInfo().contentWidth;this._modifiedWidth.set(l,void 0)})),this._register(this.editor.getOriginalEditor().onDidLayoutChange(a=>{const l=this.editor.getOriginalEditor().getLayoutInfo().contentWidth;this._originalWidth.set(l,void 0)})),this._register(this.editor.onDidContentSizeChange(a=>{xi(l=>{this._editorContentHeight.set(a.contentHeight,l),this._modifiedContentWidth.set(this.editor.getModifiedEditor().getContentWidth(),l),this._originalContentWidth.set(this.editor.getOriginalEditor().getContentWidth(),l)})})),this._register(this.editor.getOriginalEditor().onDidScrollChange(a=>{if(this._isSettingScrollTop||!a.scrollTopChanged||!this._data)return;const l=a.scrollTop-this._lastScrollTop;this._data.deltaScrollVertical(l)})),this._register(G(a=>{var h;const l=(h=this._viewModel.read(a))==null?void 0:h.isActive.read(a);this._elements.root.classList.toggle("active",l)})),this._container.appendChild(this._elements.root),this._outerEditorHeight=this._headerHeight,this._contextKeyService=this._register(s.createScoped(this._elements.actions));const r=this._register(this._instantiationService.createChild(new hs([Re,this._contextKeyService])));this._register(r.createInstance(wd,this._elements.actions,de.MultiDiffEditorFileToolbar,{actionRunner:this._register(new zd(()=>{var a;return(a=this._viewModel.get())==null?void 0:a.modifiedUri})),menuOptions:{shouldForwardArgs:!0},toolbarOptions:{primaryGroup:a=>a.startsWith("navigation")},actionViewItemProvider:(a,l)=>lu(r,a,l)}))}setScrollLeft(e){this._modifiedContentWidth.get()-this._modifiedWidth.get()>this._originalContentWidth.get()-this._originalWidth.get()?this.editor.getModifiedEditor().setScrollLeft(e):this.editor.getOriginalEditor().setScrollLeft(e)}setData(e){this._data=e;function t(n){return{...n,scrollBeyondLastLine:!1,hideUnchangedRegions:{enabled:!0},scrollbar:{vertical:"hidden",horizontal:"hidden",handleMouseWheel:!1,useShadows:!1},renderOverviewRuler:!1,fixedOverflowWidgets:!0,overviewRulerBorder:!1}}if(!e){xi(n=>{this._viewModel.set(void 0,n),this.editor.setDiffModel(null,n),this._dataStore.clear()});return}const i=e.viewModel.documentDiffItem;if(xi(n=>{var l,h;(l=this._resourceLabel)==null||l.setUri(e.viewModel.modifiedUri??e.viewModel.originalUri,{strikethrough:e.viewModel.modifiedUri===void 0});let s=!1,o=!1,r=!1,a="";e.viewModel.modifiedUri&&e.viewModel.originalUri&&e.viewModel.modifiedUri.path!==e.viewModel.originalUri.path?(a="R",s=!0):e.viewModel.modifiedUri?e.viewModel.originalUri||(a="A",r=!0):(a="D",o=!0),this._elements.status.classList.toggle("renamed",s),this._elements.status.classList.toggle("deleted",o),this._elements.status.classList.toggle("added",r),this._elements.status.innerText=a,(h=this._resourceLabel2)==null||h.setUri(s?e.viewModel.originalUri:void 0,{strikethrough:!0}),this._dataStore.clear(),this._viewModel.set(e.viewModel,n),this.editor.setDiffModel(e.viewModel.diffEditorViewModelRef,n),this.editor.updateOptions(t(i.options??{}))}),i.onOptionsDidChange&&this._dataStore.add(i.onOptionsDidChange(()=>{this.editor.updateOptions(t(i.options??{}))})),e.viewModel.isAlive.recomputeInitiallyAndOnChange(this._dataStore,n=>{n||this.setData(void 0)}),e.viewModel.documentDiffItem.contextKeys)for(const[n,s]of Object.entries(e.viewModel.documentDiffItem.contextKeys))this._contextKeyService.createKey(n,s)}render(e,t,i,n){this._elements.root.style.visibility="visible",this._elements.root.style.top=`${e.start}px`,this._elements.root.style.height=`${e.length}px`,this._elements.root.style.width=`${t}px`,this._elements.root.style.position="absolute";const s=e.length-this._headerHeight,o=Math.max(0,Math.min(n.start-e.start,s));this._elements.header.style.transform=`translateY(${o}px)`,xi(r=>{this.editor.layout({width:t-2*8-2*1,height:e.length-this._outerEditorHeight})});try{this._isSettingScrollTop=!0,this._lastScrollTop=i,this.editor.getOriginalEditor().setScrollTop(i)}finally{this._isSettingScrollTop=!1}this._elements.header.classList.toggle("shadow",o>0||i>0),this._elements.header.classList.toggle("collapsed",o===s)}hide(){this._elements.root.style.top="-100000px",this._elements.root.style.visibility="hidden"}};Wn=Cm([Ia(3,ve),Ia(4,Re)],Wn);class bm{constructor(e){this._create=e,this._unused=new Set,this._used=new Set,this._itemData=new Map}getUnusedObj(e){let t;if(this._unused.size===0)t=this._create(e),this._itemData.set(t,e);else{const i=[...this._unused.values()];t=i.find(n=>this._itemData.get(n).getId()===e.getId())??i[0],this._unused.delete(t),this._itemData.set(t,e),t.setData(e)}return this._used.add(t),{object:t,dispose:()=>{this._used.delete(t),this._unused.size>5?t.dispose():this._unused.add(t)}}}dispose(){for(const e of this._used)e.dispose();for(const e of this._unused)e.dispose();this._used.clear(),this._unused.clear()}}var Lm=function(d,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(d,e,t,i);else for(var r=d.length-1;r>=0;r--)(o=d[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},Oa=function(d,e){return function(t,i){e(t,i,d)}};let wo=class extends V{constructor(e,t,i,n,s,o){super(),this._element=e,this._dimension=t,this._viewModel=i,this._workbenchUIElementFactory=n,this._parentContextKeyService=s,this._parentInstantiationService=o,this._scrollableElements=U("div.scrollContent",[U("div@content",{style:{overflow:"hidden"}}),U("div.monaco-editor@overflowWidgetsDomNode",{})]),this._scrollable=this._register(new oh({forceIntegerValues:!1,scheduleAtNextAnimationFrame:a=>Ui(j(this._element),a),smoothScrollDuration:100})),this._scrollableElement=this._register(new Ka(this._scrollableElements.root,{vertical:1,horizontal:1,useShadows:!1},this._scrollable)),this._elements=U("div.monaco-component.multiDiffEditor",{},[U("div",{},[this._scrollableElement.getDomNode()]),U("div.placeholder@placeholder",{},[U("div",[T("noChangedFiles","No Changed Files")])])]),this._sizeObserver=this._register(new Hd(this._element,void 0)),this._objectPool=this._register(new bm(a=>{const l=this._instantiationService.createInstance(Wn,this._scrollableElements.content,this._scrollableElements.overflowWidgetsDomNode,this._workbenchUIElementFactory);return l.setData(a),l})),this.scrollTop=te(this,this._scrollableElement.onScroll,()=>this._scrollableElement.getScrollPosition().scrollTop),this.scrollLeft=te(this,this._scrollableElement.onScroll,()=>this._scrollableElement.getScrollPosition().scrollLeft),this._viewItemsInfo=fi(this,(a,l)=>{const h=this._viewModel.read(a);if(!h)return{items:[],getItem:f=>{throw new at}};const c=h.items.read(a),u=new Map;return{items:c.map(f=>{var v;const w=l.add(new ym(f,this._objectPool,this.scrollLeft,g=>{this._scrollableElement.setScrollPosition({scrollTop:this._scrollableElement.getScrollPosition().scrollTop+g})})),C=(v=this._lastDocStates)==null?void 0:v[w.getKey()];return C&&ae(g=>{w.setViewState(C,g)}),u.set(f,w),w}),getItem:f=>u.get(f)}}),this._viewItems=this._viewItemsInfo.map(this,a=>a.items),this._spaceBetweenPx=0,this._totalHeight=this._viewItems.map(this,(a,l)=>a.reduce((h,c)=>h+c.contentHeight.read(l)+this._spaceBetweenPx,0)),this._contextKeyService=this._register(this._parentContextKeyService.createScoped(this._element)),this._instantiationService=this._register(this._parentInstantiationService.createChild(new hs([Re,this._contextKeyService]))),this._lastDocStates={},this._contextKeyService.createKey(N.inMultiDiffEditor.key,!0),this._register(ke((a,l)=>{const h=this._viewModel.read(a);if(h&&h.contextKeys)for(const[c,u]of Object.entries(h.contextKeys)){const _=this._contextKeyService.createKey(c,void 0);_.set(u),l.add(ye(()=>_.reset()))}}));const r=this._parentContextKeyService.createKey(N.multiDiffEditorAllCollapsed.key,!1);this._register(G(a=>{const l=this._viewModel.read(a);if(l){const h=l.items.read(a).every(c=>c.collapsed.read(a));r.set(h)}})),this._register(G(a=>{const l=this._dimension.read(a);this._sizeObserver.observe(l)})),this._register(G(a=>{const l=this._viewItems.read(a);this._elements.placeholder.classList.toggle("visible",l.length===0)})),this._scrollableElements.content.style.position="relative",this._register(G(a=>{const l=this._sizeObserver.height.read(a);this._scrollableElements.root.style.height=`${l}px`;const h=this._totalHeight.read(a);this._scrollableElements.content.style.height=`${h}px`;const c=this._sizeObserver.width.read(a);let u=c;const _=this._viewItems.read(a),f=rh(_,Cn(w=>w.maxScroll.read(a).maxScroll,Mo));if(f){const w=f.maxScroll.read(a);u=c+w.maxScroll}this._scrollableElement.setScrollDimensions({width:c,height:l,scrollHeight:h,scrollWidth:u})})),e.replaceChildren(this._elements.root),this._register(ye(()=>{e.replaceChildren()})),this._register(this._register(G(a=>{xi(l=>{this.render(a)})})))}render(e){const t=this.scrollTop.read(e);let i=0,n=0,s=0;const o=this._sizeObserver.height.read(e),r=He.ofStartAndLength(t,o),a=this._sizeObserver.width.read(e);for(const l of this._viewItems.read(e)){const h=l.contentHeight.read(e),c=Math.min(h,o),u=He.ofStartAndLength(n,c),_=He.ofStartAndLength(s,h);if(_.isBefore(r))i-=h-c,l.hide();else if(_.isAfter(r))l.hide();else{const f=Math.max(0,Math.min(r.start-_.start,h-c));i-=f;const w=He.ofStartAndLength(t+i,o);l.render(u,f,a,w)}n+=c+this._spaceBetweenPx,s+=h+this._spaceBetweenPx}this._scrollableElements.content.style.transform=`translateY(${-(t+i)}px)`}};wo=Lm([Oa(4,Re),Oa(5,ve)],wo);class ym extends V{constructor(e,t,i,n){super(),this.viewModel=e,this._objectPool=t,this._scrollLeft=i,this._deltaScrollVertical=n,this._templateRef=this._register(nd(this,void 0)),this.contentHeight=O(this,s=>{var o,r;return((r=(o=this._templateRef.read(s))==null?void 0:o.object.contentHeight)==null?void 0:r.read(s))??this.viewModel.lastTemplateData.read(s).contentHeight}),this.maxScroll=O(this,s=>{var o;return((o=this._templateRef.read(s))==null?void 0:o.object.maxScroll.read(s))??{maxScroll:0,scrollWidth:0}}),this.template=O(this,s=>{var o;return(o=this._templateRef.read(s))==null?void 0:o.object}),this._isHidden=z(this,!1),this._isFocused=O(this,s=>{var o;return((o=this.template.read(s))==null?void 0:o.isFocused.read(s))??!1}),this.viewModel.setIsFocused(this._isFocused,void 0),this._register(G(s=>{var r;const o=this._scrollLeft.read(s);(r=this._templateRef.read(s))==null||r.object.setScrollLeft(o)})),this._register(G(s=>{const o=this._templateRef.read(s);!o||!this._isHidden.read(s)||o.object.isFocused.read(s)||this._clear()}))}dispose(){this._clear(),super.dispose()}toString(){var e;return`VirtualViewItem(${(e=this.viewModel.documentDiffItem.modified)==null?void 0:e.uri.toString()})`}getKey(){return this.viewModel.getKey()}setViewState(e,t){var o;this.viewModel.collapsed.set(e.collapsed,t),this._updateTemplateData(t);const i=this.viewModel.lastTemplateData.get(),n=(o=e.selections)==null?void 0:o.map(Me.liftSelection);this.viewModel.lastTemplateData.set({...i,selections:n},t);const s=this._templateRef.get();s&&n&&s.object.editor.setSelections(n)}_updateTemplateData(e){const t=this._templateRef.get();t&&this.viewModel.lastTemplateData.set({contentHeight:t.object.contentHeight.get(),selections:t.object.editor.getSelections()??void 0},e)}_clear(){const e=this._templateRef.get();e&&ae(t=>{this._updateTemplateData(t),e.object.hide(),this._templateRef.set(void 0,t)})}hide(){this._isHidden.set(!0,void 0)}render(e,t,i,n){this._isHidden.set(!1,void 0);let s=this._templateRef.get();if(!s){s=this._objectPool.getUnusedObj(new wm(this.viewModel,this._deltaScrollVertical)),this._templateRef.set(s,void 0);const o=this.viewModel.lastTemplateData.get().selections;o&&s.object.editor.setSelections(o)}s.object.render(e,i,t,n)}}mi("multiDiffEditor.headerBackground",{dark:"#262626",light:"tab.inactiveBackground",hcDark:"tab.inactiveBackground",hcLight:"tab.inactiveBackground"},T("multiDiffEditor.headerBackground","The background color of the diff editor's header"));mi("multiDiffEditor.background",hu,T("multiDiffEditor.background","The background color of the multi file diff editor"));mi("multiDiffEditor.border",{dark:"sideBarSectionHeader.border",light:"#cccccc",hcDark:"sideBarSectionHeader.border",hcLight:"#cccccc"},T("multiDiffEditor.border","The border color of the multi file diff editor"));var Sm=function(d,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(d,e,t,i);else for(var r=d.length-1;r>=0;r--)(o=d[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},Dm=function(d,e){return function(t,i){e(t,i,d)}};let Aa=class extends V{constructor(e,t,i){super(),this._element=e,this._workbenchUIElementFactory=t,this._instantiationService=i,this._dimension=z(this,void 0),this._viewModel=z(this,void 0),this._widgetImpl=fi(this,(n,s)=>(Ee(Wn,n),s.add(this._instantiationService.createInstance(Ee(wo,n),this._element,this._dimension,this._viewModel,this._workbenchUIElementFactory)))),this._register(No(this._widgetImpl))}};Aa=Sm([Dm(2,ve)],Aa);function Pa(d){return d&&typeof d.getEditorType=="function"?d.getEditorType()===ns.ICodeEditor:!1}function Nm(d){return d&&typeof d.getEditorType=="function"?d.getEditorType()===ns.IDiffEditor:!1}function Mm(d){return!!d&&typeof d=="object"&&typeof d.onDidChangeActiveEditor=="function"}function y_(d){return Pa(d)?d:Nm(d)?d.getModifiedEditor():Mm(d)&&Pa(d.activeCodeEditor)?d.activeCodeEditor:null}class Rm extends It{constructor(){super({id:"diffEditor.toggleCollapseUnchangedRegions",title:Pe("toggleCollapseUnchangedRegions","Toggle Collapse Unchanged Regions"),icon:oe.map,toggled:ee.has("config.diffEditor.hideUnchangedRegions.enabled"),precondition:ee.has("isInDiffEditor"),menu:{when:ee.has("isInDiffEditor"),id:de.EditorTitle,order:22,group:"navigation"}})}run(e,...t){const i=e.get(ds),n=!i.getValue("diffEditor.hideUnchangedRegions.enabled");i.updateValue("diffEditor.hideUnchangedRegions.enabled",n)}}class Gd extends It{constructor(){super({id:"diffEditor.toggleShowMovedCodeBlocks",title:Pe("toggleShowMovedCodeBlocks","Toggle Show Moved Code Blocks"),precondition:ee.has("isInDiffEditor")})}run(e,...t){const i=e.get(ds),n=!i.getValue("diffEditor.experimental.showMoves");i.updateValue("diffEditor.experimental.showMoves",n)}}class jd extends It{constructor(){super({id:"diffEditor.toggleUseInlineViewWhenSpaceIsLimited",title:Pe("toggleUseInlineViewWhenSpaceIsLimited","Toggle Use Inline View When Space Is Limited"),precondition:ee.has("isInDiffEditor")})}run(e,...t){const i=e.get(ds),n=!i.getValue("diffEditor.useInlineViewWhenSpaceIsLimited");i.updateValue("diffEditor.useInlineViewWhenSpaceIsLimited",n)}}const tn=Pe("diffEditor","Diff Editor");class xm extends us{constructor(){super({id:"diffEditor.switchSide",title:Pe("switchSide","Switch Side"),icon:oe.arrowSwap,precondition:ee.has("isInDiffEditor"),f1:!0,category:tn})}runEditorCommand(e,t,i){const n=pi(e);if(n instanceof ft){if(i&&i.dryRun)return{destinationSelection:n.mapToOtherSide().destinationSelection};n.switchSide()}}}class Em extends us{constructor(){super({id:"diffEditor.exitCompareMove",title:Pe("exitCompareMove","Exit Compare Move"),icon:oe.close,precondition:N.comparingMovedCode,f1:!1,category:tn,keybinding:{weight:1e4,primary:9}})}runEditorCommand(e,t,...i){const n=pi(e);n instanceof ft&&n.exitCompareMove()}}class Tm extends us{constructor(){super({id:"diffEditor.collapseAllUnchangedRegions",title:Pe("collapseAllUnchangedRegions","Collapse All Unchanged Regions"),icon:oe.fold,precondition:ee.has("isInDiffEditor"),f1:!0,category:tn})}runEditorCommand(e,t,...i){const n=pi(e);n instanceof ft&&n.collapseAllUnchangedRegions()}}class Im extends us{constructor(){super({id:"diffEditor.showAllUnchangedRegions",title:Pe("showAllUnchangedRegions","Show All Unchanged Regions"),icon:oe.unfold,precondition:ee.has("isInDiffEditor"),f1:!0,category:tn})}runEditorCommand(e,t,...i){const n=pi(e);n instanceof ft&&n.showAllUnchangedRegions()}}class bo extends It{constructor(){super({id:"diffEditor.revert",title:Pe("revert","Revert"),f1:!1,category:tn})}run(e,t){const i=Om(e,t.originalUri,t.modifiedUri);i instanceof ft&&i.revertRangeMappings(t.mapping.innerChanges??[])}}const Zd=Pe("accessibleDiffViewer","Accessible Diff Viewer"),Yn=class Yn extends It{constructor(){super({id:Yn.id,title:Pe("editor.action.accessibleDiffViewer.next","Go to Next Difference"),category:Zd,precondition:ee.has("isInDiffEditor"),keybinding:{primary:65,weight:100},f1:!0})}run(e){const t=pi(e);t==null||t.accessibleDiffViewerNext()}};Yn.id="editor.action.accessibleDiffViewer.next";let qi=Yn;const Qn=class Qn extends It{constructor(){super({id:Qn.id,title:Pe("editor.action.accessibleDiffViewer.prev","Go to Previous Difference"),category:Zd,precondition:ee.has("isInDiffEditor"),keybinding:{primary:1089,weight:100},f1:!0})}run(e){const t=pi(e);t==null||t.accessibleDiffViewerPrev()}};Qn.id="editor.action.accessibleDiffViewer.prev";let Hn=Qn;function Om(d,e,t){return d.get(Ae).listDiffEditors().find(s=>{var a,l;const o=s.getModifiedEditor(),r=s.getOriginalEditor();return o&&((a=o.getModel())==null?void 0:a.uri.toString())===t.toString()&&r&&((l=r.getModel())==null?void 0:l.uri.toString())===e.toString()})||null}function pi(d){const t=d.get(Ae).listDiffEditors(),i=xt();if(i)for(const n of t){const s=n.getContainerDomNode();if(Am(s,i))return n}return null}function Am(d,e){let t=e;for(;t;){if(t===d)return!0;t=t.parentElement}return!1}je(Rm);je(Gd);je(jd);ci.appendMenuItem(de.EditorTitle,{command:{id:new jd().desc.id,title:T("useInlineViewWhenSpaceIsLimited","Use Inline View When Space Is Limited"),toggled:ee.has("config.diffEditor.useInlineViewWhenSpaceIsLimited"),precondition:ee.has("isInDiffEditor")},order:11,group:"1_diff",when:ee.and(N.diffEditorRenderSideBySideInlineBreakpointReached,ee.has("isInDiffEditor"))});ci.appendMenuItem(de.EditorTitle,{command:{id:new Gd().desc.id,title:T("showMoves","Show Moved Code Blocks"),icon:oe.move,toggled:cu.create("config.diffEditor.experimental.showMoves",!0),precondition:ee.has("isInDiffEditor")},order:10,group:"1_diff",when:ee.has("isInDiffEditor")});je(bo);for(const d of[{icon:oe.arrowRight,key:N.diffEditorInlineMode.toNegated()},{icon:oe.discard,key:N.diffEditorInlineMode}])ci.appendMenuItem(de.DiffEditorHunkToolbar,{command:{id:new bo().desc.id,title:T("revertHunk","Revert Block"),icon:d.icon},when:ee.and(N.diffEditorModifiedWritable,d.key),order:5,group:"primary"}),ci.appendMenuItem(de.DiffEditorSelectionToolbar,{command:{id:new bo().desc.id,title:T("revertSelection","Revert Selection"),icon:d.icon},when:ee.and(N.diffEditorModifiedWritable,d.key),order:5,group:"primary"});je(xm);je(Em);je(Tm);je(Im);ci.appendMenuItem(de.EditorTitle,{command:{id:qi.id,title:T("Open Accessible Diff Viewer","Open Accessible Diff Viewer"),precondition:ee.has("isInDiffEditor")},order:10,group:"2_diff",when:ee.and(N.accessibleDiffViewerVisible.negate(),ee.has("isInDiffEditor"))});os.registerCommandAlias("editor.action.diffReview.next",qi.id);je(qi);os.registerCommandAlias("editor.action.diffReview.prev",Hn.id);je(Hn);function Pm(d){const e=new ah;for(const t of d.items){const i=t.type;if(t.kind==="string"){const n=new Promise(s=>t.getAsString(s));e.append(i,sd(n))}else if(t.kind==="file"){const n=t.getAsFile();n&&e.append(i,Wm(n))}}return e}function Wm(d){const e=d.path?it.parse(d.path):void 0;return lh(d.name,e,async()=>new Uint8Array(await d.arrayBuffer()))}const Hm=Object.freeze([Pr.EDITORS,Pr.FILES,Os.RESOURCES,Os.INTERNAL_URI_LIST]);function S_(d,e=!1){const t=Pm(d),i=t.get(Os.INTERNAL_URI_LIST);if(i)t.replace(Oi.uriList,i);else if(e||!t.has(Oi.uriList)){const n=[];for(const s of d.items){const o=s.getAsFile();if(o){const r=o.path;try{r?n.push(it.file(r).toString()):n.push(it.parse(o.name,!0).toString())}catch{}}}n.length&&t.replace(Oi.uriList,sd(dh.create(n)))}for(const n of Hm)t.delete(n);return t}var km=function(d,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(d,e,t,i);else for(var r=d.length-1;r>=0;r--)(o=d[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},Ye=function(d,e){return function(t,i){e(t,i,d)}};let Wa=class extends En{constructor(e,t,i,n,s,o,r,a,l,h,c,u,_){super(e,{...n.getRawOptions(),overflowWidgetsDomNode:n.getOverflowWidgetsDomNode()},i,s,o,r,a,l,h,c,u,_),this._parentEditor=n,this._overwriteOptions=t,super.updateOptions(this._overwriteOptions),this._register(n.onDidChangeConfiguration(f=>this._onParentConfigurationChanged(f)))}getParentEditor(){return this._parentEditor}_onParentConfigurationChanged(e){super.updateOptions(this._parentEditor.getRawOptions()),super.updateOptions(this._overwriteOptions)}updateOptions(e){hh(this._overwriteOptions,e,!0),super.updateOptions(this._overwriteOptions)}};Wa=km([Ye(4,ve),Ye(5,Ae),Ye(6,ls),Ye(7,Re),Ye(8,rs),Ye(9,vd),Ye(10,Ot),Ye(11,xo),Ye(12,Eo)],Wa);export{Nm as $,Vr as A,om as B,En as C,ft as D,kr as E,Wr as F,ea as G,__ as H,Ae as I,ro as J,_a as K,Fd as L,Aa as M,ma as N,$r as O,Gf as P,zf as Q,Dd as R,Tn as S,jf as T,$f as U,Ca as V,ii as W,gt as X,Ei as Y,Ed as Z,Sn as _,ni as a,_o as a0,d_ as a1,y_ as a2,e_ as b,Ws as c,ui as d,A as e,Gm as f,Fo as g,S_ as h,Pa as i,Qr as j,Vo as k,Nn as l,hg as m,jr as n,Sd as o,$m as p,ks as q,_u as r,Wa as s,Pm as t,us as u,jm as v,zm as w,Zm as x,le as y,Zi as z};
//# sourceMappingURL=monaco-editor-editor-browser-H6PfZ53L.js.map
