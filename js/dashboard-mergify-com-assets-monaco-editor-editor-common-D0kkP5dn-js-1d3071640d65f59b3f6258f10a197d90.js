import{$ as Ph,ci as Ah,M as g,l as Cs,n as xt,cj as bs,at as wi,b as J,t as tn,D as oe,bu as A,U as ot,af as Dh,ck as Oh,cl as Bh,cm as oc,aL as Ne,cn as ac,co as _i,cp as Vh,p as Tt,aN as Cn,cq as ha,cr as ke,b7 as da,b8 as lc,cs as Br,ct as uc,cu as Vr,cv as ar,cw as yo,b3 as he,cx as fa,cy as Wr,cz as Pn,cA as Si,cB as Ro,cC as Wh,bd as Ve,be as on,bE as Fh,cD as zh,cE as Fr,cF as Hh,bQ as Ot,cG as jh,cH as cc,bR as us,cI as Uh,bD as qh,h as fe,cJ as Gh,cK as un,cL as Ks,B as er,cM as $h,bl as zr,q as tr,cN as Qh,y as ga,cO as Zh,cP as Xh,V as hc,cQ as dc,cR as Jh,cS as lr,cT as Yh,ak as Kh,cU as ed,cV as td,cW as nd,S as Ge,cX as An,cY as id,cZ as sd,c_ as rd,A as fc,c$ as od,f as ad,bK as ld,E as gc,d0 as In,R as ud,d1 as cd,d2 as hd,ba as Bi,d3 as dd,d4 as ma,d5 as fd,b5 as ki,d6 as ei,aK as Ls,d7 as Ze,d8 as gd,d9 as Xe,x as md,da as pa,db as Ca,bt as pd,dc as vi,dd as mc,de as Cd,df as bd,dg as Ld,aA as pc,bh as wd,j as _d,dh as Cc,di as Sd,dj as kd,dk as vd,O as ba,dl as Id,dm as Nd,dn as bc,dp as xd,dq as Hi,dr as ji,ds as cn,aj as Td,ad as La,b0 as ur,b2 as Ed,b1 as yd,dt as Rd,du as Md,dv as Pd,dw as Ad,aI as Dd,aJ as Od,c9 as Bd,a$ as Vd,bz as Wd,dx as Fd}from"./monaco-editor-base-CbpQQOWn.js";import{n as ze,R as nr,aT as Mo,r as Vi,d as Lc,s as Po,Y as zd,a as wc,aG as R,aU as ws,aV as Dn,aW as wa,f as _c,aX as _a,aB as Hr,aY as Sa,aC as ka,aZ as Hd,ao as Sc,_ as jd,a_ as zn,a$ as hn,b0 as Ud,b1 as qd,b2 as Gd,b3 as kc,c as vc,b4 as W,b5 as Ui}from"./monaco-editor-platform-D3l4KW_b.js";import{_ as $d}from"./@tanstack-D9TvfXfY.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};s.SENTRY_RELEASE={id:"1a852bb1435e099912e47361ac6ea11c1a9da234"}}catch{}})();try{(function(){var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},e=new s.Error().stack;e&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[e]="4b37874e-e6eb-4239-8b49-e9402a0574cf",s._sentryDebugIdIdentifier="sentry-dbid-4b37874e-e6eb-4239-8b49-e9402a0574cf")})()}catch{}const ve={tabSize:4,indentSize:4,insertSpaces:!0,detectIndentation:!0,trimAutoWhitespace:!0,largeFileOptimizations:!0,bracketPairColorizationOptions:{enabled:!0,independentColorPoolPerBracketType:!1}},Ic="`~!@#$%^&*()-=+[{]}\\|;:'\",.<>/?";function Qd(s=""){let e="(-?\\d*\\.\\d\\w*)|([^";for(const t of Ic)s.indexOf(t)>=0||(e+="\\"+t);return e+="\\s]+)",new RegExp(e,"g")}const Ao=Qd();function Do(s){let e=Ao;if(s&&s instanceof RegExp)if(s.global)e=s;else{let t="g";s.ignoreCase&&(t+="i"),s.multiline&&(t+="m"),s.unicode&&(t+="u"),e=new RegExp(s.source,t)}return e.lastIndex=0,e}const Nc=new Ph;Nc.unshift({maxLen:1e3,windowSize:15,timeBudget:150});function Ii(s,e,t,n,i){if(e=Do(e),i||(i=Ah.first(Nc)),t.length>i.maxLen){let u=s-i.maxLen/2;return u<0?u=0:n+=u,t=t.substring(u,s+i.maxLen/2),Ii(s,e,t,n,i)}const r=Date.now(),o=s-1-n;let a=-1,l=null;for(let u=1;!(Date.now()-r>=i.timeBudget);u++){const c=o-i.windowSize*u;e.lastIndex=Math.max(0,c);const h=Zd(e,t,o,a);if(!h&&l||(l=h,c<=0))break;a=c}if(l){const u={word:l[0],startColumn:n+1+l.index,endColumn:n+1+l.index+l[0].length};return e.lastIndex=0,u}return null}function Zd(s,e,t,n){let i;for(;i=s.exec(e);){const r=i.index||0;if(r<=t&&s.lastIndex>=t)return i;if(n>0&&r>n)return null}return null}const Xd=8;class ew{constructor(e){this._values=e}hasChanged(e){return this._values[e]}}class Jd{constructor(){this.stableMinimapLayoutInput=null,this.stableFitMaxMinimapScale=0,this.stableFitRemainingWidth=0}}class K{constructor(e,t,n,i){this.id=e,this.name=t,this.defaultValue=n,this.schema=i}applyUpdate(e,t){return ir(e,t)}compute(e,t,n){return n}}class cs{constructor(e,t){this.newValue=e,this.didChange=t}}function ir(s,e){if(typeof s!="object"||typeof e!="object"||!s||!e)return new cs(e,s!==e);if(Array.isArray(s)||Array.isArray(e)){const n=Array.isArray(s)&&Array.isArray(e)&&wi(s,e);return new cs(e,!n)}let t=!1;for(const n in e)if(e.hasOwnProperty(n)){const i=ir(s[n],e[n]);i.didChange&&(s[n]=i.newValue,t=!0)}return new cs(s,t)}class Wi{constructor(e){this.schema=void 0,this.id=e,this.name="_never_",this.defaultValue=void 0}applyUpdate(e,t){return ir(e,t)}validate(e){return this.defaultValue}}class Wn{constructor(e,t,n,i){this.id=e,this.name=t,this.defaultValue=n,this.schema=i}applyUpdate(e,t){return ir(e,t)}validate(e){return typeof e>"u"?this.defaultValue:e}compute(e,t,n){return n}}function y(s,e){return typeof s>"u"?e:s==="false"?!1:!!s}class F extends Wn{constructor(e,t,n,i=void 0){typeof i<"u"&&(i.type="boolean",i.default=n),super(e,t,n,i)}validate(e){return y(e,this.defaultValue)}}function Yd(s,e,t,n){if(typeof s>"u")return e;let i=parseInt(s,10);return isNaN(i)?e:(i=Math.max(t,i),i=Math.min(n,i),i|0)}class G extends Wn{static clampedInt(e,t,n,i){return Yd(e,t,n,i)}constructor(e,t,n,i,r,o=void 0){typeof o<"u"&&(o.type="integer",o.default=n,o.minimum=i,o.maximum=r),super(e,t,n,o),this.minimum=i,this.maximum=r}validate(e){return G.clampedInt(e,this.defaultValue,this.minimum,this.maximum)}}function tw(s,e,t,n){if(typeof s>"u")return e;const i=Ae.float(s,e);return Ae.clamp(i,t,n)}class Ae extends Wn{static clamp(e,t,n){return e<t?t:e>n?n:e}static float(e,t){if(typeof e=="number")return e;if(typeof e>"u")return t;const n=parseFloat(e);return isNaN(n)?t:n}constructor(e,t,n,i,r){typeof r<"u"&&(r.type="number",r.default=n),super(e,t,n,r),this.validationFn=i}validate(e){return this.validationFn(Ae.float(e,this.defaultValue))}}class Ie extends Wn{static string(e,t){return typeof e!="string"?t:e}constructor(e,t,n,i=void 0){typeof i<"u"&&(i.type="string",i.default=n),super(e,t,n,i)}validate(e){return Ie.string(e,this.defaultValue)}}function re(s,e,t,n){return typeof s!="string"?e:n&&s in n?n[s]:t.indexOf(s)===-1?e:s}class te extends Wn{constructor(e,t,n,i,r=void 0){typeof r<"u"&&(r.type="string",r.enum=i,r.default=n),super(e,t,n,r),this._allowedValues=i}validate(e){return re(e,this.defaultValue,this._allowedValues)}}class qi extends K{constructor(e,t,n,i,r,o,a=void 0){typeof a<"u"&&(a.type="string",a.enum=r,a.default=i),super(e,t,n,a),this._allowedValues=r,this._convert=o}validate(e){return typeof e!="string"?this.defaultValue:this._allowedValues.indexOf(e)===-1?this.defaultValue:this._convert(e)}}function Kd(s){switch(s){case"none":return 0;case"keep":return 1;case"brackets":return 2;case"advanced":return 3;case"full":return 4}}class ef extends K{constructor(){super(2,"accessibilitySupport",0,{type:"string",enum:["auto","on","off"],enumDescriptions:[g("accessibilitySupport.auto","Use platform APIs to detect when a Screen Reader is attached."),g("accessibilitySupport.on","Optimize for usage with a Screen Reader."),g("accessibilitySupport.off","Assume a screen reader is not attached.")],default:"auto",tags:["accessibility"],description:g("accessibilitySupport","Controls if the UI should run in a mode where it is optimized for screen readers.")})}validate(e){switch(e){case"auto":return 0;case"off":return 1;case"on":return 2}return this.defaultValue}compute(e,t,n){return n===0?e.accessibilitySupport:n}}class tf extends K{constructor(){const e={insertSpace:!0,ignoreEmptyLines:!0};super(23,"comments",e,{"editor.comments.insertSpace":{type:"boolean",default:e.insertSpace,description:g("comments.insertSpace","Controls whether a space character is inserted when commenting.")},"editor.comments.ignoreEmptyLines":{type:"boolean",default:e.ignoreEmptyLines,description:g("comments.ignoreEmptyLines","Controls if empty lines should be ignored with toggle, add or remove actions for line comments.")}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{insertSpace:y(t.insertSpace,this.defaultValue.insertSpace),ignoreEmptyLines:y(t.ignoreEmptyLines,this.defaultValue.ignoreEmptyLines)}}}function nf(s){switch(s){case"blink":return 1;case"smooth":return 2;case"phase":return 3;case"expand":return 4;case"solid":return 5}}var Lt;(function(s){s[s.Line=1]="Line",s[s.Block=2]="Block",s[s.Underline=3]="Underline",s[s.LineThin=4]="LineThin",s[s.BlockOutline=5]="BlockOutline",s[s.UnderlineThin=6]="UnderlineThin"})(Lt||(Lt={}));function sf(s){switch(s){case"line":return Lt.Line;case"block":return Lt.Block;case"underline":return Lt.Underline;case"line-thin":return Lt.LineThin;case"block-outline":return Lt.BlockOutline;case"underline-thin":return Lt.UnderlineThin}}class rf extends Wi{constructor(){super(143)}compute(e,t,n){const i=["monaco-editor"];return t.get(39)&&i.push(t.get(39)),e.extraEditorClassName&&i.push(e.extraEditorClassName),t.get(74)==="default"?i.push("mouse-default"):t.get(74)==="copy"&&i.push("mouse-copy"),t.get(112)&&i.push("showUnused"),t.get(141)&&i.push("showDeprecated"),i.join(" ")}}class of extends F{constructor(){super(37,"emptySelectionClipboard",!0,{description:g("emptySelectionClipboard","Controls whether copying without a selection copies the current line.")})}compute(e,t,n){return n&&e.emptySelectionClipboard}}class af extends K{constructor(){const e={cursorMoveOnType:!0,seedSearchStringFromSelection:"always",autoFindInSelection:"never",globalFindClipboard:!1,addExtraSpaceOnTop:!0,loop:!0};super(41,"find",e,{"editor.find.cursorMoveOnType":{type:"boolean",default:e.cursorMoveOnType,description:g("find.cursorMoveOnType","Controls whether the cursor should jump to find matches while typing.")},"editor.find.seedSearchStringFromSelection":{type:"string",enum:["never","always","selection"],default:e.seedSearchStringFromSelection,enumDescriptions:[g("editor.find.seedSearchStringFromSelection.never","Never seed search string from the editor selection."),g("editor.find.seedSearchStringFromSelection.always","Always seed search string from the editor selection, including word at cursor position."),g("editor.find.seedSearchStringFromSelection.selection","Only seed search string from the editor selection.")],description:g("find.seedSearchStringFromSelection","Controls whether the search string in the Find Widget is seeded from the editor selection.")},"editor.find.autoFindInSelection":{type:"string",enum:["never","always","multiline"],default:e.autoFindInSelection,enumDescriptions:[g("editor.find.autoFindInSelection.never","Never turn on Find in Selection automatically (default)."),g("editor.find.autoFindInSelection.always","Always turn on Find in Selection automatically."),g("editor.find.autoFindInSelection.multiline","Turn on Find in Selection automatically when multiple lines of content are selected.")],description:g("find.autoFindInSelection","Controls the condition for turning on Find in Selection automatically.")},"editor.find.globalFindClipboard":{type:"boolean",default:e.globalFindClipboard,description:g("find.globalFindClipboard","Controls whether the Find Widget should read or modify the shared find clipboard on macOS."),included:xt},"editor.find.addExtraSpaceOnTop":{type:"boolean",default:e.addExtraSpaceOnTop,description:g("find.addExtraSpaceOnTop","Controls whether the Find Widget should add extra lines on top of the editor. When true, you can scroll beyond the first line when the Find Widget is visible.")},"editor.find.loop":{type:"boolean",default:e.loop,description:g("find.loop","Controls whether the search automatically restarts from the beginning (or the end) when no further matches can be found.")}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{cursorMoveOnType:y(t.cursorMoveOnType,this.defaultValue.cursorMoveOnType),seedSearchStringFromSelection:typeof e.seedSearchStringFromSelection=="boolean"?e.seedSearchStringFromSelection?"always":"never":re(t.seedSearchStringFromSelection,this.defaultValue.seedSearchStringFromSelection,["never","always","selection"]),autoFindInSelection:typeof e.autoFindInSelection=="boolean"?e.autoFindInSelection?"always":"never":re(t.autoFindInSelection,this.defaultValue.autoFindInSelection,["never","always","multiline"]),globalFindClipboard:y(t.globalFindClipboard,this.defaultValue.globalFindClipboard),addExtraSpaceOnTop:y(t.addExtraSpaceOnTop,this.defaultValue.addExtraSpaceOnTop),loop:y(t.loop,this.defaultValue.loop)}}}const mt=class mt extends K{constructor(){super(51,"fontLigatures",mt.OFF,{anyOf:[{type:"boolean",description:g("fontLigatures","Enables/Disables font ligatures ('calt' and 'liga' font features). Change this to a string for fine-grained control of the 'font-feature-settings' CSS property.")},{type:"string",description:g("fontFeatureSettings","Explicit 'font-feature-settings' CSS property. A boolean can be passed instead if one only needs to turn on/off ligatures.")}],description:g("fontLigaturesGeneral","Configures font ligatures or font features. Can be either a boolean to enable/disable ligatures or a string for the value of the CSS 'font-feature-settings' property."),default:!1})}validate(e){return typeof e>"u"?this.defaultValue:typeof e=="string"?e==="false"||e.length===0?mt.OFF:e==="true"?mt.ON:e:e?mt.ON:mt.OFF}};mt.OFF='"liga" off, "calt" off',mt.ON='"liga" on, "calt" on';let jr=mt;const pt=class pt extends K{constructor(){super(54,"fontVariations",pt.OFF,{anyOf:[{type:"boolean",description:g("fontVariations","Enables/Disables the translation from font-weight to font-variation-settings. Change this to a string for fine-grained control of the 'font-variation-settings' CSS property.")},{type:"string",description:g("fontVariationSettings","Explicit 'font-variation-settings' CSS property. A boolean can be passed instead if one only needs to translate font-weight to font-variation-settings.")}],description:g("fontVariationsGeneral","Configures font variations. Can be either a boolean to enable/disable the translation from font-weight to font-variation-settings or a string for the value of the CSS 'font-variation-settings' property."),default:!1})}validate(e){return typeof e>"u"?this.defaultValue:typeof e=="string"?e==="false"?pt.OFF:e==="true"?pt.TRANSLATE:e:e?pt.TRANSLATE:pt.OFF}compute(e,t,n){return e.fontInfo.fontVariationSettings}};pt.OFF="normal",pt.TRANSLATE="translate";let Ni=pt;class lf extends Wi{constructor(){super(50)}compute(e,t,n){return e.fontInfo}}class uf extends Wn{constructor(){super(52,"fontSize",We.fontSize,{type:"number",minimum:6,maximum:100,default:We.fontSize,description:g("fontSize","Controls the font size in pixels.")})}validate(e){const t=Ae.float(e,this.defaultValue);return t===0?We.fontSize:Ae.clamp(t,6,100)}compute(e,t,n){return e.fontInfo.fontSize}}const nt=class nt extends K{constructor(){super(53,"fontWeight",We.fontWeight,{anyOf:[{type:"number",minimum:nt.MINIMUM_VALUE,maximum:nt.MAXIMUM_VALUE,errorMessage:g("fontWeightErrorMessage",'Only "normal" and "bold" keywords or numbers between 1 and 1000 are allowed.')},{type:"string",pattern:"^(normal|bold|1000|[1-9][0-9]{0,2})$"},{enum:nt.SUGGESTION_VALUES}],default:We.fontWeight,description:g("fontWeight",'Controls the font weight. Accepts "normal" and "bold" keywords or numbers between 1 and 1000.')})}validate(e){return e==="normal"||e==="bold"?e:String(G.clampedInt(e,We.fontWeight,nt.MINIMUM_VALUE,nt.MAXIMUM_VALUE))}};nt.SUGGESTION_VALUES=["normal","bold","100","200","300","400","500","600","700","800","900"],nt.MINIMUM_VALUE=1,nt.MAXIMUM_VALUE=1e3;let Ur=nt;class cf extends K{constructor(){const e={multiple:"peek",multipleDefinitions:"peek",multipleTypeDefinitions:"peek",multipleDeclarations:"peek",multipleImplementations:"peek",multipleReferences:"peek",multipleTests:"peek",alternativeDefinitionCommand:"editor.action.goToReferences",alternativeTypeDefinitionCommand:"editor.action.goToReferences",alternativeDeclarationCommand:"editor.action.goToReferences",alternativeImplementationCommand:"",alternativeReferenceCommand:"",alternativeTestsCommand:""},t={type:"string",enum:["peek","gotoAndPeek","goto"],default:e.multiple,enumDescriptions:[g("editor.gotoLocation.multiple.peek","Show Peek view of the results (default)"),g("editor.gotoLocation.multiple.gotoAndPeek","Go to the primary result and show a Peek view"),g("editor.gotoLocation.multiple.goto","Go to the primary result and enable Peek-less navigation to others")]},n=["","editor.action.referenceSearch.trigger","editor.action.goToReferences","editor.action.peekImplementation","editor.action.goToImplementation","editor.action.peekTypeDefinition","editor.action.goToTypeDefinition","editor.action.peekDeclaration","editor.action.revealDeclaration","editor.action.peekDefinition","editor.action.revealDefinitionAside","editor.action.revealDefinition"];super(58,"gotoLocation",e,{"editor.gotoLocation.multiple":{deprecationMessage:g("editor.gotoLocation.multiple.deprecated","This setting is deprecated, please use separate settings like 'editor.editor.gotoLocation.multipleDefinitions' or 'editor.editor.gotoLocation.multipleImplementations' instead.")},"editor.gotoLocation.multipleDefinitions":{description:g("editor.editor.gotoLocation.multipleDefinitions","Controls the behavior the 'Go to Definition'-command when multiple target locations exist."),...t},"editor.gotoLocation.multipleTypeDefinitions":{description:g("editor.editor.gotoLocation.multipleTypeDefinitions","Controls the behavior the 'Go to Type Definition'-command when multiple target locations exist."),...t},"editor.gotoLocation.multipleDeclarations":{description:g("editor.editor.gotoLocation.multipleDeclarations","Controls the behavior the 'Go to Declaration'-command when multiple target locations exist."),...t},"editor.gotoLocation.multipleImplementations":{description:g("editor.editor.gotoLocation.multipleImplemenattions","Controls the behavior the 'Go to Implementations'-command when multiple target locations exist."),...t},"editor.gotoLocation.multipleReferences":{description:g("editor.editor.gotoLocation.multipleReferences","Controls the behavior the 'Go to References'-command when multiple target locations exist."),...t},"editor.gotoLocation.alternativeDefinitionCommand":{type:"string",default:e.alternativeDefinitionCommand,enum:n,description:g("alternativeDefinitionCommand","Alternative command id that is being executed when the result of 'Go to Definition' is the current location.")},"editor.gotoLocation.alternativeTypeDefinitionCommand":{type:"string",default:e.alternativeTypeDefinitionCommand,enum:n,description:g("alternativeTypeDefinitionCommand","Alternative command id that is being executed when the result of 'Go to Type Definition' is the current location.")},"editor.gotoLocation.alternativeDeclarationCommand":{type:"string",default:e.alternativeDeclarationCommand,enum:n,description:g("alternativeDeclarationCommand","Alternative command id that is being executed when the result of 'Go to Declaration' is the current location.")},"editor.gotoLocation.alternativeImplementationCommand":{type:"string",default:e.alternativeImplementationCommand,enum:n,description:g("alternativeImplementationCommand","Alternative command id that is being executed when the result of 'Go to Implementation' is the current location.")},"editor.gotoLocation.alternativeReferenceCommand":{type:"string",default:e.alternativeReferenceCommand,enum:n,description:g("alternativeReferenceCommand","Alternative command id that is being executed when the result of 'Go to Reference' is the current location.")}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{multiple:re(t.multiple,this.defaultValue.multiple,["peek","gotoAndPeek","goto"]),multipleDefinitions:t.multipleDefinitions??re(t.multipleDefinitions,"peek",["peek","gotoAndPeek","goto"]),multipleTypeDefinitions:t.multipleTypeDefinitions??re(t.multipleTypeDefinitions,"peek",["peek","gotoAndPeek","goto"]),multipleDeclarations:t.multipleDeclarations??re(t.multipleDeclarations,"peek",["peek","gotoAndPeek","goto"]),multipleImplementations:t.multipleImplementations??re(t.multipleImplementations,"peek",["peek","gotoAndPeek","goto"]),multipleReferences:t.multipleReferences??re(t.multipleReferences,"peek",["peek","gotoAndPeek","goto"]),multipleTests:t.multipleTests??re(t.multipleTests,"peek",["peek","gotoAndPeek","goto"]),alternativeDefinitionCommand:Ie.string(t.alternativeDefinitionCommand,this.defaultValue.alternativeDefinitionCommand),alternativeTypeDefinitionCommand:Ie.string(t.alternativeTypeDefinitionCommand,this.defaultValue.alternativeTypeDefinitionCommand),alternativeDeclarationCommand:Ie.string(t.alternativeDeclarationCommand,this.defaultValue.alternativeDeclarationCommand),alternativeImplementationCommand:Ie.string(t.alternativeImplementationCommand,this.defaultValue.alternativeImplementationCommand),alternativeReferenceCommand:Ie.string(t.alternativeReferenceCommand,this.defaultValue.alternativeReferenceCommand),alternativeTestsCommand:Ie.string(t.alternativeTestsCommand,this.defaultValue.alternativeTestsCommand)}}}class hf extends K{constructor(){const e={enabled:!0,delay:300,hidingDelay:300,sticky:!0,above:!0};super(60,"hover",e,{"editor.hover.enabled":{type:"boolean",default:e.enabled,description:g("hover.enabled","Controls whether the hover is shown.")},"editor.hover.delay":{type:"number",default:e.delay,minimum:0,maximum:1e4,description:g("hover.delay","Controls the delay in milliseconds after which the hover is shown.")},"editor.hover.sticky":{type:"boolean",default:e.sticky,description:g("hover.sticky","Controls whether the hover should remain visible when mouse is moved over it.")},"editor.hover.hidingDelay":{type:"integer",minimum:0,default:e.hidingDelay,description:g("hover.hidingDelay","Controls the delay in milliseconds after which the hover is hidden. Requires `editor.hover.sticky` to be enabled.")},"editor.hover.above":{type:"boolean",default:e.above,description:g("hover.above","Prefer showing hovers above the line, if there's space.")}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{enabled:y(t.enabled,this.defaultValue.enabled),delay:G.clampedInt(t.delay,this.defaultValue.delay,0,1e4),sticky:y(t.sticky,this.defaultValue.sticky),hidingDelay:G.clampedInt(t.hidingDelay,this.defaultValue.hidingDelay,0,6e5),above:y(t.above,this.defaultValue.above)}}}class ti extends Wi{constructor(){super(146)}compute(e,t,n){return ti.computeLayout(t,{memory:e.memory,outerWidth:e.outerWidth,outerHeight:e.outerHeight,isDominatedByLongLines:e.isDominatedByLongLines,lineHeight:e.fontInfo.lineHeight,viewLineCount:e.viewLineCount,lineNumbersDigitCount:e.lineNumbersDigitCount,typicalHalfwidthCharacterWidth:e.fontInfo.typicalHalfwidthCharacterWidth,maxDigitWidth:e.fontInfo.maxDigitWidth,pixelRatio:e.pixelRatio,glyphMarginDecorationLaneCount:e.glyphMarginDecorationLaneCount})}static computeContainedMinimapLineCount(e){const t=e.height/e.lineHeight,n=Math.floor(e.paddingTop/e.lineHeight);let i=Math.floor(e.paddingBottom/e.lineHeight);e.scrollBeyondLastLine&&(i=Math.max(i,t-1));const r=(n+e.viewLineCount+i)/(e.pixelRatio*e.height),o=Math.floor(e.viewLineCount/r);return{typicalViewportLineCount:t,extraLinesBeforeFirstLine:n,extraLinesBeyondLastLine:i,desiredRatio:r,minimapLineCount:o}}static _computeMinimapLayout(e,t){const n=e.outerWidth,i=e.outerHeight,r=e.pixelRatio;if(!e.minimap.enabled)return{renderMinimap:0,minimapLeft:0,minimapWidth:0,minimapHeightIsEditorHeight:!1,minimapIsSampling:!1,minimapScale:1,minimapLineHeight:1,minimapCanvasInnerWidth:0,minimapCanvasInnerHeight:Math.floor(r*i),minimapCanvasOuterWidth:0,minimapCanvasOuterHeight:i};const o=t.stableMinimapLayoutInput,a=o&&e.outerHeight===o.outerHeight&&e.lineHeight===o.lineHeight&&e.typicalHalfwidthCharacterWidth===o.typicalHalfwidthCharacterWidth&&e.pixelRatio===o.pixelRatio&&e.scrollBeyondLastLine===o.scrollBeyondLastLine&&e.paddingTop===o.paddingTop&&e.paddingBottom===o.paddingBottom&&e.minimap.enabled===o.minimap.enabled&&e.minimap.side===o.minimap.side&&e.minimap.size===o.minimap.size&&e.minimap.showSlider===o.minimap.showSlider&&e.minimap.renderCharacters===o.minimap.renderCharacters&&e.minimap.maxColumn===o.minimap.maxColumn&&e.minimap.scale===o.minimap.scale&&e.verticalScrollbarWidth===o.verticalScrollbarWidth&&e.isViewportWrapping===o.isViewportWrapping,l=e.lineHeight,u=e.typicalHalfwidthCharacterWidth,c=e.scrollBeyondLastLine,h=e.minimap.renderCharacters;let d=r>=2?Math.round(e.minimap.scale*2):e.minimap.scale;const f=e.minimap.maxColumn,m=e.minimap.size,p=e.minimap.side,C=e.verticalScrollbarWidth,b=e.viewLineCount,L=e.remainingWidth,_=e.isViewportWrapping,k=h?2:3;let S=Math.floor(r*i);const N=S/r;let x=!1,T=!1,E=k*d,V=d/r,P=1;if(m==="fill"||m==="fit"){const{typicalViewportLineCount:se,extraLinesBeforeFirstLine:Q,extraLinesBeyondLastLine:ie,desiredRatio:ce,minimapLineCount:Oe}=ti.computeContainedMinimapLineCount({viewLineCount:b,scrollBeyondLastLine:c,paddingTop:e.paddingTop,paddingBottom:e.paddingBottom,height:i,lineHeight:l,pixelRatio:r});if(b/Oe>1)x=!0,T=!0,d=1,E=1,V=d/r;else{let He=!1,ln=d+1;if(m==="fit"){const Wt=Math.ceil((Q+b+ie)*E);_&&a&&L<=t.stableFitRemainingWidth?(He=!0,ln=t.stableFitMaxMinimapScale):He=Wt>S}if(m==="fill"||He){x=!0;const Wt=d;E=Math.min(l*r,Math.max(1,Math.floor(1/ce))),_&&a&&L<=t.stableFitRemainingWidth&&(ln=t.stableFitMaxMinimapScale),d=Math.min(ln,Math.max(1,Math.floor(E/k))),d>Wt&&(P=Math.min(2,d/Wt)),V=d/r/P,S=Math.ceil(Math.max(se,Q+b+ie)*E),_?(t.stableMinimapLayoutInput=e,t.stableFitRemainingWidth=L,t.stableFitMaxMinimapScale=d):(t.stableMinimapLayoutInput=null,t.stableFitRemainingWidth=0)}}}const B=Math.floor(f*V),O=Math.min(B,Math.max(0,Math.floor((L-C-2)*V/(u+V)))+Xd);let U=Math.floor(r*O);const ue=U/r;U=Math.floor(U*P);const ge=h?1:2,ae=p==="left"?0:n-O-C;return{renderMinimap:ge,minimapLeft:ae,minimapWidth:O,minimapHeightIsEditorHeight:x,minimapIsSampling:T,minimapScale:d,minimapLineHeight:E,minimapCanvasInnerWidth:U,minimapCanvasInnerHeight:S,minimapCanvasOuterWidth:ue,minimapCanvasOuterHeight:N}}static computeLayout(e,t){const n=t.outerWidth|0,i=t.outerHeight|0,r=t.lineHeight|0,o=t.lineNumbersDigitCount|0,a=t.typicalHalfwidthCharacterWidth,l=t.maxDigitWidth,u=t.pixelRatio,c=t.viewLineCount,h=e.get(138),d=h==="inherit"?e.get(137):h,f=d==="inherit"?e.get(133):d,m=e.get(136),p=t.isDominatedByLongLines,C=e.get(57),b=e.get(68).renderType!==0,L=e.get(69),_=e.get(106),k=e.get(84),S=e.get(73),N=e.get(104),x=N.verticalScrollbarSize,T=N.verticalHasArrows,E=N.arrowSize,V=N.horizontalScrollbarSize,P=e.get(43),B=e.get(111)!=="never";let O=e.get(66);P&&B&&(O+=16);let U=0;if(b){const Mh=Math.max(o,L);U=Math.round(Mh*l)}let ue=0;C&&(ue=r*t.glyphMarginDecorationLaneCount);let ge=0,ae=ge+ue,se=ae+U,Q=se+O;const ie=n-ue-U-O;let ce=!1,Oe=!1,an=-1;d==="inherit"&&p?(ce=!0,Oe=!0):f==="on"||f==="bounded"?Oe=!0:f==="wordWrapColumn"&&(an=m);const He=ti._computeMinimapLayout({outerWidth:n,outerHeight:i,lineHeight:r,typicalHalfwidthCharacterWidth:a,pixelRatio:u,scrollBeyondLastLine:_,paddingTop:k.top,paddingBottom:k.bottom,minimap:S,verticalScrollbarWidth:x,viewLineCount:c,remainingWidth:ie,isViewportWrapping:Oe},t.memory||new Jd);He.renderMinimap!==0&&He.minimapLeft===0&&(ge+=He.minimapWidth,ae+=He.minimapWidth,se+=He.minimapWidth,Q+=He.minimapWidth);const ln=ie-He.minimapWidth,Wt=Math.max(1,Math.floor((ln-x-2)/a)),ca=T?E:0;return Oe&&(an=Math.max(1,Wt),f==="bounded"&&(an=Math.min(an,m))),{width:n,height:i,glyphMarginLeft:ge,glyphMarginWidth:ue,glyphMarginDecorationLaneCount:t.glyphMarginDecorationLaneCount,lineNumbersLeft:ae,lineNumbersWidth:U,decorationsLeft:se,decorationsWidth:O,contentLeft:Q,contentWidth:ln,minimap:He,viewportColumn:Wt,isWordWrapMinified:ce,isViewportWrapping:Oe,wrappingColumn:an,verticalScrollbarWidth:x,horizontalScrollbarHeight:V,overviewRuler:{top:ca,width:x,height:i-2*ca,right:0}}}}class df extends K{constructor(){super(140,"wrappingStrategy","simple",{"editor.wrappingStrategy":{enumDescriptions:[g("wrappingStrategy.simple","Assumes that all characters are of the same width. This is a fast algorithm that works correctly for monospace fonts and certain scripts (like Latin characters) where glyphs are of equal width."),g("wrappingStrategy.advanced","Delegates wrapping points computation to the browser. This is a slow algorithm, that might cause freezes for large files, but it works correctly in all cases.")],type:"string",enum:["simple","advanced"],default:"simple",description:g("wrappingStrategy","Controls the algorithm that computes wrapping points. Note that when in accessibility mode, advanced will be used for the best experience.")}})}validate(e){return re(e,"simple",["simple","advanced"])}compute(e,t,n){return t.get(2)===2?"advanced":n}}var dt;(function(s){s.Off="off",s.OnCode="onCode",s.On="on"})(dt||(dt={}));class ff extends K{constructor(){const e={enabled:dt.OnCode};super(65,"lightbulb",e,{"editor.lightbulb.enabled":{type:"string",tags:["experimental"],enum:[dt.Off,dt.OnCode,dt.On],default:e.enabled,enumDescriptions:[g("editor.lightbulb.enabled.off","Disable the code action menu."),g("editor.lightbulb.enabled.onCode","Show the code action menu when the cursor is on lines with code."),g("editor.lightbulb.enabled.on","Show the code action menu when the cursor is on lines with code or on empty lines.")],description:g("enabled","Enables the Code Action lightbulb in the editor.")}})}validate(e){return!e||typeof e!="object"?this.defaultValue:{enabled:re(e.enabled,this.defaultValue.enabled,[dt.Off,dt.OnCode,dt.On])}}}class gf extends K{constructor(){const e={enabled:!0,maxLineCount:5,defaultModel:"outlineModel",scrollWithEditor:!0};super(116,"stickyScroll",e,{"editor.stickyScroll.enabled":{type:"boolean",default:e.enabled,description:g("editor.stickyScroll.enabled","Shows the nested current scopes during the scroll at the top of the editor."),tags:["experimental"]},"editor.stickyScroll.maxLineCount":{type:"number",default:e.maxLineCount,minimum:1,maximum:20,description:g("editor.stickyScroll.maxLineCount","Defines the maximum number of sticky lines to show.")},"editor.stickyScroll.defaultModel":{type:"string",enum:["outlineModel","foldingProviderModel","indentationModel"],default:e.defaultModel,description:g("editor.stickyScroll.defaultModel","Defines the model to use for determining which lines to stick. If the outline model does not exist, it will fall back on the folding provider model which falls back on the indentation model. This order is respected in all three cases.")},"editor.stickyScroll.scrollWithEditor":{type:"boolean",default:e.scrollWithEditor,description:g("editor.stickyScroll.scrollWithEditor","Enable scrolling of Sticky Scroll with the editor's horizontal scrollbar.")}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{enabled:y(t.enabled,this.defaultValue.enabled),maxLineCount:G.clampedInt(t.maxLineCount,this.defaultValue.maxLineCount,1,20),defaultModel:re(t.defaultModel,this.defaultValue.defaultModel,["outlineModel","foldingProviderModel","indentationModel"]),scrollWithEditor:y(t.scrollWithEditor,this.defaultValue.scrollWithEditor)}}}class mf extends K{constructor(){const e={enabled:"on",fontSize:0,fontFamily:"",padding:!1};super(142,"inlayHints",e,{"editor.inlayHints.enabled":{type:"string",default:e.enabled,description:g("inlayHints.enable","Enables the inlay hints in the editor."),enum:["on","onUnlessPressed","offUnlessPressed","off"],markdownEnumDescriptions:[g("editor.inlayHints.on","Inlay hints are enabled"),g("editor.inlayHints.onUnlessPressed","Inlay hints are showing by default and hide when holding {0}",xt?"Ctrl+Option":"Ctrl+Alt"),g("editor.inlayHints.offUnlessPressed","Inlay hints are hidden by default and show when holding {0}",xt?"Ctrl+Option":"Ctrl+Alt"),g("editor.inlayHints.off","Inlay hints are disabled")]},"editor.inlayHints.fontSize":{type:"number",default:e.fontSize,markdownDescription:g("inlayHints.fontSize","Controls font size of inlay hints in the editor. As default the {0} is used when the configured value is less than {1} or greater than the editor font size.","`#editor.fontSize#`","`5`")},"editor.inlayHints.fontFamily":{type:"string",default:e.fontFamily,markdownDescription:g("inlayHints.fontFamily","Controls font family of inlay hints in the editor. When set to empty, the {0} is used.","`#editor.fontFamily#`")},"editor.inlayHints.padding":{type:"boolean",default:e.padding,description:g("inlayHints.padding","Enables the padding around the inlay hints in the editor.")}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return typeof t.enabled=="boolean"&&(t.enabled=t.enabled?"on":"off"),{enabled:re(t.enabled,this.defaultValue.enabled,["on","off","offUnlessPressed","onUnlessPressed"]),fontSize:G.clampedInt(t.fontSize,this.defaultValue.fontSize,0,100),fontFamily:Ie.string(t.fontFamily,this.defaultValue.fontFamily),padding:y(t.padding,this.defaultValue.padding)}}}class pf extends K{constructor(){super(66,"lineDecorationsWidth",10)}validate(e){return typeof e=="string"&&/^\d+(\.\d+)?ch$/.test(e)?-parseFloat(e.substring(0,e.length-2)):G.clampedInt(e,this.defaultValue,0,1e3)}compute(e,t,n){return n<0?G.clampedInt(-n*e.fontInfo.typicalHalfwidthCharacterWidth,this.defaultValue,0,1e3):n}}class Cf extends Ae{constructor(){super(67,"lineHeight",We.lineHeight,e=>Ae.clamp(e,0,150),{markdownDescription:g("lineHeight",`Controls the line height. 
 - Use 0 to automatically compute the line height from the font size.
 - Values between 0 and 8 will be used as a multiplier with the font size.
 - Values greater than or equal to 8 will be used as effective values.`)})}compute(e,t,n){return e.fontInfo.lineHeight}}class bf extends K{constructor(){const e={enabled:!0,size:"proportional",side:"right",showSlider:"mouseover",autohide:!1,renderCharacters:!0,maxColumn:120,scale:1,showRegionSectionHeaders:!0,showMarkSectionHeaders:!0,sectionHeaderFontSize:9,sectionHeaderLetterSpacing:1};super(73,"minimap",e,{"editor.minimap.enabled":{type:"boolean",default:e.enabled,description:g("minimap.enabled","Controls whether the minimap is shown.")},"editor.minimap.autohide":{type:"boolean",default:e.autohide,description:g("minimap.autohide","Controls whether the minimap is hidden automatically.")},"editor.minimap.size":{type:"string",enum:["proportional","fill","fit"],enumDescriptions:[g("minimap.size.proportional","The minimap has the same size as the editor contents (and might scroll)."),g("minimap.size.fill","The minimap will stretch or shrink as necessary to fill the height of the editor (no scrolling)."),g("minimap.size.fit","The minimap will shrink as necessary to never be larger than the editor (no scrolling).")],default:e.size,description:g("minimap.size","Controls the size of the minimap.")},"editor.minimap.side":{type:"string",enum:["left","right"],default:e.side,description:g("minimap.side","Controls the side where to render the minimap.")},"editor.minimap.showSlider":{type:"string",enum:["always","mouseover"],default:e.showSlider,description:g("minimap.showSlider","Controls when the minimap slider is shown.")},"editor.minimap.scale":{type:"number",default:e.scale,minimum:1,maximum:3,enum:[1,2,3],description:g("minimap.scale","Scale of content drawn in the minimap: 1, 2 or 3.")},"editor.minimap.renderCharacters":{type:"boolean",default:e.renderCharacters,description:g("minimap.renderCharacters","Render the actual characters on a line as opposed to color blocks.")},"editor.minimap.maxColumn":{type:"number",default:e.maxColumn,description:g("minimap.maxColumn","Limit the width of the minimap to render at most a certain number of columns.")},"editor.minimap.showRegionSectionHeaders":{type:"boolean",default:e.showRegionSectionHeaders,description:g("minimap.showRegionSectionHeaders","Controls whether named regions are shown as section headers in the minimap.")},"editor.minimap.showMarkSectionHeaders":{type:"boolean",default:e.showMarkSectionHeaders,description:g("minimap.showMarkSectionHeaders","Controls whether MARK: comments are shown as section headers in the minimap.")},"editor.minimap.sectionHeaderFontSize":{type:"number",default:e.sectionHeaderFontSize,description:g("minimap.sectionHeaderFontSize","Controls the font size of section headers in the minimap.")},"editor.minimap.sectionHeaderLetterSpacing":{type:"number",default:e.sectionHeaderLetterSpacing,description:g("minimap.sectionHeaderLetterSpacing","Controls the amount of space (in pixels) between characters of section header. This helps the readability of the header in small font sizes.")}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{enabled:y(t.enabled,this.defaultValue.enabled),autohide:y(t.autohide,this.defaultValue.autohide),size:re(t.size,this.defaultValue.size,["proportional","fill","fit"]),side:re(t.side,this.defaultValue.side,["right","left"]),showSlider:re(t.showSlider,this.defaultValue.showSlider,["always","mouseover"]),renderCharacters:y(t.renderCharacters,this.defaultValue.renderCharacters),scale:G.clampedInt(t.scale,1,1,3),maxColumn:G.clampedInt(t.maxColumn,this.defaultValue.maxColumn,1,1e4),showRegionSectionHeaders:y(t.showRegionSectionHeaders,this.defaultValue.showRegionSectionHeaders),showMarkSectionHeaders:y(t.showMarkSectionHeaders,this.defaultValue.showMarkSectionHeaders),sectionHeaderFontSize:Ae.clamp(t.sectionHeaderFontSize??this.defaultValue.sectionHeaderFontSize,4,32),sectionHeaderLetterSpacing:Ae.clamp(t.sectionHeaderLetterSpacing??this.defaultValue.sectionHeaderLetterSpacing,0,5)}}}function Lf(s){return s==="ctrlCmd"?xt?"metaKey":"ctrlKey":"altKey"}class wf extends K{constructor(){super(84,"padding",{top:0,bottom:0},{"editor.padding.top":{type:"number",default:0,minimum:0,maximum:1e3,description:g("padding.top","Controls the amount of space between the top edge of the editor and the first line.")},"editor.padding.bottom":{type:"number",default:0,minimum:0,maximum:1e3,description:g("padding.bottom","Controls the amount of space between the bottom edge of the editor and the last line.")}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{top:G.clampedInt(t.top,0,0,1e3),bottom:G.clampedInt(t.bottom,0,0,1e3)}}}class _f extends K{constructor(){const e={enabled:!0,cycle:!0};super(86,"parameterHints",e,{"editor.parameterHints.enabled":{type:"boolean",default:e.enabled,description:g("parameterHints.enabled","Enables a pop-up that shows parameter documentation and type information as you type.")},"editor.parameterHints.cycle":{type:"boolean",default:e.cycle,description:g("parameterHints.cycle","Controls whether the parameter hints menu cycles or closes when reaching the end of the list.")}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{enabled:y(t.enabled,this.defaultValue.enabled),cycle:y(t.cycle,this.defaultValue.cycle)}}}class Sf extends Wi{constructor(){super(144)}compute(e,t,n){return e.pixelRatio}}class kf extends K{constructor(){super(88,"placeholder",void 0)}validate(e){return typeof e>"u"?this.defaultValue:typeof e=="string"?e:this.defaultValue}}class vf extends K{constructor(){const e={other:"on",comments:"off",strings:"off"},t=[{type:"boolean"},{type:"string",enum:["on","inline","off"],enumDescriptions:[g("on","Quick suggestions show inside the suggest widget"),g("inline","Quick suggestions show as ghost text"),g("off","Quick suggestions are disabled")]}];super(90,"quickSuggestions",e,{type:"object",additionalProperties:!1,properties:{strings:{anyOf:t,default:e.strings,description:g("quickSuggestions.strings","Enable quick suggestions inside strings.")},comments:{anyOf:t,default:e.comments,description:g("quickSuggestions.comments","Enable quick suggestions inside comments.")},other:{anyOf:t,default:e.other,description:g("quickSuggestions.other","Enable quick suggestions outside of strings and comments.")}},default:e,markdownDescription:g("quickSuggestions","Controls whether suggestions should automatically show up while typing. This can be controlled for typing in comments, strings, and other code. Quick suggestion can be configured to show as ghost text or with the suggest widget. Also be aware of the {0}-setting which controls if suggestions are triggered by special characters.","`#editor.suggestOnTriggerCharacters#`")}),this.defaultValue=e}validate(e){if(typeof e=="boolean"){const u=e?"on":"off";return{comments:u,strings:u,other:u}}if(!e||typeof e!="object")return this.defaultValue;const{other:t,comments:n,strings:i}=e,r=["on","inline","off"];let o,a,l;return typeof t=="boolean"?o=t?"on":"off":o=re(t,this.defaultValue.other,r),typeof n=="boolean"?a=n?"on":"off":a=re(n,this.defaultValue.comments,r),typeof i=="boolean"?l=i?"on":"off":l=re(i,this.defaultValue.strings,r),{other:o,comments:a,strings:l}}}class If extends K{constructor(){super(68,"lineNumbers",{renderType:1,renderFn:null},{type:"string",enum:["off","on","relative","interval"],enumDescriptions:[g("lineNumbers.off","Line numbers are not rendered."),g("lineNumbers.on","Line numbers are rendered as absolute number."),g("lineNumbers.relative","Line numbers are rendered as distance in lines to cursor position."),g("lineNumbers.interval","Line numbers are rendered every 10 lines.")],default:"on",description:g("lineNumbers","Controls the display of line numbers.")})}validate(e){let t=this.defaultValue.renderType,n=this.defaultValue.renderFn;return typeof e<"u"&&(typeof e=="function"?(t=4,n=e):e==="interval"?t=3:e==="relative"?t=2:e==="on"?t=1:t=0),{renderType:t,renderFn:n}}}function xc(s){const e=s.get(99);return e==="editable"?s.get(92):e!=="on"}class Nf extends K{constructor(){const e=[],t={type:"number",description:g("rulers.size","Number of monospace characters at which this editor ruler will render.")};super(103,"rulers",e,{type:"array",items:{anyOf:[t,{type:["object"],properties:{column:t,color:{type:"string",description:g("rulers.color","Color of this editor ruler."),format:"color-hex"}}}]},default:e,description:g("rulers","Render vertical rulers after a certain number of monospace characters. Use multiple values for multiple rulers. No rulers are drawn if array is empty.")})}validate(e){if(Array.isArray(e)){const t=[];for(const n of e)if(typeof n=="number")t.push({column:G.clampedInt(n,0,0,1e4),color:null});else if(n&&typeof n=="object"){const i=n;t.push({column:G.clampedInt(i.column,0,0,1e4),color:i.color})}return t.sort((n,i)=>n.column-i.column),t}return this.defaultValue}}class xf extends K{constructor(){super(93,"readOnlyMessage",void 0)}validate(e){return!e||typeof e!="object"?this.defaultValue:e}}function va(s,e){if(typeof s!="string")return e;switch(s){case"hidden":return 2;case"visible":return 3;default:return 1}}class Tf extends K{constructor(){const e={vertical:1,horizontal:1,arrowSize:11,useShadows:!0,verticalHasArrows:!1,horizontalHasArrows:!1,horizontalScrollbarSize:12,horizontalSliderSize:12,verticalScrollbarSize:14,verticalSliderSize:14,handleMouseWheel:!0,alwaysConsumeMouseWheel:!0,scrollByPage:!1,ignoreHorizontalScrollbarInContentHeight:!1};super(104,"scrollbar",e,{"editor.scrollbar.vertical":{type:"string",enum:["auto","visible","hidden"],enumDescriptions:[g("scrollbar.vertical.auto","The vertical scrollbar will be visible only when necessary."),g("scrollbar.vertical.visible","The vertical scrollbar will always be visible."),g("scrollbar.vertical.fit","The vertical scrollbar will always be hidden.")],default:"auto",description:g("scrollbar.vertical","Controls the visibility of the vertical scrollbar.")},"editor.scrollbar.horizontal":{type:"string",enum:["auto","visible","hidden"],enumDescriptions:[g("scrollbar.horizontal.auto","The horizontal scrollbar will be visible only when necessary."),g("scrollbar.horizontal.visible","The horizontal scrollbar will always be visible."),g("scrollbar.horizontal.fit","The horizontal scrollbar will always be hidden.")],default:"auto",description:g("scrollbar.horizontal","Controls the visibility of the horizontal scrollbar.")},"editor.scrollbar.verticalScrollbarSize":{type:"number",default:e.verticalScrollbarSize,description:g("scrollbar.verticalScrollbarSize","The width of the vertical scrollbar.")},"editor.scrollbar.horizontalScrollbarSize":{type:"number",default:e.horizontalScrollbarSize,description:g("scrollbar.horizontalScrollbarSize","The height of the horizontal scrollbar.")},"editor.scrollbar.scrollByPage":{type:"boolean",default:e.scrollByPage,description:g("scrollbar.scrollByPage","Controls whether clicks scroll by page or jump to click position.")},"editor.scrollbar.ignoreHorizontalScrollbarInContentHeight":{type:"boolean",default:e.ignoreHorizontalScrollbarInContentHeight,description:g("scrollbar.ignoreHorizontalScrollbarInContentHeight","When set, the horizontal scrollbar will not increase the size of the editor's content.")}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e,n=G.clampedInt(t.horizontalScrollbarSize,this.defaultValue.horizontalScrollbarSize,0,1e3),i=G.clampedInt(t.verticalScrollbarSize,this.defaultValue.verticalScrollbarSize,0,1e3);return{arrowSize:G.clampedInt(t.arrowSize,this.defaultValue.arrowSize,0,1e3),vertical:va(t.vertical,this.defaultValue.vertical),horizontal:va(t.horizontal,this.defaultValue.horizontal),useShadows:y(t.useShadows,this.defaultValue.useShadows),verticalHasArrows:y(t.verticalHasArrows,this.defaultValue.verticalHasArrows),horizontalHasArrows:y(t.horizontalHasArrows,this.defaultValue.horizontalHasArrows),handleMouseWheel:y(t.handleMouseWheel,this.defaultValue.handleMouseWheel),alwaysConsumeMouseWheel:y(t.alwaysConsumeMouseWheel,this.defaultValue.alwaysConsumeMouseWheel),horizontalScrollbarSize:n,horizontalSliderSize:G.clampedInt(t.horizontalSliderSize,n,0,1e3),verticalScrollbarSize:i,verticalSliderSize:G.clampedInt(t.verticalSliderSize,i,0,1e3),scrollByPage:y(t.scrollByPage,this.defaultValue.scrollByPage),ignoreHorizontalScrollbarInContentHeight:y(t.ignoreHorizontalScrollbarInContentHeight,this.defaultValue.ignoreHorizontalScrollbarInContentHeight)}}}const Qe="inUntrustedWorkspace",Ft={allowedCharacters:"editor.unicodeHighlight.allowedCharacters",invisibleCharacters:"editor.unicodeHighlight.invisibleCharacters",nonBasicASCII:"editor.unicodeHighlight.nonBasicASCII",ambiguousCharacters:"editor.unicodeHighlight.ambiguousCharacters",includeComments:"editor.unicodeHighlight.includeComments",includeStrings:"editor.unicodeHighlight.includeStrings",allowedLocales:"editor.unicodeHighlight.allowedLocales"};class Ef extends K{constructor(){const e={nonBasicASCII:Qe,invisibleCharacters:!0,ambiguousCharacters:!0,includeComments:Qe,includeStrings:!0,allowedCharacters:{},allowedLocales:{_os:!0,_vscode:!0}};super(126,"unicodeHighlight",e,{[Ft.nonBasicASCII]:{restricted:!0,type:["boolean","string"],enum:[!0,!1,Qe],default:e.nonBasicASCII,description:g("unicodeHighlight.nonBasicASCII","Controls whether all non-basic ASCII characters are highlighted. Only characters between U+0020 and U+007E, tab, line-feed and carriage-return are considered basic ASCII.")},[Ft.invisibleCharacters]:{restricted:!0,type:"boolean",default:e.invisibleCharacters,description:g("unicodeHighlight.invisibleCharacters","Controls whether characters that just reserve space or have no width at all are highlighted.")},[Ft.ambiguousCharacters]:{restricted:!0,type:"boolean",default:e.ambiguousCharacters,description:g("unicodeHighlight.ambiguousCharacters","Controls whether characters are highlighted that can be confused with basic ASCII characters, except those that are common in the current user locale.")},[Ft.includeComments]:{restricted:!0,type:["boolean","string"],enum:[!0,!1,Qe],default:e.includeComments,description:g("unicodeHighlight.includeComments","Controls whether characters in comments should also be subject to Unicode highlighting.")},[Ft.includeStrings]:{restricted:!0,type:["boolean","string"],enum:[!0,!1,Qe],default:e.includeStrings,description:g("unicodeHighlight.includeStrings","Controls whether characters in strings should also be subject to Unicode highlighting.")},[Ft.allowedCharacters]:{restricted:!0,type:"object",default:e.allowedCharacters,description:g("unicodeHighlight.allowedCharacters","Defines allowed characters that are not being highlighted."),additionalProperties:{type:"boolean"}},[Ft.allowedLocales]:{restricted:!0,type:"object",additionalProperties:{type:"boolean"},default:e.allowedLocales,description:g("unicodeHighlight.allowedLocales","Unicode characters that are common in allowed locales are not being highlighted.")}})}applyUpdate(e,t){let n=!1;t.allowedCharacters&&e&&(bs(e.allowedCharacters,t.allowedCharacters)||(e={...e,allowedCharacters:t.allowedCharacters},n=!0)),t.allowedLocales&&e&&(bs(e.allowedLocales,t.allowedLocales)||(e={...e,allowedLocales:t.allowedLocales},n=!0));const i=super.applyUpdate(e,t);return n?new cs(i.newValue,!0):i}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{nonBasicASCII:Nn(t.nonBasicASCII,Qe,[!0,!1,Qe]),invisibleCharacters:y(t.invisibleCharacters,this.defaultValue.invisibleCharacters),ambiguousCharacters:y(t.ambiguousCharacters,this.defaultValue.ambiguousCharacters),includeComments:Nn(t.includeComments,Qe,[!0,!1,Qe]),includeStrings:Nn(t.includeStrings,Qe,[!0,!1,Qe]),allowedCharacters:this.validateBooleanMap(e.allowedCharacters,this.defaultValue.allowedCharacters),allowedLocales:this.validateBooleanMap(e.allowedLocales,this.defaultValue.allowedLocales)}}validateBooleanMap(e,t){if(typeof e!="object"||!e)return t;const n={};for(const[i,r]of Object.entries(e))r===!0&&(n[i]=!0);return n}}class yf extends K{constructor(){const e={enabled:!0,mode:"subwordSmart",showToolbar:"onHover",suppressSuggestions:!1,keepOnBlur:!1,fontFamily:"default"};super(62,"inlineSuggest",e,{"editor.inlineSuggest.enabled":{type:"boolean",default:e.enabled,description:g("inlineSuggest.enabled","Controls whether to automatically show inline suggestions in the editor.")},"editor.inlineSuggest.showToolbar":{type:"string",default:e.showToolbar,enum:["always","onHover","never"],enumDescriptions:[g("inlineSuggest.showToolbar.always","Show the inline suggestion toolbar whenever an inline suggestion is shown."),g("inlineSuggest.showToolbar.onHover","Show the inline suggestion toolbar when hovering over an inline suggestion."),g("inlineSuggest.showToolbar.never","Never show the inline suggestion toolbar.")],description:g("inlineSuggest.showToolbar","Controls when to show the inline suggestion toolbar.")},"editor.inlineSuggest.suppressSuggestions":{type:"boolean",default:e.suppressSuggestions,description:g("inlineSuggest.suppressSuggestions","Controls how inline suggestions interact with the suggest widget. If enabled, the suggest widget is not shown automatically when inline suggestions are available.")},"editor.inlineSuggest.fontFamily":{type:"string",default:e.fontFamily,description:g("inlineSuggest.fontFamily","Controls the font family of the inline suggestions.")}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{enabled:y(t.enabled,this.defaultValue.enabled),mode:re(t.mode,this.defaultValue.mode,["prefix","subword","subwordSmart"]),showToolbar:re(t.showToolbar,this.defaultValue.showToolbar,["always","onHover","never"]),suppressSuggestions:y(t.suppressSuggestions,this.defaultValue.suppressSuggestions),keepOnBlur:y(t.keepOnBlur,this.defaultValue.keepOnBlur),fontFamily:Ie.string(t.fontFamily,this.defaultValue.fontFamily)}}}class Rf extends K{constructor(){const e={enabled:!1,showToolbar:"onHover",fontFamily:"default",keepOnBlur:!1};super(63,"experimentalInlineEdit",e,{"editor.experimentalInlineEdit.enabled":{type:"boolean",default:e.enabled,description:g("inlineEdit.enabled","Controls whether to show inline edits in the editor.")},"editor.experimentalInlineEdit.showToolbar":{type:"string",default:e.showToolbar,enum:["always","onHover","never"],enumDescriptions:[g("inlineEdit.showToolbar.always","Show the inline edit toolbar whenever an inline suggestion is shown."),g("inlineEdit.showToolbar.onHover","Show the inline edit toolbar when hovering over an inline suggestion."),g("inlineEdit.showToolbar.never","Never show the inline edit toolbar.")],description:g("inlineEdit.showToolbar","Controls when to show the inline edit toolbar.")},"editor.experimentalInlineEdit.fontFamily":{type:"string",default:e.fontFamily,description:g("inlineEdit.fontFamily","Controls the font family of the inline edit.")}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{enabled:y(t.enabled,this.defaultValue.enabled),showToolbar:re(t.showToolbar,this.defaultValue.showToolbar,["always","onHover","never"]),fontFamily:Ie.string(t.fontFamily,this.defaultValue.fontFamily),keepOnBlur:y(t.keepOnBlur,this.defaultValue.keepOnBlur)}}}class Mf extends K{constructor(){const e={enabled:ve.bracketPairColorizationOptions.enabled,independentColorPoolPerBracketType:ve.bracketPairColorizationOptions.independentColorPoolPerBracketType};super(15,"bracketPairColorization",e,{"editor.bracketPairColorization.enabled":{type:"boolean",default:e.enabled,markdownDescription:g("bracketPairColorization.enabled","Controls whether bracket pair colorization is enabled or not. Use {0} to override the bracket highlight colors.","`#workbench.colorCustomizations#`")},"editor.bracketPairColorization.independentColorPoolPerBracketType":{type:"boolean",default:e.independentColorPoolPerBracketType,description:g("bracketPairColorization.independentColorPoolPerBracketType","Controls whether each bracket type has its own independent color pool.")}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{enabled:y(t.enabled,this.defaultValue.enabled),independentColorPoolPerBracketType:y(t.independentColorPoolPerBracketType,this.defaultValue.independentColorPoolPerBracketType)}}}class Pf extends K{constructor(){const e={bracketPairs:!1,bracketPairsHorizontal:"active",highlightActiveBracketPair:!0,indentation:!0,highlightActiveIndentation:!0};super(16,"guides",e,{"editor.guides.bracketPairs":{type:["boolean","string"],enum:[!0,"active",!1],enumDescriptions:[g("editor.guides.bracketPairs.true","Enables bracket pair guides."),g("editor.guides.bracketPairs.active","Enables bracket pair guides only for the active bracket pair."),g("editor.guides.bracketPairs.false","Disables bracket pair guides.")],default:e.bracketPairs,description:g("editor.guides.bracketPairs","Controls whether bracket pair guides are enabled or not.")},"editor.guides.bracketPairsHorizontal":{type:["boolean","string"],enum:[!0,"active",!1],enumDescriptions:[g("editor.guides.bracketPairsHorizontal.true","Enables horizontal guides as addition to vertical bracket pair guides."),g("editor.guides.bracketPairsHorizontal.active","Enables horizontal guides only for the active bracket pair."),g("editor.guides.bracketPairsHorizontal.false","Disables horizontal bracket pair guides.")],default:e.bracketPairsHorizontal,description:g("editor.guides.bracketPairsHorizontal","Controls whether horizontal bracket pair guides are enabled or not.")},"editor.guides.highlightActiveBracketPair":{type:"boolean",default:e.highlightActiveBracketPair,description:g("editor.guides.highlightActiveBracketPair","Controls whether the editor should highlight the active bracket pair.")},"editor.guides.indentation":{type:"boolean",default:e.indentation,description:g("editor.guides.indentation","Controls whether the editor should render indent guides.")},"editor.guides.highlightActiveIndentation":{type:["boolean","string"],enum:[!0,"always",!1],enumDescriptions:[g("editor.guides.highlightActiveIndentation.true","Highlights the active indent guide."),g("editor.guides.highlightActiveIndentation.always","Highlights the active indent guide even if bracket guides are highlighted."),g("editor.guides.highlightActiveIndentation.false","Do not highlight the active indent guide.")],default:e.highlightActiveIndentation,description:g("editor.guides.highlightActiveIndentation","Controls whether the editor should highlight the active indent guide.")}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{bracketPairs:Nn(t.bracketPairs,this.defaultValue.bracketPairs,[!0,!1,"active"]),bracketPairsHorizontal:Nn(t.bracketPairsHorizontal,this.defaultValue.bracketPairsHorizontal,[!0,!1,"active"]),highlightActiveBracketPair:y(t.highlightActiveBracketPair,this.defaultValue.highlightActiveBracketPair),indentation:y(t.indentation,this.defaultValue.indentation),highlightActiveIndentation:Nn(t.highlightActiveIndentation,this.defaultValue.highlightActiveIndentation,[!0,!1,"always"])}}}function Nn(s,e,t){const n=t.indexOf(s);return n===-1?e:t[n]}class Af extends K{constructor(){const e={insertMode:"insert",filterGraceful:!0,snippetsPreventQuickSuggestions:!1,localityBonus:!1,shareSuggestSelections:!1,selectionMode:"always",showIcons:!0,showStatusBar:!1,preview:!1,previewMode:"subwordSmart",showInlineDetails:!0,showMethods:!0,showFunctions:!0,showConstructors:!0,showDeprecated:!0,matchOnWordStartOnly:!0,showFields:!0,showVariables:!0,showClasses:!0,showStructs:!0,showInterfaces:!0,showModules:!0,showProperties:!0,showEvents:!0,showOperators:!0,showUnits:!0,showValues:!0,showConstants:!0,showEnums:!0,showEnumMembers:!0,showKeywords:!0,showWords:!0,showColors:!0,showFiles:!0,showReferences:!0,showFolders:!0,showTypeParameters:!0,showSnippets:!0,showUsers:!0,showIssues:!0};super(119,"suggest",e,{"editor.suggest.insertMode":{type:"string",enum:["insert","replace"],enumDescriptions:[g("suggest.insertMode.insert","Insert suggestion without overwriting text right of the cursor."),g("suggest.insertMode.replace","Insert suggestion and overwrite text right of the cursor.")],default:e.insertMode,description:g("suggest.insertMode","Controls whether words are overwritten when accepting completions. Note that this depends on extensions opting into this feature.")},"editor.suggest.filterGraceful":{type:"boolean",default:e.filterGraceful,description:g("suggest.filterGraceful","Controls whether filtering and sorting suggestions accounts for small typos.")},"editor.suggest.localityBonus":{type:"boolean",default:e.localityBonus,description:g("suggest.localityBonus","Controls whether sorting favors words that appear close to the cursor.")},"editor.suggest.shareSuggestSelections":{type:"boolean",default:e.shareSuggestSelections,markdownDescription:g("suggest.shareSuggestSelections","Controls whether remembered suggestion selections are shared between multiple workspaces and windows (needs `#editor.suggestSelection#`).")},"editor.suggest.selectionMode":{type:"string",enum:["always","never","whenTriggerCharacter","whenQuickSuggestion"],enumDescriptions:[g("suggest.insertMode.always","Always select a suggestion when automatically triggering IntelliSense."),g("suggest.insertMode.never","Never select a suggestion when automatically triggering IntelliSense."),g("suggest.insertMode.whenTriggerCharacter","Select a suggestion only when triggering IntelliSense from a trigger character."),g("suggest.insertMode.whenQuickSuggestion","Select a suggestion only when triggering IntelliSense as you type.")],default:e.selectionMode,markdownDescription:g("suggest.selectionMode","Controls whether a suggestion is selected when the widget shows. Note that this only applies to automatically triggered suggestions ({0} and {1}) and that a suggestion is always selected when explicitly invoked, e.g via `Ctrl+Space`.","`#editor.quickSuggestions#`","`#editor.suggestOnTriggerCharacters#`")},"editor.suggest.snippetsPreventQuickSuggestions":{type:"boolean",default:e.snippetsPreventQuickSuggestions,description:g("suggest.snippetsPreventQuickSuggestions","Controls whether an active snippet prevents quick suggestions.")},"editor.suggest.showIcons":{type:"boolean",default:e.showIcons,description:g("suggest.showIcons","Controls whether to show or hide icons in suggestions.")},"editor.suggest.showStatusBar":{type:"boolean",default:e.showStatusBar,description:g("suggest.showStatusBar","Controls the visibility of the status bar at the bottom of the suggest widget.")},"editor.suggest.preview":{type:"boolean",default:e.preview,description:g("suggest.preview","Controls whether to preview the suggestion outcome in the editor.")},"editor.suggest.showInlineDetails":{type:"boolean",default:e.showInlineDetails,description:g("suggest.showInlineDetails","Controls whether suggest details show inline with the label or only in the details widget.")},"editor.suggest.maxVisibleSuggestions":{type:"number",deprecationMessage:g("suggest.maxVisibleSuggestions.dep","This setting is deprecated. The suggest widget can now be resized.")},"editor.suggest.filteredTypes":{type:"object",deprecationMessage:g("deprecated","This setting is deprecated, please use separate settings like 'editor.suggest.showKeywords' or 'editor.suggest.showSnippets' instead.")},"editor.suggest.showMethods":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showMethods","When enabled IntelliSense shows `method`-suggestions.")},"editor.suggest.showFunctions":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showFunctions","When enabled IntelliSense shows `function`-suggestions.")},"editor.suggest.showConstructors":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showConstructors","When enabled IntelliSense shows `constructor`-suggestions.")},"editor.suggest.showDeprecated":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showDeprecated","When enabled IntelliSense shows `deprecated`-suggestions.")},"editor.suggest.matchOnWordStartOnly":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.matchOnWordStartOnly","When enabled IntelliSense filtering requires that the first character matches on a word start. For example, `c` on `Console` or `WebContext` but _not_ on `description`. When disabled IntelliSense will show more results but still sorts them by match quality.")},"editor.suggest.showFields":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showFields","When enabled IntelliSense shows `field`-suggestions.")},"editor.suggest.showVariables":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showVariables","When enabled IntelliSense shows `variable`-suggestions.")},"editor.suggest.showClasses":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showClasss","When enabled IntelliSense shows `class`-suggestions.")},"editor.suggest.showStructs":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showStructs","When enabled IntelliSense shows `struct`-suggestions.")},"editor.suggest.showInterfaces":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showInterfaces","When enabled IntelliSense shows `interface`-suggestions.")},"editor.suggest.showModules":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showModules","When enabled IntelliSense shows `module`-suggestions.")},"editor.suggest.showProperties":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showPropertys","When enabled IntelliSense shows `property`-suggestions.")},"editor.suggest.showEvents":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showEvents","When enabled IntelliSense shows `event`-suggestions.")},"editor.suggest.showOperators":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showOperators","When enabled IntelliSense shows `operator`-suggestions.")},"editor.suggest.showUnits":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showUnits","When enabled IntelliSense shows `unit`-suggestions.")},"editor.suggest.showValues":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showValues","When enabled IntelliSense shows `value`-suggestions.")},"editor.suggest.showConstants":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showConstants","When enabled IntelliSense shows `constant`-suggestions.")},"editor.suggest.showEnums":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showEnums","When enabled IntelliSense shows `enum`-suggestions.")},"editor.suggest.showEnumMembers":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showEnumMembers","When enabled IntelliSense shows `enumMember`-suggestions.")},"editor.suggest.showKeywords":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showKeywords","When enabled IntelliSense shows `keyword`-suggestions.")},"editor.suggest.showWords":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showTexts","When enabled IntelliSense shows `text`-suggestions.")},"editor.suggest.showColors":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showColors","When enabled IntelliSense shows `color`-suggestions.")},"editor.suggest.showFiles":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showFiles","When enabled IntelliSense shows `file`-suggestions.")},"editor.suggest.showReferences":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showReferences","When enabled IntelliSense shows `reference`-suggestions.")},"editor.suggest.showCustomcolors":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showCustomcolors","When enabled IntelliSense shows `customcolor`-suggestions.")},"editor.suggest.showFolders":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showFolders","When enabled IntelliSense shows `folder`-suggestions.")},"editor.suggest.showTypeParameters":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showTypeParameters","When enabled IntelliSense shows `typeParameter`-suggestions.")},"editor.suggest.showSnippets":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showSnippets","When enabled IntelliSense shows `snippet`-suggestions.")},"editor.suggest.showUsers":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showUsers","When enabled IntelliSense shows `user`-suggestions.")},"editor.suggest.showIssues":{type:"boolean",default:!0,markdownDescription:g("editor.suggest.showIssues","When enabled IntelliSense shows `issues`-suggestions.")}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{insertMode:re(t.insertMode,this.defaultValue.insertMode,["insert","replace"]),filterGraceful:y(t.filterGraceful,this.defaultValue.filterGraceful),snippetsPreventQuickSuggestions:y(t.snippetsPreventQuickSuggestions,this.defaultValue.filterGraceful),localityBonus:y(t.localityBonus,this.defaultValue.localityBonus),shareSuggestSelections:y(t.shareSuggestSelections,this.defaultValue.shareSuggestSelections),selectionMode:re(t.selectionMode,this.defaultValue.selectionMode,["always","never","whenQuickSuggestion","whenTriggerCharacter"]),showIcons:y(t.showIcons,this.defaultValue.showIcons),showStatusBar:y(t.showStatusBar,this.defaultValue.showStatusBar),preview:y(t.preview,this.defaultValue.preview),previewMode:re(t.previewMode,this.defaultValue.previewMode,["prefix","subword","subwordSmart"]),showInlineDetails:y(t.showInlineDetails,this.defaultValue.showInlineDetails),showMethods:y(t.showMethods,this.defaultValue.showMethods),showFunctions:y(t.showFunctions,this.defaultValue.showFunctions),showConstructors:y(t.showConstructors,this.defaultValue.showConstructors),showDeprecated:y(t.showDeprecated,this.defaultValue.showDeprecated),matchOnWordStartOnly:y(t.matchOnWordStartOnly,this.defaultValue.matchOnWordStartOnly),showFields:y(t.showFields,this.defaultValue.showFields),showVariables:y(t.showVariables,this.defaultValue.showVariables),showClasses:y(t.showClasses,this.defaultValue.showClasses),showStructs:y(t.showStructs,this.defaultValue.showStructs),showInterfaces:y(t.showInterfaces,this.defaultValue.showInterfaces),showModules:y(t.showModules,this.defaultValue.showModules),showProperties:y(t.showProperties,this.defaultValue.showProperties),showEvents:y(t.showEvents,this.defaultValue.showEvents),showOperators:y(t.showOperators,this.defaultValue.showOperators),showUnits:y(t.showUnits,this.defaultValue.showUnits),showValues:y(t.showValues,this.defaultValue.showValues),showConstants:y(t.showConstants,this.defaultValue.showConstants),showEnums:y(t.showEnums,this.defaultValue.showEnums),showEnumMembers:y(t.showEnumMembers,this.defaultValue.showEnumMembers),showKeywords:y(t.showKeywords,this.defaultValue.showKeywords),showWords:y(t.showWords,this.defaultValue.showWords),showColors:y(t.showColors,this.defaultValue.showColors),showFiles:y(t.showFiles,this.defaultValue.showFiles),showReferences:y(t.showReferences,this.defaultValue.showReferences),showFolders:y(t.showFolders,this.defaultValue.showFolders),showTypeParameters:y(t.showTypeParameters,this.defaultValue.showTypeParameters),showSnippets:y(t.showSnippets,this.defaultValue.showSnippets),showUsers:y(t.showUsers,this.defaultValue.showUsers),showIssues:y(t.showIssues,this.defaultValue.showIssues)}}}class Df extends K{constructor(){super(114,"smartSelect",{selectLeadingAndTrailingWhitespace:!0,selectSubwords:!0},{"editor.smartSelect.selectLeadingAndTrailingWhitespace":{description:g("selectLeadingAndTrailingWhitespace","Whether leading and trailing whitespace should always be selected."),default:!0,type:"boolean"},"editor.smartSelect.selectSubwords":{description:g("selectSubwords","Whether subwords (like 'foo' in 'fooBar' or 'foo_bar') should be selected."),default:!0,type:"boolean"}})}validate(e){return!e||typeof e!="object"?this.defaultValue:{selectLeadingAndTrailingWhitespace:y(e.selectLeadingAndTrailingWhitespace,this.defaultValue.selectLeadingAndTrailingWhitespace),selectSubwords:y(e.selectSubwords,this.defaultValue.selectSubwords)}}}class Of extends K{constructor(){const e=[];super(131,"wordSegmenterLocales",e,{anyOf:[{description:g("wordSegmenterLocales","Locales to be used for word segmentation when doing word related navigations or operations. Specify the BCP 47 language tag of the word you wish to recognize (e.g., ja, zh-CN, zh-Hant-TW, etc.)."),type:"string"},{description:g("wordSegmenterLocales","Locales to be used for word segmentation when doing word related navigations or operations. Specify the BCP 47 language tag of the word you wish to recognize (e.g., ja, zh-CN, zh-Hant-TW, etc.)."),type:"array",items:{type:"string"}}]})}validate(e){if(typeof e=="string"&&(e=[e]),Array.isArray(e)){const t=[];for(const n of e)if(typeof n=="string")try{Intl.Segmenter.supportedLocalesOf(n).length>0&&t.push(n)}catch{}return t}return this.defaultValue}}class Bf extends K{constructor(){super(139,"wrappingIndent",1,{"editor.wrappingIndent":{type:"string",enum:["none","same","indent","deepIndent"],enumDescriptions:[g("wrappingIndent.none","No indentation. Wrapped lines begin at column 1."),g("wrappingIndent.same","Wrapped lines get the same indentation as the parent."),g("wrappingIndent.indent","Wrapped lines get +1 indentation toward the parent."),g("wrappingIndent.deepIndent","Wrapped lines get +2 indentation toward the parent.")],description:g("wrappingIndent","Controls the indentation of wrapped lines."),default:"same"}})}validate(e){switch(e){case"none":return 0;case"same":return 1;case"indent":return 2;case"deepIndent":return 3}return 1}compute(e,t,n){return t.get(2)===2?0:n}}class Vf extends Wi{constructor(){super(147)}compute(e,t,n){const i=t.get(146);return{isDominatedByLongLines:e.isDominatedByLongLines,isWordWrapMinified:i.isWordWrapMinified,isViewportWrapping:i.isViewportWrapping,wrappingColumn:i.wrappingColumn}}}class Wf extends K{constructor(){const e={enabled:!0,showDropSelector:"afterDrop"};super(36,"dropIntoEditor",e,{"editor.dropIntoEditor.enabled":{type:"boolean",default:e.enabled,markdownDescription:g("dropIntoEditor.enabled","Controls whether you can drag and drop a file into a text editor by holding down the `Shift` key (instead of opening the file in an editor).")},"editor.dropIntoEditor.showDropSelector":{type:"string",markdownDescription:g("dropIntoEditor.showDropSelector","Controls if a widget is shown when dropping files into the editor. This widget lets you control how the file is dropped."),enum:["afterDrop","never"],enumDescriptions:[g("dropIntoEditor.showDropSelector.afterDrop","Show the drop selector widget after a file is dropped into the editor."),g("dropIntoEditor.showDropSelector.never","Never show the drop selector widget. Instead the default drop provider is always used.")],default:"afterDrop"}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{enabled:y(t.enabled,this.defaultValue.enabled),showDropSelector:re(t.showDropSelector,this.defaultValue.showDropSelector,["afterDrop","never"])}}}class Ff extends K{constructor(){const e={enabled:!0,showPasteSelector:"afterPaste"};super(85,"pasteAs",e,{"editor.pasteAs.enabled":{type:"boolean",default:e.enabled,markdownDescription:g("pasteAs.enabled","Controls whether you can paste content in different ways.")},"editor.pasteAs.showPasteSelector":{type:"string",markdownDescription:g("pasteAs.showPasteSelector","Controls if a widget is shown when pasting content in to the editor. This widget lets you control how the file is pasted."),enum:["afterPaste","never"],enumDescriptions:[g("pasteAs.showPasteSelector.afterPaste","Show the paste selector widget after content is pasted into the editor."),g("pasteAs.showPasteSelector.never","Never show the paste selector widget. Instead the default pasting behavior is always used.")],default:"afterPaste"}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{enabled:y(t.enabled,this.defaultValue.enabled),showPasteSelector:re(t.showPasteSelector,this.defaultValue.showPasteSelector,["afterPaste","never"])}}}const zf="Consolas, 'Courier New', monospace",Hf="Menlo, Monaco, 'Courier New', monospace",jf="'Droid Sans Mono', 'monospace', monospace",We={fontFamily:xt?Hf:Cs?jf:zf,fontWeight:"normal",fontSize:xt?12:14,lineHeight:0,letterSpacing:0},Tc=[];function v(s){return Tc[s.id]=s,s}const nw={acceptSuggestionOnCommitCharacter:v(new F(0,"acceptSuggestionOnCommitCharacter",!0,{markdownDescription:g("acceptSuggestionOnCommitCharacter","Controls whether suggestions should be accepted on commit characters. For example, in JavaScript, the semi-colon (`;`) can be a commit character that accepts a suggestion and types that character.")})),acceptSuggestionOnEnter:v(new te(1,"acceptSuggestionOnEnter","on",["on","smart","off"],{markdownEnumDescriptions:["",g("acceptSuggestionOnEnterSmart","Only accept a suggestion with `Enter` when it makes a textual change."),""],markdownDescription:g("acceptSuggestionOnEnter","Controls whether suggestions should be accepted on `Enter`, in addition to `Tab`. Helps to avoid ambiguity between inserting new lines or accepting suggestions.")})),accessibilitySupport:v(new ef),accessibilityPageSize:v(new G(3,"accessibilityPageSize",10,1,1073741824,{description:g("accessibilityPageSize","Controls the number of lines in the editor that can be read out by a screen reader at once. When we detect a screen reader we automatically set the default to be 500. Warning: this has a performance implication for numbers larger than the default."),tags:["accessibility"]})),ariaLabel:v(new Ie(4,"ariaLabel",g("editorViewAccessibleLabel","Editor content"))),ariaRequired:v(new F(5,"ariaRequired",!1,void 0)),screenReaderAnnounceInlineSuggestion:v(new F(8,"screenReaderAnnounceInlineSuggestion",!0,{description:g("screenReaderAnnounceInlineSuggestion","Control whether inline suggestions are announced by a screen reader."),tags:["accessibility"]})),autoClosingBrackets:v(new te(6,"autoClosingBrackets","languageDefined",["always","languageDefined","beforeWhitespace","never"],{enumDescriptions:["",g("editor.autoClosingBrackets.languageDefined","Use language configurations to determine when to autoclose brackets."),g("editor.autoClosingBrackets.beforeWhitespace","Autoclose brackets only when the cursor is to the left of whitespace."),""],description:g("autoClosingBrackets","Controls whether the editor should automatically close brackets after the user adds an opening bracket.")})),autoClosingComments:v(new te(7,"autoClosingComments","languageDefined",["always","languageDefined","beforeWhitespace","never"],{enumDescriptions:["",g("editor.autoClosingComments.languageDefined","Use language configurations to determine when to autoclose comments."),g("editor.autoClosingComments.beforeWhitespace","Autoclose comments only when the cursor is to the left of whitespace."),""],description:g("autoClosingComments","Controls whether the editor should automatically close comments after the user adds an opening comment.")})),autoClosingDelete:v(new te(9,"autoClosingDelete","auto",["always","auto","never"],{enumDescriptions:["",g("editor.autoClosingDelete.auto","Remove adjacent closing quotes or brackets only if they were automatically inserted."),""],description:g("autoClosingDelete","Controls whether the editor should remove adjacent closing quotes or brackets when deleting.")})),autoClosingOvertype:v(new te(10,"autoClosingOvertype","auto",["always","auto","never"],{enumDescriptions:["",g("editor.autoClosingOvertype.auto","Type over closing quotes or brackets only if they were automatically inserted."),""],description:g("autoClosingOvertype","Controls whether the editor should type over closing quotes or brackets.")})),autoClosingQuotes:v(new te(11,"autoClosingQuotes","languageDefined",["always","languageDefined","beforeWhitespace","never"],{enumDescriptions:["",g("editor.autoClosingQuotes.languageDefined","Use language configurations to determine when to autoclose quotes."),g("editor.autoClosingQuotes.beforeWhitespace","Autoclose quotes only when the cursor is to the left of whitespace."),""],description:g("autoClosingQuotes","Controls whether the editor should automatically close quotes after the user adds an opening quote.")})),autoIndent:v(new qi(12,"autoIndent",4,"full",["none","keep","brackets","advanced","full"],Kd,{enumDescriptions:[g("editor.autoIndent.none","The editor will not insert indentation automatically."),g("editor.autoIndent.keep","The editor will keep the current line's indentation."),g("editor.autoIndent.brackets","The editor will keep the current line's indentation and honor language defined brackets."),g("editor.autoIndent.advanced","The editor will keep the current line's indentation, honor language defined brackets and invoke special onEnterRules defined by languages."),g("editor.autoIndent.full","The editor will keep the current line's indentation, honor language defined brackets, invoke special onEnterRules defined by languages, and honor indentationRules defined by languages.")],description:g("autoIndent","Controls whether the editor should automatically adjust the indentation when users type, paste, move or indent lines.")})),automaticLayout:v(new F(13,"automaticLayout",!1)),autoSurround:v(new te(14,"autoSurround","languageDefined",["languageDefined","quotes","brackets","never"],{enumDescriptions:[g("editor.autoSurround.languageDefined","Use language configurations to determine when to automatically surround selections."),g("editor.autoSurround.quotes","Surround with quotes but not brackets."),g("editor.autoSurround.brackets","Surround with brackets but not quotes."),""],description:g("autoSurround","Controls whether the editor should automatically surround selections when typing quotes or brackets.")})),bracketPairColorization:v(new Mf),bracketPairGuides:v(new Pf),stickyTabStops:v(new F(117,"stickyTabStops",!1,{description:g("stickyTabStops","Emulate selection behavior of tab characters when using spaces for indentation. Selection will stick to tab stops.")})),codeLens:v(new F(17,"codeLens",!0,{description:g("codeLens","Controls whether the editor shows CodeLens.")})),codeLensFontFamily:v(new Ie(18,"codeLensFontFamily","",{description:g("codeLensFontFamily","Controls the font family for CodeLens.")})),codeLensFontSize:v(new G(19,"codeLensFontSize",0,0,100,{type:"number",default:0,minimum:0,maximum:100,markdownDescription:g("codeLensFontSize","Controls the font size in pixels for CodeLens. When set to 0, 90% of `#editor.fontSize#` is used.")})),colorDecorators:v(new F(20,"colorDecorators",!0,{description:g("colorDecorators","Controls whether the editor should render the inline color decorators and color picker.")})),colorDecoratorActivatedOn:v(new te(149,"colorDecoratorsActivatedOn","clickAndHover",["clickAndHover","hover","click"],{enumDescriptions:[g("editor.colorDecoratorActivatedOn.clickAndHover","Make the color picker appear both on click and hover of the color decorator"),g("editor.colorDecoratorActivatedOn.hover","Make the color picker appear on hover of the color decorator"),g("editor.colorDecoratorActivatedOn.click","Make the color picker appear on click of the color decorator")],description:g("colorDecoratorActivatedOn","Controls the condition to make a color picker appear from a color decorator")})),colorDecoratorsLimit:v(new G(21,"colorDecoratorsLimit",500,1,1e6,{markdownDescription:g("colorDecoratorsLimit","Controls the max number of color decorators that can be rendered in an editor at once.")})),columnSelection:v(new F(22,"columnSelection",!1,{description:g("columnSelection","Enable that the selection with the mouse and keys is doing column selection.")})),comments:v(new tf),contextmenu:v(new F(24,"contextmenu",!0)),copyWithSyntaxHighlighting:v(new F(25,"copyWithSyntaxHighlighting",!0,{description:g("copyWithSyntaxHighlighting","Controls whether syntax highlighting should be copied into the clipboard.")})),cursorBlinking:v(new qi(26,"cursorBlinking",1,"blink",["blink","smooth","phase","expand","solid"],nf,{description:g("cursorBlinking","Control the cursor animation style.")})),cursorSmoothCaretAnimation:v(new te(27,"cursorSmoothCaretAnimation","off",["off","explicit","on"],{enumDescriptions:[g("cursorSmoothCaretAnimation.off","Smooth caret animation is disabled."),g("cursorSmoothCaretAnimation.explicit","Smooth caret animation is enabled only when the user moves the cursor with an explicit gesture."),g("cursorSmoothCaretAnimation.on","Smooth caret animation is always enabled.")],description:g("cursorSmoothCaretAnimation","Controls whether the smooth caret animation should be enabled.")})),cursorStyle:v(new qi(28,"cursorStyle",Lt.Line,"line",["line","block","underline","line-thin","block-outline","underline-thin"],sf,{description:g("cursorStyle","Controls the cursor style.")})),cursorSurroundingLines:v(new G(29,"cursorSurroundingLines",0,0,1073741824,{description:g("cursorSurroundingLines","Controls the minimal number of visible leading lines (minimum 0) and trailing lines (minimum 1) surrounding the cursor. Known as 'scrollOff' or 'scrollOffset' in some other editors.")})),cursorSurroundingLinesStyle:v(new te(30,"cursorSurroundingLinesStyle","default",["default","all"],{enumDescriptions:[g("cursorSurroundingLinesStyle.default","`cursorSurroundingLines` is enforced only when triggered via the keyboard or API."),g("cursorSurroundingLinesStyle.all","`cursorSurroundingLines` is enforced always.")],markdownDescription:g("cursorSurroundingLinesStyle","Controls when `#editor.cursorSurroundingLines#` should be enforced.")})),cursorWidth:v(new G(31,"cursorWidth",0,0,1073741824,{markdownDescription:g("cursorWidth","Controls the width of the cursor when `#editor.cursorStyle#` is set to `line`.")})),disableLayerHinting:v(new F(32,"disableLayerHinting",!1)),disableMonospaceOptimizations:v(new F(33,"disableMonospaceOptimizations",!1)),domReadOnly:v(new F(34,"domReadOnly",!1)),dragAndDrop:v(new F(35,"dragAndDrop",!0,{description:g("dragAndDrop","Controls whether the editor should allow moving selections via drag and drop.")})),emptySelectionClipboard:v(new of),dropIntoEditor:v(new Wf),stickyScroll:v(new gf),experimentalWhitespaceRendering:v(new te(38,"experimentalWhitespaceRendering","svg",["svg","font","off"],{enumDescriptions:[g("experimentalWhitespaceRendering.svg","Use a new rendering method with svgs."),g("experimentalWhitespaceRendering.font","Use a new rendering method with font characters."),g("experimentalWhitespaceRendering.off","Use the stable rendering method.")],description:g("experimentalWhitespaceRendering","Controls whether whitespace is rendered with a new, experimental method.")})),extraEditorClassName:v(new Ie(39,"extraEditorClassName","")),fastScrollSensitivity:v(new Ae(40,"fastScrollSensitivity",5,s=>s<=0?5:s,{markdownDescription:g("fastScrollSensitivity","Scrolling speed multiplier when pressing `Alt`.")})),find:v(new af),fixedOverflowWidgets:v(new F(42,"fixedOverflowWidgets",!1)),folding:v(new F(43,"folding",!0,{description:g("folding","Controls whether the editor has code folding enabled.")})),foldingStrategy:v(new te(44,"foldingStrategy","auto",["auto","indentation"],{enumDescriptions:[g("foldingStrategy.auto","Use a language-specific folding strategy if available, else the indentation-based one."),g("foldingStrategy.indentation","Use the indentation-based folding strategy.")],description:g("foldingStrategy","Controls the strategy for computing folding ranges.")})),foldingHighlight:v(new F(45,"foldingHighlight",!0,{description:g("foldingHighlight","Controls whether the editor should highlight folded ranges.")})),foldingImportsByDefault:v(new F(46,"foldingImportsByDefault",!1,{description:g("foldingImportsByDefault","Controls whether the editor automatically collapses import ranges.")})),foldingMaximumRegions:v(new G(47,"foldingMaximumRegions",5e3,10,65e3,{description:g("foldingMaximumRegions","The maximum number of foldable regions. Increasing this value may result in the editor becoming less responsive when the current source has a large number of foldable regions.")})),unfoldOnClickAfterEndOfLine:v(new F(48,"unfoldOnClickAfterEndOfLine",!1,{description:g("unfoldOnClickAfterEndOfLine","Controls whether clicking on the empty content after a folded line will unfold the line.")})),fontFamily:v(new Ie(49,"fontFamily",We.fontFamily,{description:g("fontFamily","Controls the font family.")})),fontInfo:v(new lf),fontLigatures2:v(new jr),fontSize:v(new uf),fontWeight:v(new Ur),fontVariations:v(new Ni),formatOnPaste:v(new F(55,"formatOnPaste",!1,{description:g("formatOnPaste","Controls whether the editor should automatically format the pasted content. A formatter must be available and the formatter should be able to format a range in a document.")})),formatOnType:v(new F(56,"formatOnType",!1,{description:g("formatOnType","Controls whether the editor should automatically format the line after typing.")})),glyphMargin:v(new F(57,"glyphMargin",!0,{description:g("glyphMargin","Controls whether the editor should render the vertical glyph margin. Glyph margin is mostly used for debugging.")})),gotoLocation:v(new cf),hideCursorInOverviewRuler:v(new F(59,"hideCursorInOverviewRuler",!1,{description:g("hideCursorInOverviewRuler","Controls whether the cursor should be hidden in the overview ruler.")})),hover:v(new hf),inDiffEditor:v(new F(61,"inDiffEditor",!1)),letterSpacing:v(new Ae(64,"letterSpacing",We.letterSpacing,s=>Ae.clamp(s,-5,20),{description:g("letterSpacing","Controls the letter spacing in pixels.")})),lightbulb:v(new ff),lineDecorationsWidth:v(new pf),lineHeight:v(new Cf),lineNumbers:v(new If),lineNumbersMinChars:v(new G(69,"lineNumbersMinChars",5,1,300)),linkedEditing:v(new F(70,"linkedEditing",!1,{description:g("linkedEditing","Controls whether the editor has linked editing enabled. Depending on the language, related symbols such as HTML tags, are updated while editing.")})),links:v(new F(71,"links",!0,{description:g("links","Controls whether the editor should detect links and make them clickable.")})),matchBrackets:v(new te(72,"matchBrackets","always",["always","near","never"],{description:g("matchBrackets","Highlight matching brackets.")})),minimap:v(new bf),mouseStyle:v(new te(74,"mouseStyle","text",["text","default","copy"])),mouseWheelScrollSensitivity:v(new Ae(75,"mouseWheelScrollSensitivity",1,s=>s===0?1:s,{markdownDescription:g("mouseWheelScrollSensitivity","A multiplier to be used on the `deltaX` and `deltaY` of mouse wheel scroll events.")})),mouseWheelZoom:v(new F(76,"mouseWheelZoom",!1,{markdownDescription:xt?g("mouseWheelZoom.mac","Zoom the font of the editor when using mouse wheel and holding `Cmd`."):g("mouseWheelZoom","Zoom the font of the editor when using mouse wheel and holding `Ctrl`.")})),multiCursorMergeOverlapping:v(new F(77,"multiCursorMergeOverlapping",!0,{description:g("multiCursorMergeOverlapping","Merge multiple cursors when they are overlapping.")})),multiCursorModifier:v(new qi(78,"multiCursorModifier","altKey","alt",["ctrlCmd","alt"],Lf,{markdownEnumDescriptions:[g("multiCursorModifier.ctrlCmd","Maps to `Control` on Windows and Linux and to `Command` on macOS."),g("multiCursorModifier.alt","Maps to `Alt` on Windows and Linux and to `Option` on macOS.")],markdownDescription:g({key:"multiCursorModifier",comment:["- `ctrlCmd` refers to a value the setting can take and should not be localized.","- `Control` and `Command` refer to the modifier keys Ctrl or Cmd on the keyboard and can be localized."]},"The modifier to be used to add multiple cursors with the mouse. The Go to Definition and Open Link mouse gestures will adapt such that they do not conflict with the [multicursor modifier](https://code.visualstudio.com/docs/editor/codebasics#_multicursor-modifier).")})),multiCursorPaste:v(new te(79,"multiCursorPaste","spread",["spread","full"],{markdownEnumDescriptions:[g("multiCursorPaste.spread","Each cursor pastes a single line of the text."),g("multiCursorPaste.full","Each cursor pastes the full text.")],markdownDescription:g("multiCursorPaste","Controls pasting when the line count of the pasted text matches the cursor count.")})),multiCursorLimit:v(new G(80,"multiCursorLimit",1e4,1,1e5,{markdownDescription:g("multiCursorLimit","Controls the max number of cursors that can be in an active editor at once.")})),occurrencesHighlight:v(new te(81,"occurrencesHighlight","singleFile",["off","singleFile","multiFile"],{markdownEnumDescriptions:[g("occurrencesHighlight.off","Does not highlight occurrences."),g("occurrencesHighlight.singleFile","Highlights occurrences only in the current file."),g("occurrencesHighlight.multiFile","Experimental: Highlights occurrences across all valid open files.")],markdownDescription:g("occurrencesHighlight","Controls whether occurrences should be highlighted across open files.")})),overviewRulerBorder:v(new F(82,"overviewRulerBorder",!0,{description:g("overviewRulerBorder","Controls whether a border should be drawn around the overview ruler.")})),overviewRulerLanes:v(new G(83,"overviewRulerLanes",3,0,3)),padding:v(new wf),pasteAs:v(new Ff),parameterHints:v(new _f),peekWidgetDefaultFocus:v(new te(87,"peekWidgetDefaultFocus","tree",["tree","editor"],{enumDescriptions:[g("peekWidgetDefaultFocus.tree","Focus the tree when opening peek"),g("peekWidgetDefaultFocus.editor","Focus the editor when opening peek")],description:g("peekWidgetDefaultFocus","Controls whether to focus the inline editor or the tree in the peek widget.")})),placeholder:v(new kf),definitionLinkOpensInPeek:v(new F(89,"definitionLinkOpensInPeek",!1,{description:g("definitionLinkOpensInPeek","Controls whether the Go to Definition mouse gesture always opens the peek widget.")})),quickSuggestions:v(new vf),quickSuggestionsDelay:v(new G(91,"quickSuggestionsDelay",10,0,1073741824,{description:g("quickSuggestionsDelay","Controls the delay in milliseconds after which quick suggestions will show up.")})),readOnly:v(new F(92,"readOnly",!1)),readOnlyMessage:v(new xf),renameOnType:v(new F(94,"renameOnType",!1,{description:g("renameOnType","Controls whether the editor auto renames on type."),markdownDeprecationMessage:g("renameOnTypeDeprecate","Deprecated, use `editor.linkedEditing` instead.")})),renderControlCharacters:v(new F(95,"renderControlCharacters",!0,{description:g("renderControlCharacters","Controls whether the editor should render control characters."),restricted:!0})),renderFinalNewline:v(new te(96,"renderFinalNewline",Cs?"dimmed":"on",["off","on","dimmed"],{description:g("renderFinalNewline","Render last line number when the file ends with a newline.")})),renderLineHighlight:v(new te(97,"renderLineHighlight","line",["none","gutter","line","all"],{enumDescriptions:["","","",g("renderLineHighlight.all","Highlights both the gutter and the current line.")],description:g("renderLineHighlight","Controls how the editor should render the current line highlight.")})),renderLineHighlightOnlyWhenFocus:v(new F(98,"renderLineHighlightOnlyWhenFocus",!1,{description:g("renderLineHighlightOnlyWhenFocus","Controls if the editor should render the current line highlight only when the editor is focused.")})),renderValidationDecorations:v(new te(99,"renderValidationDecorations","editable",["editable","on","off"])),renderWhitespace:v(new te(100,"renderWhitespace","selection",["none","boundary","selection","trailing","all"],{enumDescriptions:["",g("renderWhitespace.boundary","Render whitespace characters except for single spaces between words."),g("renderWhitespace.selection","Render whitespace characters only on selected text."),g("renderWhitespace.trailing","Render only trailing whitespace characters."),""],description:g("renderWhitespace","Controls how the editor should render whitespace characters.")})),revealHorizontalRightPadding:v(new G(101,"revealHorizontalRightPadding",15,0,1e3)),roundedSelection:v(new F(102,"roundedSelection",!0,{description:g("roundedSelection","Controls whether selections should have rounded corners.")})),rulers:v(new Nf),scrollbar:v(new Tf),scrollBeyondLastColumn:v(new G(105,"scrollBeyondLastColumn",4,0,1073741824,{description:g("scrollBeyondLastColumn","Controls the number of extra characters beyond which the editor will scroll horizontally.")})),scrollBeyondLastLine:v(new F(106,"scrollBeyondLastLine",!0,{description:g("scrollBeyondLastLine","Controls whether the editor will scroll beyond the last line.")})),scrollPredominantAxis:v(new F(107,"scrollPredominantAxis",!0,{description:g("scrollPredominantAxis","Scroll only along the predominant axis when scrolling both vertically and horizontally at the same time. Prevents horizontal drift when scrolling vertically on a trackpad.")})),selectionClipboard:v(new F(108,"selectionClipboard",!0,{description:g("selectionClipboard","Controls whether the Linux primary clipboard should be supported."),included:Cs})),selectionHighlight:v(new F(109,"selectionHighlight",!0,{description:g("selectionHighlight","Controls whether the editor should highlight matches similar to the selection.")})),selectOnLineNumbers:v(new F(110,"selectOnLineNumbers",!0)),showFoldingControls:v(new te(111,"showFoldingControls","mouseover",["always","never","mouseover"],{enumDescriptions:[g("showFoldingControls.always","Always show the folding controls."),g("showFoldingControls.never","Never show the folding controls and reduce the gutter size."),g("showFoldingControls.mouseover","Only show the folding controls when the mouse is over the gutter.")],description:g("showFoldingControls","Controls when the folding controls on the gutter are shown.")})),showUnused:v(new F(112,"showUnused",!0,{description:g("showUnused","Controls fading out of unused code.")})),showDeprecated:v(new F(141,"showDeprecated",!0,{description:g("showDeprecated","Controls strikethrough deprecated variables.")})),inlayHints:v(new mf),snippetSuggestions:v(new te(113,"snippetSuggestions","inline",["top","bottom","inline","none"],{enumDescriptions:[g("snippetSuggestions.top","Show snippet suggestions on top of other suggestions."),g("snippetSuggestions.bottom","Show snippet suggestions below other suggestions."),g("snippetSuggestions.inline","Show snippets suggestions with other suggestions."),g("snippetSuggestions.none","Do not show snippet suggestions.")],description:g("snippetSuggestions","Controls whether snippets are shown with other suggestions and how they are sorted.")})),smartSelect:v(new Df),smoothScrolling:v(new F(115,"smoothScrolling",!1,{description:g("smoothScrolling","Controls whether the editor will scroll using an animation.")})),stopRenderingLineAfter:v(new G(118,"stopRenderingLineAfter",1e4,-1,1073741824)),suggest:v(new Af),inlineSuggest:v(new yf),inlineEdit:v(new Rf),inlineCompletionsAccessibilityVerbose:v(new F(150,"inlineCompletionsAccessibilityVerbose",!1,{description:g("inlineCompletionsAccessibilityVerbose","Controls whether the accessibility hint should be provided to screen reader users when an inline completion is shown.")})),suggestFontSize:v(new G(120,"suggestFontSize",0,0,1e3,{markdownDescription:g("suggestFontSize","Font size for the suggest widget. When set to {0}, the value of {1} is used.","`0`","`#editor.fontSize#`")})),suggestLineHeight:v(new G(121,"suggestLineHeight",0,0,1e3,{markdownDescription:g("suggestLineHeight","Line height for the suggest widget. When set to {0}, the value of {1} is used. The minimum value is 8.","`0`","`#editor.lineHeight#`")})),suggestOnTriggerCharacters:v(new F(122,"suggestOnTriggerCharacters",!0,{description:g("suggestOnTriggerCharacters","Controls whether suggestions should automatically show up when typing trigger characters.")})),suggestSelection:v(new te(123,"suggestSelection","first",["first","recentlyUsed","recentlyUsedByPrefix"],{markdownEnumDescriptions:[g("suggestSelection.first","Always select the first suggestion."),g("suggestSelection.recentlyUsed","Select recent suggestions unless further typing selects one, e.g. `console.| -> console.log` because `log` has been completed recently."),g("suggestSelection.recentlyUsedByPrefix","Select suggestions based on previous prefixes that have completed those suggestions, e.g. `co -> console` and `con -> const`.")],description:g("suggestSelection","Controls how suggestions are pre-selected when showing the suggest list.")})),tabCompletion:v(new te(124,"tabCompletion","off",["on","off","onlySnippets"],{enumDescriptions:[g("tabCompletion.on","Tab complete will insert the best matching suggestion when pressing tab."),g("tabCompletion.off","Disable tab completions."),g("tabCompletion.onlySnippets","Tab complete snippets when their prefix match. Works best when 'quickSuggestions' aren't enabled.")],description:g("tabCompletion","Enables tab completions.")})),tabIndex:v(new G(125,"tabIndex",0,-1,1073741824)),unicodeHighlight:v(new Ef),unusualLineTerminators:v(new te(127,"unusualLineTerminators","prompt",["auto","off","prompt"],{enumDescriptions:[g("unusualLineTerminators.auto","Unusual line terminators are automatically removed."),g("unusualLineTerminators.off","Unusual line terminators are ignored."),g("unusualLineTerminators.prompt","Unusual line terminators prompt to be removed.")],description:g("unusualLineTerminators","Remove unusual line terminators that might cause problems.")})),useShadowDOM:v(new F(128,"useShadowDOM",!0)),useTabStops:v(new F(129,"useTabStops",!0,{description:g("useTabStops","Spaces and tabs are inserted and deleted in alignment with tab stops.")})),wordBreak:v(new te(130,"wordBreak","normal",["normal","keepAll"],{markdownEnumDescriptions:[g("wordBreak.normal","Use the default line break rule."),g("wordBreak.keepAll","Word breaks should not be used for Chinese/Japanese/Korean (CJK) text. Non-CJK text behavior is the same as for normal.")],description:g("wordBreak","Controls the word break rules used for Chinese/Japanese/Korean (CJK) text.")})),wordSegmenterLocales:v(new Of),wordSeparators:v(new Ie(132,"wordSeparators",Ic,{description:g("wordSeparators","Characters that will be used as word separators when doing word related navigations or operations.")})),wordWrap:v(new te(133,"wordWrap","off",["off","on","wordWrapColumn","bounded"],{markdownEnumDescriptions:[g("wordWrap.off","Lines will never wrap."),g("wordWrap.on","Lines will wrap at the viewport width."),g({key:"wordWrap.wordWrapColumn",comment:["- `editor.wordWrapColumn` refers to a different setting and should not be localized."]},"Lines will wrap at `#editor.wordWrapColumn#`."),g({key:"wordWrap.bounded",comment:["- viewport means the edge of the visible window size.","- `editor.wordWrapColumn` refers to a different setting and should not be localized."]},"Lines will wrap at the minimum of viewport and `#editor.wordWrapColumn#`.")],description:g({key:"wordWrap",comment:["- 'off', 'on', 'wordWrapColumn' and 'bounded' refer to values the setting can take and should not be localized.","- `editor.wordWrapColumn` refers to a different setting and should not be localized."]},"Controls how lines should wrap.")})),wordWrapBreakAfterCharacters:v(new Ie(134,"wordWrapBreakAfterCharacters"," 	})]?|/&.,;")),wordWrapBreakBeforeCharacters:v(new Ie(135,"wordWrapBreakBeforeCharacters","([{+")),wordWrapColumn:v(new G(136,"wordWrapColumn",80,1,1073741824,{markdownDescription:g({key:"wordWrapColumn",comment:["- `editor.wordWrap` refers to a different setting and should not be localized.","- 'wordWrapColumn' and 'bounded' refer to values the different setting can take and should not be localized."]},"Controls the wrapping column of the editor when `#editor.wordWrap#` is `wordWrapColumn` or `bounded`.")})),wordWrapOverride1:v(new te(137,"wordWrapOverride1","inherit",["off","on","inherit"])),wordWrapOverride2:v(new te(138,"wordWrapOverride2","inherit",["off","on","inherit"])),editorClassName:v(new rf),defaultColorDecorators:v(new F(148,"defaultColorDecorators",!1,{markdownDescription:g("defaultColorDecorators","Controls whether inline color decorations should be shown using the default document color provider")})),pixelRatio:v(new Sf),tabFocusMode:v(new F(145,"tabFocusMode",!1,{markdownDescription:g("tabFocusMode","Controls whether the editor receives tabs or defers them to the workbench for navigation.")})),layoutInfo:v(new ti),wrappingInfo:v(new Vf),wrappingIndent:v(new Bf),wrappingStrategy:v(new df)};class I{constructor(e,t){this.lineNumber=e,this.column=t}with(e=this.lineNumber,t=this.column){return e===this.lineNumber&&t===this.column?this:new I(e,t)}delta(e=0,t=0){return this.with(this.lineNumber+e,this.column+t)}equals(e){return I.equals(this,e)}static equals(e,t){return!e&&!t?!0:!!e&&!!t&&e.lineNumber===t.lineNumber&&e.column===t.column}isBefore(e){return I.isBefore(this,e)}static isBefore(e,t){return e.lineNumber<t.lineNumber?!0:t.lineNumber<e.lineNumber?!1:e.column<t.column}isBeforeOrEqual(e){return I.isBeforeOrEqual(this,e)}static isBeforeOrEqual(e,t){return e.lineNumber<t.lineNumber?!0:t.lineNumber<e.lineNumber?!1:e.column<=t.column}static compare(e,t){const n=e.lineNumber|0,i=t.lineNumber|0;if(n===i){const r=e.column|0,o=t.column|0;return r-o}return n-i}clone(){return new I(this.lineNumber,this.column)}toString(){return"("+this.lineNumber+","+this.column+")"}static lift(e){return new I(e.lineNumber,e.column)}static isIPosition(e){return e&&typeof e.lineNumber=="number"&&typeof e.column=="number"}toJSON(){return{lineNumber:this.lineNumber,column:this.column}}}class w{constructor(e,t,n,i){e>n||e===n&&t>i?(this.startLineNumber=n,this.startColumn=i,this.endLineNumber=e,this.endColumn=t):(this.startLineNumber=e,this.startColumn=t,this.endLineNumber=n,this.endColumn=i)}isEmpty(){return w.isEmpty(this)}static isEmpty(e){return e.startLineNumber===e.endLineNumber&&e.startColumn===e.endColumn}containsPosition(e){return w.containsPosition(this,e)}static containsPosition(e,t){return!(t.lineNumber<e.startLineNumber||t.lineNumber>e.endLineNumber||t.lineNumber===e.startLineNumber&&t.column<e.startColumn||t.lineNumber===e.endLineNumber&&t.column>e.endColumn)}static strictContainsPosition(e,t){return!(t.lineNumber<e.startLineNumber||t.lineNumber>e.endLineNumber||t.lineNumber===e.startLineNumber&&t.column<=e.startColumn||t.lineNumber===e.endLineNumber&&t.column>=e.endColumn)}containsRange(e){return w.containsRange(this,e)}static containsRange(e,t){return!(t.startLineNumber<e.startLineNumber||t.endLineNumber<e.startLineNumber||t.startLineNumber>e.endLineNumber||t.endLineNumber>e.endLineNumber||t.startLineNumber===e.startLineNumber&&t.startColumn<e.startColumn||t.endLineNumber===e.endLineNumber&&t.endColumn>e.endColumn)}strictContainsRange(e){return w.strictContainsRange(this,e)}static strictContainsRange(e,t){return!(t.startLineNumber<e.startLineNumber||t.endLineNumber<e.startLineNumber||t.startLineNumber>e.endLineNumber||t.endLineNumber>e.endLineNumber||t.startLineNumber===e.startLineNumber&&t.startColumn<=e.startColumn||t.endLineNumber===e.endLineNumber&&t.endColumn>=e.endColumn)}plusRange(e){return w.plusRange(this,e)}static plusRange(e,t){let n,i,r,o;return t.startLineNumber<e.startLineNumber?(n=t.startLineNumber,i=t.startColumn):t.startLineNumber===e.startLineNumber?(n=t.startLineNumber,i=Math.min(t.startColumn,e.startColumn)):(n=e.startLineNumber,i=e.startColumn),t.endLineNumber>e.endLineNumber?(r=t.endLineNumber,o=t.endColumn):t.endLineNumber===e.endLineNumber?(r=t.endLineNumber,o=Math.max(t.endColumn,e.endColumn)):(r=e.endLineNumber,o=e.endColumn),new w(n,i,r,o)}intersectRanges(e){return w.intersectRanges(this,e)}static intersectRanges(e,t){let n=e.startLineNumber,i=e.startColumn,r=e.endLineNumber,o=e.endColumn;const a=t.startLineNumber,l=t.startColumn,u=t.endLineNumber,c=t.endColumn;return n<a?(n=a,i=l):n===a&&(i=Math.max(i,l)),r>u?(r=u,o=c):r===u&&(o=Math.min(o,c)),n>r||n===r&&i>o?null:new w(n,i,r,o)}equalsRange(e){return w.equalsRange(this,e)}static equalsRange(e,t){return!e&&!t?!0:!!e&&!!t&&e.startLineNumber===t.startLineNumber&&e.startColumn===t.startColumn&&e.endLineNumber===t.endLineNumber&&e.endColumn===t.endColumn}getEndPosition(){return w.getEndPosition(this)}static getEndPosition(e){return new I(e.endLineNumber,e.endColumn)}getStartPosition(){return w.getStartPosition(this)}static getStartPosition(e){return new I(e.startLineNumber,e.startColumn)}toString(){return"["+this.startLineNumber+","+this.startColumn+" -> "+this.endLineNumber+","+this.endColumn+"]"}setEndPosition(e,t){return new w(this.startLineNumber,this.startColumn,e,t)}setStartPosition(e,t){return new w(e,t,this.endLineNumber,this.endColumn)}collapseToStart(){return w.collapseToStart(this)}static collapseToStart(e){return new w(e.startLineNumber,e.startColumn,e.startLineNumber,e.startColumn)}collapseToEnd(){return w.collapseToEnd(this)}static collapseToEnd(e){return new w(e.endLineNumber,e.endColumn,e.endLineNumber,e.endColumn)}delta(e){return new w(this.startLineNumber+e,this.startColumn,this.endLineNumber+e,this.endColumn)}static fromPositions(e,t=e){return new w(e.lineNumber,e.column,t.lineNumber,t.column)}static lift(e){return e?new w(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn):null}static isIRange(e){return e&&typeof e.startLineNumber=="number"&&typeof e.startColumn=="number"&&typeof e.endLineNumber=="number"&&typeof e.endColumn=="number"}static areIntersectingOrTouching(e,t){return!(e.endLineNumber<t.startLineNumber||e.endLineNumber===t.startLineNumber&&e.endColumn<t.startColumn||t.endLineNumber<e.startLineNumber||t.endLineNumber===e.startLineNumber&&t.endColumn<e.startColumn)}static areIntersecting(e,t){return!(e.endLineNumber<t.startLineNumber||e.endLineNumber===t.startLineNumber&&e.endColumn<=t.startColumn||t.endLineNumber<e.startLineNumber||t.endLineNumber===e.startLineNumber&&t.endColumn<=e.startColumn)}static compareRangesUsingStarts(e,t){if(e&&t){const r=e.startLineNumber|0,o=t.startLineNumber|0;if(r===o){const a=e.startColumn|0,l=t.startColumn|0;if(a===l){const u=e.endLineNumber|0,c=t.endLineNumber|0;if(u===c){const h=e.endColumn|0,d=t.endColumn|0;return h-d}return u-c}return a-l}return r-o}return(e?1:0)-(t?1:0)}static compareRangesUsingEnds(e,t){return e.endLineNumber===t.endLineNumber?e.endColumn===t.endColumn?e.startLineNumber===t.startLineNumber?e.startColumn-t.startColumn:e.startLineNumber-t.startLineNumber:e.endColumn-t.endColumn:e.endLineNumber-t.endLineNumber}static spansMultipleLines(e){return e.endLineNumber>e.startLineNumber}toJSON(){return this}}class Z extends w{constructor(e,t,n,i){super(e,t,n,i),this.selectionStartLineNumber=e,this.selectionStartColumn=t,this.positionLineNumber=n,this.positionColumn=i}toString(){return"["+this.selectionStartLineNumber+","+this.selectionStartColumn+" -> "+this.positionLineNumber+","+this.positionColumn+"]"}equalsSelection(e){return Z.selectionsEqual(this,e)}static selectionsEqual(e,t){return e.selectionStartLineNumber===t.selectionStartLineNumber&&e.selectionStartColumn===t.selectionStartColumn&&e.positionLineNumber===t.positionLineNumber&&e.positionColumn===t.positionColumn}getDirection(){return this.selectionStartLineNumber===this.startLineNumber&&this.selectionStartColumn===this.startColumn?0:1}setEndPosition(e,t){return this.getDirection()===0?new Z(this.startLineNumber,this.startColumn,e,t):new Z(e,t,this.startLineNumber,this.startColumn)}getPosition(){return new I(this.positionLineNumber,this.positionColumn)}getSelectionStart(){return new I(this.selectionStartLineNumber,this.selectionStartColumn)}setStartPosition(e,t){return this.getDirection()===0?new Z(e,t,this.endLineNumber,this.endColumn):new Z(this.endLineNumber,this.endColumn,e,t)}static fromPositions(e,t=e){return new Z(e.lineNumber,e.column,t.lineNumber,t.column)}static fromRange(e,t){return t===0?new Z(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn):new Z(e.endLineNumber,e.endColumn,e.startLineNumber,e.startColumn)}static liftSelection(e){return new Z(e.selectionStartLineNumber,e.selectionStartColumn,e.positionLineNumber,e.positionColumn)}static selectionsArrEqual(e,t){if(e&&!t||!e&&t)return!1;if(!e&&!t)return!0;if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(!this.selectionsEqual(e[n],t[n]))return!1;return!0}static isISelection(e){return e&&typeof e.selectionStartLineNumber=="number"&&typeof e.selectionStartColumn=="number"&&typeof e.positionLineNumber=="number"&&typeof e.positionColumn=="number"}static createWithDirection(e,t,n,i,r){return r===0?new Z(e,t,n,i):new Z(n,i,e,t)}}let Ec=class{constructor(){this._tokenizationSupports=new Map,this._factories=new Map,this._onDidChange=new J,this.onDidChange=this._onDidChange.event,this._colorMap=null}handleChange(e){this._onDidChange.fire({changedLanguages:e,changedColorMap:!1})}register(e,t){return this._tokenizationSupports.set(e,t),this.handleChange([e]),tn(()=>{this._tokenizationSupports.get(e)===t&&(this._tokenizationSupports.delete(e),this.handleChange([e]))})}get(e){return this._tokenizationSupports.get(e)||null}registerFactory(e,t){var i;(i=this._factories.get(e))==null||i.dispose();const n=new Uf(this,e,t);return this._factories.set(e,n),tn(()=>{const r=this._factories.get(e);!r||r!==n||(this._factories.delete(e),r.dispose())})}async getOrCreate(e){const t=this.get(e);if(t)return t;const n=this._factories.get(e);return!n||n.isResolved?null:(await n.resolve(),this.get(e))}isResolved(e){if(this.get(e))return!0;const n=this._factories.get(e);return!!(!n||n.isResolved)}setColorMap(e){this._colorMap=e,this._onDidChange.fire({changedLanguages:Array.from(this._tokenizationSupports.keys()),changedColorMap:!0})}getColorMap(){return this._colorMap}getDefaultBackground(){return this._colorMap&&this._colorMap.length>2?this._colorMap[2]:null}};class Uf extends oe{get isResolved(){return this._isResolved}constructor(e,t,n){super(),this._registry=e,this._languageId=t,this._factory=n,this._isDisposed=!1,this._resolvePromise=null,this._isResolved=!1}dispose(){this._isDisposed=!0,super.dispose()}async resolve(){return this._resolvePromise||(this._resolvePromise=this._create()),this._resolvePromise}async _create(){const e=await this._factory.tokenizationSupport;this._isResolved=!0,e&&!this._isDisposed&&this._register(this._registry.register(this._languageId,e))}}let yc=class{constructor(e,t,n){this.offset=e,this.type=t,this.language=n,this._tokenBrand=void 0}toString(){return"("+this.offset+", "+this.type+")"}};class qf{constructor(e,t){this.tokens=e,this.endState=t,this._tokenizationResultBrand=void 0}}class Gf{constructor(e,t){this.tokens=e,this.endState=t,this._encodedTokenizationResultBrand=void 0}}var Ia;(function(s){s[s.Increase=0]="Increase",s[s.Decrease=1]="Decrease"})(Ia||(Ia={}));var Na;(function(s){const e=new Map;e.set(0,A.symbolMethod),e.set(1,A.symbolFunction),e.set(2,A.symbolConstructor),e.set(3,A.symbolField),e.set(4,A.symbolVariable),e.set(5,A.symbolClass),e.set(6,A.symbolStruct),e.set(7,A.symbolInterface),e.set(8,A.symbolModule),e.set(9,A.symbolProperty),e.set(10,A.symbolEvent),e.set(11,A.symbolOperator),e.set(12,A.symbolUnit),e.set(13,A.symbolValue),e.set(15,A.symbolEnum),e.set(14,A.symbolConstant),e.set(15,A.symbolEnum),e.set(16,A.symbolEnumMember),e.set(17,A.symbolKeyword),e.set(27,A.symbolSnippet),e.set(18,A.symbolText),e.set(19,A.symbolColor),e.set(20,A.symbolFile),e.set(21,A.symbolReference),e.set(22,A.symbolCustomColor),e.set(23,A.symbolFolder),e.set(24,A.symbolTypeParameter),e.set(25,A.account),e.set(26,A.issues);function t(r){let o=e.get(r);return o||(console.info("No codicon found for CompletionItemKind "+r),o=A.symbolProperty),o}s.toIcon=t;const n=new Map;n.set("method",0),n.set("function",1),n.set("constructor",2),n.set("field",3),n.set("variable",4),n.set("class",5),n.set("struct",6),n.set("interface",7),n.set("module",8),n.set("property",9),n.set("event",10),n.set("operator",11),n.set("unit",12),n.set("value",13),n.set("constant",14),n.set("enum",15),n.set("enum-member",16),n.set("enumMember",16),n.set("keyword",17),n.set("snippet",27),n.set("text",18),n.set("color",19),n.set("file",20),n.set("reference",21),n.set("customcolor",22),n.set("folder",23),n.set("type-parameter",24),n.set("typeParameter",24),n.set("account",25),n.set("issue",26);function i(r,o){let a=n.get(r);return typeof a>"u"&&!o&&(a=9),a}s.fromString=i})(Na||(Na={}));var xa;(function(s){s[s.Automatic=0]="Automatic",s[s.Explicit=1]="Explicit"})(xa||(xa={}));class rw{constructor(e,t,n,i){this.range=e,this.text=t,this.completionKind=n,this.isSnippetText=i}equals(e){return w.lift(this.range).equalsRange(e.range)&&this.text===e.text&&this.completionKind===e.completionKind&&this.isSnippetText===e.isSnippetText}}var Ta;(function(s){s[s.Automatic=0]="Automatic",s[s.PasteAs=1]="PasteAs"})(Ta||(Ta={}));var Ea;(function(s){s[s.Invoke=1]="Invoke",s[s.TriggerCharacter=2]="TriggerCharacter",s[s.ContentChange=3]="ContentChange"})(Ea||(Ea={}));var ya;(function(s){s[s.Text=0]="Text",s[s.Read=1]="Read",s[s.Write=2]="Write"})(ya||(ya={}));function ow(s){return s&&ot.isUri(s.uri)&&w.isIRange(s.range)&&(w.isIRange(s.originSelectionRange)||w.isIRange(s.targetSelectionRange))}const $f={17:g("Array","array"),16:g("Boolean","boolean"),4:g("Class","class"),13:g("Constant","constant"),8:g("Constructor","constructor"),9:g("Enum","enumeration"),21:g("EnumMember","enumeration member"),23:g("Event","event"),7:g("Field","field"),0:g("File","file"),11:g("Function","function"),10:g("Interface","interface"),19:g("Key","key"),5:g("Method","method"),1:g("Module","module"),2:g("Namespace","namespace"),20:g("Null","null"),15:g("Number","number"),18:g("Object","object"),24:g("Operator","operator"),3:g("Package","package"),6:g("Property","property"),14:g("String","string"),22:g("Struct","struct"),25:g("TypeParameter","type parameter"),12:g("Variable","variable")};function aw(s,e){return g("symbolAriaLabel","{0} ({1})",s,$f[e])}var Ra;(function(s){const e=new Map;e.set(0,A.symbolFile),e.set(1,A.symbolModule),e.set(2,A.symbolNamespace),e.set(3,A.symbolPackage),e.set(4,A.symbolClass),e.set(5,A.symbolMethod),e.set(6,A.symbolProperty),e.set(7,A.symbolField),e.set(8,A.symbolConstructor),e.set(9,A.symbolEnum),e.set(10,A.symbolInterface),e.set(11,A.symbolFunction),e.set(12,A.symbolVariable),e.set(13,A.symbolConstant),e.set(14,A.symbolString),e.set(15,A.symbolNumber),e.set(16,A.symbolBoolean),e.set(17,A.symbolArray),e.set(18,A.symbolObject),e.set(19,A.symbolKey),e.set(20,A.symbolNull),e.set(21,A.symbolEnumMember),e.set(22,A.symbolStruct),e.set(23,A.symbolEvent),e.set(24,A.symbolOperator),e.set(25,A.symbolTypeParameter);function t(n){let i=e.get(n);return i||(console.info("No codicon found for SymbolKind "+n),i=A.symbolProperty),i}s.toIcon=t})(Ra||(Ra={}));const Ue=class Ue{static fromValue(e){switch(e){case"comment":return Ue.Comment;case"imports":return Ue.Imports;case"region":return Ue.Region}return new Ue(e)}constructor(e){this.value=e}};Ue.Comment=new Ue("comment"),Ue.Imports=new Ue("imports"),Ue.Region=new Ue("region");let Ma=Ue;var Pa;(function(s){s[s.AIGenerated=1]="AIGenerated"})(Pa||(Pa={}));var Aa;(function(s){s[s.Invoke=0]="Invoke",s[s.Automatic=1]="Automatic"})(Aa||(Aa={}));var Da;(function(s){function e(t){return!t||typeof t!="object"?!1:typeof t.id=="string"&&typeof t.title=="string"}s.is=e})(Da||(Da={}));var Oa;(function(s){s[s.Type=1]="Type",s[s.Parameter=2]="Parameter"})(Oa||(Oa={}));class lw{constructor(e){this.createSupport=e,this._tokenizationSupport=null}dispose(){this._tokenizationSupport&&this._tokenizationSupport.then(e=>{e&&e.dispose()})}get tokenizationSupport(){return this._tokenizationSupport||(this._tokenizationSupport=this.createSupport()),this._tokenizationSupport}}const nn=new Ec,qr=new Ec;var Ba;(function(s){s[s.Invoke=0]="Invoke",s[s.Automatic=1]="Automatic"})(Ba||(Ba={}));var Va;(function(s){s[s.Unknown=0]="Unknown",s[s.Disabled=1]="Disabled",s[s.Enabled=2]="Enabled"})(Va||(Va={}));var Wa;(function(s){s[s.Invoke=1]="Invoke",s[s.Auto=2]="Auto"})(Wa||(Wa={}));var Fa;(function(s){s[s.None=0]="None",s[s.KeepWhitespace=1]="KeepWhitespace",s[s.InsertAsSnippet=4]="InsertAsSnippet"})(Fa||(Fa={}));var za;(function(s){s[s.Method=0]="Method",s[s.Function=1]="Function",s[s.Constructor=2]="Constructor",s[s.Field=3]="Field",s[s.Variable=4]="Variable",s[s.Class=5]="Class",s[s.Struct=6]="Struct",s[s.Interface=7]="Interface",s[s.Module=8]="Module",s[s.Property=9]="Property",s[s.Event=10]="Event",s[s.Operator=11]="Operator",s[s.Unit=12]="Unit",s[s.Value=13]="Value",s[s.Constant=14]="Constant",s[s.Enum=15]="Enum",s[s.EnumMember=16]="EnumMember",s[s.Keyword=17]="Keyword",s[s.Text=18]="Text",s[s.Color=19]="Color",s[s.File=20]="File",s[s.Reference=21]="Reference",s[s.Customcolor=22]="Customcolor",s[s.Folder=23]="Folder",s[s.TypeParameter=24]="TypeParameter",s[s.User=25]="User",s[s.Issue=26]="Issue",s[s.Snippet=27]="Snippet"})(za||(za={}));var Ha;(function(s){s[s.Deprecated=1]="Deprecated"})(Ha||(Ha={}));var ja;(function(s){s[s.Invoke=0]="Invoke",s[s.TriggerCharacter=1]="TriggerCharacter",s[s.TriggerForIncompleteCompletions=2]="TriggerForIncompleteCompletions"})(ja||(ja={}));var Ua;(function(s){s[s.EXACT=0]="EXACT",s[s.ABOVE=1]="ABOVE",s[s.BELOW=2]="BELOW"})(Ua||(Ua={}));var qa;(function(s){s[s.NotSet=0]="NotSet",s[s.ContentFlush=1]="ContentFlush",s[s.RecoverFromMarkers=2]="RecoverFromMarkers",s[s.Explicit=3]="Explicit",s[s.Paste=4]="Paste",s[s.Undo=5]="Undo",s[s.Redo=6]="Redo"})(qa||(qa={}));var Ga;(function(s){s[s.LF=1]="LF",s[s.CRLF=2]="CRLF"})(Ga||(Ga={}));var $a;(function(s){s[s.Text=0]="Text",s[s.Read=1]="Read",s[s.Write=2]="Write"})($a||($a={}));var Qa;(function(s){s[s.None=0]="None",s[s.Keep=1]="Keep",s[s.Brackets=2]="Brackets",s[s.Advanced=3]="Advanced",s[s.Full=4]="Full"})(Qa||(Qa={}));var Za;(function(s){s[s.acceptSuggestionOnCommitCharacter=0]="acceptSuggestionOnCommitCharacter",s[s.acceptSuggestionOnEnter=1]="acceptSuggestionOnEnter",s[s.accessibilitySupport=2]="accessibilitySupport",s[s.accessibilityPageSize=3]="accessibilityPageSize",s[s.ariaLabel=4]="ariaLabel",s[s.ariaRequired=5]="ariaRequired",s[s.autoClosingBrackets=6]="autoClosingBrackets",s[s.autoClosingComments=7]="autoClosingComments",s[s.screenReaderAnnounceInlineSuggestion=8]="screenReaderAnnounceInlineSuggestion",s[s.autoClosingDelete=9]="autoClosingDelete",s[s.autoClosingOvertype=10]="autoClosingOvertype",s[s.autoClosingQuotes=11]="autoClosingQuotes",s[s.autoIndent=12]="autoIndent",s[s.automaticLayout=13]="automaticLayout",s[s.autoSurround=14]="autoSurround",s[s.bracketPairColorization=15]="bracketPairColorization",s[s.guides=16]="guides",s[s.codeLens=17]="codeLens",s[s.codeLensFontFamily=18]="codeLensFontFamily",s[s.codeLensFontSize=19]="codeLensFontSize",s[s.colorDecorators=20]="colorDecorators",s[s.colorDecoratorsLimit=21]="colorDecoratorsLimit",s[s.columnSelection=22]="columnSelection",s[s.comments=23]="comments",s[s.contextmenu=24]="contextmenu",s[s.copyWithSyntaxHighlighting=25]="copyWithSyntaxHighlighting",s[s.cursorBlinking=26]="cursorBlinking",s[s.cursorSmoothCaretAnimation=27]="cursorSmoothCaretAnimation",s[s.cursorStyle=28]="cursorStyle",s[s.cursorSurroundingLines=29]="cursorSurroundingLines",s[s.cursorSurroundingLinesStyle=30]="cursorSurroundingLinesStyle",s[s.cursorWidth=31]="cursorWidth",s[s.disableLayerHinting=32]="disableLayerHinting",s[s.disableMonospaceOptimizations=33]="disableMonospaceOptimizations",s[s.domReadOnly=34]="domReadOnly",s[s.dragAndDrop=35]="dragAndDrop",s[s.dropIntoEditor=36]="dropIntoEditor",s[s.emptySelectionClipboard=37]="emptySelectionClipboard",s[s.experimentalWhitespaceRendering=38]="experimentalWhitespaceRendering",s[s.extraEditorClassName=39]="extraEditorClassName",s[s.fastScrollSensitivity=40]="fastScrollSensitivity",s[s.find=41]="find",s[s.fixedOverflowWidgets=42]="fixedOverflowWidgets",s[s.folding=43]="folding",s[s.foldingStrategy=44]="foldingStrategy",s[s.foldingHighlight=45]="foldingHighlight",s[s.foldingImportsByDefault=46]="foldingImportsByDefault",s[s.foldingMaximumRegions=47]="foldingMaximumRegions",s[s.unfoldOnClickAfterEndOfLine=48]="unfoldOnClickAfterEndOfLine",s[s.fontFamily=49]="fontFamily",s[s.fontInfo=50]="fontInfo",s[s.fontLigatures=51]="fontLigatures",s[s.fontSize=52]="fontSize",s[s.fontWeight=53]="fontWeight",s[s.fontVariations=54]="fontVariations",s[s.formatOnPaste=55]="formatOnPaste",s[s.formatOnType=56]="formatOnType",s[s.glyphMargin=57]="glyphMargin",s[s.gotoLocation=58]="gotoLocation",s[s.hideCursorInOverviewRuler=59]="hideCursorInOverviewRuler",s[s.hover=60]="hover",s[s.inDiffEditor=61]="inDiffEditor",s[s.inlineSuggest=62]="inlineSuggest",s[s.inlineEdit=63]="inlineEdit",s[s.letterSpacing=64]="letterSpacing",s[s.lightbulb=65]="lightbulb",s[s.lineDecorationsWidth=66]="lineDecorationsWidth",s[s.lineHeight=67]="lineHeight",s[s.lineNumbers=68]="lineNumbers",s[s.lineNumbersMinChars=69]="lineNumbersMinChars",s[s.linkedEditing=70]="linkedEditing",s[s.links=71]="links",s[s.matchBrackets=72]="matchBrackets",s[s.minimap=73]="minimap",s[s.mouseStyle=74]="mouseStyle",s[s.mouseWheelScrollSensitivity=75]="mouseWheelScrollSensitivity",s[s.mouseWheelZoom=76]="mouseWheelZoom",s[s.multiCursorMergeOverlapping=77]="multiCursorMergeOverlapping",s[s.multiCursorModifier=78]="multiCursorModifier",s[s.multiCursorPaste=79]="multiCursorPaste",s[s.multiCursorLimit=80]="multiCursorLimit",s[s.occurrencesHighlight=81]="occurrencesHighlight",s[s.overviewRulerBorder=82]="overviewRulerBorder",s[s.overviewRulerLanes=83]="overviewRulerLanes",s[s.padding=84]="padding",s[s.pasteAs=85]="pasteAs",s[s.parameterHints=86]="parameterHints",s[s.peekWidgetDefaultFocus=87]="peekWidgetDefaultFocus",s[s.placeholder=88]="placeholder",s[s.definitionLinkOpensInPeek=89]="definitionLinkOpensInPeek",s[s.quickSuggestions=90]="quickSuggestions",s[s.quickSuggestionsDelay=91]="quickSuggestionsDelay",s[s.readOnly=92]="readOnly",s[s.readOnlyMessage=93]="readOnlyMessage",s[s.renameOnType=94]="renameOnType",s[s.renderControlCharacters=95]="renderControlCharacters",s[s.renderFinalNewline=96]="renderFinalNewline",s[s.renderLineHighlight=97]="renderLineHighlight",s[s.renderLineHighlightOnlyWhenFocus=98]="renderLineHighlightOnlyWhenFocus",s[s.renderValidationDecorations=99]="renderValidationDecorations",s[s.renderWhitespace=100]="renderWhitespace",s[s.revealHorizontalRightPadding=101]="revealHorizontalRightPadding",s[s.roundedSelection=102]="roundedSelection",s[s.rulers=103]="rulers",s[s.scrollbar=104]="scrollbar",s[s.scrollBeyondLastColumn=105]="scrollBeyondLastColumn",s[s.scrollBeyondLastLine=106]="scrollBeyondLastLine",s[s.scrollPredominantAxis=107]="scrollPredominantAxis",s[s.selectionClipboard=108]="selectionClipboard",s[s.selectionHighlight=109]="selectionHighlight",s[s.selectOnLineNumbers=110]="selectOnLineNumbers",s[s.showFoldingControls=111]="showFoldingControls",s[s.showUnused=112]="showUnused",s[s.snippetSuggestions=113]="snippetSuggestions",s[s.smartSelect=114]="smartSelect",s[s.smoothScrolling=115]="smoothScrolling",s[s.stickyScroll=116]="stickyScroll",s[s.stickyTabStops=117]="stickyTabStops",s[s.stopRenderingLineAfter=118]="stopRenderingLineAfter",s[s.suggest=119]="suggest",s[s.suggestFontSize=120]="suggestFontSize",s[s.suggestLineHeight=121]="suggestLineHeight",s[s.suggestOnTriggerCharacters=122]="suggestOnTriggerCharacters",s[s.suggestSelection=123]="suggestSelection",s[s.tabCompletion=124]="tabCompletion",s[s.tabIndex=125]="tabIndex",s[s.unicodeHighlighting=126]="unicodeHighlighting",s[s.unusualLineTerminators=127]="unusualLineTerminators",s[s.useShadowDOM=128]="useShadowDOM",s[s.useTabStops=129]="useTabStops",s[s.wordBreak=130]="wordBreak",s[s.wordSegmenterLocales=131]="wordSegmenterLocales",s[s.wordSeparators=132]="wordSeparators",s[s.wordWrap=133]="wordWrap",s[s.wordWrapBreakAfterCharacters=134]="wordWrapBreakAfterCharacters",s[s.wordWrapBreakBeforeCharacters=135]="wordWrapBreakBeforeCharacters",s[s.wordWrapColumn=136]="wordWrapColumn",s[s.wordWrapOverride1=137]="wordWrapOverride1",s[s.wordWrapOverride2=138]="wordWrapOverride2",s[s.wrappingIndent=139]="wrappingIndent",s[s.wrappingStrategy=140]="wrappingStrategy",s[s.showDeprecated=141]="showDeprecated",s[s.inlayHints=142]="inlayHints",s[s.editorClassName=143]="editorClassName",s[s.pixelRatio=144]="pixelRatio",s[s.tabFocusMode=145]="tabFocusMode",s[s.layoutInfo=146]="layoutInfo",s[s.wrappingInfo=147]="wrappingInfo",s[s.defaultColorDecorators=148]="defaultColorDecorators",s[s.colorDecoratorsActivatedOn=149]="colorDecoratorsActivatedOn",s[s.inlineCompletionsAccessibilityVerbose=150]="inlineCompletionsAccessibilityVerbose"})(Za||(Za={}));var Xa;(function(s){s[s.TextDefined=0]="TextDefined",s[s.LF=1]="LF",s[s.CRLF=2]="CRLF"})(Xa||(Xa={}));var Ja;(function(s){s[s.LF=0]="LF",s[s.CRLF=1]="CRLF"})(Ja||(Ja={}));var Ya;(function(s){s[s.Left=1]="Left",s[s.Center=2]="Center",s[s.Right=3]="Right"})(Ya||(Ya={}));var Ka;(function(s){s[s.Increase=0]="Increase",s[s.Decrease=1]="Decrease"})(Ka||(Ka={}));var el;(function(s){s[s.None=0]="None",s[s.Indent=1]="Indent",s[s.IndentOutdent=2]="IndentOutdent",s[s.Outdent=3]="Outdent"})(el||(el={}));var tl;(function(s){s[s.Both=0]="Both",s[s.Right=1]="Right",s[s.Left=2]="Left",s[s.None=3]="None"})(tl||(tl={}));var nl;(function(s){s[s.Type=1]="Type",s[s.Parameter=2]="Parameter"})(nl||(nl={}));var il;(function(s){s[s.Automatic=0]="Automatic",s[s.Explicit=1]="Explicit"})(il||(il={}));var sl;(function(s){s[s.Invoke=0]="Invoke",s[s.Automatic=1]="Automatic"})(sl||(sl={}));var Gr;(function(s){s[s.DependsOnKbLayout=-1]="DependsOnKbLayout",s[s.Unknown=0]="Unknown",s[s.Backspace=1]="Backspace",s[s.Tab=2]="Tab",s[s.Enter=3]="Enter",s[s.Shift=4]="Shift",s[s.Ctrl=5]="Ctrl",s[s.Alt=6]="Alt",s[s.PauseBreak=7]="PauseBreak",s[s.CapsLock=8]="CapsLock",s[s.Escape=9]="Escape",s[s.Space=10]="Space",s[s.PageUp=11]="PageUp",s[s.PageDown=12]="PageDown",s[s.End=13]="End",s[s.Home=14]="Home",s[s.LeftArrow=15]="LeftArrow",s[s.UpArrow=16]="UpArrow",s[s.RightArrow=17]="RightArrow",s[s.DownArrow=18]="DownArrow",s[s.Insert=19]="Insert",s[s.Delete=20]="Delete",s[s.Digit0=21]="Digit0",s[s.Digit1=22]="Digit1",s[s.Digit2=23]="Digit2",s[s.Digit3=24]="Digit3",s[s.Digit4=25]="Digit4",s[s.Digit5=26]="Digit5",s[s.Digit6=27]="Digit6",s[s.Digit7=28]="Digit7",s[s.Digit8=29]="Digit8",s[s.Digit9=30]="Digit9",s[s.KeyA=31]="KeyA",s[s.KeyB=32]="KeyB",s[s.KeyC=33]="KeyC",s[s.KeyD=34]="KeyD",s[s.KeyE=35]="KeyE",s[s.KeyF=36]="KeyF",s[s.KeyG=37]="KeyG",s[s.KeyH=38]="KeyH",s[s.KeyI=39]="KeyI",s[s.KeyJ=40]="KeyJ",s[s.KeyK=41]="KeyK",s[s.KeyL=42]="KeyL",s[s.KeyM=43]="KeyM",s[s.KeyN=44]="KeyN",s[s.KeyO=45]="KeyO",s[s.KeyP=46]="KeyP",s[s.KeyQ=47]="KeyQ",s[s.KeyR=48]="KeyR",s[s.KeyS=49]="KeyS",s[s.KeyT=50]="KeyT",s[s.KeyU=51]="KeyU",s[s.KeyV=52]="KeyV",s[s.KeyW=53]="KeyW",s[s.KeyX=54]="KeyX",s[s.KeyY=55]="KeyY",s[s.KeyZ=56]="KeyZ",s[s.Meta=57]="Meta",s[s.ContextMenu=58]="ContextMenu",s[s.F1=59]="F1",s[s.F2=60]="F2",s[s.F3=61]="F3",s[s.F4=62]="F4",s[s.F5=63]="F5",s[s.F6=64]="F6",s[s.F7=65]="F7",s[s.F8=66]="F8",s[s.F9=67]="F9",s[s.F10=68]="F10",s[s.F11=69]="F11",s[s.F12=70]="F12",s[s.F13=71]="F13",s[s.F14=72]="F14",s[s.F15=73]="F15",s[s.F16=74]="F16",s[s.F17=75]="F17",s[s.F18=76]="F18",s[s.F19=77]="F19",s[s.F20=78]="F20",s[s.F21=79]="F21",s[s.F22=80]="F22",s[s.F23=81]="F23",s[s.F24=82]="F24",s[s.NumLock=83]="NumLock",s[s.ScrollLock=84]="ScrollLock",s[s.Semicolon=85]="Semicolon",s[s.Equal=86]="Equal",s[s.Comma=87]="Comma",s[s.Minus=88]="Minus",s[s.Period=89]="Period",s[s.Slash=90]="Slash",s[s.Backquote=91]="Backquote",s[s.BracketLeft=92]="BracketLeft",s[s.Backslash=93]="Backslash",s[s.BracketRight=94]="BracketRight",s[s.Quote=95]="Quote",s[s.OEM_8=96]="OEM_8",s[s.IntlBackslash=97]="IntlBackslash",s[s.Numpad0=98]="Numpad0",s[s.Numpad1=99]="Numpad1",s[s.Numpad2=100]="Numpad2",s[s.Numpad3=101]="Numpad3",s[s.Numpad4=102]="Numpad4",s[s.Numpad5=103]="Numpad5",s[s.Numpad6=104]="Numpad6",s[s.Numpad7=105]="Numpad7",s[s.Numpad8=106]="Numpad8",s[s.Numpad9=107]="Numpad9",s[s.NumpadMultiply=108]="NumpadMultiply",s[s.NumpadAdd=109]="NumpadAdd",s[s.NUMPAD_SEPARATOR=110]="NUMPAD_SEPARATOR",s[s.NumpadSubtract=111]="NumpadSubtract",s[s.NumpadDecimal=112]="NumpadDecimal",s[s.NumpadDivide=113]="NumpadDivide",s[s.KEY_IN_COMPOSITION=114]="KEY_IN_COMPOSITION",s[s.ABNT_C1=115]="ABNT_C1",s[s.ABNT_C2=116]="ABNT_C2",s[s.AudioVolumeMute=117]="AudioVolumeMute",s[s.AudioVolumeUp=118]="AudioVolumeUp",s[s.AudioVolumeDown=119]="AudioVolumeDown",s[s.BrowserSearch=120]="BrowserSearch",s[s.BrowserHome=121]="BrowserHome",s[s.BrowserBack=122]="BrowserBack",s[s.BrowserForward=123]="BrowserForward",s[s.MediaTrackNext=124]="MediaTrackNext",s[s.MediaTrackPrevious=125]="MediaTrackPrevious",s[s.MediaStop=126]="MediaStop",s[s.MediaPlayPause=127]="MediaPlayPause",s[s.LaunchMediaPlayer=128]="LaunchMediaPlayer",s[s.LaunchMail=129]="LaunchMail",s[s.LaunchApp2=130]="LaunchApp2",s[s.Clear=131]="Clear",s[s.MAX_VALUE=132]="MAX_VALUE"})(Gr||(Gr={}));var $r;(function(s){s[s.Hint=1]="Hint",s[s.Info=2]="Info",s[s.Warning=4]="Warning",s[s.Error=8]="Error"})($r||($r={}));var Qr;(function(s){s[s.Unnecessary=1]="Unnecessary",s[s.Deprecated=2]="Deprecated"})(Qr||(Qr={}));var rl;(function(s){s[s.Inline=1]="Inline",s[s.Gutter=2]="Gutter"})(rl||(rl={}));var ol;(function(s){s[s.Normal=1]="Normal",s[s.Underlined=2]="Underlined"})(ol||(ol={}));var al;(function(s){s[s.UNKNOWN=0]="UNKNOWN",s[s.TEXTAREA=1]="TEXTAREA",s[s.GUTTER_GLYPH_MARGIN=2]="GUTTER_GLYPH_MARGIN",s[s.GUTTER_LINE_NUMBERS=3]="GUTTER_LINE_NUMBERS",s[s.GUTTER_LINE_DECORATIONS=4]="GUTTER_LINE_DECORATIONS",s[s.GUTTER_VIEW_ZONE=5]="GUTTER_VIEW_ZONE",s[s.CONTENT_TEXT=6]="CONTENT_TEXT",s[s.CONTENT_EMPTY=7]="CONTENT_EMPTY",s[s.CONTENT_VIEW_ZONE=8]="CONTENT_VIEW_ZONE",s[s.CONTENT_WIDGET=9]="CONTENT_WIDGET",s[s.OVERVIEW_RULER=10]="OVERVIEW_RULER",s[s.SCROLLBAR=11]="SCROLLBAR",s[s.OVERLAY_WIDGET=12]="OVERLAY_WIDGET",s[s.OUTSIDE_EDITOR=13]="OUTSIDE_EDITOR"})(al||(al={}));var ll;(function(s){s[s.AIGenerated=1]="AIGenerated"})(ll||(ll={}));var ul;(function(s){s[s.Invoke=0]="Invoke",s[s.Automatic=1]="Automatic"})(ul||(ul={}));var cl;(function(s){s[s.TOP_RIGHT_CORNER=0]="TOP_RIGHT_CORNER",s[s.BOTTOM_RIGHT_CORNER=1]="BOTTOM_RIGHT_CORNER",s[s.TOP_CENTER=2]="TOP_CENTER"})(cl||(cl={}));var hl;(function(s){s[s.Left=1]="Left",s[s.Center=2]="Center",s[s.Right=4]="Right",s[s.Full=7]="Full"})(hl||(hl={}));var dl;(function(s){s[s.Word=0]="Word",s[s.Line=1]="Line",s[s.Suggest=2]="Suggest"})(dl||(dl={}));var fl;(function(s){s[s.Left=0]="Left",s[s.Right=1]="Right",s[s.None=2]="None",s[s.LeftOfInjectedText=3]="LeftOfInjectedText",s[s.RightOfInjectedText=4]="RightOfInjectedText"})(fl||(fl={}));var gl;(function(s){s[s.Off=0]="Off",s[s.On=1]="On",s[s.Relative=2]="Relative",s[s.Interval=3]="Interval",s[s.Custom=4]="Custom"})(gl||(gl={}));var ml;(function(s){s[s.None=0]="None",s[s.Text=1]="Text",s[s.Blocks=2]="Blocks"})(ml||(ml={}));var pl;(function(s){s[s.Smooth=0]="Smooth",s[s.Immediate=1]="Immediate"})(pl||(pl={}));var Cl;(function(s){s[s.Auto=1]="Auto",s[s.Hidden=2]="Hidden",s[s.Visible=3]="Visible"})(Cl||(Cl={}));var Zr;(function(s){s[s.LTR=0]="LTR",s[s.RTL=1]="RTL"})(Zr||(Zr={}));var bl;(function(s){s.Off="off",s.OnCode="onCode",s.On="on"})(bl||(bl={}));var Ll;(function(s){s[s.Invoke=1]="Invoke",s[s.TriggerCharacter=2]="TriggerCharacter",s[s.ContentChange=3]="ContentChange"})(Ll||(Ll={}));var wl;(function(s){s[s.File=0]="File",s[s.Module=1]="Module",s[s.Namespace=2]="Namespace",s[s.Package=3]="Package",s[s.Class=4]="Class",s[s.Method=5]="Method",s[s.Property=6]="Property",s[s.Field=7]="Field",s[s.Constructor=8]="Constructor",s[s.Enum=9]="Enum",s[s.Interface=10]="Interface",s[s.Function=11]="Function",s[s.Variable=12]="Variable",s[s.Constant=13]="Constant",s[s.String=14]="String",s[s.Number=15]="Number",s[s.Boolean=16]="Boolean",s[s.Array=17]="Array",s[s.Object=18]="Object",s[s.Key=19]="Key",s[s.Null=20]="Null",s[s.EnumMember=21]="EnumMember",s[s.Struct=22]="Struct",s[s.Event=23]="Event",s[s.Operator=24]="Operator",s[s.TypeParameter=25]="TypeParameter"})(wl||(wl={}));var _l;(function(s){s[s.Deprecated=1]="Deprecated"})(_l||(_l={}));var Sl;(function(s){s[s.Hidden=0]="Hidden",s[s.Blink=1]="Blink",s[s.Smooth=2]="Smooth",s[s.Phase=3]="Phase",s[s.Expand=4]="Expand",s[s.Solid=5]="Solid"})(Sl||(Sl={}));var kl;(function(s){s[s.Line=1]="Line",s[s.Block=2]="Block",s[s.Underline=3]="Underline",s[s.LineThin=4]="LineThin",s[s.BlockOutline=5]="BlockOutline",s[s.UnderlineThin=6]="UnderlineThin"})(kl||(kl={}));var vl;(function(s){s[s.AlwaysGrowsWhenTypingAtEdges=0]="AlwaysGrowsWhenTypingAtEdges",s[s.NeverGrowsWhenTypingAtEdges=1]="NeverGrowsWhenTypingAtEdges",s[s.GrowsOnlyWhenTypingBefore=2]="GrowsOnlyWhenTypingBefore",s[s.GrowsOnlyWhenTypingAfter=3]="GrowsOnlyWhenTypingAfter"})(vl||(vl={}));var Il;(function(s){s[s.None=0]="None",s[s.Same=1]="Same",s[s.Indent=2]="Indent",s[s.DeepIndent=3]="DeepIndent"})(Il||(Il={}));const kn=class kn{static chord(e,t){return Oh(e,t)}};kn.CtrlCmd=2048,kn.Shift=1024,kn.Alt=512,kn.WinCtrl=256;let Xr=kn;function Qf(){return{editor:void 0,languages:void 0,CancellationTokenSource:Dh,Emitter:J,KeyCode:Gr,KeyMod:Xr,Position:I,Range:w,Selection:Z,SelectionDirection:Zr,MarkerSeverity:$r,MarkerTag:Qr,Uri:ot,Token:yc}}const Zf=new class{constructor(){this._zoomLevel=0,this._onDidChangeZoomLevel=new J,this.onDidChangeZoomLevel=this._onDidChangeZoomLevel.event}getZoomLevel(){return this._zoomLevel}setZoomLevel(s){s=Math.min(Math.max(-5,s),20),this._zoomLevel!==s&&(this._zoomLevel=s,this._onDidChangeZoomLevel.fire(this._zoomLevel))}},Xf=xt?1.5:1.35,cr=8;class ni{static createFromValidatedSettings(e,t,n){const i=e.get(49),r=e.get(53),o=e.get(52),a=e.get(51),l=e.get(54),u=e.get(67),c=e.get(64);return ni._create(i,r,o,a,l,u,c,t,n)}static _create(e,t,n,i,r,o,a,l,u){o===0?o=Xf*n:o<cr&&(o=o*n),o=Math.round(o),o<cr&&(o=cr);const c=1+(u?0:Zf.getZoomLevel()*.1);return n*=c,o*=c,r===Ni.TRANSLATE&&(t==="normal"||t==="bold"?r=Ni.OFF:(r=`'wght' ${parseInt(t,10)}`,t="normal")),new ni({pixelRatio:l,fontFamily:e,fontWeight:t,fontSize:n,fontFeatureSettings:i,fontVariationSettings:r,lineHeight:o,letterSpacing:a})}constructor(e){this._bareFontInfoBrand=void 0,this.pixelRatio=e.pixelRatio,this.fontFamily=String(e.fontFamily),this.fontWeight=String(e.fontWeight),this.fontSize=e.fontSize,this.fontFeatureSettings=e.fontFeatureSettings,this.fontVariationSettings=e.fontVariationSettings,this.lineHeight=e.lineHeight|0,this.letterSpacing=e.letterSpacing}getId(){return`${this.pixelRatio}-${this.fontFamily}-${this.fontWeight}-${this.fontSize}-${this.fontFeatureSettings}-${this.fontVariationSettings}-${this.lineHeight}-${this.letterSpacing}`}getMassagedFontFamily(){const e=We.fontFamily,t=ni._wrapInQuotes(this.fontFamily);return this.fontFamily!==e?`${t}, ${e}`:t}static _wrapInQuotes(e){return/[,"']/.test(e)?e:/[+ ]/.test(e)?`"${e}"`:e}}const Jf=2;class uw extends ni{constructor(e,t){super(e),this._editorStylingBrand=void 0,this.version=Jf,this.isTrusted=t,this.isMonospace=e.isMonospace,this.typicalHalfwidthCharacterWidth=e.typicalHalfwidthCharacterWidth,this.typicalFullwidthCharacterWidth=e.typicalFullwidthCharacterWidth,this.canUseHalfwidthRightwardsArrow=e.canUseHalfwidthRightwardsArrow,this.spaceWidth=e.spaceWidth,this.middotWidth=e.middotWidth,this.wsmiddotWidth=e.wsmiddotWidth,this.maxDigitWidth=e.maxDigitWidth}equals(e){return this.fontFamily===e.fontFamily&&this.fontWeight===e.fontWeight&&this.fontSize===e.fontSize&&this.fontFeatureSettings===e.fontFeatureSettings&&this.fontVariationSettings===e.fontVariationSettings&&this.lineHeight===e.lineHeight&&this.letterSpacing===e.letterSpacing&&this.typicalHalfwidthCharacterWidth===e.typicalHalfwidthCharacterWidth&&this.typicalFullwidthCharacterWidth===e.typicalFullwidthCharacterWidth&&this.canUseHalfwidthRightwardsArrow===e.canUseHalfwidthRightwardsArrow&&this.spaceWidth===e.spaceWidth&&this.middotWidth===e.middotWidth&&this.wsmiddotWidth===e.wsmiddotWidth&&this.maxDigitWidth===e.maxDigitWidth}}const Yf=ze("modelService"),cw=ze("textModelService");var Ce;(function(s){s[s.None=0]="None",s[s.Indent=1]="Indent",s[s.IndentOutdent=2]="IndentOutdent",s[s.Outdent=3]="Outdent"})(Ce||(Ce={}));class hr{constructor(e){if(this._neutralCharacter=null,this._neutralCharacterSearched=!1,this.open=e.open,this.close=e.close,this._inString=!0,this._inComment=!0,this._inRegEx=!0,Array.isArray(e.notIn))for(let t=0,n=e.notIn.length;t<n;t++)switch(e.notIn[t]){case"string":this._inString=!1;break;case"comment":this._inComment=!1;break;case"regex":this._inRegEx=!1;break}}isOK(e){switch(e){case 0:return!0;case 1:return this._inComment;case 2:return this._inString;case 3:return this._inRegEx}}shouldAutoClose(e,t){if(e.getTokenCount()===0)return!0;const n=e.findTokenIndexAtOffset(t-2),i=e.getStandardTokenType(n);return this.isOK(i)}_findNeutralCharacterInRange(e,t){for(let n=e;n<=t;n++){const i=String.fromCharCode(n);if(!this.open.includes(i)&&!this.close.includes(i))return i}return null}findNeutralCharacter(){return this._neutralCharacterSearched||(this._neutralCharacterSearched=!0,this._neutralCharacter||(this._neutralCharacter=this._findNeutralCharacterInRange(48,57)),this._neutralCharacter||(this._neutralCharacter=this._findNeutralCharacterInRange(97,122)),this._neutralCharacter||(this._neutralCharacter=this._findNeutralCharacterInRange(65,90))),this._neutralCharacter}}class Kf{constructor(e){this.autoClosingPairsOpenByStart=new Map,this.autoClosingPairsOpenByEnd=new Map,this.autoClosingPairsCloseByStart=new Map,this.autoClosingPairsCloseByEnd=new Map,this.autoClosingPairsCloseSingleChar=new Map;for(const t of e)Hn(this.autoClosingPairsOpenByStart,t.open.charAt(0),t),Hn(this.autoClosingPairsOpenByEnd,t.open.charAt(t.open.length-1),t),Hn(this.autoClosingPairsCloseByStart,t.close.charAt(0),t),Hn(this.autoClosingPairsCloseByEnd,t.close.charAt(t.close.length-1),t),t.close.length===1&&t.open.length===1&&Hn(this.autoClosingPairsCloseSingleChar,t.close,t)}}function Hn(s,e,t){s.has(e)?s.get(e).push(t):s.set(e,[t])}const vn=class vn{constructor(e){if(e.autoClosingPairs?this._autoClosingPairs=e.autoClosingPairs.map(t=>new hr(t)):e.brackets?this._autoClosingPairs=e.brackets.map(t=>new hr({open:t[0],close:t[1]})):this._autoClosingPairs=[],e.__electricCharacterSupport&&e.__electricCharacterSupport.docComment){const t=e.__electricCharacterSupport.docComment;this._autoClosingPairs.push(new hr({open:t.open,close:t.close||""}))}this._autoCloseBeforeForQuotes=typeof e.autoCloseBefore=="string"?e.autoCloseBefore:vn.DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED_QUOTES,this._autoCloseBeforeForBrackets=typeof e.autoCloseBefore=="string"?e.autoCloseBefore:vn.DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED_BRACKETS,this._surroundingPairs=e.surroundingPairs||this._autoClosingPairs}getAutoClosingPairs(){return this._autoClosingPairs}getAutoCloseBeforeSet(e){return e?this._autoCloseBeforeForQuotes:this._autoCloseBeforeForBrackets}getSurroundingPairs(){return this._surroundingPairs}};vn.DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED_QUOTES=`;:.,=}])> 
	`,vn.DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED_BRACKETS=`'"\`;:.,=}])> 
	`;let Jr=vn;function Jt(s,e){const t=s.getCount(),n=s.findTokenIndexAtOffset(e),i=s.getLanguageId(n);let r=n;for(;r+1<t&&s.getLanguageId(r+1)===i;)r++;let o=n;for(;o>0&&s.getLanguageId(o-1)===i;)o--;return new eg(s,i,o,r+1,s.getStartOffset(o),s.getEndOffset(r))}class eg{constructor(e,t,n,i,r,o){this._scopedLineTokensBrand=void 0,this._actual=e,this.languageId=t,this._firstTokenIndex=n,this._lastTokenIndex=i,this.firstCharOffset=r,this._lastCharOffset=o,this.languageIdCodec=e.languageIdCodec}getLineContent(){return this._actual.getLineContent().substring(this.firstCharOffset,this._lastCharOffset)}getLineLength(){return this._lastCharOffset-this.firstCharOffset}getActualLineContentBefore(e){return this._actual.getLineContent().substring(0,this.firstCharOffset+e)}getTokenCount(){return this._lastTokenIndex-this._firstTokenIndex}findTokenIndexAtOffset(e){return this._actual.findTokenIndexAtOffset(e+this.firstCharOffset)-this._firstTokenIndex}getStandardTokenType(e){return this._actual.getStandardTokenType(e+this._firstTokenIndex)}toIViewLineTokens(){return this._actual.sliceAndInflate(this.firstCharOffset,this._lastCharOffset,0)}}function et(s){return(s&3)!==0}let dr;function Rc(){return dr||(dr=new TextDecoder("UTF-16LE")),dr}let fr;function tg(){return fr||(fr=new TextDecoder("UTF-16BE")),fr}let gr;function Mc(){return gr||(gr=oc()?Rc():tg()),gr}function ng(s,e,t){const n=new Uint16Array(s.buffer,e,t);return t>0&&(n[0]===65279||n[0]===65534)?ig(s,e,t):Rc().decode(n)}function ig(s,e,t){const n=[];let i=0;for(let r=0;r<t;r++){const o=Bh(s,e);e+=2,n[i++]=String.fromCharCode(o)}return n.join("")}class sg{constructor(e){this._capacity=e|0,this._buffer=new Uint16Array(this._capacity),this._completedStrings=null,this._bufferLength=0}reset(){this._completedStrings=null,this._bufferLength=0}build(){return this._completedStrings!==null?(this._flushBuffer(),this._completedStrings.join("")):this._buildBuffer()}_buildBuffer(){if(this._bufferLength===0)return"";const e=new Uint16Array(this._buffer.buffer,0,this._bufferLength);return Mc().decode(e)}_flushBuffer(){const e=this._buildBuffer();this._bufferLength=0,this._completedStrings===null?this._completedStrings=[e]:this._completedStrings[this._completedStrings.length]=e}appendCharCode(e){const t=this._capacity-this._bufferLength;t<=1&&(t===0||Ne(e))&&this._flushBuffer(),this._buffer[this._bufferLength++]=e}appendASCIICharCode(e){this._bufferLength===this._capacity&&this._flushBuffer(),this._buffer[this._bufferLength++]=e}appendString(e){const t=e.length;if(this._bufferLength+t>=this._capacity){this._flushBuffer(),this._completedStrings[this._completedStrings.length]=e;return}for(let n=0;n<t;n++)this._buffer[this._bufferLength++]=e.charCodeAt(n)}}class _s{constructor(e,t,n,i,r,o){this._richEditBracketBrand=void 0,this.languageId=e,this.index=t,this.open=n,this.close=i,this.forwardRegex=r,this.reversedRegex=o,this._openSet=_s._toSet(this.open),this._closeSet=_s._toSet(this.close)}isOpen(e){return this._openSet.has(e)}isClose(e){return this._closeSet.has(e)}static _toSet(e){const t=new Set;for(const n of e)t.add(n);return t}}function rg(s){const e=s.length;s=s.map(o=>[o[0].toLowerCase(),o[1].toLowerCase()]);const t=[];for(let o=0;o<e;o++)t[o]=o;const n=(o,a)=>{const[l,u]=o,[c,h]=a;return l===c||l===h||u===c||u===h},i=(o,a)=>{const l=Math.min(o,a),u=Math.max(o,a);for(let c=0;c<e;c++)t[c]===u&&(t[c]=l)};for(let o=0;o<e;o++){const a=s[o];for(let l=o+1;l<e;l++){const u=s[l];n(a,u)&&i(t[o],t[l])}}const r=[];for(let o=0;o<e;o++){const a=[],l=[];for(let u=0;u<e;u++)if(t[u]===o){const[c,h]=s[u];a.push(c),l.push(h)}a.length>0&&r.push({open:a,close:l})}return r}class og{constructor(e,t){this._richEditBracketsBrand=void 0;const n=rg(t);this.brackets=n.map((i,r)=>new _s(e,r,i.open,i.close,ag(i.open,i.close,n,r),lg(i.open,i.close,n,r))),this.forwardRegex=ug(this.brackets),this.reversedRegex=cg(this.brackets),this.textIsBracket={},this.textIsOpenBracket={},this.maxBracketLength=0;for(const i of this.brackets){for(const r of i.open)this.textIsBracket[r]=i,this.textIsOpenBracket[r]=!0,this.maxBracketLength=Math.max(this.maxBracketLength,r.length);for(const r of i.close)this.textIsBracket[r]=i,this.textIsOpenBracket[r]=!1,this.maxBracketLength=Math.max(this.maxBracketLength,r.length)}}}function Pc(s,e,t,n){for(let i=0,r=e.length;i<r;i++){if(i===t)continue;const o=e[i];for(const a of o.open)a.indexOf(s)>=0&&n.push(a);for(const a of o.close)a.indexOf(s)>=0&&n.push(a)}}function Ac(s,e){return s.length-e.length}function sr(s){if(s.length<=1)return s;const e=[],t=new Set;for(const n of s)t.has(n)||(e.push(n),t.add(n));return e}function ag(s,e,t,n){let i=[];i=i.concat(s),i=i.concat(e);for(let r=0,o=i.length;r<o;r++)Pc(i[r],t,n,i);return i=sr(i),i.sort(Ac),i.reverse(),Fi(i)}function lg(s,e,t,n){let i=[];i=i.concat(s),i=i.concat(e);for(let r=0,o=i.length;r<o;r++)Pc(i[r],t,n,i);return i=sr(i),i.sort(Ac),i.reverse(),Fi(i.map(Oo))}function ug(s){let e=[];for(const t of s){for(const n of t.open)e.push(n);for(const n of t.close)e.push(n)}return e=sr(e),Fi(e)}function cg(s){let e=[];for(const t of s){for(const n of t.open)e.push(n);for(const n of t.close)e.push(n)}return e=sr(e),Fi(e.map(Oo))}function hg(s){const e=/^[\w ]+$/.test(s);return s=_i(s),e?`\\b${s}\\b`:s}function Fi(s,e){const t=`(${s.map(hg).join(")|(")})`;return ac(t,!0,e)}const Oo=function(){function s(n){const i=new Uint16Array(n.length);let r=0;for(let o=n.length-1;o>=0;o--)i[r++]=n.charCodeAt(o);return Mc().decode(i)}let e=null,t=null;return function(i){return e!==i&&(e=i,t=s(e)),t}}();class je{static _findPrevBracketInText(e,t,n,i){const r=n.match(e);if(!r)return null;const o=n.length-(r.index||0),a=r[0].length,l=i+o;return new w(t,l-a+1,t,l+1)}static findPrevBracketInRange(e,t,n,i,r){const a=Oo(n).substring(n.length-r,n.length-i);return this._findPrevBracketInText(e,t,a,i)}static findNextBracketInText(e,t,n,i){const r=n.match(e);if(!r)return null;const o=r.index||0,a=r[0].length;if(a===0)return null;const l=i+o;return new w(t,l+1,t,l+1+a)}static findNextBracketInRange(e,t,n,i,r){const o=n.substring(i,r);return this.findNextBracketInText(e,t,o,i)}}class dg{constructor(e){this._richEditBrackets=e}getElectricCharacters(){const e=[];if(this._richEditBrackets)for(const t of this._richEditBrackets.brackets)for(const n of t.close){const i=n.charAt(n.length-1);e.push(i)}return Vh(e)}onElectricCharacter(e,t,n){if(!this._richEditBrackets||this._richEditBrackets.brackets.length===0)return null;const i=t.findTokenIndexAtOffset(n-1);if(et(t.getStandardTokenType(i)))return null;const r=this._richEditBrackets.reversedRegex,o=t.getLineContent().substring(0,n-1)+e,a=je.findPrevBracketInRange(r,1,o,0,o.length);if(!a)return null;const l=o.substring(a.startColumn-1,a.endColumn-1).toLowerCase();if(this._richEditBrackets.textIsOpenBracket[l])return null;const c=t.getActualLineContentBefore(a.startColumn-1);return/^\s*$/.test(c)?{matchOpenBracket:l}:null}}function Gi(s){return s.global&&(s.lastIndex=0),!0}class fg{constructor(e){this._indentationRules=e}shouldIncrease(e){return!!(this._indentationRules&&this._indentationRules.increaseIndentPattern&&Gi(this._indentationRules.increaseIndentPattern)&&this._indentationRules.increaseIndentPattern.test(e))}shouldDecrease(e){return!!(this._indentationRules&&this._indentationRules.decreaseIndentPattern&&Gi(this._indentationRules.decreaseIndentPattern)&&this._indentationRules.decreaseIndentPattern.test(e))}shouldIndentNextLine(e){return!!(this._indentationRules&&this._indentationRules.indentNextLinePattern&&Gi(this._indentationRules.indentNextLinePattern)&&this._indentationRules.indentNextLinePattern.test(e))}shouldIgnore(e){return!!(this._indentationRules&&this._indentationRules.unIndentedLinePattern&&Gi(this._indentationRules.unIndentedLinePattern)&&this._indentationRules.unIndentedLinePattern.test(e))}getIndentMetadata(e){let t=0;return this.shouldIncrease(e)&&(t+=1),this.shouldDecrease(e)&&(t+=2),this.shouldIndentNextLine(e)&&(t+=4),this.shouldIgnore(e)&&(t+=8),t}}class Ln{constructor(e){e=e||{},e.brackets=e.brackets||[["(",")"],["{","}"],["[","]"]],this._brackets=[],e.brackets.forEach(t=>{const n=Ln._createOpenBracketRegExp(t[0]),i=Ln._createCloseBracketRegExp(t[1]);n&&i&&this._brackets.push({open:t[0],openRegExp:n,close:t[1],closeRegExp:i})}),this._regExpRules=e.onEnterRules||[]}onEnter(e,t,n,i){if(e>=3)for(let r=0,o=this._regExpRules.length;r<o;r++){const a=this._regExpRules[r];if([{reg:a.beforeText,text:n},{reg:a.afterText,text:i},{reg:a.previousLineText,text:t}].every(u=>u.reg?(u.reg.lastIndex=0,u.reg.test(u.text)):!0))return a.action}if(e>=2&&n.length>0&&i.length>0)for(let r=0,o=this._brackets.length;r<o;r++){const a=this._brackets[r];if(a.openRegExp.test(n)&&a.closeRegExp.test(i))return{indentAction:Ce.IndentOutdent}}if(e>=2&&n.length>0){for(let r=0,o=this._brackets.length;r<o;r++)if(this._brackets[r].openRegExp.test(n))return{indentAction:Ce.Indent}}return null}static _createOpenBracketRegExp(e){let t=_i(e);return/\B/.test(t.charAt(0))||(t="\\b"+t),t+="\\s*$",Ln._safeRegExp(t)}static _createCloseBracketRegExp(e){let t=_i(e);return/\B/.test(t.charAt(t.length-1))||(t=t+"\\b"),t="^\\s*"+t,Ln._safeRegExp(t)}static _safeRegExp(e){try{return new RegExp(e)}catch(t){return Tt(t),null}}}const zi=ze("languageService"),gg={ModesRegistry:"editor.modesRegistry"};class mg{constructor(){this._onDidChangeLanguages=new J,this.onDidChangeLanguages=this._onDidChangeLanguages.event,this._languages=[]}registerLanguage(e){return this._languages.push(e),this._onDidChangeLanguages.fire(void 0),{dispose:()=>{for(let t=0,n=this._languages.length;t<n;t++)if(this._languages[t]===e){this._languages.splice(t,1);return}}}}getLanguages(){return this._languages}}const Ss=new mg;nr.add(gg.ModesRegistry,Ss);const at="plaintext",pg=".txt";Ss.registerLanguage({id:at,extensions:[pg],aliases:[g("plainText.alias","Plain Text"),"text"],mimetypes:[Cn.text]});nr.as(Mo.Configuration).registerDefaultConfigurations([{overrides:{"[plaintext]":{"editor.unicodeHighlight.ambiguousCharacters":!1,"editor.unicodeHighlight.invisibleCharacters":!1}}}]);class Cg{constructor(e,t){this.languageId=e;const n=t.brackets?Nl(t.brackets):[],i=new ha(a=>{const l=new Set;return{info:new bg(this,a,l),closing:l}}),r=new ha(a=>{const l=new Set,u=new Set;return{info:new Lg(this,a,l,u),opening:l,openingColorized:u}});for(const[a,l]of n){const u=i.get(a),c=r.get(l);u.closing.add(c.info),c.opening.add(u.info)}const o=t.colorizedBracketPairs?Nl(t.colorizedBracketPairs):n.filter(a=>!(a[0]==="<"&&a[1]===">"));for(const[a,l]of o){const u=i.get(a),c=r.get(l);u.closing.add(c.info),c.openingColorized.add(u.info),c.opening.add(u.info)}this._openingBrackets=new Map([...i.cachedValues].map(([a,l])=>[a,l.info])),this._closingBrackets=new Map([...r.cachedValues].map(([a,l])=>[a,l.info]))}get openingBrackets(){return[...this._openingBrackets.values()]}get closingBrackets(){return[...this._closingBrackets.values()]}getOpeningBracketInfo(e){return this._openingBrackets.get(e)}getClosingBracketInfo(e){return this._closingBrackets.get(e)}getBracketInfo(e){return this.getOpeningBracketInfo(e)||this.getClosingBracketInfo(e)}getBracketRegExp(e){const t=Array.from([...this._openingBrackets.keys(),...this._closingBrackets.keys()]);return Fi(t,e)}}function Nl(s){return s.filter(([e,t])=>e!==""&&t!=="")}class Dc{constructor(e,t){this.config=e,this.bracketText=t}get languageId(){return this.config.languageId}}class bg extends Dc{constructor(e,t,n){super(e,t),this.openedBrackets=n,this.isOpeningBracket=!0}}class Lg extends Dc{constructor(e,t,n,i){super(e,t),this.openingBrackets=n,this.openingColorizedBrackets=i,this.isOpeningBracket=!1}closes(e){return e.config!==this.config?!1:this.openingBrackets.has(e)}closesColorized(e){return e.config!==this.config?!1:this.openingColorizedBrackets.has(e)}getOpeningBrackets(){return[...this.openingBrackets]}}var wg=function(s,e,t,n){var i=arguments.length,r=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,n);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(i<3?o(r):i>3?o(e,t,r):o(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},xl=function(s,e){return function(t,n){e(t,n,s)}};class mr{constructor(e){this.languageId=e}affects(e){return this.languageId?this.languageId===e:!0}}const rr=ze("languageConfigurationService");let Yr=class extends oe{constructor(e,t){super(),this.configurationService=e,this.languageService=t,this._registry=this._register(new vg),this.onDidChangeEmitter=this._register(new J),this.onDidChange=this.onDidChangeEmitter.event,this.configurations=new Map;const n=new Set(Object.values(Kr));this._register(this.configurationService.onDidChangeConfiguration(i=>{const r=i.change.keys.some(a=>n.has(a)),o=i.change.overrides.filter(([a,l])=>l.some(u=>n.has(u))).map(([a])=>a);if(r)this.configurations.clear(),this.onDidChangeEmitter.fire(new mr(void 0));else for(const a of o)this.languageService.isRegisteredLanguageId(a)&&(this.configurations.delete(a),this.onDidChangeEmitter.fire(new mr(a)))})),this._register(this._registry.onDidChange(i=>{this.configurations.delete(i.languageId),this.onDidChangeEmitter.fire(new mr(i.languageId))}))}register(e,t,n){return this._registry.register(e,t,n)}getLanguageConfiguration(e){let t=this.configurations.get(e);return t||(t=_g(e,this._registry,this.configurationService,this.languageService),this.configurations.set(e,t)),t}};Yr=wg([xl(0,Lc),xl(1,zi)],Yr);function _g(s,e,t,n){let i=e.getLanguageConfiguration(s);if(!i){if(!n.isRegisteredLanguageId(s))return new xn(s,{});i=new xn(s,{})}const r=Sg(i.languageId,t),o=Bc([i.underlyingConfig,r]);return new xn(i.languageId,o)}const Kr={brackets:"editor.language.brackets",colorizedBracketPairs:"editor.language.colorizedBracketPairs"};function Sg(s,e){const t=e.getValue(Kr.brackets,{overrideIdentifier:s}),n=e.getValue(Kr.colorizedBracketPairs,{overrideIdentifier:s});return{brackets:Tl(t),colorizedBracketPairs:Tl(n)}}function Tl(s){if(Array.isArray(s))return s.map(e=>{if(!(!Array.isArray(e)||e.length!==2))return[e[0],e[1]]}).filter(e=>!!e)}function Oc(s,e,t){const n=s.getLineContent(e);let i=ke(n);return i.length>t-1&&(i=i.substring(0,t-1)),i}class kg{constructor(e){this.languageId=e,this._resolved=null,this._entries=[],this._order=0,this._resolved=null}register(e,t){const n=new El(e,t,++this._order);return this._entries.push(n),this._resolved=null,tn(()=>{for(let i=0;i<this._entries.length;i++)if(this._entries[i]===n){this._entries.splice(i,1),this._resolved=null;break}})}getResolvedConfiguration(){if(!this._resolved){const e=this._resolve();e&&(this._resolved=new xn(this.languageId,e))}return this._resolved}_resolve(){return this._entries.length===0?null:(this._entries.sort(El.cmp),Bc(this._entries.map(e=>e.configuration)))}}function Bc(s){let e={comments:void 0,brackets:void 0,wordPattern:void 0,indentationRules:void 0,onEnterRules:void 0,autoClosingPairs:void 0,surroundingPairs:void 0,autoCloseBefore:void 0,folding:void 0,colorizedBracketPairs:void 0,__electricCharacterSupport:void 0};for(const t of s)e={comments:t.comments||e.comments,brackets:t.brackets||e.brackets,wordPattern:t.wordPattern||e.wordPattern,indentationRules:t.indentationRules||e.indentationRules,onEnterRules:t.onEnterRules||e.onEnterRules,autoClosingPairs:t.autoClosingPairs||e.autoClosingPairs,surroundingPairs:t.surroundingPairs||e.surroundingPairs,autoCloseBefore:t.autoCloseBefore||e.autoCloseBefore,folding:t.folding||e.folding,colorizedBracketPairs:t.colorizedBracketPairs||e.colorizedBracketPairs,__electricCharacterSupport:t.__electricCharacterSupport||e.__electricCharacterSupport};return e}class El{constructor(e,t,n){this.configuration=e,this.priority=t,this.order=n}static cmp(e,t){return e.priority===t.priority?e.order-t.order:e.priority-t.priority}}class yl{constructor(e){this.languageId=e}}class vg extends oe{constructor(){super(),this._entries=new Map,this._onDidChange=this._register(new J),this.onDidChange=this._onDidChange.event,this._register(this.register(at,{brackets:[["(",")"],["[","]"],["{","}"]],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:"<",close:">"},{open:'"',close:'"'},{open:"'",close:"'"},{open:"`",close:"`"}],colorizedBracketPairs:[],folding:{offSide:!0}},0))}register(e,t,n=0){let i=this._entries.get(e);i||(i=new kg(e),this._entries.set(e,i));const r=i.register(t,n);return this._onDidChange.fire(new yl(e)),tn(()=>{r.dispose(),this._onDidChange.fire(new yl(e))})}getLanguageConfiguration(e){const t=this._entries.get(e);return(t==null?void 0:t.getResolvedConfiguration())||null}}class xn{constructor(e,t){this.languageId=e,this.underlyingConfig=t,this._brackets=null,this._electricCharacter=null,this._onEnterSupport=this.underlyingConfig.brackets||this.underlyingConfig.indentationRules||this.underlyingConfig.onEnterRules?new Ln(this.underlyingConfig):null,this.comments=xn._handleComments(this.underlyingConfig),this.characterPair=new Jr(this.underlyingConfig),this.wordDefinition=this.underlyingConfig.wordPattern||Ao,this.indentationRules=this.underlyingConfig.indentationRules,this.underlyingConfig.indentationRules?this.indentRulesSupport=new fg(this.underlyingConfig.indentationRules):this.indentRulesSupport=null,this.foldingRules=this.underlyingConfig.folding||{},this.bracketsNew=new Cg(e,this.underlyingConfig)}getWordDefinition(){return Do(this.wordDefinition)}get brackets(){return!this._brackets&&this.underlyingConfig.brackets&&(this._brackets=new og(this.languageId,this.underlyingConfig.brackets)),this._brackets}get electricCharacter(){return this._electricCharacter||(this._electricCharacter=new dg(this.brackets)),this._electricCharacter}onEnter(e,t,n,i){return this._onEnterSupport?this._onEnterSupport.onEnter(e,t,n,i):null}getAutoClosingPairs(){return new Kf(this.characterPair.getAutoClosingPairs())}getAutoCloseBeforeSet(e){return this.characterPair.getAutoCloseBeforeSet(e)}getSurroundingPairs(){return this.characterPair.getSurroundingPairs()}static _handleComments(e){const t=e.comments;if(!t)return null;const n={};if(t.lineComment&&(n.lineCommentToken=t.lineComment),t.blockComment){const[i,r]=t.blockComment;n.blockCommentStartToken=i,n.blockCommentEndToken=r}return n}}Vi(rr,Yr,1);class Fn{constructor(e){const t=da(e);this._defaultValue=t,this._asciiMap=Fn._createAsciiMap(t),this._map=new Map}static _createAsciiMap(e){const t=new Uint8Array(256);return t.fill(e),t}set(e,t){const n=da(t);e>=0&&e<256?this._asciiMap[e]=n:this._map.set(e,n)}get(e){return e>=0&&e<256?this._asciiMap[e]:this._map.get(e)||this._defaultValue}clear(){this._asciiMap.fill(this._defaultValue),this._map.clear()}}class dw{constructor(){this._actual=new Fn(0)}add(e){this._actual.set(e,1)}has(e){return this._actual.get(e)===1}clear(){return this._actual.clear()}}class Ig{constructor(e,t,n){const i=new Uint8Array(e*t);for(let r=0,o=e*t;r<o;r++)i[r]=n;this._data=i,this.rows=e,this.cols=t}get(e,t){return this._data[e*this.cols+t]}set(e,t,n){this._data[e*this.cols+t]=n}}class Ng{constructor(e){let t=0,n=0;for(let r=0,o=e.length;r<o;r++){const[a,l,u]=e[r];l>t&&(t=l),a>n&&(n=a),u>n&&(n=u)}t++,n++;const i=new Ig(n,t,0);for(let r=0,o=e.length;r<o;r++){const[a,l,u]=e[r];i.set(a,l,u)}this._states=i,this._maxCharCode=t}nextState(e,t){return t<0||t>=this._maxCharCode?0:this._states.get(e,t)}}let pr=null;function xg(){return pr===null&&(pr=new Ng([[1,104,2],[1,72,2],[1,102,6],[1,70,6],[2,116,3],[2,84,3],[3,116,4],[3,84,4],[4,112,5],[4,80,5],[5,115,9],[5,83,9],[5,58,10],[6,105,7],[6,73,7],[7,108,8],[7,76,8],[8,101,9],[8,69,9],[9,58,10],[10,47,11],[11,47,12]])),pr}let jn=null;function Tg(){if(jn===null){jn=new Fn(0);const s=` 	<>'"`;for(let t=0;t<s.length;t++)jn.set(s.charCodeAt(t),1);const e=".,;:";for(let t=0;t<e.length;t++)jn.set(e.charCodeAt(t),2)}return jn}class ks{static _createLink(e,t,n,i,r){let o=r-1;do{const a=t.charCodeAt(o);if(e.get(a)!==2)break;o--}while(o>i);if(i>0){const a=t.charCodeAt(i-1),l=t.charCodeAt(o);(a===40&&l===41||a===91&&l===93||a===123&&l===125)&&o--}return{range:{startLineNumber:n,startColumn:i+1,endLineNumber:n,endColumn:o+2},url:t.substring(i,o+1)}}static computeLinks(e,t=xg()){const n=Tg(),i=[];for(let r=1,o=e.getLineCount();r<=o;r++){const a=e.getLineContent(r),l=a.length;let u=0,c=0,h=0,d=1,f=!1,m=!1,p=!1,C=!1;for(;u<l;){let b=!1;const L=a.charCodeAt(u);if(d===13){let _;switch(L){case 40:f=!0,_=0;break;case 41:_=f?0:1;break;case 91:p=!0,m=!0,_=0;break;case 93:p=!1,_=m?0:1;break;case 123:C=!0,_=0;break;case 125:_=C?0:1;break;case 39:case 34:case 96:h===L?_=1:h===39||h===34||h===96?_=0:_=1;break;case 42:_=h===42?1:0;break;case 124:_=h===124?1:0;break;case 32:_=p?0:1;break;default:_=n.get(L)}_===1&&(i.push(ks._createLink(n,a,r,c,u)),b=!0)}else if(d===12){let _;L===91?(m=!0,_=0):_=n.get(L),_===1?b=!0:d=13}else d=t.nextState(d,L),d===0&&(b=!0);b&&(d=1,f=!1,m=!1,C=!1,c=u+1,h=L),u++}d===13&&i.push(ks._createLink(n,a,r,c,l))}return i}}function Eg(s){return!s||typeof s.getLineCount!="function"||typeof s.getLineContent!="function"?[]:ks.computeLinks(s)}const qs=class qs{constructor(){this._defaultValueSet=[["true","false"],["True","False"],["Private","Public","Friend","ReadOnly","Partial","Protected","WriteOnly"],["public","protected","private"]]}navigateValueSet(e,t,n,i,r){if(e&&t){const o=this.doNavigateValueSet(t,r);if(o)return{range:e,value:o}}if(n&&i){const o=this.doNavigateValueSet(i,r);if(o)return{range:n,value:o}}return null}doNavigateValueSet(e,t){const n=this.numberReplace(e,t);return n!==null?n:this.textReplace(e,t)}numberReplace(e,t){const n=Math.pow(10,e.length-(e.lastIndexOf(".")+1));let i=Number(e);const r=parseFloat(e);return!isNaN(i)&&!isNaN(r)&&i===r?i===0&&!t?null:(i=Math.floor(i*n),i+=t?n:-n,String(i/n)):null}textReplace(e,t){return this.valueSetsReplace(this._defaultValueSet,e,t)}valueSetsReplace(e,t,n){let i=null;for(let r=0,o=e.length;i===null&&r<o;r++)i=this.valueSetReplace(e[r],t,n);return i}valueSetReplace(e,t,n){let i=e.indexOf(t);return i>=0?(i+=n?1:-1,i<0?i=e.length-1:i%=e.length,e[i]):null}};qs.INSTANCE=new qs;let eo=qs;const mi=class mi{static getChannel(e){return e.getChannel(mi.CHANNEL_NAME)}static setChannel(e,t){e.setChannel(mi.CHANNEL_NAME,t)}};mi.CHANNEL_NAME="editorWorkerHost";let Rl=mi;class yg extends Fn{constructor(e,t){super(0),this._segmenter=null,this._cachedLine=null,this._cachedSegments=[],this.intlSegmenterLocales=t,this.intlSegmenterLocales.length>0?this._segmenter=new Intl.Segmenter(this.intlSegmenterLocales,{granularity:"word"}):this._segmenter=null;for(let n=0,i=e.length;n<i;n++)this.set(e.charCodeAt(n),2);this.set(32,1),this.set(9,1)}findPrevIntlWordBeforeOrAtOffset(e,t){let n=null;for(const i of this._getIntlSegmenterWordsOnLine(e)){if(i.index>t)break;n=i}return n}findNextIntlWordAtOrAfterOffset(e,t){for(const n of this._getIntlSegmenterWordsOnLine(e))if(!(n.index<t))return n;return null}_getIntlSegmenterWordsOnLine(e){return this._segmenter?this._cachedLine===e?this._cachedSegments:(this._cachedLine=e,this._cachedSegments=this._filterWordSegments(this._segmenter.segment(e)),this._cachedSegments):[]}_filterWordSegments(e){const t=[];for(const n of e)this._isWordLike(n)&&t.push(n);return t}_isWordLike(e){return!!e.isWordLike}}const Ml=new lc(10);function vs(s,e){const t=`${s}/${e.join(",")}`;let n=Ml.get(t);return n||(n=new yg(s,e),Ml.set(t,n)),n}var Is;(function(s){s[s.Left=1]="Left",s[s.Center=2]="Center",s[s.Right=4]="Right",s[s.Full=7]="Full"})(Is||(Is={}));var xi;(function(s){s[s.Left=1]="Left",s[s.Center=2]="Center",s[s.Right=3]="Right"})(xi||(xi={}));var On;(function(s){s[s.Both=0]="Both",s[s.Right=1]="Right",s[s.Left=2]="Left",s[s.None=3]="None"})(On||(On={}));class Cr{get originalIndentSize(){return this._indentSizeIsTabSize?"tabSize":this.indentSize}constructor(e){this._textModelResolvedOptionsBrand=void 0,this.tabSize=Math.max(1,e.tabSize|0),e.indentSize==="tabSize"?(this.indentSize=this.tabSize,this._indentSizeIsTabSize=!0):(this.indentSize=Math.max(1,e.indentSize|0),this._indentSizeIsTabSize=!1),this.insertSpaces=!!e.insertSpaces,this.defaultEOL=e.defaultEOL|0,this.trimAutoWhitespace=!!e.trimAutoWhitespace,this.bracketPairColorizationOptions=e.bracketPairColorizationOptions}equals(e){return this.tabSize===e.tabSize&&this._indentSizeIsTabSize===e._indentSizeIsTabSize&&this.indentSize===e.indentSize&&this.insertSpaces===e.insertSpaces&&this.defaultEOL===e.defaultEOL&&this.trimAutoWhitespace===e.trimAutoWhitespace&&bs(this.bracketPairColorizationOptions,e.bracketPairColorizationOptions)}createChangeEvent(e){return{tabSize:this.tabSize!==e.tabSize,indentSize:this.indentSize!==e.indentSize,insertSpaces:this.insertSpaces!==e.insertSpaces,trimAutoWhitespace:this.trimAutoWhitespace!==e.trimAutoWhitespace}}}class Ns{constructor(e,t){this._findMatchBrand=void 0,this.range=e,this.matches=t}}function Rg(s){return s&&typeof s.read=="function"}class br{constructor(e,t,n,i,r,o){this.identifier=e,this.range=t,this.text=n,this.forceMoveMarkers=i,this.isAutoWhitespaceEdit=r,this._isTracked=o}}class Mg{constructor(e,t,n){this.regex=e,this.wordSeparators=t,this.simpleSearch=n}}class Pg{constructor(e,t,n){this.reverseEdits=e,this.changes=t,this.trimAutoWhitespaceLineNumbers=n}}function Ag(s){return!s.isTooLargeForSyncing()&&!s.isForSimpleWidget}const Dg=999;class dn{constructor(e,t,n,i){this.searchString=e,this.isRegex=t,this.matchCase=n,this.wordSeparators=i}parseSearchRequest(){if(this.searchString==="")return null;let e;this.isRegex?e=Og(this.searchString):e=this.searchString.indexOf(`
`)>=0;let t=null;try{t=ac(this.searchString,this.isRegex,{matchCase:this.matchCase,wholeWord:!1,multiline:e,global:!0,unicode:!0})}catch{return null}if(!t)return null;let n=!this.isRegex&&!e;return n&&this.searchString.toLowerCase()!==this.searchString.toUpperCase()&&(n=this.matchCase),new Mg(t,this.wordSeparators?vs(this.wordSeparators,[]):null,n?this.searchString:null)}}function Og(s){if(!s||s.length===0)return!1;for(let e=0,t=s.length;e<t;e++){const n=s.charCodeAt(e);if(n===10)return!0;if(n===92){if(e++,e>=t)break;const i=s.charCodeAt(e);if(i===110||i===114||i===87)return!0}}return!1}function $t(s,e,t){if(!t)return new Ns(s,null);const n=[];for(let i=0,r=e.length;i<r;i++)n[i]=e[i];return new Ns(s,n)}class Pl{constructor(e){const t=[];let n=0;for(let i=0,r=e.length;i<r;i++)e.charCodeAt(i)===10&&(t[n++]=i);this._lineFeedsOffsets=t}findLineFeedCountBeforeOffset(e){const t=this._lineFeedsOffsets;let n=0,i=t.length-1;if(i===-1||e<=t[0])return 0;for(;n<i;){const r=n+((i-n)/2>>0);t[r]>=e?i=r-1:t[r+1]>=e?(n=r,i=r):n=r+1}return n+1}}class $i{static findMatches(e,t,n,i,r){const o=t.parseSearchRequest();return o?o.regex.multiline?this._doFindMatchesMultiline(e,n,new wn(o.wordSeparators,o.regex),i,r):this._doFindMatchesLineByLine(e,n,o,i,r):[]}static _getMultilineMatchRange(e,t,n,i,r,o){let a,l=0;i?(l=i.findLineFeedCountBeforeOffset(r),a=t+r+l):a=t+r;let u;if(i){const f=i.findLineFeedCountBeforeOffset(r+o.length)-l;u=a+o.length+f}else u=a+o.length;const c=e.getPositionAt(a),h=e.getPositionAt(u);return new w(c.lineNumber,c.column,h.lineNumber,h.column)}static _doFindMatchesMultiline(e,t,n,i,r){const o=e.getOffsetAt(t.getStartPosition()),a=e.getValueInRange(t,1),l=e.getEOL()===`\r
`?new Pl(a):null,u=[];let c=0,h;for(n.reset(0);h=n.next(a);)if(u[c++]=$t(this._getMultilineMatchRange(e,o,a,l,h.index,h[0]),h,i),c>=r)return u;return u}static _doFindMatchesLineByLine(e,t,n,i,r){const o=[];let a=0;if(t.startLineNumber===t.endLineNumber){const u=e.getLineContent(t.startLineNumber).substring(t.startColumn-1,t.endColumn-1);return a=this._findMatchesInLine(n,u,t.startLineNumber,t.startColumn-1,a,o,i,r),o}const l=e.getLineContent(t.startLineNumber).substring(t.startColumn-1);a=this._findMatchesInLine(n,l,t.startLineNumber,t.startColumn-1,a,o,i,r);for(let u=t.startLineNumber+1;u<t.endLineNumber&&a<r;u++)a=this._findMatchesInLine(n,e.getLineContent(u),u,0,a,o,i,r);if(a<r){const u=e.getLineContent(t.endLineNumber).substring(0,t.endColumn-1);a=this._findMatchesInLine(n,u,t.endLineNumber,0,a,o,i,r)}return o}static _findMatchesInLine(e,t,n,i,r,o,a,l){const u=e.wordSeparators;if(!a&&e.simpleSearch){const d=e.simpleSearch,f=d.length,m=t.length;let p=-f;for(;(p=t.indexOf(d,p+f))!==-1;)if((!u||Bo(u,t,m,p,f))&&(o[r++]=new Ns(new w(n,p+1+i,n,p+1+f+i),null),r>=l))return r;return r}const c=new wn(e.wordSeparators,e.regex);let h;c.reset(0);do if(h=c.next(t),h&&(o[r++]=$t(new w(n,h.index+1+i,n,h.index+1+h[0].length+i),h,a),r>=l))return r;while(h);return r}static findNextMatch(e,t,n,i){const r=t.parseSearchRequest();if(!r)return null;const o=new wn(r.wordSeparators,r.regex);return r.regex.multiline?this._doFindNextMatchMultiline(e,n,o,i):this._doFindNextMatchLineByLine(e,n,o,i)}static _doFindNextMatchMultiline(e,t,n,i){const r=new I(t.lineNumber,1),o=e.getOffsetAt(r),a=e.getLineCount(),l=e.getValueInRange(new w(r.lineNumber,r.column,a,e.getLineMaxColumn(a)),1),u=e.getEOL()===`\r
`?new Pl(l):null;n.reset(t.column-1);const c=n.next(l);return c?$t(this._getMultilineMatchRange(e,o,l,u,c.index,c[0]),c,i):t.lineNumber!==1||t.column!==1?this._doFindNextMatchMultiline(e,new I(1,1),n,i):null}static _doFindNextMatchLineByLine(e,t,n,i){const r=e.getLineCount(),o=t.lineNumber,a=e.getLineContent(o),l=this._findFirstMatchInLine(n,a,o,t.column,i);if(l)return l;for(let u=1;u<=r;u++){const c=(o+u-1)%r,h=e.getLineContent(c+1),d=this._findFirstMatchInLine(n,h,c+1,1,i);if(d)return d}return null}static _findFirstMatchInLine(e,t,n,i,r){e.reset(i-1);const o=e.next(t);return o?$t(new w(n,o.index+1,n,o.index+1+o[0].length),o,r):null}static findPreviousMatch(e,t,n,i){const r=t.parseSearchRequest();if(!r)return null;const o=new wn(r.wordSeparators,r.regex);return r.regex.multiline?this._doFindPreviousMatchMultiline(e,n,o,i):this._doFindPreviousMatchLineByLine(e,n,o,i)}static _doFindPreviousMatchMultiline(e,t,n,i){const r=this._doFindMatchesMultiline(e,new w(1,1,t.lineNumber,t.column),n,i,10*Dg);if(r.length>0)return r[r.length-1];const o=e.getLineCount();return t.lineNumber!==o||t.column!==e.getLineMaxColumn(o)?this._doFindPreviousMatchMultiline(e,new I(o,e.getLineMaxColumn(o)),n,i):null}static _doFindPreviousMatchLineByLine(e,t,n,i){const r=e.getLineCount(),o=t.lineNumber,a=e.getLineContent(o).substring(0,t.column-1),l=this._findLastMatchInLine(n,a,o,i);if(l)return l;for(let u=1;u<=r;u++){const c=(r+o-u-1)%r,h=e.getLineContent(c+1),d=this._findLastMatchInLine(n,h,c+1,i);if(d)return d}return null}static _findLastMatchInLine(e,t,n,i){let r=null,o;for(e.reset(0);o=e.next(t);)r=$t(new w(n,o.index+1,n,o.index+1+o[0].length),o,i);return r}}function Bg(s,e,t,n,i){if(n===0)return!0;const r=e.charCodeAt(n-1);if(s.get(r)!==0||r===13||r===10)return!0;if(i>0){const o=e.charCodeAt(n);if(s.get(o)!==0)return!0}return!1}function Vg(s,e,t,n,i){if(n+i===t)return!0;const r=e.charCodeAt(n+i);if(s.get(r)!==0||r===13||r===10)return!0;if(i>0){const o=e.charCodeAt(n+i-1);if(s.get(o)!==0)return!0}return!1}function Bo(s,e,t,n,i){return Bg(s,e,t,n,i)&&Vg(s,e,t,n,i)}class wn{constructor(e,t){this._wordSeparators=e,this._searchRegex=t,this._prevMatchStartIndex=-1,this._prevMatchLength=0}reset(e){this._searchRegex.lastIndex=e,this._prevMatchStartIndex=-1,this._prevMatchLength=0}next(e){const t=e.length;let n;do{if(this._prevMatchStartIndex+this._prevMatchLength===t||(n=this._searchRegex.exec(e),!n))return null;const i=n.index,r=n[0].length;if(i===this._prevMatchStartIndex&&r===this._prevMatchLength){if(r===0){Br(e,t,this._searchRegex.lastIndex)>65535?this._searchRegex.lastIndex+=2:this._searchRegex.lastIndex+=1;continue}return null}if(this._prevMatchStartIndex=i,this._prevMatchLength=r,!this._wordSeparators||Bo(this._wordSeparators,e,t,i,r))return n}while(n);return null}}class Wg{static computeUnicodeHighlights(e,t,n){const i=n?n.startLineNumber:1,r=n?n.endLineNumber:e.getLineCount(),o=new Al(t),a=o.getCandidateCodePoints();let l;a==="allNonBasicAscii"?l=new RegExp("[^\\t\\n\\r\\x20-\\x7E]","g"):l=new RegExp(`${Fg(Array.from(a))}`,"g");const u=new wn(null,l),c=[];let h=!1,d,f=0,m=0,p=0;e:for(let C=i,b=r;C<=b;C++){const L=e.getLineContent(C),_=L.length;u.reset(0);do if(d=u.next(L),d){let k=d.index,S=d.index+d[0].length;if(k>0){const E=L.charCodeAt(k-1);Ne(E)&&k--}if(S+1<_){const E=L.charCodeAt(S-1);Ne(E)&&S++}const N=L.substring(k,S);let x=Ii(k+1,Ao,L,0);x&&x.endColumn<=k+1&&(x=null);const T=o.shouldHighlightNonBasicASCII(N,x?x.word:null);if(T!==0){if(T===3?f++:T===2?m++:T===1?p++:uc(),c.length>=1e3){h=!0;break e}c.push(new w(C,k+1,C,S+1))}}while(d)}return{ranges:c,hasMore:h,ambiguousCharacterCount:f,invisibleCharacterCount:m,nonBasicAsciiCharacterCount:p}}static computeUnicodeHighlightReason(e,t){const n=new Al(t);switch(n.shouldHighlightNonBasicASCII(e,null)){case 0:return null;case 2:return{kind:1};case 3:{const r=e.codePointAt(0),o=n.ambiguousCharacters.getPrimaryConfusable(r),a=Vr.getLocales().filter(l=>!Vr.getInstance(new Set([...t.allowedLocales,l])).isAmbiguous(r));return{kind:0,confusableWith:String.fromCodePoint(o),notAmbiguousInLocales:a}}case 1:return{kind:2}}}}function Fg(s,e){return`[${_i(s.map(n=>String.fromCodePoint(n)).join(""))}]`}class Al{constructor(e){this.options=e,this.allowedCodePoints=new Set(e.allowedCodePoints),this.ambiguousCharacters=Vr.getInstance(new Set(e.allowedLocales))}getCandidateCodePoints(){if(this.options.nonBasicASCII)return"allNonBasicAscii";const e=new Set;if(this.options.invisibleCharacters)for(const t of ar.codePoints)Dl(String.fromCodePoint(t))||e.add(t);if(this.options.ambiguousCharacters)for(const t of this.ambiguousCharacters.getConfusableCodePoints())e.add(t);for(const t of this.allowedCodePoints)e.delete(t);return e}shouldHighlightNonBasicASCII(e,t){const n=e.codePointAt(0);if(this.allowedCodePoints.has(n))return 0;if(this.options.nonBasicASCII)return 1;let i=!1,r=!1;if(t)for(const o of t){const a=o.codePointAt(0),l=yo(o);i=i||l,!l&&!this.ambiguousCharacters.isAmbiguous(a)&&!ar.isInvisibleCharacter(a)&&(r=!0)}return!i&&r?0:this.options.invisibleCharacters&&!Dl(e)&&ar.isInvisibleCharacter(n)?2:this.options.ambiguousCharacters&&this.ambiguousCharacters.isAmbiguous(n)?3:0}}function Dl(s){return s===" "||s===`
`||s==="	"}class hs{constructor(e,t,n){this.changes=e,this.moves=t,this.hitTimeout=n}}class zg{constructor(e,t){this.lineRangeMapping=e,this.changes=t}}class z{static addRange(e,t){let n=0;for(;n<t.length&&t[n].endExclusive<e.start;)n++;let i=n;for(;i<t.length&&t[i].start<=e.endExclusive;)i++;if(n===i)t.splice(n,0,e);else{const r=Math.min(e.start,t[n].start),o=Math.max(e.endExclusive,t[i-1].endExclusive);t.splice(n,i-n,new z(r,o))}}static tryCreate(e,t){if(!(e>t))return new z(e,t)}static ofLength(e){return new z(0,e)}static ofStartAndLength(e,t){return new z(e,e+t)}constructor(e,t){if(this.start=e,this.endExclusive=t,e>t)throw new he(`Invalid range: ${this.toString()}`)}get isEmpty(){return this.start===this.endExclusive}delta(e){return new z(this.start+e,this.endExclusive+e)}deltaStart(e){return new z(this.start+e,this.endExclusive)}deltaEnd(e){return new z(this.start,this.endExclusive+e)}get length(){return this.endExclusive-this.start}toString(){return`[${this.start}, ${this.endExclusive})`}contains(e){return this.start<=e&&e<this.endExclusive}join(e){return new z(Math.min(this.start,e.start),Math.max(this.endExclusive,e.endExclusive))}intersect(e){const t=Math.max(this.start,e.start),n=Math.min(this.endExclusive,e.endExclusive);if(t<=n)return new z(t,n)}intersects(e){const t=Math.max(this.start,e.start),n=Math.min(this.endExclusive,e.endExclusive);return t<n}isBefore(e){return this.endExclusive<=e.start}isAfter(e){return this.start>=e.endExclusive}slice(e){return e.slice(this.start,this.endExclusive)}substring(e){return e.substring(this.start,this.endExclusive)}clip(e){if(this.isEmpty)throw new he(`Invalid clipping range: ${this.toString()}`);return Math.max(this.start,Math.min(this.endExclusive-1,e))}clipCyclic(e){if(this.isEmpty)throw new he(`Invalid clipping range: ${this.toString()}`);return e<this.start?this.endExclusive-(this.start-e)%this.length:e>=this.endExclusive?this.start+(e-this.start)%this.length:e}forEach(e){for(let t=this.start;t<this.endExclusive;t++)e(t)}}class Vc{constructor(){this._sortedRanges=[]}addRange(e){let t=0;for(;t<this._sortedRanges.length&&this._sortedRanges[t].endExclusive<e.start;)t++;let n=t;for(;n<this._sortedRanges.length&&this._sortedRanges[n].start<=e.endExclusive;)n++;if(t===n)this._sortedRanges.splice(t,0,e);else{const i=Math.min(e.start,this._sortedRanges[t].start),r=Math.max(e.endExclusive,this._sortedRanges[n-1].endExclusive);this._sortedRanges.splice(t,n-t,new z(i,r))}}toString(){return this._sortedRanges.map(e=>e.toString()).join(", ")}intersectsStrict(e){let t=0;for(;t<this._sortedRanges.length&&this._sortedRanges[t].endExclusive<=e.start;)t++;return t<this._sortedRanges.length&&this._sortedRanges[t].start<e.endExclusive}intersectWithRange(e){const t=new Vc;for(const n of this._sortedRanges){const i=n.intersect(e);i&&t.addRange(i)}return t}intersectWithRangeLength(e){return this.intersectWithRange(e).length}get length(){return this._sortedRanges.reduce((e,t)=>e+t.length,0)}}let $=class ct{static fromRangeInclusive(e){return new ct(e.startLineNumber,e.endLineNumber+1)}static joinMany(e){if(e.length===0)return[];let t=new rt(e[0].slice());for(let n=1;n<e.length;n++)t=t.getUnion(new rt(e[n].slice()));return t.ranges}static join(e){if(e.length===0)throw new he("lineRanges cannot be empty");let t=e[0].startLineNumber,n=e[0].endLineNumberExclusive;for(let i=1;i<e.length;i++)t=Math.min(t,e[i].startLineNumber),n=Math.max(n,e[i].endLineNumberExclusive);return new ct(t,n)}static ofLength(e,t){return new ct(e,e+t)}static deserialize(e){return new ct(e[0],e[1])}constructor(e,t){if(e>t)throw new he(`startLineNumber ${e} cannot be after endLineNumberExclusive ${t}`);this.startLineNumber=e,this.endLineNumberExclusive=t}contains(e){return this.startLineNumber<=e&&e<this.endLineNumberExclusive}get isEmpty(){return this.startLineNumber===this.endLineNumberExclusive}delta(e){return new ct(this.startLineNumber+e,this.endLineNumberExclusive+e)}deltaLength(e){return new ct(this.startLineNumber,this.endLineNumberExclusive+e)}get length(){return this.endLineNumberExclusive-this.startLineNumber}join(e){return new ct(Math.min(this.startLineNumber,e.startLineNumber),Math.max(this.endLineNumberExclusive,e.endLineNumberExclusive))}toString(){return`[${this.startLineNumber},${this.endLineNumberExclusive})`}intersect(e){const t=Math.max(this.startLineNumber,e.startLineNumber),n=Math.min(this.endLineNumberExclusive,e.endLineNumberExclusive);if(t<=n)return new ct(t,n)}intersectsStrict(e){return this.startLineNumber<e.endLineNumberExclusive&&e.startLineNumber<this.endLineNumberExclusive}overlapOrTouch(e){return this.startLineNumber<=e.endLineNumberExclusive&&e.startLineNumber<=this.endLineNumberExclusive}equals(e){return this.startLineNumber===e.startLineNumber&&this.endLineNumberExclusive===e.endLineNumberExclusive}toInclusiveRange(){return this.isEmpty?null:new w(this.startLineNumber,1,this.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER)}toExclusiveRange(){return new w(this.startLineNumber,1,this.endLineNumberExclusive,1)}mapToLineArray(e){const t=[];for(let n=this.startLineNumber;n<this.endLineNumberExclusive;n++)t.push(e(n));return t}forEach(e){for(let t=this.startLineNumber;t<this.endLineNumberExclusive;t++)e(t)}serialize(){return[this.startLineNumber,this.endLineNumberExclusive]}includes(e){return this.startLineNumber<=e&&e<this.endLineNumberExclusive}toOffsetRange(){return new z(this.startLineNumber-1,this.endLineNumberExclusive-1)}};class rt{constructor(e=[]){this._normalizedRanges=e}get ranges(){return this._normalizedRanges}addRange(e){if(e.length===0)return;const t=fa(this._normalizedRanges,i=>i.endLineNumberExclusive>=e.startLineNumber),n=Wr(this._normalizedRanges,i=>i.startLineNumber<=e.endLineNumberExclusive)+1;if(t===n)this._normalizedRanges.splice(t,0,e);else if(t===n-1){const i=this._normalizedRanges[t];this._normalizedRanges[t]=i.join(e)}else{const i=this._normalizedRanges[t].join(this._normalizedRanges[n-1]).join(e);this._normalizedRanges.splice(t,n-t,i)}}contains(e){const t=Pn(this._normalizedRanges,n=>n.startLineNumber<=e);return!!t&&t.endLineNumberExclusive>e}intersects(e){const t=Pn(this._normalizedRanges,n=>n.startLineNumber<e.endLineNumberExclusive);return!!t&&t.endLineNumberExclusive>e.startLineNumber}getUnion(e){if(this._normalizedRanges.length===0)return e;if(e._normalizedRanges.length===0)return this;const t=[];let n=0,i=0,r=null;for(;n<this._normalizedRanges.length||i<e._normalizedRanges.length;){let o=null;if(n<this._normalizedRanges.length&&i<e._normalizedRanges.length){const a=this._normalizedRanges[n],l=e._normalizedRanges[i];a.startLineNumber<l.startLineNumber?(o=a,n++):(o=l,i++)}else n<this._normalizedRanges.length?(o=this._normalizedRanges[n],n++):(o=e._normalizedRanges[i],i++);r===null?r=o:r.endLineNumberExclusive>=o.startLineNumber?r=new $(r.startLineNumber,Math.max(r.endLineNumberExclusive,o.endLineNumberExclusive)):(t.push(r),r=o)}return r!==null&&t.push(r),new rt(t)}subtractFrom(e){const t=fa(this._normalizedRanges,o=>o.endLineNumberExclusive>=e.startLineNumber),n=Wr(this._normalizedRanges,o=>o.startLineNumber<=e.endLineNumberExclusive)+1;if(t===n)return new rt([e]);const i=[];let r=e.startLineNumber;for(let o=t;o<n;o++){const a=this._normalizedRanges[o];a.startLineNumber>r&&i.push(new $(r,a.startLineNumber)),r=a.endLineNumberExclusive}return r<e.endLineNumberExclusive&&i.push(new $(r,e.endLineNumberExclusive)),new rt(i)}toString(){return this._normalizedRanges.map(e=>e.toString()).join(", ")}getIntersection(e){const t=[];let n=0,i=0;for(;n<this._normalizedRanges.length&&i<e._normalizedRanges.length;){const r=this._normalizedRanges[n],o=e._normalizedRanges[i],a=r.intersect(o);a&&!a.isEmpty&&t.push(a),r.endLineNumberExclusive<o.endLineNumberExclusive?n++:i++}return new rt(t)}getWithDelta(e){return new rt(this._normalizedRanges.map(t=>t.delta(e)))}}const Rt=class Rt{static betweenPositions(e,t){return e.lineNumber===t.lineNumber?new Rt(0,t.column-e.column):new Rt(t.lineNumber-e.lineNumber,t.column-1)}static ofRange(e){return Rt.betweenPositions(e.getStartPosition(),e.getEndPosition())}static ofText(e){let t=0,n=0;for(const i of e)i===`
`?(t++,n=0):n++;return new Rt(t,n)}constructor(e,t){this.lineCount=e,this.columnCount=t}isGreaterThanOrEqualTo(e){return this.lineCount!==e.lineCount?this.lineCount>e.lineCount:this.columnCount>=e.columnCount}createRange(e){return this.lineCount===0?new w(e.lineNumber,e.column,e.lineNumber,e.column+this.columnCount):new w(e.lineNumber,e.column,e.lineNumber+this.lineCount,this.columnCount+1)}addToPosition(e){return this.lineCount===0?new I(e.lineNumber,e.column+this.columnCount):new I(e.lineNumber+this.lineCount,this.columnCount+1)}toString(){return`${this.lineCount},${this.columnCount}`}};Rt.zero=new Rt(0,0);let Bn=Rt;class Hg{constructor(e){this.text=e,this.lineStartOffsetByLineIdx=[],this.lineStartOffsetByLineIdx.push(0);for(let t=0;t<e.length;t++)e.charAt(t)===`
`&&this.lineStartOffsetByLineIdx.push(t+1)}getOffset(e){return this.lineStartOffsetByLineIdx[e.lineNumber-1]+e.column-1}getOffsetRange(e){return new z(this.getOffset(e.getStartPosition()),this.getOffset(e.getEndPosition()))}get textLength(){const e=this.lineStartOffsetByLineIdx.length-1;return new Bn(e,this.text.length-this.lineStartOffsetByLineIdx[e])}}class fw{constructor(e){this.edits=e,Si(()=>Ro(e,(t,n)=>t.range.getEndPosition().isBeforeOrEqual(n.range.getStartPosition())))}apply(e){let t="",n=new I(1,1);for(const r of this.edits){const o=r.range,a=o.getStartPosition(),l=o.getEndPosition(),u=Ol(n,a);u.isEmpty()||(t+=e.getValueOfRange(u)),t+=r.text,n=l}const i=Ol(n,e.endPositionExclusive);return i.isEmpty()||(t+=e.getValueOfRange(i)),t}applyToString(e){const t=new Ug(e);return this.apply(t)}getNewRanges(){const e=[];let t=0,n=0,i=0;for(const r of this.edits){const o=Bn.ofText(r.text),a=I.lift({lineNumber:r.range.startLineNumber+n,column:r.range.startColumn+(r.range.startLineNumber===t?i:0)}),l=o.createRange(a);e.push(l),n=l.endLineNumber-r.range.endLineNumber,i=l.endColumn-r.range.endColumn,t=r.range.endLineNumber}return e}}class jg{constructor(e,t){this.range=e,this.text=t}toSingleEditOperation(){return{range:this.range,text:this.text}}}function Ol(s,e){if(s.lineNumber===e.lineNumber&&s.column===Number.MAX_SAFE_INTEGER)return w.fromPositions(e,e);if(!s.isBeforeOrEqual(e))throw new he("start must be before end");return new w(s.lineNumber,s.column,e.lineNumber,e.column)}class Wc{get endPositionExclusive(){return this.length.addToPosition(new I(1,1))}}class Ug extends Wc{constructor(e){super(),this.value=e,this._t=new Hg(this.value)}getValueOfRange(e){return this._t.getOffsetRange(e).substring(this.value)}get length(){return this._t.textLength}}class qe{static inverse(e,t,n){const i=[];let r=1,o=1;for(const l of e){const u=new qe(new $(r,l.original.startLineNumber),new $(o,l.modified.startLineNumber));u.modified.isEmpty||i.push(u),r=l.original.endLineNumberExclusive,o=l.modified.endLineNumberExclusive}const a=new qe(new $(r,t+1),new $(o,n+1));return a.modified.isEmpty||i.push(a),i}static clip(e,t,n){const i=[];for(const r of e){const o=r.original.intersect(t),a=r.modified.intersect(n);o&&!o.isEmpty&&a&&!a.isEmpty&&i.push(new qe(o,a))}return i}constructor(e,t){this.original=e,this.modified=t}toString(){return`{${this.original.toString()}->${this.modified.toString()}}`}flip(){return new qe(this.modified,this.original)}join(e){return new qe(this.original.join(e.original),this.modified.join(e.modified))}toRangeMapping(){const e=this.original.toInclusiveRange(),t=this.modified.toInclusiveRange();if(e&&t)return new Je(e,t);if(this.original.startLineNumber===1||this.modified.startLineNumber===1){if(!(this.modified.startLineNumber===1&&this.original.startLineNumber===1))throw new he("not a valid diff");return new Je(new w(this.original.startLineNumber,1,this.original.endLineNumberExclusive,1),new w(this.modified.startLineNumber,1,this.modified.endLineNumberExclusive,1))}else return new Je(new w(this.original.startLineNumber-1,Number.MAX_SAFE_INTEGER,this.original.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER),new w(this.modified.startLineNumber-1,Number.MAX_SAFE_INTEGER,this.modified.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER))}toRangeMapping2(e,t){if(Bl(this.original.endLineNumberExclusive,e)&&Bl(this.modified.endLineNumberExclusive,t))return new Je(new w(this.original.startLineNumber,1,this.original.endLineNumberExclusive,1),new w(this.modified.startLineNumber,1,this.modified.endLineNumberExclusive,1));if(!this.original.isEmpty&&!this.modified.isEmpty)return new Je(w.fromPositions(new I(this.original.startLineNumber,1),fn(new I(this.original.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER),e)),w.fromPositions(new I(this.modified.startLineNumber,1),fn(new I(this.modified.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER),t)));if(this.original.startLineNumber>1&&this.modified.startLineNumber>1)return new Je(w.fromPositions(fn(new I(this.original.startLineNumber-1,Number.MAX_SAFE_INTEGER),e),fn(new I(this.original.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER),e)),w.fromPositions(fn(new I(this.modified.startLineNumber-1,Number.MAX_SAFE_INTEGER),t),fn(new I(this.modified.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER),t)));throw new he}}function fn(s,e){if(s.lineNumber<1)return new I(1,1);if(s.lineNumber>e.length)return new I(e.length,e[e.length-1].length+1);const t=e[s.lineNumber-1];return s.column>t.length+1?new I(s.lineNumber,t.length+1):s}function Bl(s,e){return s>=1&&s<=e.length}class It extends qe{static fromRangeMappings(e){const t=$.join(e.map(i=>$.fromRangeInclusive(i.originalRange))),n=$.join(e.map(i=>$.fromRangeInclusive(i.modifiedRange)));return new It(t,n,e)}constructor(e,t,n){super(e,t),this.innerChanges=n}flip(){var e;return new It(this.modified,this.original,(e=this.innerChanges)==null?void 0:e.map(t=>t.flip()))}withInnerChangesFromLineRanges(){return new It(this.original,this.modified,[this.toRangeMapping()])}}class Je{static assertSorted(e){for(let t=1;t<e.length;t++){const n=e[t-1],i=e[t];if(!(n.originalRange.getEndPosition().isBeforeOrEqual(i.originalRange.getStartPosition())&&n.modifiedRange.getEndPosition().isBeforeOrEqual(i.modifiedRange.getStartPosition())))throw new he("Range mappings must be sorted")}}constructor(e,t){this.originalRange=e,this.modifiedRange=t}toString(){return`{${this.originalRange.toString()}->${this.modifiedRange.toString()}}`}flip(){return new Je(this.modifiedRange,this.originalRange)}toTextEdit(e){const t=e.getValueOfRange(this.modifiedRange);return new jg(this.originalRange,t)}}const qg=3;class Gg{computeDiff(e,t,n){var l;const r=new Zg(e,t,{maxComputationTime:n.maxComputationTimeMs,shouldIgnoreTrimWhitespace:n.ignoreTrimWhitespace,shouldComputeCharChanges:!0,shouldMakePrettyDiff:!0,shouldPostProcessCharChanges:!0}).computeDiff(),o=[];let a=null;for(const u of r.changes){let c;u.originalEndLineNumber===0?c=new $(u.originalStartLineNumber+1,u.originalStartLineNumber+1):c=new $(u.originalStartLineNumber,u.originalEndLineNumber+1);let h;u.modifiedEndLineNumber===0?h=new $(u.modifiedStartLineNumber+1,u.modifiedStartLineNumber+1):h=new $(u.modifiedStartLineNumber,u.modifiedEndLineNumber+1);let d=new It(c,h,(l=u.charChanges)==null?void 0:l.map(f=>new Je(new w(f.originalStartLineNumber,f.originalStartColumn,f.originalEndLineNumber,f.originalEndColumn),new w(f.modifiedStartLineNumber,f.modifiedStartColumn,f.modifiedEndLineNumber,f.modifiedEndColumn))));a&&(a.modified.endLineNumberExclusive===d.modified.startLineNumber||a.original.endLineNumberExclusive===d.original.startLineNumber)&&(d=new It(a.original.join(d.original),a.modified.join(d.modified),a.innerChanges&&d.innerChanges?a.innerChanges.concat(d.innerChanges):void 0),o.pop()),o.push(d),a=d}return Si(()=>Ro(o,(u,c)=>c.original.startLineNumber-u.original.endLineNumberExclusive===c.modified.startLineNumber-u.modified.endLineNumberExclusive&&u.original.endLineNumberExclusive<c.original.startLineNumber&&u.modified.endLineNumberExclusive<c.modified.startLineNumber)),new hs(o,[],r.quitEarly)}}function Fc(s,e,t,n){return new Wh(s,e,t).ComputeDiff(n)}let Vl=class{constructor(e){const t=[],n=[];for(let i=0,r=e.length;i<r;i++)t[i]=to(e[i],1),n[i]=no(e[i],1);this.lines=e,this._startColumns=t,this._endColumns=n}getElements(){const e=[];for(let t=0,n=this.lines.length;t<n;t++)e[t]=this.lines[t].substring(this._startColumns[t]-1,this._endColumns[t]-1);return e}getStrictElement(e){return this.lines[e]}getStartLineNumber(e){return e+1}getEndLineNumber(e){return e+1}createCharSequence(e,t,n){const i=[],r=[],o=[];let a=0;for(let l=t;l<=n;l++){const u=this.lines[l],c=e?this._startColumns[l]:1,h=e?this._endColumns[l]:u.length+1;for(let d=c;d<h;d++)i[a]=u.charCodeAt(d-1),r[a]=l+1,o[a]=d,a++;!e&&l<n&&(i[a]=10,r[a]=l+1,o[a]=u.length+1,a++)}return new $g(i,r,o)}};class $g{constructor(e,t,n){this._charCodes=e,this._lineNumbers=t,this._columns=n}toString(){return"["+this._charCodes.map((e,t)=>(e===10?"\\n":String.fromCharCode(e))+`-(${this._lineNumbers[t]},${this._columns[t]})`).join(", ")+"]"}_assertIndex(e,t){if(e<0||e>=t.length)throw new Error("Illegal index")}getElements(){return this._charCodes}getStartLineNumber(e){return e>0&&e===this._lineNumbers.length?this.getEndLineNumber(e-1):(this._assertIndex(e,this._lineNumbers),this._lineNumbers[e])}getEndLineNumber(e){return e===-1?this.getStartLineNumber(e+1):(this._assertIndex(e,this._lineNumbers),this._charCodes[e]===10?this._lineNumbers[e]+1:this._lineNumbers[e])}getStartColumn(e){return e>0&&e===this._columns.length?this.getEndColumn(e-1):(this._assertIndex(e,this._columns),this._columns[e])}getEndColumn(e){return e===-1?this.getStartColumn(e+1):(this._assertIndex(e,this._columns),this._charCodes[e]===10?1:this._columns[e]+1)}}class Tn{constructor(e,t,n,i,r,o,a,l){this.originalStartLineNumber=e,this.originalStartColumn=t,this.originalEndLineNumber=n,this.originalEndColumn=i,this.modifiedStartLineNumber=r,this.modifiedStartColumn=o,this.modifiedEndLineNumber=a,this.modifiedEndColumn=l}static createFromDiffChange(e,t,n){const i=t.getStartLineNumber(e.originalStart),r=t.getStartColumn(e.originalStart),o=t.getEndLineNumber(e.originalStart+e.originalLength-1),a=t.getEndColumn(e.originalStart+e.originalLength-1),l=n.getStartLineNumber(e.modifiedStart),u=n.getStartColumn(e.modifiedStart),c=n.getEndLineNumber(e.modifiedStart+e.modifiedLength-1),h=n.getEndColumn(e.modifiedStart+e.modifiedLength-1);return new Tn(i,r,o,a,l,u,c,h)}}function Qg(s){if(s.length<=1)return s;const e=[s[0]];let t=e[0];for(let n=1,i=s.length;n<i;n++){const r=s[n],o=r.originalStart-(t.originalStart+t.originalLength),a=r.modifiedStart-(t.modifiedStart+t.modifiedLength);Math.min(o,a)<qg?(t.originalLength=r.originalStart+r.originalLength-t.originalStart,t.modifiedLength=r.modifiedStart+r.modifiedLength-t.modifiedStart):(e.push(r),t=r)}return e}class ii{constructor(e,t,n,i,r){this.originalStartLineNumber=e,this.originalEndLineNumber=t,this.modifiedStartLineNumber=n,this.modifiedEndLineNumber=i,this.charChanges=r}static createFromDiffResult(e,t,n,i,r,o,a){let l,u,c,h,d;if(t.originalLength===0?(l=n.getStartLineNumber(t.originalStart)-1,u=0):(l=n.getStartLineNumber(t.originalStart),u=n.getEndLineNumber(t.originalStart+t.originalLength-1)),t.modifiedLength===0?(c=i.getStartLineNumber(t.modifiedStart)-1,h=0):(c=i.getStartLineNumber(t.modifiedStart),h=i.getEndLineNumber(t.modifiedStart+t.modifiedLength-1)),o&&t.originalLength>0&&t.originalLength<20&&t.modifiedLength>0&&t.modifiedLength<20&&r()){const f=n.createCharSequence(e,t.originalStart,t.originalStart+t.originalLength-1),m=i.createCharSequence(e,t.modifiedStart,t.modifiedStart+t.modifiedLength-1);if(f.getElements().length>0&&m.getElements().length>0){let p=Fc(f,m,r,!0).changes;a&&(p=Qg(p)),d=[];for(let C=0,b=p.length;C<b;C++)d.push(Tn.createFromDiffChange(p[C],f,m))}}return new ii(l,u,c,h,d)}}class Zg{constructor(e,t,n){this.shouldComputeCharChanges=n.shouldComputeCharChanges,this.shouldPostProcessCharChanges=n.shouldPostProcessCharChanges,this.shouldIgnoreTrimWhitespace=n.shouldIgnoreTrimWhitespace,this.shouldMakePrettyDiff=n.shouldMakePrettyDiff,this.originalLines=e,this.modifiedLines=t,this.original=new Vl(e),this.modified=new Vl(t),this.continueLineDiff=Wl(n.maxComputationTime),this.continueCharDiff=Wl(n.maxComputationTime===0?0:Math.min(n.maxComputationTime,5e3))}computeDiff(){if(this.original.lines.length===1&&this.original.lines[0].length===0)return this.modified.lines.length===1&&this.modified.lines[0].length===0?{quitEarly:!1,changes:[]}:{quitEarly:!1,changes:[{originalStartLineNumber:1,originalEndLineNumber:1,modifiedStartLineNumber:1,modifiedEndLineNumber:this.modified.lines.length,charChanges:void 0}]};if(this.modified.lines.length===1&&this.modified.lines[0].length===0)return{quitEarly:!1,changes:[{originalStartLineNumber:1,originalEndLineNumber:this.original.lines.length,modifiedStartLineNumber:1,modifiedEndLineNumber:1,charChanges:void 0}]};const e=Fc(this.original,this.modified,this.continueLineDiff,this.shouldMakePrettyDiff),t=e.changes,n=e.quitEarly;if(this.shouldIgnoreTrimWhitespace){const a=[];for(let l=0,u=t.length;l<u;l++)a.push(ii.createFromDiffResult(this.shouldIgnoreTrimWhitespace,t[l],this.original,this.modified,this.continueCharDiff,this.shouldComputeCharChanges,this.shouldPostProcessCharChanges));return{quitEarly:n,changes:a}}const i=[];let r=0,o=0;for(let a=-1,l=t.length;a<l;a++){const u=a+1<l?t[a+1]:null,c=u?u.originalStart:this.originalLines.length,h=u?u.modifiedStart:this.modifiedLines.length;for(;r<c&&o<h;){const d=this.originalLines[r],f=this.modifiedLines[o];if(d!==f){{let m=to(d,1),p=to(f,1);for(;m>1&&p>1;){const C=d.charCodeAt(m-2),b=f.charCodeAt(p-2);if(C!==b)break;m--,p--}(m>1||p>1)&&this._pushTrimWhitespaceCharChange(i,r+1,1,m,o+1,1,p)}{let m=no(d,1),p=no(f,1);const C=d.length+1,b=f.length+1;for(;m<C&&p<b;){const L=d.charCodeAt(m-1),_=d.charCodeAt(p-1);if(L!==_)break;m++,p++}(m<C||p<b)&&this._pushTrimWhitespaceCharChange(i,r+1,m,C,o+1,p,b)}}r++,o++}u&&(i.push(ii.createFromDiffResult(this.shouldIgnoreTrimWhitespace,u,this.original,this.modified,this.continueCharDiff,this.shouldComputeCharChanges,this.shouldPostProcessCharChanges)),r+=u.originalLength,o+=u.modifiedLength)}return{quitEarly:n,changes:i}}_pushTrimWhitespaceCharChange(e,t,n,i,r,o,a){if(this._mergeTrimWhitespaceCharChange(e,t,n,i,r,o,a))return;let l;this.shouldComputeCharChanges&&(l=[new Tn(t,n,t,i,r,o,r,a)]),e.push(new ii(t,t,r,r,l))}_mergeTrimWhitespaceCharChange(e,t,n,i,r,o,a){const l=e.length;if(l===0)return!1;const u=e[l-1];return u.originalEndLineNumber===0||u.modifiedEndLineNumber===0?!1:u.originalEndLineNumber===t&&u.modifiedEndLineNumber===r?(this.shouldComputeCharChanges&&u.charChanges&&u.charChanges.push(new Tn(t,n,t,i,r,o,r,a)),!0):u.originalEndLineNumber+1===t&&u.modifiedEndLineNumber+1===r?(u.originalEndLineNumber=t,u.modifiedEndLineNumber=r,this.shouldComputeCharChanges&&u.charChanges&&u.charChanges.push(new Tn(t,n,t,i,r,o,r,a)),!0):!1}}function to(s,e){const t=Ve(s);return t===-1?e:t+1}function no(s,e){const t=on(s);return t===-1?e:t+2}function Wl(s){if(s===0)return()=>!0;const e=Date.now();return()=>Date.now()-e<s}class Nt{static trivial(e,t){return new Nt([new de(z.ofLength(e.length),z.ofLength(t.length))],!1)}static trivialTimedOut(e,t){return new Nt([new de(z.ofLength(e.length),z.ofLength(t.length))],!0)}constructor(e,t){this.diffs=e,this.hitTimeout=t}}class de{static invert(e,t){const n=[];return Fh(e,(i,r)=>{n.push(de.fromOffsetPairs(i?i.getEndExclusives():vt.zero,r?r.getStarts():new vt(t,(i?i.seq2Range.endExclusive-i.seq1Range.endExclusive:0)+t)))}),n}static fromOffsetPairs(e,t){return new de(new z(e.offset1,t.offset1),new z(e.offset2,t.offset2))}static assertSorted(e){let t;for(const n of e){if(t&&!(t.seq1Range.endExclusive<=n.seq1Range.start&&t.seq2Range.endExclusive<=n.seq2Range.start))throw new he("Sequence diffs must be sorted");t=n}}constructor(e,t){this.seq1Range=e,this.seq2Range=t}swap(){return new de(this.seq2Range,this.seq1Range)}toString(){return`${this.seq1Range} <-> ${this.seq2Range}`}join(e){return new de(this.seq1Range.join(e.seq1Range),this.seq2Range.join(e.seq2Range))}delta(e){return e===0?this:new de(this.seq1Range.delta(e),this.seq2Range.delta(e))}deltaStart(e){return e===0?this:new de(this.seq1Range.deltaStart(e),this.seq2Range.deltaStart(e))}deltaEnd(e){return e===0?this:new de(this.seq1Range.deltaEnd(e),this.seq2Range.deltaEnd(e))}intersect(e){const t=this.seq1Range.intersect(e.seq1Range),n=this.seq2Range.intersect(e.seq2Range);if(!(!t||!n))return new de(t,n)}getStarts(){return new vt(this.seq1Range.start,this.seq2Range.start)}getEndExclusives(){return new vt(this.seq1Range.endExclusive,this.seq2Range.endExclusive)}}const Xt=class Xt{constructor(e,t){this.offset1=e,this.offset2=t}toString(){return`${this.offset1} <-> ${this.offset2}`}delta(e){return e===0?this:new Xt(this.offset1+e,this.offset2+e)}equals(e){return this.offset1===e.offset1&&this.offset2===e.offset2}};Xt.zero=new Xt(0,0),Xt.max=new Xt(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER);let vt=Xt;const Gs=class Gs{isValid(){return!0}};Gs.instance=new Gs;let Ti=Gs;class Xg{constructor(e){if(this.timeout=e,this.startTime=Date.now(),this.valid=!0,e<=0)throw new he("timeout must be positive")}isValid(){if(!(Date.now()-this.startTime<this.timeout)&&this.valid){this.valid=!1;debugger}return this.valid}}class Lr{constructor(e,t){this.width=e,this.height=t,this.array=[],this.array=new Array(e*t)}get(e,t){return this.array[e+t*this.width]}set(e,t,n){this.array[e+t*this.width]=n}}function io(s){return s===32||s===9}const pi=class pi{static getKey(e){let t=this.chrKeys.get(e);return t===void 0&&(t=this.chrKeys.size,this.chrKeys.set(e,t)),t}constructor(e,t,n){this.range=e,this.lines=t,this.source=n,this.histogram=[];let i=0;for(let r=e.startLineNumber-1;r<e.endLineNumberExclusive-1;r++){const o=t[r];for(let l=0;l<o.length;l++){i++;const u=o[l],c=pi.getKey(u);this.histogram[c]=(this.histogram[c]||0)+1}i++;const a=pi.getKey(`
`);this.histogram[a]=(this.histogram[a]||0)+1}this.totalCount=i}computeSimilarity(e){let t=0;const n=Math.max(this.histogram.length,e.histogram.length);for(let i=0;i<n;i++)t+=Math.abs((this.histogram[i]??0)-(e.histogram[i]??0));return 1-t/(this.totalCount+e.totalCount)}};pi.chrKeys=new Map;let xs=pi;class Jg{compute(e,t,n=Ti.instance,i){if(e.length===0||t.length===0)return Nt.trivial(e,t);const r=new Lr(e.length,t.length),o=new Lr(e.length,t.length),a=new Lr(e.length,t.length);for(let m=0;m<e.length;m++)for(let p=0;p<t.length;p++){if(!n.isValid())return Nt.trivialTimedOut(e,t);const C=m===0?0:r.get(m-1,p),b=p===0?0:r.get(m,p-1);let L;e.getElement(m)===t.getElement(p)?(m===0||p===0?L=0:L=r.get(m-1,p-1),m>0&&p>0&&o.get(m-1,p-1)===3&&(L+=a.get(m-1,p-1)),L+=i?i(m,p):1):L=-1;const _=Math.max(C,b,L);if(_===L){const k=m>0&&p>0?a.get(m-1,p-1):0;a.set(m,p,k+1),o.set(m,p,3)}else _===C?(a.set(m,p,0),o.set(m,p,1)):_===b&&(a.set(m,p,0),o.set(m,p,2));r.set(m,p,_)}const l=[];let u=e.length,c=t.length;function h(m,p){(m+1!==u||p+1!==c)&&l.push(new de(new z(m+1,u),new z(p+1,c))),u=m,c=p}let d=e.length-1,f=t.length-1;for(;d>=0&&f>=0;)o.get(d,f)===3?(h(d,f),d--,f--):o.get(d,f)===1?d--:f--;return h(-1,-1),l.reverse(),new Nt(l,!1)}}class zc{compute(e,t,n=Ti.instance){if(e.length===0||t.length===0)return Nt.trivial(e,t);const i=e,r=t;function o(p,C){for(;p<i.length&&C<r.length&&i.getElement(p)===r.getElement(C);)p++,C++;return p}let a=0;const l=new Yg;l.set(0,o(0,0));const u=new Kg;u.set(0,l.get(0)===0?null:new Fl(null,0,0,l.get(0)));let c=0;e:for(;;){if(a++,!n.isValid())return Nt.trivialTimedOut(i,r);const p=-Math.min(a,r.length+a%2),C=Math.min(a,i.length+a%2);for(c=p;c<=C;c+=2){const b=c===C?-1:l.get(c+1),L=c===p?-1:l.get(c-1)+1,_=Math.min(Math.max(b,L),i.length),k=_-c;if(_>i.length||k>r.length)continue;const S=o(_,k);l.set(c,S);const N=_===b?u.get(c+1):u.get(c-1);if(u.set(c,S!==_?new Fl(N,_,k,S-_):N),l.get(c)===i.length&&l.get(c)-c===r.length)break e}}let h=u.get(c);const d=[];let f=i.length,m=r.length;for(;;){const p=h?h.x+h.length:0,C=h?h.y+h.length:0;if((p!==f||C!==m)&&d.push(new de(new z(p,f),new z(C,m))),!h)break;f=h.x,m=h.y,h=h.prev}return d.reverse(),new Nt(d,!1)}}class Fl{constructor(e,t,n,i){this.prev=e,this.x=t,this.y=n,this.length=i}}class Yg{constructor(){this.positiveArr=new Int32Array(10),this.negativeArr=new Int32Array(10)}get(e){return e<0?(e=-e-1,this.negativeArr[e]):this.positiveArr[e]}set(e,t){if(e<0){if(e=-e-1,e>=this.negativeArr.length){const n=this.negativeArr;this.negativeArr=new Int32Array(n.length*2),this.negativeArr.set(n)}this.negativeArr[e]=t}else{if(e>=this.positiveArr.length){const n=this.positiveArr;this.positiveArr=new Int32Array(n.length*2),this.positiveArr.set(n)}this.positiveArr[e]=t}}}class Kg{constructor(){this.positiveArr=[],this.negativeArr=[]}get(e){return e<0?(e=-e-1,this.negativeArr[e]):this.positiveArr[e]}set(e,t){e<0?(e=-e-1,this.negativeArr[e]=t):this.positiveArr[e]=t}}class Ts{constructor(e,t,n){this.lines=e,this.range=t,this.considerWhitespaceChanges=n,this.elements=[],this.firstElementOffsetByLineIdx=[],this.lineStartOffsets=[],this.trimmedWsLengthsByLineIdx=[],this.firstElementOffsetByLineIdx.push(0);for(let i=this.range.startLineNumber;i<=this.range.endLineNumber;i++){let r=e[i-1],o=0;i===this.range.startLineNumber&&this.range.startColumn>1&&(o=this.range.startColumn-1,r=r.substring(o)),this.lineStartOffsets.push(o);let a=0;if(!n){const u=r.trimStart();a=r.length-u.length,r=u.trimEnd()}this.trimmedWsLengthsByLineIdx.push(a);const l=i===this.range.endLineNumber?Math.min(this.range.endColumn-1-o-a,r.length):r.length;for(let u=0;u<l;u++)this.elements.push(r.charCodeAt(u));i<this.range.endLineNumber&&(this.elements.push(10),this.firstElementOffsetByLineIdx.push(this.elements.length))}}toString(){return`Slice: "${this.text}"`}get text(){return this.getText(new z(0,this.length))}getText(e){return this.elements.slice(e.start,e.endExclusive).map(t=>String.fromCharCode(t)).join("")}getElement(e){return this.elements[e]}get length(){return this.elements.length}getBoundaryScore(e){const t=Hl(e>0?this.elements[e-1]:-1),n=Hl(e<this.elements.length?this.elements[e]:-1);if(t===7&&n===8)return 0;if(t===8)return 150;let i=0;return t!==n&&(i+=10,t===0&&n===1&&(i+=1)),i+=zl(t),i+=zl(n),i}translateOffset(e,t="right"){const n=Wr(this.firstElementOffsetByLineIdx,r=>r<=e),i=e-this.firstElementOffsetByLineIdx[n];return new I(this.range.startLineNumber+n,1+this.lineStartOffsets[n]+i+(i===0&&t==="left"?0:this.trimmedWsLengthsByLineIdx[n]))}translateRange(e){const t=this.translateOffset(e.start,"right"),n=this.translateOffset(e.endExclusive,"left");return n.isBefore(t)?w.fromPositions(n,n):w.fromPositions(t,n)}findWordContaining(e){if(e<0||e>=this.elements.length||!wr(this.elements[e]))return;let t=e;for(;t>0&&wr(this.elements[t-1]);)t--;let n=e;for(;n<this.elements.length&&wr(this.elements[n]);)n++;return new z(t,n)}countLinesIn(e){return this.translateOffset(e.endExclusive).lineNumber-this.translateOffset(e.start).lineNumber}isStronglyEqual(e,t){return this.elements[e]===this.elements[t]}extendToFullLines(e){const t=Pn(this.firstElementOffsetByLineIdx,i=>i<=e.start)??0,n=zh(this.firstElementOffsetByLineIdx,i=>e.endExclusive<=i)??this.elements.length;return new z(t,n)}}function wr(s){return s>=97&&s<=122||s>=65&&s<=90||s>=48&&s<=57}const em={0:0,1:0,2:0,3:10,4:2,5:30,6:3,7:10,8:10};function zl(s){return em[s]}function Hl(s){return s===10?8:s===13?7:io(s)?6:s>=97&&s<=122?0:s>=65&&s<=90?1:s>=48&&s<=57?2:s===-1?3:s===44||s===59?5:4}function tm(s,e,t,n,i,r){let{moves:o,excludedChanges:a}=im(s,e,t,r);if(!r.isValid())return[];const l=s.filter(c=>!a.has(c)),u=sm(l,n,i,e,t,r);return Fr(o,u),o=rm(o),o=o.filter(c=>{const h=c.original.toOffsetRange().slice(e).map(f=>f.trim());return h.join(`
`).length>=15&&nm(h,f=>f.length>=2)>=2}),o=om(s,o),o}function nm(s,e){let t=0;for(const n of s)e(n)&&t++;return t}function im(s,e,t,n){const i=[],r=s.filter(l=>l.modified.isEmpty&&l.original.length>=3).map(l=>new xs(l.original,e,l)),o=new Set(s.filter(l=>l.original.isEmpty&&l.modified.length>=3).map(l=>new xs(l.modified,t,l))),a=new Set;for(const l of r){let u=-1,c;for(const h of o){const d=l.computeSimilarity(h);d>u&&(u=d,c=h)}if(u>.9&&c&&(o.delete(c),i.push(new qe(l.range,c.range)),a.add(l.source),a.add(c.source)),!n.isValid())return{moves:i,excludedChanges:a}}return{moves:i,excludedChanges:a}}function sm(s,e,t,n,i,r){const o=[],a=new Hh;for(const d of s)for(let f=d.original.startLineNumber;f<d.original.endLineNumberExclusive-2;f++){const m=`${e[f-1]}:${e[f+1-1]}:${e[f+2-1]}`;a.add(m,{range:new $(f,f+3)})}const l=[];s.sort(Ot(d=>d.modified.startLineNumber,us));for(const d of s){let f=[];for(let m=d.modified.startLineNumber;m<d.modified.endLineNumberExclusive-2;m++){const p=`${t[m-1]}:${t[m+1-1]}:${t[m+2-1]}`,C=new $(m,m+3),b=[];a.forEach(p,({range:L})=>{for(const k of f)if(k.originalLineRange.endLineNumberExclusive+1===L.endLineNumberExclusive&&k.modifiedLineRange.endLineNumberExclusive+1===C.endLineNumberExclusive){k.originalLineRange=new $(k.originalLineRange.startLineNumber,L.endLineNumberExclusive),k.modifiedLineRange=new $(k.modifiedLineRange.startLineNumber,C.endLineNumberExclusive),b.push(k);return}const _={modifiedLineRange:C,originalLineRange:L};l.push(_),b.push(_)}),f=b}if(!r.isValid())return[]}l.sort(jh(Ot(d=>d.modifiedLineRange.length,us)));const u=new rt,c=new rt;for(const d of l){const f=d.modifiedLineRange.startLineNumber-d.originalLineRange.startLineNumber,m=u.subtractFrom(d.modifiedLineRange),p=c.subtractFrom(d.originalLineRange).getWithDelta(f),C=m.getIntersection(p);for(const b of C.ranges){if(b.length<3)continue;const L=b,_=b.delta(-f);o.push(new qe(_,L)),u.addRange(L),c.addRange(_)}}o.sort(Ot(d=>d.original.startLineNumber,us));const h=new cc(s);for(let d=0;d<o.length;d++){const f=o[d],m=h.findLastMonotonous(N=>N.original.startLineNumber<=f.original.startLineNumber),p=Pn(s,N=>N.modified.startLineNumber<=f.modified.startLineNumber),C=Math.max(f.original.startLineNumber-m.original.startLineNumber,f.modified.startLineNumber-p.modified.startLineNumber),b=h.findLastMonotonous(N=>N.original.startLineNumber<f.original.endLineNumberExclusive),L=Pn(s,N=>N.modified.startLineNumber<f.modified.endLineNumberExclusive),_=Math.max(b.original.endLineNumberExclusive-f.original.endLineNumberExclusive,L.modified.endLineNumberExclusive-f.modified.endLineNumberExclusive);let k;for(k=0;k<C;k++){const N=f.original.startLineNumber-k-1,x=f.modified.startLineNumber-k-1;if(N>n.length||x>i.length||u.contains(x)||c.contains(N)||!jl(n[N-1],i[x-1],r))break}k>0&&(c.addRange(new $(f.original.startLineNumber-k,f.original.startLineNumber)),u.addRange(new $(f.modified.startLineNumber-k,f.modified.startLineNumber)));let S;for(S=0;S<_;S++){const N=f.original.endLineNumberExclusive+S,x=f.modified.endLineNumberExclusive+S;if(N>n.length||x>i.length||u.contains(x)||c.contains(N)||!jl(n[N-1],i[x-1],r))break}S>0&&(c.addRange(new $(f.original.endLineNumberExclusive,f.original.endLineNumberExclusive+S)),u.addRange(new $(f.modified.endLineNumberExclusive,f.modified.endLineNumberExclusive+S))),(k>0||S>0)&&(o[d]=new qe(new $(f.original.startLineNumber-k,f.original.endLineNumberExclusive+S),new $(f.modified.startLineNumber-k,f.modified.endLineNumberExclusive+S)))}return o}function jl(s,e,t){if(s.trim()===e.trim())return!0;if(s.length>300&&e.length>300)return!1;const i=new zc().compute(new Ts([s],new w(1,1,1,s.length),!1),new Ts([e],new w(1,1,1,e.length),!1),t);let r=0;const o=de.invert(i.diffs,s.length);for(const c of o)c.seq1Range.forEach(h=>{io(s.charCodeAt(h))||r++});function a(c){let h=0;for(let d=0;d<s.length;d++)io(c.charCodeAt(d))||h++;return h}const l=a(s.length>e.length?s:e);return r/l>.6&&l>10}function rm(s){if(s.length===0)return s;s.sort(Ot(t=>t.original.startLineNumber,us));const e=[s[0]];for(let t=1;t<s.length;t++){const n=e[e.length-1],i=s[t],r=i.original.startLineNumber-n.original.endLineNumberExclusive,o=i.modified.startLineNumber-n.modified.endLineNumberExclusive;if(r>=0&&o>=0&&r+o<=2){e[e.length-1]=n.join(i);continue}e.push(i)}return e}function om(s,e){const t=new cc(s);return e=e.filter(n=>{const i=t.findLastMonotonous(a=>a.original.startLineNumber<n.original.endLineNumberExclusive)||new qe(new $(1,1),new $(1,1)),r=Pn(s,a=>a.modified.startLineNumber<n.modified.endLineNumberExclusive);return i!==r}),e}function Ul(s,e,t){let n=t;return n=ql(s,e,n),n=ql(s,e,n),n=am(s,e,n),n}function ql(s,e,t){if(t.length===0)return t;const n=[];n.push(t[0]);for(let r=1;r<t.length;r++){const o=n[n.length-1];let a=t[r];if(a.seq1Range.isEmpty||a.seq2Range.isEmpty){const l=a.seq1Range.start-o.seq1Range.endExclusive;let u;for(u=1;u<=l&&!(s.getElement(a.seq1Range.start-u)!==s.getElement(a.seq1Range.endExclusive-u)||e.getElement(a.seq2Range.start-u)!==e.getElement(a.seq2Range.endExclusive-u));u++);if(u--,u===l){n[n.length-1]=new de(new z(o.seq1Range.start,a.seq1Range.endExclusive-l),new z(o.seq2Range.start,a.seq2Range.endExclusive-l));continue}a=a.delta(-u)}n.push(a)}const i=[];for(let r=0;r<n.length-1;r++){const o=n[r+1];let a=n[r];if(a.seq1Range.isEmpty||a.seq2Range.isEmpty){const l=o.seq1Range.start-a.seq1Range.endExclusive;let u;for(u=0;u<l&&!(!s.isStronglyEqual(a.seq1Range.start+u,a.seq1Range.endExclusive+u)||!e.isStronglyEqual(a.seq2Range.start+u,a.seq2Range.endExclusive+u));u++);if(u===l){n[r+1]=new de(new z(a.seq1Range.start+l,o.seq1Range.endExclusive),new z(a.seq2Range.start+l,o.seq2Range.endExclusive));continue}u>0&&(a=a.delta(u))}i.push(a)}return n.length>0&&i.push(n[n.length-1]),i}function am(s,e,t){if(!s.getBoundaryScore||!e.getBoundaryScore)return t;for(let n=0;n<t.length;n++){const i=n>0?t[n-1]:void 0,r=t[n],o=n+1<t.length?t[n+1]:void 0,a=new z(i?i.seq1Range.endExclusive+1:0,o?o.seq1Range.start-1:s.length),l=new z(i?i.seq2Range.endExclusive+1:0,o?o.seq2Range.start-1:e.length);r.seq1Range.isEmpty?t[n]=Gl(r,s,e,a,l):r.seq2Range.isEmpty&&(t[n]=Gl(r.swap(),e,s,l,a).swap())}return t}function Gl(s,e,t,n,i){let o=1;for(;s.seq1Range.start-o>=n.start&&s.seq2Range.start-o>=i.start&&t.isStronglyEqual(s.seq2Range.start-o,s.seq2Range.endExclusive-o)&&o<100;)o++;o--;let a=0;for(;s.seq1Range.start+a<n.endExclusive&&s.seq2Range.endExclusive+a<i.endExclusive&&t.isStronglyEqual(s.seq2Range.start+a,s.seq2Range.endExclusive+a)&&a<100;)a++;if(o===0&&a===0)return s;let l=0,u=-1;for(let c=-o;c<=a;c++){const h=s.seq2Range.start+c,d=s.seq2Range.endExclusive+c,f=s.seq1Range.start+c,m=e.getBoundaryScore(f)+t.getBoundaryScore(h)+t.getBoundaryScore(d);m>u&&(u=m,l=c)}return s.delta(l)}function lm(s,e,t){const n=[];for(const i of t){const r=n[n.length-1];if(!r){n.push(i);continue}i.seq1Range.start-r.seq1Range.endExclusive<=2||i.seq2Range.start-r.seq2Range.endExclusive<=2?n[n.length-1]=new de(r.seq1Range.join(i.seq1Range),r.seq2Range.join(i.seq2Range)):n.push(i)}return n}function um(s,e,t){const n=de.invert(t,s.length),i=[];let r=new vt(0,0);function o(l,u){if(l.offset1<r.offset1||l.offset2<r.offset2)return;const c=s.findWordContaining(l.offset1),h=e.findWordContaining(l.offset2);if(!c||!h)return;let d=new de(c,h);const f=d.intersect(u);let m=f.seq1Range.length,p=f.seq2Range.length;for(;n.length>0;){const C=n[0];if(!(C.seq1Range.intersects(d.seq1Range)||C.seq2Range.intersects(d.seq2Range)))break;const L=s.findWordContaining(C.seq1Range.start),_=e.findWordContaining(C.seq2Range.start),k=new de(L,_),S=k.intersect(C);if(m+=S.seq1Range.length,p+=S.seq2Range.length,d=d.join(k),d.seq1Range.endExclusive>=C.seq1Range.endExclusive)n.shift();else break}m+p<(d.seq1Range.length+d.seq2Range.length)*2/3&&i.push(d),r=d.getEndExclusives()}for(;n.length>0;){const l=n.shift();l.seq1Range.isEmpty||(o(l.getStarts(),l),o(l.getEndExclusives().delta(-1),l))}return cm(t,i)}function cm(s,e){const t=[];for(;s.length>0||e.length>0;){const n=s[0],i=e[0];let r;n&&(!i||n.seq1Range.start<i.seq1Range.start)?r=s.shift():r=e.shift(),t.length>0&&t[t.length-1].seq1Range.endExclusive>=r.seq1Range.start?t[t.length-1]=t[t.length-1].join(r):t.push(r)}return t}function hm(s,e,t){let n=t;if(n.length===0)return n;let i=0,r;do{r=!1;const o=[n[0]];for(let a=1;a<n.length;a++){let c=function(d,f){const m=new z(u.seq1Range.endExclusive,l.seq1Range.start);return s.getText(m).replace(/\s/g,"").length<=4&&(d.seq1Range.length+d.seq2Range.length>5||f.seq1Range.length+f.seq2Range.length>5)};const l=n[a],u=o[o.length-1];c(u,l)?(r=!0,o[o.length-1]=o[o.length-1].join(l)):o.push(l)}n=o}while(i++<10&&r);return n}function dm(s,e,t){let n=t;if(n.length===0)return n;let i=0,r;do{r=!1;const a=[n[0]];for(let l=1;l<n.length;l++){let h=function(f,m){const p=new z(c.seq1Range.endExclusive,u.seq1Range.start);if(s.countLinesIn(p)>5||p.length>500)return!1;const b=s.getText(p).trim();if(b.length>20||b.split(/\r\n|\r|\n/).length>1)return!1;const L=s.countLinesIn(f.seq1Range),_=f.seq1Range.length,k=e.countLinesIn(f.seq2Range),S=f.seq2Range.length,N=s.countLinesIn(m.seq1Range),x=m.seq1Range.length,T=e.countLinesIn(m.seq2Range),E=m.seq2Range.length,V=2*40+50;function P(B){return Math.min(B,V)}return Math.pow(Math.pow(P(L*40+_),1.5)+Math.pow(P(k*40+S),1.5),1.5)+Math.pow(Math.pow(P(N*40+x),1.5)+Math.pow(P(T*40+E),1.5),1.5)>(V**1.5)**1.5*1.3};const u=n[l],c=a[a.length-1];h(c,u)?(r=!0,a[a.length-1]=a[a.length-1].join(u)):a.push(u)}n=a}while(i++<10&&r);const o=[];return Uh(n,(a,l,u)=>{let c=l;function h(b){return b.length>0&&b.trim().length<=3&&l.seq1Range.length+l.seq2Range.length>100}const d=s.extendToFullLines(l.seq1Range),f=s.getText(new z(d.start,l.seq1Range.start));h(f)&&(c=c.deltaStart(-f.length));const m=s.getText(new z(l.seq1Range.endExclusive,d.endExclusive));h(m)&&(c=c.deltaEnd(m.length));const p=de.fromOffsetPairs(a?a.getEndExclusives():vt.zero,u?u.getStarts():vt.max),C=c.intersect(p);o.length>0&&C.getStarts().equals(o[o.length-1].getEndExclusives())?o[o.length-1]=o[o.length-1].join(C):o.push(C)}),o}class $l{constructor(e,t){this.trimmedHash=e,this.lines=t}getElement(e){return this.trimmedHash[e]}get length(){return this.trimmedHash.length}getBoundaryScore(e){const t=e===0?0:Ql(this.lines[e-1]),n=e===this.lines.length?0:Ql(this.lines[e]);return 1e3-(t+n)}getText(e){return this.lines.slice(e.start,e.endExclusive).join(`
`)}isStronglyEqual(e,t){return this.lines[e]===this.lines[t]}}function Ql(s){let e=0;for(;e<s.length&&(s.charCodeAt(e)===32||s.charCodeAt(e)===9);)e++;return e}class fm{constructor(){this.dynamicProgrammingDiffing=new Jg,this.myersDiffingAlgorithm=new zc}computeDiff(e,t,n){if(e.length<=1&&wi(e,t,(S,N)=>S===N))return new hs([],[],!1);if(e.length===1&&e[0].length===0||t.length===1&&t[0].length===0)return new hs([new It(new $(1,e.length+1),new $(1,t.length+1),[new Je(new w(1,1,e.length,e[e.length-1].length+1),new w(1,1,t.length,t[t.length-1].length+1))])],[],!1);const i=n.maxComputationTimeMs===0?Ti.instance:new Xg(n.maxComputationTimeMs),r=!n.ignoreTrimWhitespace,o=new Map;function a(S){let N=o.get(S);return N===void 0&&(N=o.size,o.set(S,N)),N}const l=e.map(S=>a(S.trim())),u=t.map(S=>a(S.trim())),c=new $l(l,e),h=new $l(u,t),d=c.length+h.length<1700?this.dynamicProgrammingDiffing.compute(c,h,i,(S,N)=>e[S]===t[N]?t[N].length===0?.1:1+Math.log(1+t[N].length):.99):this.myersDiffingAlgorithm.compute(c,h,i);let f=d.diffs,m=d.hitTimeout;f=Ul(c,h,f),f=hm(c,h,f);const p=[],C=S=>{if(r)for(let N=0;N<S;N++){const x=b+N,T=L+N;if(e[x]!==t[T]){const E=this.refineDiff(e,t,new de(new z(x,x+1),new z(T,T+1)),i,r);for(const V of E.mappings)p.push(V);E.hitTimeout&&(m=!0)}}};let b=0,L=0;for(const S of f){Si(()=>S.seq1Range.start-b===S.seq2Range.start-L);const N=S.seq1Range.start-b;C(N),b=S.seq1Range.endExclusive,L=S.seq2Range.endExclusive;const x=this.refineDiff(e,t,S,i,r);x.hitTimeout&&(m=!0);for(const T of x.mappings)p.push(T)}C(e.length-b);const _=Zl(p,e,t);let k=[];return n.computeMoves&&(k=this.computeMoves(_,e,t,l,u,i,r)),Si(()=>{function S(x,T){if(x.lineNumber<1||x.lineNumber>T.length)return!1;const E=T[x.lineNumber-1];return!(x.column<1||x.column>E.length+1)}function N(x,T){return!(x.startLineNumber<1||x.startLineNumber>T.length+1||x.endLineNumberExclusive<1||x.endLineNumberExclusive>T.length+1)}for(const x of _){if(!x.innerChanges)return!1;for(const T of x.innerChanges)if(!(S(T.modifiedRange.getStartPosition(),t)&&S(T.modifiedRange.getEndPosition(),t)&&S(T.originalRange.getStartPosition(),e)&&S(T.originalRange.getEndPosition(),e)))return!1;if(!N(x.modified,t)||!N(x.original,e))return!1}return!0}),new hs(_,k,m)}computeMoves(e,t,n,i,r,o,a){return tm(e,t,n,i,r,o).map(c=>{const h=this.refineDiff(t,n,new de(c.original.toOffsetRange(),c.modified.toOffsetRange()),o,a),d=Zl(h.mappings,t,n,!0);return new zg(c,d)})}refineDiff(e,t,n,i,r){const a=mm(n).toRangeMapping2(e,t),l=new Ts(e,a.originalRange,r),u=new Ts(t,a.modifiedRange,r),c=l.length+u.length<500?this.dynamicProgrammingDiffing.compute(l,u,i):this.myersDiffingAlgorithm.compute(l,u,i);let h=c.diffs;return h=Ul(l,u,h),h=um(l,u,h),h=lm(l,u,h),h=dm(l,u,h),{mappings:h.map(f=>new Je(l.translateRange(f.seq1Range),u.translateRange(f.seq2Range))),hitTimeout:c.hitTimeout}}}function Zl(s,e,t,n=!1){const i=[];for(const r of qh(s.map(o=>gm(o,e,t)),(o,a)=>o.original.overlapOrTouch(a.original)||o.modified.overlapOrTouch(a.modified))){const o=r[0],a=r[r.length-1];i.push(new It(o.original.join(a.original),o.modified.join(a.modified),r.map(l=>l.innerChanges[0])))}return Si(()=>!n&&i.length>0&&(i[0].modified.startLineNumber!==i[0].original.startLineNumber||t.length-i[i.length-1].modified.endLineNumberExclusive!==e.length-i[i.length-1].original.endLineNumberExclusive)?!1:Ro(i,(r,o)=>o.original.startLineNumber-r.original.endLineNumberExclusive===o.modified.startLineNumber-r.modified.endLineNumberExclusive&&r.original.endLineNumberExclusive<o.original.startLineNumber&&r.modified.endLineNumberExclusive<o.modified.startLineNumber)),i}function gm(s,e,t){let n=0,i=0;s.modifiedRange.endColumn===1&&s.originalRange.endColumn===1&&s.originalRange.startLineNumber+n<=s.originalRange.endLineNumber&&s.modifiedRange.startLineNumber+n<=s.modifiedRange.endLineNumber&&(i=-1),s.modifiedRange.startColumn-1>=t[s.modifiedRange.startLineNumber-1].length&&s.originalRange.startColumn-1>=e[s.originalRange.startLineNumber-1].length&&s.originalRange.startLineNumber<=s.originalRange.endLineNumber+i&&s.modifiedRange.startLineNumber<=s.modifiedRange.endLineNumber+i&&(n=1);const r=new $(s.originalRange.startLineNumber+n,s.originalRange.endLineNumber+1+i),o=new $(s.modifiedRange.startLineNumber+n,s.modifiedRange.endLineNumber+1+i);return new It(r,o,[s])}function mm(s){return new qe(new $(s.seq1Range.start+1,s.seq1Range.endExclusive+1),new $(s.seq2Range.start+1,s.seq2Range.endExclusive+1))}const Xl={getLegacy:()=>new Gg,getDefault:()=>new fm};function Hc(s){const e=[];for(const t of s){const n=Number(t);(n||n===0&&t.replace(/\s/g,"")!=="")&&e.push(n)}return e}function Vo(s,e,t,n){return{red:s/255,blue:t/255,green:e/255,alpha:n}}function Un(s,e){const t=e.index,n=e[0].length;if(!t)return;const i=s.positionAt(t);return{startLineNumber:i.lineNumber,startColumn:i.column,endLineNumber:i.lineNumber,endColumn:i.column+n}}function pm(s,e){if(!s)return;const t=fe.Format.CSS.parseHex(e);if(t)return{range:s,color:Vo(t.rgba.r,t.rgba.g,t.rgba.b,t.rgba.a)}}function Jl(s,e,t){if(!s||e.length!==1)return;const i=e[0].values(),r=Hc(i);return{range:s,color:Vo(r[0],r[1],r[2],t?r[3]:1)}}function Yl(s,e,t){if(!s||e.length!==1)return;const i=e[0].values(),r=Hc(i),o=new fe(new Gh(r[0],r[1]/100,r[2]/100,t?r[3]:1));return{range:s,color:Vo(o.rgba.r,o.rgba.g,o.rgba.b,o.rgba.a)}}function qn(s,e){return typeof s=="string"?[...s.matchAll(e)]:s.findMatches(e)}function Cm(s){const e=[],n=qn(s,/\b(rgb|rgba|hsl|hsla)(\([0-9\s,.\%]*\))|(#)([A-Fa-f0-9]{3})\b|(#)([A-Fa-f0-9]{4})\b|(#)([A-Fa-f0-9]{6})\b|(#)([A-Fa-f0-9]{8})\b/gm);if(n.length>0)for(const i of n){const r=i.filter(u=>u!==void 0),o=r[1],a=r[2];if(!a)continue;let l;if(o==="rgb"){const u=/^\(\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\s*,\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\s*,\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\s*\)$/gm;l=Jl(Un(s,i),qn(a,u),!1)}else if(o==="rgba"){const u=/^\(\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\s*,\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\s*,\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\s*,\s*(0[.][0-9]+|[.][0-9]+|[01][.]|[01])\s*\)$/gm;l=Jl(Un(s,i),qn(a,u),!0)}else if(o==="hsl"){const u=/^\(\s*(36[0]|3[0-5][0-9]|[12][0-9][0-9]|[1-9]?[0-9])\s*,\s*(100|\d{1,2}[.]\d*|\d{1,2})%\s*,\s*(100|\d{1,2}[.]\d*|\d{1,2})%\s*\)$/gm;l=Yl(Un(s,i),qn(a,u),!1)}else if(o==="hsla"){const u=/^\(\s*(36[0]|3[0-5][0-9]|[12][0-9][0-9]|[1-9]?[0-9])\s*,\s*(100|\d{1,2}[.]\d*|\d{1,2})%\s*,\s*(100|\d{1,2}[.]\d*|\d{1,2})%\s*,\s*(0[.][0-9]+|[.][0-9]+|[01][.]|[01])\s*\)$/gm;l=Yl(Un(s,i),qn(a,u),!0)}else o==="#"&&(l=pm(Un(s,i),o+a));l&&e.push(l)}return e}function bm(s){return!s||typeof s.getValue!="function"||typeof s.positionAt!="function"?[]:Cm(s)}const Kl=new RegExp("\\bMARK:\\s*(.*)$","d"),Lm=/^-+|-+$/g;function wm(s,e){var n;let t=[];if(e.findRegionSectionHeaders&&((n=e.foldingRules)!=null&&n.markers)){const i=_m(s,e);t=t.concat(i)}if(e.findMarkSectionHeaders){const i=Sm(s);t=t.concat(i)}return t}function _m(s,e){const t=[],n=s.getLineCount();for(let i=1;i<=n;i++){const r=s.getLineContent(i),o=r.match(e.foldingRules.markers.start);if(o){const a={startLineNumber:i,startColumn:o[0].length+1,endLineNumber:i,endColumn:r.length+1};if(a.endColumn>a.startColumn){const l={range:a,...jc(r.substring(o[0].length)),shouldBeInComments:!1};(l.text||l.hasSeparatorLine)&&t.push(l)}}}return t}function Sm(s){const e=[],t=s.getLineCount();for(let n=1;n<=t;n++){const i=s.getLineContent(n);km(i,n,e)}return e}function km(s,e,t){Kl.lastIndex=0;const n=Kl.exec(s);if(n){const i=n.indices[1][0]+1,r=n.indices[1][1]+1,o={startLineNumber:e,startColumn:i,endLineNumber:e,endColumn:r};if(o.endColumn>o.startColumn){const a={range:o,...jc(n[1]),shouldBeInComments:!0};(a.text||a.hasSeparatorLine)&&t.push(a)}}}function jc(s){s=s.trim();const e=s.startsWith("-");return s=s.replace(Lm,""),{text:s,hasSeparatorLine:e}}class vm{constructor(e){this.values=e,this.prefixSum=new Uint32Array(e.length),this.prefixSumValidIndex=new Int32Array(1),this.prefixSumValidIndex[0]=-1}insertValues(e,t){e=un(e);const n=this.values,i=this.prefixSum,r=t.length;return r===0?!1:(this.values=new Uint32Array(n.length+r),this.values.set(n.subarray(0,e),0),this.values.set(n.subarray(e),e+r),this.values.set(t,e),e-1<this.prefixSumValidIndex[0]&&(this.prefixSumValidIndex[0]=e-1),this.prefixSum=new Uint32Array(this.values.length),this.prefixSumValidIndex[0]>=0&&this.prefixSum.set(i.subarray(0,this.prefixSumValidIndex[0]+1)),!0)}setValue(e,t){return e=un(e),t=un(t),this.values[e]===t?!1:(this.values[e]=t,e-1<this.prefixSumValidIndex[0]&&(this.prefixSumValidIndex[0]=e-1),!0)}removeValues(e,t){e=un(e),t=un(t);const n=this.values,i=this.prefixSum;if(e>=n.length)return!1;const r=n.length-e;return t>=r&&(t=r),t===0?!1:(this.values=new Uint32Array(n.length-t),this.values.set(n.subarray(0,e),0),this.values.set(n.subarray(e+t),e),this.prefixSum=new Uint32Array(this.values.length),e-1<this.prefixSumValidIndex[0]&&(this.prefixSumValidIndex[0]=e-1),this.prefixSumValidIndex[0]>=0&&this.prefixSum.set(i.subarray(0,this.prefixSumValidIndex[0]+1)),!0)}getTotalSum(){return this.values.length===0?0:this._getPrefixSum(this.values.length-1)}getPrefixSum(e){return e<0?0:(e=un(e),this._getPrefixSum(e))}_getPrefixSum(e){if(e<=this.prefixSumValidIndex[0])return this.prefixSum[e];let t=this.prefixSumValidIndex[0]+1;t===0&&(this.prefixSum[0]=this.values[0],t++),e>=this.values.length&&(e=this.values.length-1);for(let n=t;n<=e;n++)this.prefixSum[n]=this.prefixSum[n-1]+this.values[n];return this.prefixSumValidIndex[0]=Math.max(this.prefixSumValidIndex[0],e),this.prefixSum[e]}getIndexOf(e){e=Math.floor(e),this.getTotalSum();let t=0,n=this.values.length-1,i=0,r=0,o=0;for(;t<=n;)if(i=t+(n-t)/2|0,r=this.prefixSum[i],o=r-this.values[i],e<o)n=i-1;else if(e>=r)t=i+1;else break;return new Uc(i,e-o)}}class Im{constructor(e){this._values=e,this._isValid=!1,this._validEndIndex=-1,this._prefixSum=[],this._indexBySum=[]}getTotalSum(){return this._ensureValid(),this._indexBySum.length}getPrefixSum(e){return this._ensureValid(),e===0?0:this._prefixSum[e-1]}getIndexOf(e){this._ensureValid();const t=this._indexBySum[e],n=t>0?this._prefixSum[t-1]:0;return new Uc(t,e-n)}removeValues(e,t){this._values.splice(e,t),this._invalidate(e)}insertValues(e,t){this._values=Ks(this._values,e,t),this._invalidate(e)}_invalidate(e){this._isValid=!1,this._validEndIndex=Math.min(this._validEndIndex,e-1)}_ensureValid(){if(!this._isValid){for(let e=this._validEndIndex+1,t=this._values.length;e<t;e++){const n=this._values[e],i=e>0?this._prefixSum[e-1]:0;this._prefixSum[e]=i+n;for(let r=0;r<n;r++)this._indexBySum[i+r]=e}this._prefixSum.length=this._values.length,this._indexBySum.length=this._prefixSum[this._prefixSum.length-1],this._isValid=!0,this._validEndIndex=this._values.length-1}}setValue(e,t){this._values[e]!==t&&(this._values[e]=t,this._invalidate(e))}}class Uc{constructor(e,t){this.index=e,this.remainder=t,this._prefixSumIndexOfResultBrand=void 0,this.index=e,this.remainder=t}}class Nm{constructor(e,t,n,i){this._uri=e,this._lines=t,this._eol=n,this._versionId=i,this._lineStarts=null,this._cachedTextValue=null}dispose(){this._lines.length=0}get version(){return this._versionId}getText(){return this._cachedTextValue===null&&(this._cachedTextValue=this._lines.join(this._eol)),this._cachedTextValue}onEvents(e){e.eol&&e.eol!==this._eol&&(this._eol=e.eol,this._lineStarts=null);const t=e.changes;for(const n of t)this._acceptDeleteRange(n.range),this._acceptInsertText(new I(n.range.startLineNumber,n.range.startColumn),n.text);this._versionId=e.versionId,this._cachedTextValue=null}_ensureLineStarts(){if(!this._lineStarts){const e=this._eol.length,t=this._lines.length,n=new Uint32Array(t);for(let i=0;i<t;i++)n[i]=this._lines[i].length+e;this._lineStarts=new vm(n)}}_setLineText(e,t){this._lines[e]=t,this._lineStarts&&this._lineStarts.setValue(e,this._lines[e].length+this._eol.length)}_acceptDeleteRange(e){if(e.startLineNumber===e.endLineNumber){if(e.startColumn===e.endColumn)return;this._setLineText(e.startLineNumber-1,this._lines[e.startLineNumber-1].substring(0,e.startColumn-1)+this._lines[e.startLineNumber-1].substring(e.endColumn-1));return}this._setLineText(e.startLineNumber-1,this._lines[e.startLineNumber-1].substring(0,e.startColumn-1)+this._lines[e.endLineNumber-1].substring(e.endColumn-1)),this._lines.splice(e.startLineNumber,e.endLineNumber-e.startLineNumber),this._lineStarts&&this._lineStarts.removeValues(e.startLineNumber,e.endLineNumber-e.startLineNumber)}_acceptInsertText(e,t){if(t.length===0)return;const n=er(t);if(n.length===1){this._setLineText(e.lineNumber-1,this._lines[e.lineNumber-1].substring(0,e.column-1)+n[0]+this._lines[e.lineNumber-1].substring(e.column-1));return}n[n.length-1]+=this._lines[e.lineNumber-1].substring(e.column-1),this._setLineText(e.lineNumber-1,this._lines[e.lineNumber-1].substring(0,e.column-1)+n[0]);const i=new Uint32Array(n.length-1);for(let r=1;r<n.length;r++)this._lines.splice(e.lineNumber+r-1,0,n[r]),i[r-1]=n[r].length+this._eol.length;this._lineStarts&&this._lineStarts.insertValues(e.lineNumber,i)}}const eu=60*1e3;class mw extends oe{constructor(e,t,n=!1){if(super(),this._syncedModels=Object.create(null),this._syncedModelsLastUsedTime=Object.create(null),this._proxy=e,this._modelService=t,!n){const i=new $h;i.cancelAndSet(()=>this._checkStopModelSync(),Math.round(eu/2)),this._register(i)}}dispose(){for(const e in this._syncedModels)zr(this._syncedModels[e]);this._syncedModels=Object.create(null),this._syncedModelsLastUsedTime=Object.create(null),super.dispose()}ensureSyncedResources(e,t=!1){for(const n of e){const i=n.toString();this._syncedModels[i]||this._beginModelSync(n,t),this._syncedModels[i]&&(this._syncedModelsLastUsedTime[i]=new Date().getTime())}}_checkStopModelSync(){const e=new Date().getTime(),t=[];for(const n in this._syncedModelsLastUsedTime)e-this._syncedModelsLastUsedTime[n]>eu&&t.push(n);for(const n of t)this._stopModelSync(n)}_beginModelSync(e,t){const n=this._modelService.getModel(e);if(!n||!t&&n.isTooLargeForSyncing())return;const i=e.toString();this._proxy.$acceptNewModel({url:n.uri.toString(),lines:n.getLinesContent(),EOL:n.getEOL(),versionId:n.getVersionId()});const r=new tr;r.add(n.onDidChangeContent(o=>{this._proxy.$acceptModelChanged(i.toString(),o)})),r.add(n.onWillDispose(()=>{this._stopModelSync(i)})),r.add(tn(()=>{this._proxy.$acceptRemovedModel(i)})),this._syncedModels[i]=r}_stopModelSync(e){const t=this._syncedModels[e];delete this._syncedModels[e],delete this._syncedModelsLastUsedTime[e],zr(t)}}class xm{constructor(){this._models=Object.create(null)}getModel(e){return this._models[e]}getModels(){const e=[];return Object.keys(this._models).forEach(t=>e.push(this._models[t])),e}$acceptNewModel(e){this._models[e.url]=new Tm(ot.parse(e.url),e.lines,e.EOL,e.versionId)}$acceptModelChanged(e,t){if(!this._models[e])return;this._models[e].onEvents(t)}$acceptRemovedModel(e){this._models[e]&&delete this._models[e]}}class Tm extends Nm{get uri(){return this._uri}get eol(){return this._eol}getValue(){return this.getText()}findMatches(e){const t=[];for(let n=0;n<this._lines.length;n++){const i=this._lines[n],r=this.offsetAt(new I(n+1,1)),o=i.matchAll(e);for(const a of o)(a.index||a.index===0)&&(a.index=a.index+r),t.push(a)}return t}getLinesContent(){return this._lines.slice(0)}getLineCount(){return this._lines.length}getLineContent(e){return this._lines[e-1]}getWordAtPosition(e,t){const n=Ii(e.column,Do(t),this._lines[e.lineNumber-1],0);return n?new w(e.lineNumber,n.startColumn,e.lineNumber,n.endColumn):null}words(e){const t=this._lines,n=this._wordenize.bind(this);let i=0,r="",o=0,a=[];return{*[Symbol.iterator](){for(;;)if(o<a.length){const l=r.substring(a[o].start,a[o].end);o+=1,yield l}else if(i<t.length)r=t[i],a=n(r,e),o=0,i+=1;else break}}}getLineWords(e,t){const n=this._lines[e-1],i=this._wordenize(n,t),r=[];for(const o of i)r.push({word:n.substring(o.start,o.end),startColumn:o.start+1,endColumn:o.end+1});return r}_wordenize(e,t){const n=[];let i;for(t.lastIndex=0;(i=t.exec(e))&&i[0].length!==0;)n.push({start:i.index,end:i.index+i[0].length});return n}getValueInRange(e){if(e=this._validateRange(e),e.startLineNumber===e.endLineNumber)return this._lines[e.startLineNumber-1].substring(e.startColumn-1,e.endColumn-1);const t=this._eol,n=e.startLineNumber-1,i=e.endLineNumber-1,r=[];r.push(this._lines[n].substring(e.startColumn-1));for(let o=n+1;o<i;o++)r.push(this._lines[o]);return r.push(this._lines[i].substring(0,e.endColumn-1)),r.join(t)}offsetAt(e){return e=this._validatePosition(e),this._ensureLineStarts(),this._lineStarts.getPrefixSum(e.lineNumber-2)+(e.column-1)}positionAt(e){e=Math.floor(e),e=Math.max(0,e),this._ensureLineStarts();const t=this._lineStarts.getIndexOf(e),n=this._lines[t.index].length;return{lineNumber:1+t.index,column:1+Math.min(t.remainder,n)}}_validateRange(e){const t=this._validatePosition({lineNumber:e.startLineNumber,column:e.startColumn}),n=this._validatePosition({lineNumber:e.endLineNumber,column:e.endColumn});return t.lineNumber!==e.startLineNumber||t.column!==e.startColumn||n.lineNumber!==e.endLineNumber||n.column!==e.endColumn?{startLineNumber:t.lineNumber,startColumn:t.column,endLineNumber:n.lineNumber,endColumn:n.column}:e}_validatePosition(e){if(!I.isIPosition(e))throw new Error("bad position");let{lineNumber:t,column:n}=e,i=!1;if(t<1)t=1,n=1,i=!0;else if(t>this._lines.length)t=this._lines.length,n=this._lines[t-1].length+1,i=!0;else{const r=this._lines[t-1].length+1;n<1?(n=1,i=!0):n>r&&(n=r,i=!0)}return i?{lineNumber:t,column:n}:e}}const $s=class $s{constructor(){this._workerTextModelSyncServer=new xm}dispose(){}_getModel(e){return this._workerTextModelSyncServer.getModel(e)}_getModels(){return this._workerTextModelSyncServer.getModels()}$acceptNewModel(e){this._workerTextModelSyncServer.$acceptNewModel(e)}$acceptModelChanged(e,t){this._workerTextModelSyncServer.$acceptModelChanged(e,t)}$acceptRemovedModel(e){this._workerTextModelSyncServer.$acceptRemovedModel(e)}async $computeUnicodeHighlights(e,t,n){const i=this._getModel(e);return i?Wg.computeUnicodeHighlights(i,t,n):{ranges:[],hasMore:!1,ambiguousCharacterCount:0,invisibleCharacterCount:0,nonBasicAsciiCharacterCount:0}}async $findSectionHeaders(e,t){const n=this._getModel(e);return n?wm(n,t):[]}async $computeDiff(e,t,n,i){const r=this._getModel(e),o=this._getModel(t);return!r||!o?null:_r.computeDiff(r,o,n,i)}static computeDiff(e,t,n,i){const r=i==="advanced"?Xl.getDefault():Xl.getLegacy(),o=e.getLinesContent(),a=t.getLinesContent(),l=r.computeDiff(o,a,n),u=l.changes.length>0?!1:this._modelsAreIdentical(e,t);function c(h){return h.map(d=>{var f;return[d.original.startLineNumber,d.original.endLineNumberExclusive,d.modified.startLineNumber,d.modified.endLineNumberExclusive,(f=d.innerChanges)==null?void 0:f.map(m=>[m.originalRange.startLineNumber,m.originalRange.startColumn,m.originalRange.endLineNumber,m.originalRange.endColumn,m.modifiedRange.startLineNumber,m.modifiedRange.startColumn,m.modifiedRange.endLineNumber,m.modifiedRange.endColumn])]})}return{identical:u,quitEarly:l.hitTimeout,changes:c(l.changes),moves:l.moves.map(h=>[h.lineRangeMapping.original.startLineNumber,h.lineRangeMapping.original.endLineNumberExclusive,h.lineRangeMapping.modified.startLineNumber,h.lineRangeMapping.modified.endLineNumberExclusive,c(h.changes)])}}static _modelsAreIdentical(e,t){const n=e.getLineCount(),i=t.getLineCount();if(n!==i)return!1;for(let r=1;r<=n;r++){const o=e.getLineContent(r),a=t.getLineContent(r);if(o!==a)return!1}return!0}async $computeMoreMinimalEdits(e,t,n){const i=this._getModel(e);if(!i)return t;const r=[];let o;t=t.slice(0).sort((l,u)=>{if(l.range&&u.range)return w.compareRangesUsingStarts(l.range,u.range);const c=l.range?0:1,h=u.range?0:1;return c-h});let a=0;for(let l=1;l<t.length;l++)w.getEndPosition(t[a].range).equals(w.getStartPosition(t[l].range))?(t[a].range=w.fromPositions(w.getStartPosition(t[a].range),w.getEndPosition(t[l].range)),t[a].text+=t[l].text):(a++,t[a]=t[l]);t.length=a+1;for(let{range:l,text:u,eol:c}of t){if(typeof c=="number"&&(o=c),w.isEmpty(l)&&!u)continue;const h=i.getValueInRange(l);if(u=u.replace(/\r\n|\n|\r/g,i.eol),h===u)continue;if(Math.max(u.length,h.length)>_r._diffLimit){r.push({range:l,text:u});continue}const d=Xh(h,u,n),f=i.offsetAt(w.lift(l).getStartPosition());for(const m of d){const p=i.positionAt(f+m.originalStart),C=i.positionAt(f+m.originalStart+m.originalLength),b={text:u.substr(m.modifiedStart,m.modifiedLength),range:{startLineNumber:p.lineNumber,startColumn:p.column,endLineNumber:C.lineNumber,endColumn:C.column}};i.getValueInRange(b.range)!==b.text&&r.push(b)}}return typeof o=="number"&&r.push({eol:o,text:"",range:{startLineNumber:0,startColumn:0,endLineNumber:0,endColumn:0}}),r}async $computeLinks(e){const t=this._getModel(e);return t?Eg(t):null}async $computeDefaultDocumentColors(e){const t=this._getModel(e);return t?bm(t):null}async $textualSuggest(e,t,n,i){const r=new hc,o=new RegExp(n,i),a=new Set;e:for(const l of e){const u=this._getModel(l);if(u){for(const c of u.words(o))if(!(c===t||!isNaN(Number(c)))&&(a.add(c),a.size>_r._suggestionsLimit))break e}}return{words:Array.from(a),duration:r.elapsed()}}async $computeWordRanges(e,t,n,i){const r=this._getModel(e);if(!r)return Object.create(null);const o=new RegExp(n,i),a=Object.create(null);for(let l=t.startLineNumber;l<t.endLineNumber;l++){const u=r.getLineWords(l,o);for(const c of u){if(!isNaN(Number(c.word)))continue;let h=a[c.word];h||(h=[],a[c.word]=h),h.push({startLineNumber:l,startColumn:c.startColumn,endLineNumber:l,endColumn:c.endColumn})}}return a}async $navigateValueSet(e,t,n,i,r){const o=this._getModel(e);if(!o)return null;const a=new RegExp(i,r);t.startColumn===t.endColumn&&(t={startLineNumber:t.startLineNumber,startColumn:t.startColumn,endLineNumber:t.endLineNumber,endColumn:t.endColumn+1});const l=o.getValueInRange(t),u=o.getWordAtPosition({lineNumber:t.startLineNumber,column:t.startColumn},a);if(!u)return null;const c=o.getValueInRange(u);return eo.INSTANCE.navigateValueSet(t,l,u,c,n)}};$s._diffLimit=1e5,$s._suggestionsLimit=1e4;let so=$s;class _r extends so{constructor(e,t){super(),this._host=e,this._foreignModuleFactory=t,this._foreignModule=null}async $ping(){return"pong"}$loadForeignModule(e,t,n){const o={host:Qh(n,(a,l)=>this._host.$fhr(a,l)),getMirrorModels:()=>this._getModels()};return this._foreignModuleFactory?(this._foreignModule=this._foreignModuleFactory(o,t),Promise.resolve(ga(this._foreignModule))):new Promise((a,l)=>{const u=c=>{this._foreignModule=c.create(o,t),a(ga(this._foreignModule))};{const c=Zh.asBrowserUri(`${e}.js`).toString(!0);$d(()=>import(`${c}`),[]).then(u).catch(l)}})}$fmr(e,t){if(!this._foreignModule||typeof this._foreignModule[e]!="function")return Promise.reject(new Error("Missing requestHandler or method: "+e));try{return Promise.resolve(this._foreignModule[e].apply(this._foreignModule,t))}catch(n){return Promise.reject(n)}}}typeof importScripts=="function"&&(globalThis.monaco=Qf());const pw=ze("textResourceConfigurationService"),Em=ze("textResourcePropertiesService"),ym=ze("ILanguageFeaturesService");var Rm=function(s,e,t,n){var i=arguments.length,r=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,n);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(i<3?o(r):i>3?o(e,t,r):o(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},tu=function(s,e){return function(t,n){e(t,n,s)}};const Mm=ze("ILanguageFeatureDebounceService");var Es;(function(s){const e=new WeakMap;let t=0;function n(i){let r=e.get(i);return r===void 0&&(r=++t,e.set(i,r)),r}s.of=n})(Es||(Es={}));class Pm{constructor(e){this._default=e}get(e){return this._default}update(e,t){return this._default}default(){return this._default}}class Am{constructor(e,t,n,i,r,o){this._logService=e,this._name=t,this._registry=n,this._default=i,this._min=r,this._max=o,this._cache=new lc(50,.7)}_key(e){return e.id+this._registry.all(e).reduce((t,n)=>Jh(Es.of(n),t),0)}get(e){const t=this._key(e),n=this._cache.get(t);return n?lr(n.value,this._min,this._max):this.default()}update(e,t){const n=this._key(e);let i=this._cache.get(n);i||(i=new Yh(6),this._cache.set(n,i));const r=lr(i.update(t),this._min,this._max);return Kh(e.uri,"output")||this._logService.trace(`[DEBOUNCE: ${this._name}] for ${e.uri.toString()} is ${r}ms`),r}_overall(){const e=new dc;for(const[,t]of this._cache)e.update(t.value);return e.value}default(){const e=this._overall()|0||this._default;return lr(e,this._min,this._max)}}let ro=class{constructor(e,t){this._logService=e,this._data=new Map,this._isDev=t.isExtensionDevelopment||!t.isBuilt}for(e,t,n){const i=(n==null?void 0:n.min)??50,r=(n==null?void 0:n.max)??i**2,o=(n==null?void 0:n.key)??void 0,a=`${Es.of(e)},${i}${o?","+o:""}`;let l=this._data.get(a);return l||(this._isDev?(this._logService.debug(`[DEBOUNCE: ${t}] is disabled in developed mode`),l=new Pm(i*1.5)):l=new Am(this._logService,t,e,this._overallAverage()|0||i*1.5,i,r),this._data.set(a,l)),l}_overallAverage(){const e=new dc;for(const t of this._data.values())e.update(t.default());return e.value}};ro=Rm([tu(0,Po),tu(1,zd)],ro);Vi(Mm,ro,1);class wt{static getLanguageId(e){return(e&255)>>>0}static getTokenType(e){return(e&768)>>>8}static containsBalancedBrackets(e){return(e&1024)!==0}static getFontStyle(e){return(e&30720)>>>11}static getForeground(e){return(e&16744448)>>>15}static getBackground(e){return(e&4278190080)>>>24}static getClassNameFromMetadata(e){let n="mtk"+this.getForeground(e);const i=this.getFontStyle(e);return i&1&&(n+=" mtki"),i&2&&(n+=" mtkb"),i&4&&(n+=" mtku"),i&8&&(n+=" mtks"),n}static getInlineStyleFromMetadata(e,t){const n=this.getForeground(e),i=this.getFontStyle(e);let r=`color: ${t[n]};`;i&1&&(r+="font-style: italic;"),i&2&&(r+="font-weight: bold;");let o="";return i&4&&(o+=" underline"),i&8&&(o+=" line-through"),o&&(r+=`text-decoration:${o};`),r}static getPresentationFromMetadata(e){const t=this.getForeground(e),n=this.getFontStyle(e);return{foreground:t,italic:!!(n&1),bold:!!(n&2),underline:!!(n&4),strikethrough:!!(n&8)}}}function sn(s){let e=0,t=0,n=0,i=0;for(let r=0,o=s.length;r<o;r++){const a=s.charCodeAt(r);a===13?(e===0&&(t=r),e++,r+1<o&&s.charCodeAt(r+1)===10?(i|=2,r++):i|=3,n=r+1):a===10&&(i|=1,e===0&&(t=r),e++,n=r+1)}return e===0&&(t=s.length),[e,t,s.length-n,i]}class si{static create(e,t){return new si(e,new ys(t))}get startLineNumber(){return this._startLineNumber}get endLineNumber(){return this._endLineNumber}constructor(e,t){this._startLineNumber=e,this._tokens=t,this._endLineNumber=this._startLineNumber+this._tokens.getMaxDeltaLine()}toString(){return this._tokens.toString(this._startLineNumber)}_updateEndLineNumber(){this._endLineNumber=this._startLineNumber+this._tokens.getMaxDeltaLine()}isEmpty(){return this._tokens.isEmpty()}getLineTokens(e){return this._startLineNumber<=e&&e<=this._endLineNumber?this._tokens.getLineTokens(e-this._startLineNumber):null}getRange(){const e=this._tokens.getRange();return e&&new w(this._startLineNumber+e.startLineNumber,e.startColumn,this._startLineNumber+e.endLineNumber,e.endColumn)}removeTokens(e){const t=e.startLineNumber-this._startLineNumber,n=e.endLineNumber-this._startLineNumber;this._startLineNumber+=this._tokens.removeTokens(t,e.startColumn-1,n,e.endColumn-1),this._updateEndLineNumber()}split(e){const t=e.startLineNumber-this._startLineNumber,n=e.endLineNumber-this._startLineNumber,[i,r,o]=this._tokens.split(t,e.startColumn-1,n,e.endColumn-1);return[new si(this._startLineNumber,i),new si(this._startLineNumber+o,r)]}applyEdit(e,t){const[n,i,r]=sn(t);this.acceptEdit(e,n,i,r,t.length>0?t.charCodeAt(0):0)}acceptEdit(e,t,n,i,r){this._acceptDeleteRange(e),this._acceptInsertText(new I(e.startLineNumber,e.startColumn),t,n,i,r),this._updateEndLineNumber()}_acceptDeleteRange(e){if(e.startLineNumber===e.endLineNumber&&e.startColumn===e.endColumn)return;const t=e.startLineNumber-this._startLineNumber,n=e.endLineNumber-this._startLineNumber;if(n<0){const r=n-t;this._startLineNumber-=r;return}const i=this._tokens.getMaxDeltaLine();if(!(t>=i+1)){if(t<0&&n>=i+1){this._startLineNumber=0,this._tokens.clear();return}if(t<0){const r=-t;this._startLineNumber-=r,this._tokens.acceptDeleteRange(e.startColumn-1,0,0,n,e.endColumn-1)}else this._tokens.acceptDeleteRange(0,t,e.startColumn-1,n,e.endColumn-1)}}_acceptInsertText(e,t,n,i,r){if(t===0&&n===0)return;const o=e.lineNumber-this._startLineNumber;if(o<0){this._startLineNumber+=t;return}const a=this._tokens.getMaxDeltaLine();o>=a+1||this._tokens.acceptInsertText(o,e.column-1,t,n,i,r)}}class ys{constructor(e){this._tokens=e,this._tokenCount=e.length/4}toString(e){const t=[];for(let n=0;n<this._tokenCount;n++)t.push(`(${this._getDeltaLine(n)+e},${this._getStartCharacter(n)}-${this._getEndCharacter(n)})`);return`[${t.join(",")}]`}getMaxDeltaLine(){const e=this._getTokenCount();return e===0?-1:this._getDeltaLine(e-1)}getRange(){const e=this._getTokenCount();if(e===0)return null;const t=this._getStartCharacter(0),n=this._getDeltaLine(e-1),i=this._getEndCharacter(e-1);return new w(0,t+1,n,i+1)}_getTokenCount(){return this._tokenCount}_getDeltaLine(e){return this._tokens[4*e]}_getStartCharacter(e){return this._tokens[4*e+1]}_getEndCharacter(e){return this._tokens[4*e+2]}isEmpty(){return this._getTokenCount()===0}getLineTokens(e){let t=0,n=this._getTokenCount()-1;for(;t<n;){const i=t+Math.floor((n-t)/2),r=this._getDeltaLine(i);if(r<e)t=i+1;else if(r>e)n=i-1;else{let o=i;for(;o>t&&this._getDeltaLine(o-1)===e;)o--;let a=i;for(;a<n&&this._getDeltaLine(a+1)===e;)a++;return new nu(this._tokens.subarray(4*o,4*a+4))}}return this._getDeltaLine(t)===e?new nu(this._tokens.subarray(4*t,4*t+4)):null}clear(){this._tokenCount=0}removeTokens(e,t,n,i){const r=this._tokens,o=this._tokenCount;let a=0,l=!1,u=0;for(let c=0;c<o;c++){const h=4*c,d=r[h],f=r[h+1],m=r[h+2],p=r[h+3];if((d>e||d===e&&m>=t)&&(d<n||d===n&&f<=i))l=!0;else{if(a===0&&(u=d),l){const C=4*a;r[C]=d-u,r[C+1]=f,r[C+2]=m,r[C+3]=p}a++}}return this._tokenCount=a,u}split(e,t,n,i){const r=this._tokens,o=this._tokenCount,a=[],l=[];let u=a,c=0,h=0;for(let d=0;d<o;d++){const f=4*d,m=r[f],p=r[f+1],C=r[f+2],b=r[f+3];if(m>e||m===e&&C>=t){if(m<n||m===n&&p<=i)continue;u!==l&&(u=l,c=0,h=m)}u[c++]=m-h,u[c++]=p,u[c++]=C,u[c++]=b}return[new ys(new Uint32Array(a)),new ys(new Uint32Array(l)),h]}acceptDeleteRange(e,t,n,i,r){const o=this._tokens,a=this._tokenCount,l=i-t;let u=0,c=!1;for(let h=0;h<a;h++){const d=4*h;let f=o[d],m=o[d+1],p=o[d+2];const C=o[d+3];if(f<t||f===t&&p<=n){u++;continue}else if(f===t&&m<n)f===i&&p>r?p-=r-n:p=n;else if(f===t&&m===n)if(f===i&&p>r)p-=r-n;else{c=!0;continue}else if(f<i||f===i&&m<r)if(f===i&&p>r)f=t,m=n,p=m+(p-r);else{c=!0;continue}else if(f>i){if(l===0&&!c){u=a;break}f-=l}else if(f===i&&m>=r)e&&f===0&&(m+=e,p+=e),f-=l,m-=r-n,p-=r-n;else throw new Error("Not possible!");const b=4*u;o[b]=f,o[b+1]=m,o[b+2]=p,o[b+3]=C,u++}this._tokenCount=u}acceptInsertText(e,t,n,i,r,o){const a=n===0&&i===1&&(o>=48&&o<=57||o>=65&&o<=90||o>=97&&o<=122),l=this._tokens,u=this._tokenCount;for(let c=0;c<u;c++){const h=4*c;let d=l[h],f=l[h+1],m=l[h+2];if(!(d<e||d===e&&m<t)){if(d===e&&m===t)if(a)m+=1;else continue;else if(d===e&&f<t&&t<m)n===0?m+=i:m=t;else{if(d===e&&f===t&&a)continue;if(d===e)if(d+=n,n===0)f+=i,m+=i;else{const p=m-f;f=r+(f-t),m=f+p}else d+=n}l[h]=d,l[h+1]=f,l[h+2]=m}}}}class nu{constructor(e){this._tokens=e}getCount(){return this._tokens.length/4}getStartCharacter(e){return this._tokens[4*e+1]}getEndCharacter(e){return this._tokens[4*e+2]}getMetadata(e){return this._tokens[4*e+3]}}var Dm=function(s,e,t,n){var i=arguments.length,r=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,n);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(i<3?o(r):i>3?o(e,t,r):o(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},Sr=function(s,e){return function(t,n){e(t,n,s)}};let oo=class{constructor(e,t,n,i){this._legend=e,this._themeService=t,this._languageService=n,this._logService=i,this._hasWarnedOverlappingTokens=!1,this._hasWarnedInvalidLengthTokens=!1,this._hasWarnedInvalidEditStart=!1,this._hashTable=new ao}getMetadata(e,t,n){const i=this._languageService.languageIdCodec.encodeLanguageId(n),r=this._hashTable.get(e,t,i);let o;if(r)o=r.metadata;else{let a=this._legend.tokenTypes[e];const l=[];if(a){let u=t;for(let h=0;u>0&&h<this._legend.tokenModifiers.length;h++)u&1&&l.push(this._legend.tokenModifiers[h]),u=u>>1;const c=this._themeService.getColorTheme().getTokenStyleMetadata(a,l,n);if(typeof c>"u")o=2147483647;else{if(o=0,typeof c.italic<"u"){const h=(c.italic?1:0)<<11;o|=h|1}if(typeof c.bold<"u"){const h=(c.bold?2:0)<<11;o|=h|2}if(typeof c.underline<"u"){const h=(c.underline?4:0)<<11;o|=h|4}if(typeof c.strikethrough<"u"){const h=(c.strikethrough?8:0)<<11;o|=h|8}if(c.foreground){const h=c.foreground<<15;o|=h|16}o===0&&(o=2147483647)}}else o=2147483647,a="not-in-legend";this._hashTable.add(e,t,i,o)}return o}warnOverlappingSemanticTokens(e,t){this._hasWarnedOverlappingTokens||(this._hasWarnedOverlappingTokens=!0,this._logService.warn(`Overlapping semantic tokens detected at lineNumber ${e}, column ${t}`))}warnInvalidLengthSemanticTokens(e,t){this._hasWarnedInvalidLengthTokens||(this._hasWarnedInvalidLengthTokens=!0,this._logService.warn(`Semantic token with invalid length detected at lineNumber ${e}, column ${t}`))}warnInvalidEditStart(e,t,n,i,r){this._hasWarnedInvalidEditStart||(this._hasWarnedInvalidEditStart=!0,this._logService.warn(`Invalid semantic tokens edit detected (previousResultId: ${e}, resultId: ${t}) at edit #${n}: The provided start offset ${i} is outside the previous data (length ${r}).`))}};oo=Dm([Sr(1,wc),Sr(2,zi),Sr(3,Po)],oo);function Lw(s,e,t){const n=s.data,i=s.data.length/5|0,r=Math.max(Math.ceil(i/1024),400),o=[];let a=0,l=1,u=0;for(;a<i;){const c=a;let h=Math.min(c+r,i);if(h<i){let L=h;for(;L-1>c&&n[5*L]===0;)L--;if(L-1===c){let _=h;for(;_+1<i&&n[5*_]===0;)_++;h=_}else h=L}let d=new Uint32Array((h-c)*4),f=0,m=0,p=0,C=0;for(;a<h;){const L=5*a,_=n[L],k=n[L+1],S=l+_|0,N=_===0?u+k|0:k,x=n[L+2],T=N+x|0,E=n[L+3],V=n[L+4];if(T<=N)e.warnInvalidLengthSemanticTokens(S,N+1);else if(p===S&&C>N)e.warnOverlappingSemanticTokens(S,N+1);else{const P=e.getMetadata(E,V,t);P!==2147483647&&(m===0&&(m=S),d[f]=S-m,d[f+1]=N,d[f+2]=T,d[f+3]=P,f+=4,p=S,C=T)}l=S,u=N,a++}f!==d.length&&(d=d.subarray(0,f));const b=si.create(m,d);o.push(b)}return o}class Om{constructor(e,t,n,i){this.tokenTypeIndex=e,this.tokenModifierSet=t,this.languageId=n,this.metadata=i,this.next=null}}const Ct=class Ct{constructor(){this._elementsCount=0,this._currentLengthIndex=0,this._currentLength=Ct._SIZES[this._currentLengthIndex],this._growCount=Math.round(this._currentLengthIndex+1<Ct._SIZES.length?2/3*this._currentLength:0),this._elements=[],Ct._nullOutEntries(this._elements,this._currentLength)}static _nullOutEntries(e,t){for(let n=0;n<t;n++)e[n]=null}_hash2(e,t){return(e<<5)-e+t|0}_hashFunc(e,t,n){return this._hash2(this._hash2(e,t),n)%this._currentLength}get(e,t,n){const i=this._hashFunc(e,t,n);let r=this._elements[i];for(;r;){if(r.tokenTypeIndex===e&&r.tokenModifierSet===t&&r.languageId===n)return r;r=r.next}return null}add(e,t,n,i){if(this._elementsCount++,this._growCount!==0&&this._elementsCount>=this._growCount){const r=this._elements;this._currentLengthIndex++,this._currentLength=Ct._SIZES[this._currentLengthIndex],this._growCount=Math.round(this._currentLengthIndex+1<Ct._SIZES.length?2/3*this._currentLength:0),this._elements=[],Ct._nullOutEntries(this._elements,this._currentLength);for(const o of r){let a=o;for(;a;){const l=a.next;a.next=null,this._add(a),a=l}}}this._add(new Om(e,t,n,i))}_add(e){const t=this._hashFunc(e.tokenTypeIndex,e.tokenModifierSet,e.languageId);e.next=this._elements[t],this._elements[t]=e}};Ct._SIZES=[3,7,13,31,61,127,251,509,1021,2039,4093,8191,16381,32749,65521,131071,262139,524287,1048573,2097143];let ao=Ct;const Bm=ze("semanticTokensStylingService");var Vm=function(s,e,t,n){var i=arguments.length,r=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,n);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(i<3?o(r):i>3?o(e,t,r):o(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},kr=function(s,e){return function(t,n){e(t,n,s)}};let lo=class extends oe{constructor(e,t,n){super(),this._themeService=e,this._logService=t,this._languageService=n,this._caches=new WeakMap,this._register(this._themeService.onDidColorThemeChange(()=>{this._caches=new WeakMap}))}getStyling(e){return this._caches.has(e)||this._caches.set(e,new oo(e.getLegend(),this._themeService,this._languageService,this._logService)),this._caches.get(e)}};lo=Vm([kr(0,wc),kr(1,Po),kr(2,zi)],lo);Vi(Bm,lo,1);function qc(s,e,t,n,i,r){if(Array.isArray(s)){let o=0;for(const a of s){const l=qc(a,e,t,n,i,r);if(l===10)return l;l>o&&(o=l)}return o}else{if(typeof s=="string")return n?s==="*"?5:s===t?10:0:0;if(s){const{language:o,pattern:a,scheme:l,hasAccessToAllModels:u,notebookType:c}=s;if(!n&&!u)return 0;c&&i&&(e=i);let h=0;if(l)if(l===e.scheme)h=10;else if(l==="*")h=5;else return 0;if(o)if(o===t)h=10;else if(o==="*")h=Math.max(h,5);else return 0;if(c)if(c===r)h=10;else if(c==="*"&&r!==void 0)h=Math.max(h,5);else return 0;if(a){let d;if(typeof a=="string"?d=a:d={...a,base:ed(a.base)},d===e.fsPath||td(d,e.fsPath))h=10;else return 0}return h}else return 0}}function Gc(s){return typeof s=="string"?!1:Array.isArray(s)?s.every(Gc):!!s.exclusive}class iu{constructor(e,t,n,i,r){this.uri=e,this.languageId=t,this.notebookUri=n,this.notebookType=i,this.recursive=r}equals(e){var t,n;return this.notebookType===e.notebookType&&this.languageId===e.languageId&&this.uri.toString()===e.uri.toString()&&((t=this.notebookUri)==null?void 0:t.toString())===((n=e.notebookUri)==null?void 0:n.toString())&&this.recursive===e.recursive}}class ee{constructor(e){this._notebookInfoResolver=e,this._clock=0,this._entries=[],this._onDidChange=new J,this.onDidChange=this._onDidChange.event}register(e,t){let n={selector:e,provider:t,_score:-1,_time:this._clock++};return this._entries.push(n),this._lastCandidate=void 0,this._onDidChange.fire(this._entries.length),tn(()=>{if(n){const i=this._entries.indexOf(n);i>=0&&(this._entries.splice(i,1),this._lastCandidate=void 0,this._onDidChange.fire(this._entries.length),n=void 0)}})}has(e){return this.all(e).length>0}all(e){if(!e)return[];this._updateScores(e,!1);const t=[];for(const n of this._entries)n._score>0&&t.push(n.provider);return t}ordered(e,t=!1){const n=[];return this._orderedForEach(e,t,i=>n.push(i.provider)),n}orderedGroups(e){const t=[];let n,i;return this._orderedForEach(e,!1,r=>{n&&i===r._score?n.push(r.provider):(i=r._score,n=[r.provider],t.push(n))}),t}_orderedForEach(e,t,n){this._updateScores(e,t);for(const i of this._entries)i._score>0&&n(i)}_updateScores(e,t){var r,o;const n=(r=this._notebookInfoResolver)==null?void 0:r.call(this,e.uri),i=n?new iu(e.uri,e.getLanguageId(),n.uri,n.type,t):new iu(e.uri,e.getLanguageId(),void 0,void 0,t);if(!((o=this._lastCandidate)!=null&&o.equals(i))){this._lastCandidate=i;for(const a of this._entries)if(a._score=qc(a.selector,i.uri,i.languageId,Ag(e),i.notebookUri,i.notebookType),Gc(a.selector)&&a._score>0)if(t)a._score=0;else{for(const l of this._entries)l._score=0;a._score=1e3;break}this._entries.sort(ee._compareByScoreAndTime)}}static _compareByScoreAndTime(e,t){return e._score<t._score?1:e._score>t._score?-1:Xn(e.selector)&&!Xn(t.selector)?1:!Xn(e.selector)&&Xn(t.selector)?-1:e._time<t._time?1:e._time>t._time?-1:0}}function Xn(s){return typeof s=="string"?!1:Array.isArray(s)?s.some(Xn):!!s.isBuiltin}class Wm{constructor(){this.referenceProvider=new ee(this._score.bind(this)),this.renameProvider=new ee(this._score.bind(this)),this.newSymbolNamesProvider=new ee(this._score.bind(this)),this.codeActionProvider=new ee(this._score.bind(this)),this.definitionProvider=new ee(this._score.bind(this)),this.typeDefinitionProvider=new ee(this._score.bind(this)),this.declarationProvider=new ee(this._score.bind(this)),this.implementationProvider=new ee(this._score.bind(this)),this.documentSymbolProvider=new ee(this._score.bind(this)),this.inlayHintsProvider=new ee(this._score.bind(this)),this.colorProvider=new ee(this._score.bind(this)),this.codeLensProvider=new ee(this._score.bind(this)),this.documentFormattingEditProvider=new ee(this._score.bind(this)),this.documentRangeFormattingEditProvider=new ee(this._score.bind(this)),this.onTypeFormattingEditProvider=new ee(this._score.bind(this)),this.signatureHelpProvider=new ee(this._score.bind(this)),this.hoverProvider=new ee(this._score.bind(this)),this.documentHighlightProvider=new ee(this._score.bind(this)),this.multiDocumentHighlightProvider=new ee(this._score.bind(this)),this.selectionRangeProvider=new ee(this._score.bind(this)),this.foldingRangeProvider=new ee(this._score.bind(this)),this.linkProvider=new ee(this._score.bind(this)),this.inlineCompletionsProvider=new ee(this._score.bind(this)),this.inlineEditProvider=new ee(this._score.bind(this)),this.completionProvider=new ee(this._score.bind(this)),this.linkedEditingRangeProvider=new ee(this._score.bind(this)),this.documentRangeSemanticTokensProvider=new ee(this._score.bind(this)),this.documentSemanticTokensProvider=new ee(this._score.bind(this)),this.documentDropEditProvider=new ee(this._score.bind(this)),this.documentPasteEditProvider=new ee(this._score.bind(this))}_score(e){var t;return(t=this._notebookTypeResolver)==null?void 0:t.call(this,e)}}Vi(ym,Wm,1);const bt=class bt{static createEmpty(e,t){const n=bt.defaultTokenMetadata,i=new Uint32Array(2);return i[0]=e.length,i[1]=n,new bt(i,e,t)}static createFromTextAndMetadata(e,t){let n=0,i="";const r=new Array;for(const{text:o,metadata:a}of e)r.push(n+o.length,a),n+=o.length,i+=o;return new bt(new Uint32Array(r),i,t)}constructor(e,t,n){this._lineTokensBrand=void 0,this._tokens=e,this._tokensCount=this._tokens.length>>>1,this._text=t,this.languageIdCodec=n}equals(e){return e instanceof bt?this.slicedEquals(e,0,this._tokensCount):!1}slicedEquals(e,t,n){if(this._text!==e._text||this._tokensCount!==e._tokensCount)return!1;const i=t<<1,r=i+(n<<1);for(let o=i;o<r;o++)if(this._tokens[o]!==e._tokens[o])return!1;return!0}getLineContent(){return this._text}getCount(){return this._tokensCount}getStartOffset(e){return e>0?this._tokens[e-1<<1]:0}getMetadata(e){return this._tokens[(e<<1)+1]}getLanguageId(e){const t=this._tokens[(e<<1)+1],n=wt.getLanguageId(t);return this.languageIdCodec.decodeLanguageId(n)}getStandardTokenType(e){const t=this._tokens[(e<<1)+1];return wt.getTokenType(t)}getForeground(e){const t=this._tokens[(e<<1)+1];return wt.getForeground(t)}getClassName(e){const t=this._tokens[(e<<1)+1];return wt.getClassNameFromMetadata(t)}getInlineStyle(e,t){const n=this._tokens[(e<<1)+1];return wt.getInlineStyleFromMetadata(n,t)}getPresentation(e){const t=this._tokens[(e<<1)+1];return wt.getPresentationFromMetadata(t)}getEndOffset(e){return this._tokens[e<<1]}findTokenIndexAtOffset(e){return bt.findIndexInTokensArray(this._tokens,e)}inflate(){return this}sliceAndInflate(e,t,n){return new Wo(this,e,t,n)}static convertToEndOffset(e,t){const i=(e.length>>>1)-1;for(let r=0;r<i;r++)e[r<<1]=e[r+1<<1];e[i<<1]=t}static findIndexInTokensArray(e,t){if(e.length<=2)return 0;let n=0,i=(e.length>>>1)-1;for(;n<i;){const r=n+Math.floor((i-n)/2),o=e[r<<1];if(o===t)return r+1;o<t?n=r+1:o>t&&(i=r)}return n}withInserted(e){if(e.length===0)return this;let t=0,n=0,i="";const r=new Array;let o=0;for(;;){const a=t<this._tokensCount?this._tokens[t<<1]:-1,l=n<e.length?e[n]:null;if(a!==-1&&(l===null||a<=l.offset)){i+=this._text.substring(o,a);const u=this._tokens[(t<<1)+1];r.push(i.length,u),t++,o=a}else if(l){if(l.offset>o){i+=this._text.substring(o,l.offset);const u=this._tokens[(t<<1)+1];r.push(i.length,u),o=l.offset}i+=l.text,r.push(i.length,l.tokenMetadata),n++}else break}return new bt(new Uint32Array(r),i,this.languageIdCodec)}getTokenText(e){const t=this.getStartOffset(e),n=this.getEndOffset(e);return this._text.substring(t,n)}forEach(e){const t=this.getCount();for(let n=0;n<t;n++)e(n)}};bt.defaultTokenMetadata=(32768|2<<24)>>>0;let Te=bt;class Wo{constructor(e,t,n,i){this._source=e,this._startOffset=t,this._endOffset=n,this._deltaOffset=i,this._firstTokenIndex=e.findTokenIndexAtOffset(t),this.languageIdCodec=e.languageIdCodec,this._tokensCount=0;for(let r=this._firstTokenIndex,o=e.getCount();r<o&&!(e.getStartOffset(r)>=n);r++)this._tokensCount++}getMetadata(e){return this._source.getMetadata(this._firstTokenIndex+e)}getLanguageId(e){return this._source.getLanguageId(this._firstTokenIndex+e)}getLineContent(){return this._source.getLineContent().substring(this._startOffset,this._endOffset)}equals(e){return e instanceof Wo?this._startOffset===e._startOffset&&this._endOffset===e._endOffset&&this._deltaOffset===e._deltaOffset&&this._source.slicedEquals(e._source,this._firstTokenIndex,this._tokensCount):!1}getCount(){return this._tokensCount}getStandardTokenType(e){return this._source.getStandardTokenType(this._firstTokenIndex+e)}getForeground(e){return this._source.getForeground(this._firstTokenIndex+e)}getEndOffset(e){const t=this._source.getEndOffset(this._firstTokenIndex+e);return Math.min(this._endOffset,t)-this._startOffset+this._deltaOffset}getClassName(e){return this._source.getClassName(this._firstTokenIndex+e)}getInlineStyle(e,t){return this._source.getInlineStyle(this._firstTokenIndex+e,t)}getPresentation(e){return this._source.getPresentation(this._firstTokenIndex+e)}findTokenIndexAtOffset(e){return this._source.findTokenIndexAtOffset(e+this._startOffset-this._deltaOffset)-this._firstTokenIndex}getTokenText(e){const t=this._firstTokenIndex+e,n=this._source.getStartOffset(t),i=this._source.getEndOffset(t);let r=this._source.getTokenText(t);return n<this._startOffset&&(r=r.substring(this._startOffset-n)),i>this._endOffset&&(r=r.substring(0,r.length-(i-this._endOffset))),r}forEach(e){for(let t=0;t<this.getCount();t++)e(t)}}function _w(s,e){const t=e.lineNumber;if(!s.tokenization.isCheapToTokenize(t))return;s.tokenization.forceTokenization(t);const n=s.tokenization.getLineTokens(t),i=n.findTokenIndexAtOffset(e.column-1);return n.getStandardTokenType(i)}const $c=new class{clone(){return this}equals(s){return this===s}};function Sw(s,e){return new qf([new yc(0,"",s)],e)}function Qc(s,e){const t=new Uint32Array(2);return t[0]=0,t[1]=(s<<0|0|0|32768|2<<24)>>>0,new Gf(t,e===null?$c:e)}const su={getInitialState:()=>$c,tokenizeEncoded:(s,e,t)=>Qc(0,t)};async function kw(s,e,t){if(!t)return ru(e,s.languageIdCodec,su);const n=await nn.getOrCreate(t);return ru(e,s.languageIdCodec,n||su)}function Fm(s,e,t,n,i,r,o){let a="<div>",l=n,u=0,c=!0;for(let h=0,d=e.getCount();h<d;h++){const f=e.getEndOffset(h);if(f<=n)continue;let m="";for(;l<f&&l<i;l++){const p=s.charCodeAt(l);switch(p){case 9:{let C=r-(l+u)%r;for(u+=C-1;C>0;)o&&c?(m+="&#160;",c=!1):(m+=" ",c=!0),C--;break}case 60:m+="&lt;",c=!1;break;case 62:m+="&gt;",c=!1;break;case 38:m+="&amp;",c=!1;break;case 0:m+="&#00;",c=!1;break;case 65279:case 8232:case 8233:case 133:m+="",c=!1;break;case 13:m+="&#8203",c=!1;break;case 32:o&&c?(m+="&#160;",c=!1):(m+=" ",c=!0);break;default:m+=String.fromCharCode(p),c=!1}}if(a+=`<span style="${e.getInlineStyle(h,t)}">${m}</span>`,f>i||l>=i)break}return a+="</div>",a}function ru(s,e,t){let n='<div class="monaco-tokenized-source">';const i=er(s);let r=t.getInitialState();for(let o=0,a=i.length;o<a;o++){const l=i[o];o>0&&(n+="<br/>");const u=t.tokenizeEncoded(l,!0,r);Te.convertToEndOffset(u.tokens,l.length);const h=new Te(u.tokens,l,e).inflate();let d=0;for(let f=0,m=h.getCount();f<m;f++){const p=h.getClassName(f),C=h.getEndOffset(f);n+=`<span class="${p}">${nd(l.substring(d,C))}</span>`,d=C}r=u.endState}return n+="</div>",n}const Se={enableSplitViewResizing:!0,renderSideBySide:!0,renderMarginRevertIcon:!0,renderGutterMenu:!0,maxComputationTime:5e3,maxFileSize:50,ignoreTrimWhitespace:!0,renderIndicators:!0,originalEditable:!1,diffCodeLens:!1,renderOverviewRuler:!0,diffWordWrap:"inherit",diffAlgorithm:"advanced",accessibilityVerbose:!1,experimental:{showMoves:!1,showEmptyDecorations:!0,useTrueInlineView:!1},hideUnchangedRegions:{enabled:!1,contextLineCount:3,minimumLineCount:3,revealLineCount:20},isInEmbeddedEditor:!1,onlyShowAccessibleDiffViewer:!1,renderSideBySideInlineBreakpoint:900,useInlineViewWhenSpaceIsLimited:!0,compactMode:!1},zm=Object.freeze({id:"editor",order:5,type:"object",title:g("editorConfigurationTitle","Editor"),scope:5}),Rs={...zm,properties:{"editor.tabSize":{type:"number",default:ve.tabSize,minimum:1,markdownDescription:g("tabSize","The number of spaces a tab is equal to. This setting is overridden based on the file contents when {0} is on.","`#editor.detectIndentation#`")},"editor.indentSize":{anyOf:[{type:"string",enum:["tabSize"]},{type:"number",minimum:1}],default:"tabSize",markdownDescription:g("indentSize",'The number of spaces used for indentation or `"tabSize"` to use the value from `#editor.tabSize#`. This setting is overridden based on the file contents when `#editor.detectIndentation#` is on.')},"editor.insertSpaces":{type:"boolean",default:ve.insertSpaces,markdownDescription:g("insertSpaces","Insert spaces when pressing `Tab`. This setting is overridden based on the file contents when {0} is on.","`#editor.detectIndentation#`")},"editor.detectIndentation":{type:"boolean",default:ve.detectIndentation,markdownDescription:g("detectIndentation","Controls whether {0} and {1} will be automatically detected when a file is opened based on the file contents.","`#editor.tabSize#`","`#editor.insertSpaces#`")},"editor.trimAutoWhitespace":{type:"boolean",default:ve.trimAutoWhitespace,description:g("trimAutoWhitespace","Remove trailing auto inserted whitespace.")},"editor.largeFileOptimizations":{type:"boolean",default:ve.largeFileOptimizations,description:g("largeFileOptimizations","Special handling for large files to disable certain memory intensive features.")},"editor.wordBasedSuggestions":{enum:["off","currentDocument","matchingDocuments","allDocuments"],default:"matchingDocuments",enumDescriptions:[g("wordBasedSuggestions.off","Turn off Word Based Suggestions."),g("wordBasedSuggestions.currentDocument","Only suggest words from the active document."),g("wordBasedSuggestions.matchingDocuments","Suggest words from all open documents of the same language."),g("wordBasedSuggestions.allDocuments","Suggest words from all open documents.")],description:g("wordBasedSuggestions","Controls whether completions should be computed based on words in the document and from which documents they are computed.")},"editor.semanticHighlighting.enabled":{enum:[!0,!1,"configuredByTheme"],enumDescriptions:[g("semanticHighlighting.true","Semantic highlighting enabled for all color themes."),g("semanticHighlighting.false","Semantic highlighting disabled for all color themes."),g("semanticHighlighting.configuredByTheme","Semantic highlighting is configured by the current color theme's `semanticHighlighting` setting.")],default:"configuredByTheme",description:g("semanticHighlighting.enabled","Controls whether the semanticHighlighting is shown for the languages that support it.")},"editor.stablePeek":{type:"boolean",default:!1,markdownDescription:g("stablePeek","Keep peek editors open even when double-clicking their content or when hitting `Escape`.")},"editor.maxTokenizationLineLength":{type:"integer",default:2e4,description:g("maxTokenizationLineLength","Lines above this length will not be tokenized for performance reasons")},"editor.experimental.asyncTokenization":{type:"boolean",default:!0,description:g("editor.experimental.asyncTokenization","Controls whether the tokenization should happen asynchronously on a web worker."),tags:["experimental"]},"editor.experimental.asyncTokenizationLogging":{type:"boolean",default:!1,description:g("editor.experimental.asyncTokenizationLogging","Controls whether async tokenization should be logged. For debugging only.")},"editor.experimental.asyncTokenizationVerification":{type:"boolean",default:!1,description:g("editor.experimental.asyncTokenizationVerification","Controls whether async tokenization should be verified against legacy background tokenization. Might slow down tokenization. For debugging only."),tags:["experimental"]},"editor.experimental.treeSitterTelemetry":{type:"boolean",default:!1,markdownDescription:g("editor.experimental.treeSitterTelemetry","Controls whether tree sitter parsing should be turned on and telemetry collected. Setting `editor.experimental.preferTreeSitter` for specific languages will take precedence."),tags:["experimental"]},"editor.language.brackets":{type:["array","null"],default:null,description:g("schema.brackets","Defines the bracket symbols that increase or decrease the indentation."),items:{type:"array",items:[{type:"string",description:g("schema.openBracket","The opening bracket character or string sequence.")},{type:"string",description:g("schema.closeBracket","The closing bracket character or string sequence.")}]}},"editor.language.colorizedBracketPairs":{type:["array","null"],default:null,description:g("schema.colorizedBracketPairs","Defines the bracket pairs that are colorized by their nesting level if bracket pair colorization is enabled."),items:{type:"array",items:[{type:"string",description:g("schema.openBracket","The opening bracket character or string sequence.")},{type:"string",description:g("schema.closeBracket","The closing bracket character or string sequence.")}]}},"diffEditor.maxComputationTime":{type:"number",default:Se.maxComputationTime,description:g("maxComputationTime","Timeout in milliseconds after which diff computation is cancelled. Use 0 for no timeout.")},"diffEditor.maxFileSize":{type:"number",default:Se.maxFileSize,description:g("maxFileSize","Maximum file size in MB for which to compute diffs. Use 0 for no limit.")},"diffEditor.renderSideBySide":{type:"boolean",default:Se.renderSideBySide,description:g("sideBySide","Controls whether the diff editor shows the diff side by side or inline.")},"diffEditor.renderSideBySideInlineBreakpoint":{type:"number",default:Se.renderSideBySideInlineBreakpoint,description:g("renderSideBySideInlineBreakpoint","If the diff editor width is smaller than this value, the inline view is used.")},"diffEditor.useInlineViewWhenSpaceIsLimited":{type:"boolean",default:Se.useInlineViewWhenSpaceIsLimited,description:g("useInlineViewWhenSpaceIsLimited","If enabled and the editor width is too small, the inline view is used.")},"diffEditor.renderMarginRevertIcon":{type:"boolean",default:Se.renderMarginRevertIcon,description:g("renderMarginRevertIcon","When enabled, the diff editor shows arrows in its glyph margin to revert changes.")},"diffEditor.renderGutterMenu":{type:"boolean",default:Se.renderGutterMenu,description:g("renderGutterMenu","When enabled, the diff editor shows a special gutter for revert and stage actions.")},"diffEditor.ignoreTrimWhitespace":{type:"boolean",default:Se.ignoreTrimWhitespace,description:g("ignoreTrimWhitespace","When enabled, the diff editor ignores changes in leading or trailing whitespace.")},"diffEditor.renderIndicators":{type:"boolean",default:Se.renderIndicators,description:g("renderIndicators","Controls whether the diff editor shows +/- indicators for added/removed changes.")},"diffEditor.codeLens":{type:"boolean",default:Se.diffCodeLens,description:g("codeLens","Controls whether the editor shows CodeLens.")},"diffEditor.wordWrap":{type:"string",enum:["off","on","inherit"],default:Se.diffWordWrap,markdownEnumDescriptions:[g("wordWrap.off","Lines will never wrap."),g("wordWrap.on","Lines will wrap at the viewport width."),g("wordWrap.inherit","Lines will wrap according to the {0} setting.","`#editor.wordWrap#`")]},"diffEditor.diffAlgorithm":{type:"string",enum:["legacy","advanced"],default:Se.diffAlgorithm,markdownEnumDescriptions:[g("diffAlgorithm.legacy","Uses the legacy diffing algorithm."),g("diffAlgorithm.advanced","Uses the advanced diffing algorithm.")],tags:["experimental"]},"diffEditor.hideUnchangedRegions.enabled":{type:"boolean",default:Se.hideUnchangedRegions.enabled,markdownDescription:g("hideUnchangedRegions.enabled","Controls whether the diff editor shows unchanged regions.")},"diffEditor.hideUnchangedRegions.revealLineCount":{type:"integer",default:Se.hideUnchangedRegions.revealLineCount,markdownDescription:g("hideUnchangedRegions.revealLineCount","Controls how many lines are used for unchanged regions."),minimum:1},"diffEditor.hideUnchangedRegions.minimumLineCount":{type:"integer",default:Se.hideUnchangedRegions.minimumLineCount,markdownDescription:g("hideUnchangedRegions.minimumLineCount","Controls how many lines are used as a minimum for unchanged regions."),minimum:1},"diffEditor.hideUnchangedRegions.contextLineCount":{type:"integer",default:Se.hideUnchangedRegions.contextLineCount,markdownDescription:g("hideUnchangedRegions.contextLineCount","Controls how many lines are used as context when comparing unchanged regions."),minimum:1},"diffEditor.experimental.showMoves":{type:"boolean",default:Se.experimental.showMoves,markdownDescription:g("showMoves","Controls whether the diff editor should show detected code moves.")},"diffEditor.experimental.showEmptyDecorations":{type:"boolean",default:Se.experimental.showEmptyDecorations,description:g("showEmptyDecorations","Controls whether the diff editor shows empty decorations to see where characters got inserted or deleted.")},"diffEditor.experimental.useTrueInlineView":{type:"boolean",default:Se.experimental.useTrueInlineView,description:g("useTrueInlineView","If enabled and the editor uses the inline view, word changes are rendered inline.")}}};function Hm(s){return typeof s.type<"u"||typeof s.anyOf<"u"}for(const s of Tc){const e=s.schema;if(typeof e<"u")if(Hm(e))Rs.properties[`editor.${s.name}`]=e;else for(const t in e)Object.hasOwnProperty.call(e,t)&&(Rs.properties[t]=e[t])}let Qi=null;function Zc(){return Qi===null&&(Qi=Object.create(null),Object.keys(Rs.properties).forEach(s=>{Qi[s]=!0})),Qi}function vw(s){return Zc()[`editor.${s}`]||!1}function Iw(s){return Zc()[`diffEditor.${s}`]||!1}const jm=nr.as(Mo.Configuration);jm.registerConfiguration(Rs);class Um{static insert(e,t){return{range:new w(e.lineNumber,e.column,e.lineNumber,e.column),text:t,forceMoveMarkers:!0}}static delete(e){return{range:e,text:null}}static replace(e,t){return{range:e,text:t}}static replaceMove(e,t){return{range:e,text:t,forceMoveMarkers:!0}}}var ou;(function(s){s.inspectTokensAction=g("inspectTokens","Developer: Inspect Tokens")})(ou||(ou={}));var au;(function(s){s.gotoLineActionLabel=g("gotoLineActionLabel","Go to Line/Column...")})(au||(au={}));var lu;(function(s){s.helpQuickAccessActionLabel=g("helpQuickAccess","Show all Quick Access Providers")})(lu||(lu={}));var uu;(function(s){s.quickCommandActionLabel=g("quickCommandActionLabel","Command Palette"),s.quickCommandHelp=g("quickCommandActionHelp","Show And Run Commands")})(uu||(uu={}));var cu;(function(s){s.quickOutlineActionLabel=g("quickOutlineActionLabel","Go to Symbol..."),s.quickOutlineByCategoryActionLabel=g("quickOutlineByCategoryActionLabel","Go to Symbol by Category...")})(cu||(cu={}));var hu;(function(s){s.editorViewAccessibleLabel=g("editorViewAccessibleLabel","Editor content")})(hu||(hu={}));var du;(function(s){s.toggleHighContrast=g("toggleHighContrast","Toggle High Contrast Theme")})(du||(du={}));var fu;(function(s){s.bulkEditServiceSummary=g("bulkEditServiceSummary","Made {0} edits in {1} files")})(fu||(fu={}));let Vn=[],Fo=[],Xc=[];function Zi(s,e=!1){qm(s,!1,e)}function qm(s,e,t){const n=Gm(s,e);Vn.push(n),n.userConfigured?Xc.push(n):Fo.push(n),t&&!n.userConfigured&&Vn.forEach(i=>{i.mime===n.mime||i.userConfigured||(n.extension&&i.extension===n.extension&&console.warn(`Overwriting extension <<${n.extension}>> to now point to mime <<${n.mime}>>`),n.filename&&i.filename===n.filename&&console.warn(`Overwriting filename <<${n.filename}>> to now point to mime <<${n.mime}>>`),n.filepattern&&i.filepattern===n.filepattern&&console.warn(`Overwriting filepattern <<${n.filepattern}>> to now point to mime <<${n.mime}>>`),n.firstline&&i.firstline===n.firstline&&console.warn(`Overwriting firstline <<${n.firstline}>> to now point to mime <<${n.mime}>>`))})}function Gm(s,e){return{id:s.id,mime:s.mime,filename:s.filename,extension:s.extension,filepattern:s.filepattern,firstline:s.firstline,userConfigured:e,filenameLowercase:s.filename?s.filename.toLowerCase():void 0,extensionLowercase:s.extension?s.extension.toLowerCase():void 0,filepatternLowercase:s.filepattern?sd(s.filepattern.toLowerCase()):void 0,filepatternOnPath:s.filepattern?s.filepattern.indexOf(rd.sep)>=0:!1}}function $m(){Vn=Vn.filter(s=>s.userConfigured),Fo=[]}function Qm(s,e){return Zm(s,e).map(t=>t.id)}function Zm(s,e){let t;if(s)switch(s.scheme){case Ge.file:t=s.fsPath;break;case Ge.data:{t=An.parseMetaData(s).get(An.META_DATA_LABEL);break}case Ge.vscodeNotebookCell:t=void 0;break;default:t=s.path}if(!t)return[{id:"unknown",mime:Cn.unknown}];t=t.toLowerCase();const n=id(t),i=gu(t,n,Xc);if(i)return[i,{id:at,mime:Cn.text}];const r=gu(t,n,Fo);if(r)return[r,{id:at,mime:Cn.text}];if(e){const o=Xm(e);if(o)return[o,{id:at,mime:Cn.text}]}return[{id:"unknown",mime:Cn.unknown}]}function gu(s,e,t){var o;let n,i,r;for(let a=t.length-1;a>=0;a--){const l=t[a];if(e===l.filenameLowercase){n=l;break}if(l.filepattern&&(!i||l.filepattern.length>i.filepattern.length)){const u=l.filepatternOnPath?s:e;(o=l.filepatternLowercase)!=null&&o.call(l,u)&&(i=l)}l.extension&&(!r||l.extension.length>r.extension.length)&&e.endsWith(l.extensionLowercase)&&(r=l)}if(n)return n;if(i)return i;if(r)return r}function Xm(s){if(fc(s)&&(s=s.substr(1)),s.length>0)for(let e=Vn.length-1;e>=0;e--){const t=Vn[e];if(!t.firstline)continue;const n=s.match(t.firstline);if(n&&n.length>0)return t}}const Xi=Object.prototype.hasOwnProperty,mu="vs.editor.nullLanguage";class Jm{constructor(){this._languageIdToLanguage=[],this._languageToLanguageId=new Map,this._register(mu,0),this._register(at,1),this._nextLanguageId=2}_register(e,t){this._languageIdToLanguage[t]=e,this._languageToLanguageId.set(e,t)}register(e){if(this._languageToLanguageId.has(e))return;const t=this._nextLanguageId++;this._register(e,t)}encodeLanguageId(e){return this._languageToLanguageId.get(e)||0}decodeLanguageId(e){return this._languageIdToLanguage[e]||mu}}const Ci=class Ci extends oe{constructor(e=!0,t=!1){super(),this._onDidChange=this._register(new J),this.onDidChange=this._onDidChange.event,Ci.instanceCount++,this._warnOnOverwrite=t,this.languageIdCodec=new Jm,this._dynamicLanguages=[],this._languages={},this._mimeTypesMap={},this._nameMap={},this._lowercaseNameMap={},e&&(this._initializeFromRegistry(),this._register(Ss.onDidChangeLanguages(n=>{this._initializeFromRegistry()})))}dispose(){Ci.instanceCount--,super.dispose()}_initializeFromRegistry(){this._languages={},this._mimeTypesMap={},this._nameMap={},this._lowercaseNameMap={},$m();const e=[].concat(Ss.getLanguages()).concat(this._dynamicLanguages);this._registerLanguages(e)}_registerLanguages(e){for(const t of e)this._registerLanguage(t);this._mimeTypesMap={},this._nameMap={},this._lowercaseNameMap={},Object.keys(this._languages).forEach(t=>{const n=this._languages[t];n.name&&(this._nameMap[n.name]=n.identifier),n.aliases.forEach(i=>{this._lowercaseNameMap[i.toLowerCase()]=n.identifier}),n.mimetypes.forEach(i=>{this._mimeTypesMap[i]=n.identifier})}),nr.as(Mo.Configuration).registerOverrideIdentifiers(this.getRegisteredLanguageIds()),this._onDidChange.fire()}_registerLanguage(e){const t=e.id;let n;Xi.call(this._languages,t)?n=this._languages[t]:(this.languageIdCodec.register(t),n={identifier:t,name:null,mimetypes:[],aliases:[],extensions:[],filenames:[],configurationFiles:[],icons:[]},this._languages[t]=n),this._mergeLanguage(n,e)}_mergeLanguage(e,t){const n=t.id;let i=null;if(Array.isArray(t.mimetypes)&&t.mimetypes.length>0&&(e.mimetypes.push(...t.mimetypes),i=t.mimetypes[0]),i||(i=`text/x-${n}`,e.mimetypes.push(i)),Array.isArray(t.extensions)){t.configuration?e.extensions=t.extensions.concat(e.extensions):e.extensions=e.extensions.concat(t.extensions);for(const a of t.extensions)Zi({id:n,mime:i,extension:a},this._warnOnOverwrite)}if(Array.isArray(t.filenames))for(const a of t.filenames)Zi({id:n,mime:i,filename:a},this._warnOnOverwrite),e.filenames.push(a);if(Array.isArray(t.filenamePatterns))for(const a of t.filenamePatterns)Zi({id:n,mime:i,filepattern:a},this._warnOnOverwrite);if(typeof t.firstLine=="string"&&t.firstLine.length>0){let a=t.firstLine;a.charAt(0)!=="^"&&(a="^"+a);try{const l=new RegExp(a);od(l)||Zi({id:n,mime:i,firstline:l},this._warnOnOverwrite)}catch(l){console.warn(`[${t.id}]: Invalid regular expression \`${a}\`: `,l)}}e.aliases.push(n);let r=null;if(typeof t.aliases<"u"&&Array.isArray(t.aliases)&&(t.aliases.length===0?r=[null]:r=t.aliases),r!==null)for(const a of r)!a||a.length===0||e.aliases.push(a);const o=r!==null&&r.length>0;if(!(o&&r[0]===null)){const a=(o?r[0]:null)||n;(o||!e.name)&&(e.name=a)}t.configuration&&e.configurationFiles.push(t.configuration),t.icon&&e.icons.push(t.icon)}isRegisteredLanguageId(e){return e?Xi.call(this._languages,e):!1}getRegisteredLanguageIds(){return Object.keys(this._languages)}getLanguageIdByLanguageName(e){const t=e.toLowerCase();return Xi.call(this._lowercaseNameMap,t)?this._lowercaseNameMap[t]:null}getLanguageIdByMimeType(e){return e&&Xi.call(this._mimeTypesMap,e)?this._mimeTypesMap[e]:null}guessLanguageIdByFilepathOrFirstLine(e,t){return!e&&!t?[]:Qm(e,t)}};Ci.instanceCount=0;let uo=Ci;const bi=class bi extends oe{constructor(e=!1){super(),this._onDidRequestBasicLanguageFeatures=this._register(new J),this.onDidRequestBasicLanguageFeatures=this._onDidRequestBasicLanguageFeatures.event,this._onDidRequestRichLanguageFeatures=this._register(new J),this.onDidRequestRichLanguageFeatures=this._onDidRequestRichLanguageFeatures.event,this._onDidChange=this._register(new J({leakWarningThreshold:200})),this.onDidChange=this._onDidChange.event,this._requestedBasicLanguages=new Set,this._requestedRichLanguages=new Set,bi.instanceCount++,this._registry=this._register(new uo(!0,e)),this.languageIdCodec=this._registry.languageIdCodec,this._register(this._registry.onDidChange(()=>this._onDidChange.fire()))}dispose(){bi.instanceCount--,super.dispose()}isRegisteredLanguageId(e){return this._registry.isRegisteredLanguageId(e)}getLanguageIdByLanguageName(e){return this._registry.getLanguageIdByLanguageName(e)}getLanguageIdByMimeType(e){return this._registry.getLanguageIdByMimeType(e)}guessLanguageIdByFilepathOrFirstLine(e,t){const n=this._registry.guessLanguageIdByFilepathOrFirstLine(e,t);return ad(n,null)}createById(e){return new Cu(this.onDidChange,()=>this._createAndGetLanguageIdentifier(e))}createByFilepathOrFirstLine(e,t){return new Cu(this.onDidChange,()=>{const n=this.guessLanguageIdByFilepathOrFirstLine(e,t);return this._createAndGetLanguageIdentifier(n)})}_createAndGetLanguageIdentifier(e){return(!e||!this.isRegisteredLanguageId(e))&&(e=at),e}requestBasicLanguageFeatures(e){this._requestedBasicLanguages.has(e)||(this._requestedBasicLanguages.add(e),this._onDidRequestBasicLanguageFeatures.fire(e))}requestRichLanguageFeatures(e){this._requestedRichLanguages.has(e)||(this._requestedRichLanguages.add(e),this.requestBasicLanguageFeatures(e),nn.getOrCreate(e),this._onDidRequestRichLanguageFeatures.fire(e))}};bi.instanceCount=0;let pu=bi;class Cu{constructor(e,t){this._value=ld(this,e,()=>t()),this.onDidChange=gc.fromObservable(this._value)}get languageId(){return this._value.get()}}const Nw=ze("editorWorkerService"),Ym=R("editor.lineHighlightBackground",null,g("lineHighlight","Background color for the highlight of line at the cursor position.")),xw=R("editor.lineHighlightBorder",{dark:"#282828",light:"#eeeeee",hcDark:"#f38518",hcLight:ws},g("lineHighlightBorderBox","Background color for the border around the line at the cursor position."));R("editor.rangeHighlightBackground",{dark:"#ffffff0b",light:"#fdff0033",hcDark:null,hcLight:null},g("rangeHighlight","Background color of highlighted ranges, like by quick open and find features. The color must not be opaque so as not to hide underlying decorations."),!0);R("editor.rangeHighlightBorder",{dark:null,light:null,hcDark:Dn,hcLight:Dn},g("rangeHighlightBorder","Background color of the border around highlighted ranges."));R("editor.symbolHighlightBackground",{dark:wa,light:wa,hcDark:null,hcLight:null},g("symbolHighlight","Background color of highlighted symbol, like for go to definition or go next/previous symbol. The color must not be opaque so as not to hide underlying decorations."),!0);R("editor.symbolHighlightBorder",{dark:null,light:null,hcDark:Dn,hcLight:Dn},g("symbolHighlightBorder","Background color of the border around highlighted symbols."));const Jc=R("editorCursor.foreground",{dark:"#AEAFAD",light:fe.black,hcDark:fe.white,hcLight:"#0F4A85"},g("caret","Color of the editor cursor.")),Yc=R("editorCursor.background",null,g("editorCursorBackground","The background color of the editor cursor. Allows customizing the color of a character overlapped by a block cursor.")),Tw=R("editorMultiCursor.primary.foreground",Jc,g("editorMultiCursorPrimaryForeground","Color of the primary editor cursor when multiple cursors are present.")),Ew=R("editorMultiCursor.primary.background",Yc,g("editorMultiCursorPrimaryBackground","The background color of the primary editor cursor when multiple cursors are present. Allows customizing the color of a character overlapped by a block cursor.")),yw=R("editorMultiCursor.secondary.foreground",Jc,g("editorMultiCursorSecondaryForeground","Color of secondary editor cursors when multiple cursors are present.")),Rw=R("editorMultiCursor.secondary.background",Yc,g("editorMultiCursorSecondaryBackground","The background color of secondary editor cursors when multiple cursors are present. Allows customizing the color of a character overlapped by a block cursor.")),Kc=R("editorWhitespace.foreground",{dark:"#e3e4e229",light:"#33333333",hcDark:"#e3e4e229",hcLight:"#CCCCCC"},g("editorWhitespaces","Color of whitespace characters in the editor.")),Mw=R("editorLineNumber.foreground",{dark:"#858585",light:"#237893",hcDark:fe.white,hcLight:"#292929"},g("editorLineNumbers","Color of editor line numbers.")),Km=R("editorIndentGuide.background",Kc,g("editorIndentGuides","Color of the editor indentation guides."),!1,g("deprecatedEditorIndentGuides","'editorIndentGuide.background' is deprecated. Use 'editorIndentGuide.background1' instead.")),ep=R("editorIndentGuide.activeBackground",Kc,g("editorActiveIndentGuide","Color of the active editor indentation guides."),!1,g("deprecatedEditorActiveIndentGuide","'editorIndentGuide.activeBackground' is deprecated. Use 'editorIndentGuide.activeBackground1' instead.")),Pw=R("editorIndentGuide.background1",Km,g("editorIndentGuides1","Color of the editor indentation guides (1).")),Aw=R("editorIndentGuide.background2","#00000000",g("editorIndentGuides2","Color of the editor indentation guides (2).")),Dw=R("editorIndentGuide.background3","#00000000",g("editorIndentGuides3","Color of the editor indentation guides (3).")),Ow=R("editorIndentGuide.background4","#00000000",g("editorIndentGuides4","Color of the editor indentation guides (4).")),Bw=R("editorIndentGuide.background5","#00000000",g("editorIndentGuides5","Color of the editor indentation guides (5).")),Vw=R("editorIndentGuide.background6","#00000000",g("editorIndentGuides6","Color of the editor indentation guides (6).")),Ww=R("editorIndentGuide.activeBackground1",ep,g("editorActiveIndentGuide1","Color of the active editor indentation guides (1).")),Fw=R("editorIndentGuide.activeBackground2","#00000000",g("editorActiveIndentGuide2","Color of the active editor indentation guides (2).")),zw=R("editorIndentGuide.activeBackground3","#00000000",g("editorActiveIndentGuide3","Color of the active editor indentation guides (3).")),Hw=R("editorIndentGuide.activeBackground4","#00000000",g("editorActiveIndentGuide4","Color of the active editor indentation guides (4).")),jw=R("editorIndentGuide.activeBackground5","#00000000",g("editorActiveIndentGuide5","Color of the active editor indentation guides (5).")),Uw=R("editorIndentGuide.activeBackground6","#00000000",g("editorActiveIndentGuide6","Color of the active editor indentation guides (6).")),tp=R("editorActiveLineNumber.foreground",{dark:"#c6c6c6",light:"#0B216F",hcDark:Dn,hcLight:Dn},g("editorActiveLineNumber","Color of editor active line number"),!1,g("deprecatedEditorActiveLineNumber","Id is deprecated. Use 'editorLineNumber.activeForeground' instead."));R("editorLineNumber.activeForeground",tp,g("editorActiveLineNumber","Color of editor active line number"));const qw=R("editorLineNumber.dimmedForeground",null,g("editorDimmedLineNumber","Color of the final editor line when editor.renderFinalNewline is set to dimmed."));R("editorRuler.foreground",{dark:"#5A5A5A",light:fe.lightgrey,hcDark:fe.white,hcLight:"#292929"},g("editorRuler","Color of the editor rulers."));R("editorCodeLens.foreground",{dark:"#999999",light:"#919191",hcDark:"#999999",hcLight:"#292929"},g("editorCodeLensForeground","Foreground color of editor CodeLens"));R("editorBracketMatch.background",{dark:"#0064001a",light:"#0064001a",hcDark:"#0064001a",hcLight:"#0000"},g("editorBracketMatchBackground","Background color behind matching brackets"));R("editorBracketMatch.border",{dark:"#888",light:"#B9B9B9",hcDark:ws,hcLight:ws},g("editorBracketMatchBorder","Color for matching brackets boxes"));const Gw=R("editorOverviewRuler.border",{dark:"#7f7f7f4d",light:"#7f7f7f4d",hcDark:"#7f7f7f4d",hcLight:"#666666"},g("editorOverviewRulerBorder","Color of the overview ruler border.")),$w=R("editorOverviewRuler.background",null,g("editorOverviewRulerBackground","Background color of the editor overview ruler."));R("editorGutter.background",_c,g("editorGutter","Background color of the editor gutter. The gutter contains the glyph margins and the line numbers."));R("editorUnnecessaryCode.border",{dark:null,light:null,hcDark:fe.fromHex("#fff").transparent(.8),hcLight:ws},g("unnecessaryCodeBorder","Border color of unnecessary (unused) source code in the editor."));const Qw=R("editorUnnecessaryCode.opacity",{dark:fe.fromHex("#000a"),light:fe.fromHex("#0007"),hcDark:null,hcLight:null},g("unnecessaryCodeOpacity",`Opacity of unnecessary (unused) source code in the editor. For example, "#000000c0" will render the code with 75% opacity. For high contrast themes, use the  'editorUnnecessaryCode.border' theme color to underline unnecessary code instead of fading it out.`));R("editorGhostText.border",{dark:null,light:null,hcDark:fe.fromHex("#fff").transparent(.8),hcLight:fe.fromHex("#292929").transparent(.8)},g("editorGhostTextBorder","Border color of ghost text in the editor."));const Zw=R("editorGhostText.foreground",{dark:fe.fromHex("#ffffff56"),light:fe.fromHex("#0007"),hcDark:null,hcLight:null},g("editorGhostTextForeground","Foreground color of the ghost text in the editor."));R("editorGhostText.background",null,g("editorGhostTextBackground","Background color of the ghost text in the editor."));const np=new fe(new In(0,122,204,.6)),Xw=R("editorOverviewRuler.rangeHighlightForeground",np,g("overviewRulerRangeHighlight","Overview ruler marker color for range highlights. The color must not be opaque so as not to hide underlying decorations."),!0),ip=R("editorOverviewRuler.errorForeground",{dark:new fe(new In(255,18,18,.7)),light:new fe(new In(255,18,18,.7)),hcDark:new fe(new In(255,50,50,1)),hcLight:"#B5200D"},g("overviewRuleError","Overview ruler marker color for errors.")),sp=R("editorOverviewRuler.warningForeground",{dark:Hr,light:Hr,hcDark:_a,hcLight:_a},g("overviewRuleWarning","Overview ruler marker color for warnings.")),rp=R("editorOverviewRuler.infoForeground",{dark:ka,light:ka,hcDark:Sa,hcLight:Sa},g("overviewRuleInfo","Overview ruler marker color for infos.")),op=R("editorBracketHighlight.foreground1",{dark:"#FFD700",light:"#0431FAFF",hcDark:"#FFD700",hcLight:"#0431FAFF"},g("editorBracketHighlightForeground1","Foreground color of brackets (1). Requires enabling bracket pair colorization.")),ap=R("editorBracketHighlight.foreground2",{dark:"#DA70D6",light:"#319331FF",hcDark:"#DA70D6",hcLight:"#319331FF"},g("editorBracketHighlightForeground2","Foreground color of brackets (2). Requires enabling bracket pair colorization.")),lp=R("editorBracketHighlight.foreground3",{dark:"#179FFF",light:"#7B3814FF",hcDark:"#87CEFA",hcLight:"#7B3814FF"},g("editorBracketHighlightForeground3","Foreground color of brackets (3). Requires enabling bracket pair colorization.")),up=R("editorBracketHighlight.foreground4","#00000000",g("editorBracketHighlightForeground4","Foreground color of brackets (4). Requires enabling bracket pair colorization.")),cp=R("editorBracketHighlight.foreground5","#00000000",g("editorBracketHighlightForeground5","Foreground color of brackets (5). Requires enabling bracket pair colorization.")),hp=R("editorBracketHighlight.foreground6","#00000000",g("editorBracketHighlightForeground6","Foreground color of brackets (6). Requires enabling bracket pair colorization.")),dp=R("editorBracketHighlight.unexpectedBracket.foreground",{dark:new fe(new In(255,18,18,.8)),light:new fe(new In(255,18,18,.8)),hcDark:"new Color(new RGBA(255, 50, 50, 1))",hcLight:"#B5200D"},g("editorBracketHighlightUnexpectedBracketForeground","Foreground color of unexpected brackets.")),Jw=R("editorBracketPairGuide.background1","#00000000",g("editorBracketPairGuide.background1","Background color of inactive bracket pair guides (1). Requires enabling bracket pair guides.")),Yw=R("editorBracketPairGuide.background2","#00000000",g("editorBracketPairGuide.background2","Background color of inactive bracket pair guides (2). Requires enabling bracket pair guides.")),Kw=R("editorBracketPairGuide.background3","#00000000",g("editorBracketPairGuide.background3","Background color of inactive bracket pair guides (3). Requires enabling bracket pair guides.")),e_=R("editorBracketPairGuide.background4","#00000000",g("editorBracketPairGuide.background4","Background color of inactive bracket pair guides (4). Requires enabling bracket pair guides.")),t_=R("editorBracketPairGuide.background5","#00000000",g("editorBracketPairGuide.background5","Background color of inactive bracket pair guides (5). Requires enabling bracket pair guides.")),n_=R("editorBracketPairGuide.background6","#00000000",g("editorBracketPairGuide.background6","Background color of inactive bracket pair guides (6). Requires enabling bracket pair guides.")),i_=R("editorBracketPairGuide.activeBackground1","#00000000",g("editorBracketPairGuide.activeBackground1","Background color of active bracket pair guides (1). Requires enabling bracket pair guides.")),s_=R("editorBracketPairGuide.activeBackground2","#00000000",g("editorBracketPairGuide.activeBackground2","Background color of active bracket pair guides (2). Requires enabling bracket pair guides.")),r_=R("editorBracketPairGuide.activeBackground3","#00000000",g("editorBracketPairGuide.activeBackground3","Background color of active bracket pair guides (3). Requires enabling bracket pair guides.")),o_=R("editorBracketPairGuide.activeBackground4","#00000000",g("editorBracketPairGuide.activeBackground4","Background color of active bracket pair guides (4). Requires enabling bracket pair guides.")),a_=R("editorBracketPairGuide.activeBackground5","#00000000",g("editorBracketPairGuide.activeBackground5","Background color of active bracket pair guides (5). Requires enabling bracket pair guides.")),l_=R("editorBracketPairGuide.activeBackground6","#00000000",g("editorBracketPairGuide.activeBackground6","Background color of active bracket pair guides (6). Requires enabling bracket pair guides."));R("editorUnicodeHighlight.border",Hr,g("editorUnicodeHighlight.border","Border color used to highlight unicode characters."));R("editorUnicodeHighlight.background",Hd,g("editorUnicodeHighlight.background","Background color used to highlight unicode characters."));Sc((s,e)=>{const t=s.getColor(_c),n=s.getColor(Ym),i=n&&!n.isTransparent()?n:t;i&&e.addRule(`.monaco-editor .inputarea.ime-input { background-color: ${i}; }`)});var fp=function(s,e,t,n){var i=arguments.length,r=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,n);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(i<3?o(r):i>3?o(e,t,r):o(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},bu=function(s,e){return function(t,n){e(t,n,s)}};let Lu=class extends oe{constructor(e,t){super(),this._markerService=t,this._onDidChangeMarker=this._register(new J),this._markerDecorations=new ud,e.getModels().forEach(n=>this._onModelAdded(n)),this._register(e.onModelAdded(this._onModelAdded,this)),this._register(e.onModelRemoved(this._onModelRemoved,this)),this._register(this._markerService.onMarkerChanged(this._handleMarkerChange,this))}dispose(){super.dispose(),this._markerDecorations.forEach(e=>e.dispose()),this._markerDecorations.clear()}getMarker(e,t){const n=this._markerDecorations.get(e);return n&&n.getMarker(t)||null}_handleMarkerChange(e){e.forEach(t=>{const n=this._markerDecorations.get(t);n&&this._updateDecorations(n)})}_onModelAdded(e){const t=new gp(e);this._markerDecorations.set(e.uri,t),this._updateDecorations(t)}_onModelRemoved(e){var n;const t=this._markerDecorations.get(e.uri);t&&(t.dispose(),this._markerDecorations.delete(e.uri)),(e.uri.scheme===Ge.inMemory||e.uri.scheme===Ge.internal||e.uri.scheme===Ge.vscode)&&((n=this._markerService)==null||n.read({resource:e.uri}).map(i=>i.owner).forEach(i=>this._markerService.remove(i,[e.uri])))}_updateDecorations(e){const t=this._markerService.read({resource:e.model.uri,take:500});e.update(t)&&this._onDidChangeMarker.fire(e.model)}};Lu=fp([bu(0,Yf),bu(1,jd)],Lu);class gp extends oe{constructor(e){super(),this.model=e,this._map=new cd,this._register(tn(()=>{this.model.deltaDecorations([...this._map.values()],[]),this._map.clear()}))}update(e){const{added:t,removed:n}=hd(new Set(this._map.keys()),new Set(e));if(t.length===0&&n.length===0)return!1;const i=n.map(a=>this._map.get(a)),r=t.map(a=>({range:this._createDecorationRange(this.model,a),options:this._createDecorationOption(a)})),o=this.model.deltaDecorations(i,r);for(const a of n)this._map.delete(a);for(let a=0;a<o.length;a++)this._map.set(t[a],o[a]);return!0}getMarker(e){return this._map.getKey(e.id)}_createDecorationRange(e,t){let n=w.lift(t);if(t.severity===zn.Hint&&!this._hasMarkerTag(t,1)&&!this._hasMarkerTag(t,2)&&(n=n.setEndPosition(n.startLineNumber,n.startColumn+2)),n=e.validateRange(n),n.isEmpty()){const i=e.getLineLastNonWhitespaceColumn(n.startLineNumber)||e.getLineMaxColumn(n.startLineNumber);if(i===1||n.endColumn>=i)return n;const r=e.getWordAtPosition(n.getStartPosition());r&&(n=new w(n.startLineNumber,r.startColumn,n.endLineNumber,r.endColumn))}else if(t.endColumn===Number.MAX_VALUE&&t.startColumn===1&&n.startLineNumber===n.endLineNumber){const i=e.getLineFirstNonWhitespaceColumn(t.startLineNumber);i<n.endColumn&&(n=new w(n.startLineNumber,i,n.endLineNumber,n.endColumn),t.startColumn=i)}return n}_createDecorationOption(e){let t,n,i,r,o;switch(e.severity){case zn.Hint:this._hasMarkerTag(e,2)?t=void 0:this._hasMarkerTag(e,1)?t="squiggly-unnecessary":t="squiggly-hint",i=0;break;case zn.Info:t="squiggly-info",n=hn(rp),i=10,o={color:hn(Gd),position:1};break;case zn.Warning:t="squiggly-warning",n=hn(sp),i=20,o={color:hn(qd),position:1};break;case zn.Error:default:t="squiggly-error",n=hn(ip),i=30,o={color:hn(Ud),position:1};break}return e.tags&&(e.tags.indexOf(1)!==-1&&(r="squiggly-inline-unnecessary"),e.tags.indexOf(2)!==-1&&(r="squiggly-inline-deprecated")),{description:"marker-decoration",stickiness:1,className:t,showIfCollapsed:!0,overviewRuler:{color:n,position:Is.Right},minimap:o,zIndex:i,inlineClassName:r}}_hasMarkerTag(e,t){return e.tags?e.tags.indexOf(t)>=0:!1}}const c_=ze("markerDecorationsService");class be{static _nextVisibleColumn(e,t,n){return e===9?be.nextRenderTabStop(t,n):Bi(e)||dd(e)?t+2:t+1}static visibleColumnFromColumn(e,t,n){const i=Math.min(t-1,e.length),r=e.substring(0,i),o=new ma(r);let a=0;for(;!o.eol();){const l=Br(r,i,o.offset);o.nextGraphemeLength(),a=this._nextVisibleColumn(l,a,n)}return a}static columnFromVisibleColumn(e,t,n){if(t<=0)return 1;const i=e.length,r=new ma(e);let o=0,a=1;for(;!r.eol();){const l=Br(e,i,r.offset);r.nextGraphemeLength();const u=this._nextVisibleColumn(l,o,n),c=r.offset+1;if(u>=t){const h=t-o;return u-t<h?c:a}o=u,a=c}return i+1}static nextRenderTabStop(e,t){return e+t-e%t}static nextIndentTabStop(e,t){return e+t-e%t}static prevRenderTabStop(e,t){return Math.max(0,e-1-(e-1)%t)}static prevIndentTabStop(e,t){return Math.max(0,e-1-(e-1)%t)}}function mp(s,e,t){let n=0;for(let r=0;r<s.length;r++)s.charAt(r)==="	"?n=be.nextIndentTabStop(n,e):n++;let i="";if(!t){const r=Math.floor(n/e);n=n%e;for(let o=0;o<r;o++)i+="	"}for(let r=0;r<n;r++)i+=" ";return i}function eh(s,e,t){let n=Ve(s);return n===-1&&(n=s.length),mp(s.substring(0,n),e,t)+s.substring(n)}class wu{constructor(e,t,n,i){this.range=e,this.nestingLevel=t,this.nestingLevelOfEqualBracketType=n,this.isInvalid=i}}class pp{constructor(e,t,n,i,r,o){this.range=e,this.openingBracketRange=t,this.closingBracketRange=n,this.nestingLevel=i,this.nestingLevelOfEqualBracketType=r,this.bracketPairNode=o}get openingBracketInfo(){return this.bracketPairNode.openingBracket.bracketInfo}}class Cp extends pp{constructor(e,t,n,i,r,o,a){super(e,t,n,i,r,o),this.minVisibleColumnIndentation=a}}function bp(s,e,t,n){return s!==t?le(t-s,n):le(0,n-e)}const xe=0;function Ms(s){return s===0}const De=2**26;function le(s,e){return s*De+e}function Fe(s){const e=s,t=Math.floor(e/De),n=e-t*De;return new Bn(t,n)}function Lp(s){return Math.floor(s/De)}function ne(s,e){let t=s+e;return e>=De&&(t=t-s%De),t}function wp(s,e){return s.reduce((t,n)=>ne(t,e(n)),xe)}function th(s,e){return s===e}function Ei(s,e){const t=s,n=e;if(n-t<=0)return xe;const r=Math.floor(t/De),o=Math.floor(n/De),a=n-o*De;if(r===o){const l=t-r*De;return le(0,a-l)}else return le(o-r,a)}function En(s,e){return s<e}function yn(s,e){return s<=e}function Jn(s,e){return s>=e}function _n(s){return le(s.lineNumber-1,s.column-1)}function Yt(s,e){const t=s,n=Math.floor(t/De),i=t-n*De,r=e,o=Math.floor(r/De),a=r-o*De;return new w(n+1,i+1,o+1,a+1)}function _p(s){const e=er(s);return le(e.length-1,e[e.length-1].length)}class yi{static fromModelContentChanges(e){return e.map(n=>{const i=w.lift(n.range);return new yi(_n(i.getStartPosition()),_n(i.getEndPosition()),_p(n.text))}).reverse()}constructor(e,t,n){this.startOffset=e,this.endOffset=t,this.newLength=n}toString(){return`[${Fe(this.startOffset)}...${Fe(this.endOffset)}) -> ${Fe(this.newLength)}`}}class Sp{constructor(e){this.nextEditIdx=0,this.deltaOldToNewLineCount=0,this.deltaOldToNewColumnCount=0,this.deltaLineIdxInOld=-1,this.edits=e.map(t=>zo.from(t))}getOffsetBeforeChange(e){return this.adjustNextEdit(e),this.translateCurToOld(e)}getDistanceToNextChange(e){this.adjustNextEdit(e);const t=this.edits[this.nextEditIdx],n=t?this.translateOldToCur(t.offsetObj):null;return n===null?null:Ei(e,n)}translateOldToCur(e){return e.lineCount===this.deltaLineIdxInOld?le(e.lineCount+this.deltaOldToNewLineCount,e.columnCount+this.deltaOldToNewColumnCount):le(e.lineCount+this.deltaOldToNewLineCount,e.columnCount)}translateCurToOld(e){const t=Fe(e);return t.lineCount-this.deltaOldToNewLineCount===this.deltaLineIdxInOld?le(t.lineCount-this.deltaOldToNewLineCount,t.columnCount-this.deltaOldToNewColumnCount):le(t.lineCount-this.deltaOldToNewLineCount,t.columnCount)}adjustNextEdit(e){for(;this.nextEditIdx<this.edits.length;){const t=this.edits[this.nextEditIdx],n=this.translateOldToCur(t.endOffsetAfterObj);if(yn(n,e)){this.nextEditIdx++;const i=Fe(n),r=Fe(this.translateOldToCur(t.endOffsetBeforeObj)),o=i.lineCount-r.lineCount;this.deltaOldToNewLineCount+=o;const a=this.deltaLineIdxInOld===t.endOffsetBeforeObj.lineCount?this.deltaOldToNewColumnCount:0,l=i.columnCount-r.columnCount;this.deltaOldToNewColumnCount=a+l,this.deltaLineIdxInOld=t.endOffsetBeforeObj.lineCount}else break}}}class zo{static from(e){return new zo(e.startOffset,e.endOffset,e.newLength)}constructor(e,t,n){this.endOffsetBeforeObj=Fe(t),this.endOffsetAfterObj=Fe(ne(e,n)),this.offsetObj=Fe(e)}}const Ji=[],Be=class Be{static create(e,t){if(e<=128&&t.length===0){let n=Be.cache[e];return n||(n=new Be(e,t),Be.cache[e]=n),n}return new Be(e,t)}static getEmpty(){return this.empty}constructor(e,t){this.items=e,this.additionalItems=t}add(e,t){const n=t.getKey(e);let i=n>>5;if(i===0){const o=1<<n|this.items;return o===this.items?this:Be.create(o,this.additionalItems)}i--;const r=this.additionalItems.slice(0);for(;r.length<i;)r.push(0);return r[i]|=1<<(n&31),Be.create(this.items,r)}merge(e){const t=this.items|e.items;if(this.additionalItems===Ji&&e.additionalItems===Ji)return t===this.items?this:t===e.items?e:Be.create(t,Ji);const n=[];for(let i=0;i<Math.max(this.additionalItems.length,e.additionalItems.length);i++){const r=this.additionalItems[i]||0,o=e.additionalItems[i]||0;n.push(r|o)}return Be.create(t,n)}intersects(e){if((this.items&e.items)!==0)return!0;for(let t=0;t<Math.min(this.additionalItems.length,e.additionalItems.length);t++)if((this.additionalItems[t]&e.additionalItems[t])!==0)return!0;return!1}};Be.cache=new Array(129),Be.empty=Be.create(0,Ji);let Me=Be;const _u={getKey(s){return s}};class nh{constructor(){this.items=new Map}getKey(e){let t=this.items.get(e);return t===void 0&&(t=this.items.size,this.items.set(e,t)),t}}class Ho{get length(){return this._length}constructor(e){this._length=e}}class Ri extends Ho{static create(e,t,n){let i=e.length;return t&&(i=ne(i,t.length)),n&&(i=ne(i,n.length)),new Ri(i,e,t,n,t?t.missingOpeningBracketIds:Me.getEmpty())}get kind(){return 2}get listHeight(){return 0}get childrenLength(){return 3}getChild(e){switch(e){case 0:return this.openingBracket;case 1:return this.child;case 2:return this.closingBracket}throw new Error("Invalid child index")}get children(){const e=[];return e.push(this.openingBracket),this.child&&e.push(this.child),this.closingBracket&&e.push(this.closingBracket),e}constructor(e,t,n,i,r){super(e),this.openingBracket=t,this.child=n,this.closingBracket=i,this.missingOpeningBracketIds=r}canBeReused(e){return!(this.closingBracket===null||e.intersects(this.missingOpeningBracketIds))}deepClone(){return new Ri(this.length,this.openingBracket.deepClone(),this.child&&this.child.deepClone(),this.closingBracket&&this.closingBracket.deepClone(),this.missingOpeningBracketIds)}computeMinIndentation(e,t){return this.child?this.child.computeMinIndentation(ne(e,this.openingBracket.length),t):Number.MAX_SAFE_INTEGER}}class lt extends Ho{static create23(e,t,n,i=!1){let r=e.length,o=e.missingOpeningBracketIds;if(e.listHeight!==t.listHeight)throw new Error("Invalid list heights");if(r=ne(r,t.length),o=o.merge(t.missingOpeningBracketIds),n){if(e.listHeight!==n.listHeight)throw new Error("Invalid list heights");r=ne(r,n.length),o=o.merge(n.missingOpeningBracketIds)}return i?new kp(r,e.listHeight+1,e,t,n,o):new Mi(r,e.listHeight+1,e,t,n,o)}static getEmpty(){return new vp(xe,0,[],Me.getEmpty())}get kind(){return 4}get missingOpeningBracketIds(){return this._missingOpeningBracketIds}constructor(e,t,n){super(e),this.listHeight=t,this._missingOpeningBracketIds=n,this.cachedMinIndentation=-1}throwIfImmutable(){}makeLastElementMutable(){this.throwIfImmutable();const e=this.childrenLength;if(e===0)return;const t=this.getChild(e-1),n=t.kind===4?t.toMutable():t;return t!==n&&this.setChild(e-1,n),n}makeFirstElementMutable(){if(this.throwIfImmutable(),this.childrenLength===0)return;const t=this.getChild(0),n=t.kind===4?t.toMutable():t;return t!==n&&this.setChild(0,n),n}canBeReused(e){if(e.intersects(this.missingOpeningBracketIds)||this.childrenLength===0)return!1;let t=this;for(;t.kind===4;){const n=t.childrenLength;if(n===0)throw new he;t=t.getChild(n-1)}return t.canBeReused(e)}handleChildrenChanged(){this.throwIfImmutable();const e=this.childrenLength;let t=this.getChild(0).length,n=this.getChild(0).missingOpeningBracketIds;for(let i=1;i<e;i++){const r=this.getChild(i);t=ne(t,r.length),n=n.merge(r.missingOpeningBracketIds)}this._length=t,this._missingOpeningBracketIds=n,this.cachedMinIndentation=-1}computeMinIndentation(e,t){if(this.cachedMinIndentation!==-1)return this.cachedMinIndentation;let n=Number.MAX_SAFE_INTEGER,i=e;for(let r=0;r<this.childrenLength;r++){const o=this.getChild(r);o&&(n=Math.min(n,o.computeMinIndentation(i,t)),i=ne(i,o.length))}return this.cachedMinIndentation=n,n}}class Mi extends lt{get childrenLength(){return this._item3!==null?3:2}getChild(e){switch(e){case 0:return this._item1;case 1:return this._item2;case 2:return this._item3}throw new Error("Invalid child index")}setChild(e,t){switch(e){case 0:this._item1=t;return;case 1:this._item2=t;return;case 2:this._item3=t;return}throw new Error("Invalid child index")}get children(){return this._item3?[this._item1,this._item2,this._item3]:[this._item1,this._item2]}get item1(){return this._item1}get item2(){return this._item2}get item3(){return this._item3}constructor(e,t,n,i,r,o){super(e,t,o),this._item1=n,this._item2=i,this._item3=r}deepClone(){return new Mi(this.length,this.listHeight,this._item1.deepClone(),this._item2.deepClone(),this._item3?this._item3.deepClone():null,this.missingOpeningBracketIds)}appendChildOfSameHeight(e){if(this._item3)throw new Error("Cannot append to a full (2,3) tree node");this.throwIfImmutable(),this._item3=e,this.handleChildrenChanged()}unappendChild(){if(!this._item3)throw new Error("Cannot remove from a non-full (2,3) tree node");this.throwIfImmutable();const e=this._item3;return this._item3=null,this.handleChildrenChanged(),e}prependChildOfSameHeight(e){if(this._item3)throw new Error("Cannot prepend to a full (2,3) tree node");this.throwIfImmutable(),this._item3=this._item2,this._item2=this._item1,this._item1=e,this.handleChildrenChanged()}unprependChild(){if(!this._item3)throw new Error("Cannot remove from a non-full (2,3) tree node");this.throwIfImmutable();const e=this._item1;return this._item1=this._item2,this._item2=this._item3,this._item3=null,this.handleChildrenChanged(),e}toMutable(){return this}}class kp extends Mi{toMutable(){return new Mi(this.length,this.listHeight,this.item1,this.item2,this.item3,this.missingOpeningBracketIds)}throwIfImmutable(){throw new Error("this instance is immutable")}}class Ps extends lt{get childrenLength(){return this._children.length}getChild(e){return this._children[e]}setChild(e,t){this._children[e]=t}get children(){return this._children}constructor(e,t,n,i){super(e,t,i),this._children=n}deepClone(){const e=new Array(this._children.length);for(let t=0;t<this._children.length;t++)e[t]=this._children[t].deepClone();return new Ps(this.length,this.listHeight,e,this.missingOpeningBracketIds)}appendChildOfSameHeight(e){this.throwIfImmutable(),this._children.push(e),this.handleChildrenChanged()}unappendChild(){this.throwIfImmutable();const e=this._children.pop();return this.handleChildrenChanged(),e}prependChildOfSameHeight(e){this.throwIfImmutable(),this._children.unshift(e),this.handleChildrenChanged()}unprependChild(){this.throwIfImmutable();const e=this._children.shift();return this.handleChildrenChanged(),e}toMutable(){return this}}class vp extends Ps{toMutable(){return new Ps(this.length,this.listHeight,[...this.children],this.missingOpeningBracketIds)}throwIfImmutable(){throw new Error("this instance is immutable")}}const Ip=[];class jo extends Ho{get listHeight(){return 0}get childrenLength(){return 0}getChild(e){return null}get children(){return Ip}deepClone(){return this}}class Qt extends jo{get kind(){return 0}get missingOpeningBracketIds(){return Me.getEmpty()}canBeReused(e){return!0}computeMinIndentation(e,t){const n=Fe(e),i=(n.columnCount===0?n.lineCount:n.lineCount+1)+1,r=Lp(ne(e,this.length))+1;let o=Number.MAX_SAFE_INTEGER;for(let a=i;a<=r;a++){const l=t.getLineFirstNonWhitespaceColumn(a),u=t.getLineContent(a);if(l===0)continue;const c=be.visibleColumnFromColumn(u,l,t.getOptions().tabSize);o=Math.min(o,c)}return o}}class As extends jo{static create(e,t,n){return new As(e,t,n)}get kind(){return 1}get missingOpeningBracketIds(){return Me.getEmpty()}constructor(e,t,n){super(e),this.bracketInfo=t,this.bracketIds=n}get text(){return this.bracketInfo.bracketText}get languageId(){return this.bracketInfo.languageId}canBeReused(e){return!1}computeMinIndentation(e,t){return Number.MAX_SAFE_INTEGER}}class Np extends jo{get kind(){return 3}constructor(e,t){super(t),this.missingOpeningBracketIds=e}canBeReused(e){return!e.intersects(this.missingOpeningBracketIds)}computeMinIndentation(e,t){return Number.MAX_SAFE_INTEGER}}class Pt{constructor(e,t,n,i,r){this.length=e,this.kind=t,this.bracketId=n,this.bracketIds=i,this.astNode=r}}class ih{constructor(e,t){this.textModel=e,this.bracketTokens=t,this.reader=new xp(this.textModel,this.bracketTokens),this._offset=xe,this.didPeek=!1,this.peeked=null,this.textBufferLineCount=e.getLineCount(),this.textBufferLastLineLength=e.getLineLength(this.textBufferLineCount)}get offset(){return this._offset}get length(){return le(this.textBufferLineCount-1,this.textBufferLastLineLength)}skip(e){this.didPeek=!1,this._offset=ne(this._offset,e);const t=Fe(this._offset);this.reader.setPosition(t.lineCount,t.columnCount)}read(){let e;return this.peeked?(this.didPeek=!1,e=this.peeked):e=this.reader.read(),e&&(this._offset=ne(this._offset,e.length)),e}peek(){return this.didPeek||(this.peeked=this.reader.read(),this.didPeek=!0),this.peeked}}class xp{constructor(e,t){this.textModel=e,this.bracketTokens=t,this.lineIdx=0,this.line=null,this.lineCharOffset=0,this.lineTokens=null,this.lineTokenOffset=0,this.peekedToken=null,this.textBufferLineCount=e.getLineCount(),this.textBufferLastLineLength=e.getLineLength(this.textBufferLineCount)}setPosition(e,t){e===this.lineIdx?(this.lineCharOffset=t,this.line!==null&&(this.lineTokenOffset=this.lineCharOffset===0?0:this.lineTokens.findTokenIndexAtOffset(this.lineCharOffset))):(this.lineIdx=e,this.lineCharOffset=t,this.line=null),this.peekedToken=null}read(){if(this.peekedToken){const r=this.peekedToken;return this.peekedToken=null,this.lineCharOffset+=r.length,r}if(this.lineIdx>this.textBufferLineCount-1||this.lineIdx===this.textBufferLineCount-1&&this.lineCharOffset>=this.textBufferLastLineLength)return null;this.line===null&&(this.lineTokens=this.textModel.tokenization.getLineTokens(this.lineIdx+1),this.line=this.lineTokens.getLineContent(),this.lineTokenOffset=this.lineCharOffset===0?0:this.lineTokens.findTokenIndexAtOffset(this.lineCharOffset));const e=this.lineIdx,t=this.lineCharOffset;let n=0;for(;;){const r=this.lineTokens,o=r.getCount();let a=null;if(this.lineTokenOffset<o){const l=r.getMetadata(this.lineTokenOffset);for(;this.lineTokenOffset+1<o&&l===r.getMetadata(this.lineTokenOffset+1);)this.lineTokenOffset++;const u=wt.getTokenType(l)===0,c=wt.containsBalancedBrackets(l),h=r.getEndOffset(this.lineTokenOffset);if(c&&u&&this.lineCharOffset<h){const d=r.getLanguageId(this.lineTokenOffset),f=this.line.substring(this.lineCharOffset,h),m=this.bracketTokens.getSingleLanguageBracketTokens(d),p=m.regExpGlobal;if(p){p.lastIndex=0;const C=p.exec(f);C&&(a=m.getToken(C[0]),a&&(this.lineCharOffset+=C.index))}}if(n+=h-this.lineCharOffset,a)if(e!==this.lineIdx||t!==this.lineCharOffset){this.peekedToken=a;break}else return this.lineCharOffset+=a.length,a;else this.lineTokenOffset++,this.lineCharOffset=h}else if(this.lineIdx===this.textBufferLineCount-1||(this.lineIdx++,this.lineTokens=this.textModel.tokenization.getLineTokens(this.lineIdx+1),this.lineTokenOffset=0,this.line=this.lineTokens.getLineContent(),this.lineCharOffset=0,n+=33,n>1e3))break;if(n>1500)break}const i=bp(e,t,this.lineIdx,this.lineCharOffset);return new Pt(i,0,-1,Me.getEmpty(),new Qt(i))}}class Tp{constructor(e,t){this.text=e,this._offset=xe,this.idx=0;const n=t.getRegExpStr(),i=n?new RegExp(n+`|
`,"gi"):null,r=[];let o,a=0,l=0,u=0,c=0;const h=[];for(let m=0;m<60;m++)h.push(new Pt(le(0,m),0,-1,Me.getEmpty(),new Qt(le(0,m))));const d=[];for(let m=0;m<60;m++)d.push(new Pt(le(1,m),0,-1,Me.getEmpty(),new Qt(le(1,m))));if(i)for(i.lastIndex=0;(o=i.exec(e))!==null;){const m=o.index,p=o[0];if(p===`
`)a++,l=m+1;else{if(u!==m){let C;if(c===a){const b=m-u;if(b<h.length)C=h[b];else{const L=le(0,b);C=new Pt(L,0,-1,Me.getEmpty(),new Qt(L))}}else{const b=a-c,L=m-l;if(b===1&&L<d.length)C=d[L];else{const _=le(b,L);C=new Pt(_,0,-1,Me.getEmpty(),new Qt(_))}}r.push(C)}r.push(t.getToken(p)),u=m+p.length,c=a}}const f=e.length;if(u!==f){const m=c===a?le(0,f-u):le(a-c,f-l);r.push(new Pt(m,0,-1,Me.getEmpty(),new Qt(m)))}this.length=le(a,f-l),this.tokens=r}get offset(){return this._offset}read(){return this.tokens[this.idx++]||null}peek(){return this.tokens[this.idx]||null}skip(e){throw new fd}}class Uo{static createFromLanguage(e,t){function n(r){return t.getKey(`${r.languageId}:::${r.bracketText}`)}const i=new Map;for(const r of e.bracketsNew.openingBrackets){const o=le(0,r.bracketText.length),a=n(r),l=Me.getEmpty().add(a,_u);i.set(r.bracketText,new Pt(o,1,a,l,As.create(o,r,l)))}for(const r of e.bracketsNew.closingBrackets){const o=le(0,r.bracketText.length);let a=Me.getEmpty();const l=r.getOpeningBrackets();for(const u of l)a=a.add(n(u),_u);i.set(r.bracketText,new Pt(o,2,n(l[0]),a,As.create(o,r,a)))}return new Uo(i)}constructor(e){this.map=e,this.hasRegExp=!1,this._regExpGlobal=null}getRegExpStr(){if(this.isEmpty)return null;{const e=[...this.map.keys()];return e.sort(),e.reverse(),e.map(t=>Ep(t)).join("|")}}get regExpGlobal(){if(!this.hasRegExp){const e=this.getRegExpStr();this._regExpGlobal=e?new RegExp(e,"gi"):null,this.hasRegExp=!0}return this._regExpGlobal}getToken(e){return this.map.get(e.toLowerCase())}findClosingTokenText(e){for(const[t,n]of this.map)if(n.kind===2&&n.bracketIds.intersects(e))return t}get isEmpty(){return this.map.size===0}}function Ep(s){let e=_i(s);return/^[\w ]+/.test(s)&&(e=`\\b${e}`),/[\w ]+$/.test(s)&&(e=`${e}\\b`),e}class sh{constructor(e,t){this.denseKeyProvider=e,this.getLanguageConfiguration=t,this.languageIdToBracketTokens=new Map}didLanguageChange(e){return this.languageIdToBracketTokens.has(e)}getSingleLanguageBracketTokens(e){let t=this.languageIdToBracketTokens.get(e);return t||(t=Uo.createFromLanguage(this.getLanguageConfiguration(e),this.denseKeyProvider),this.languageIdToBracketTokens.set(e,t)),t}}function yp(s){if(s.length===0)return null;if(s.length===1)return s[0];let e=0;function t(){if(e>=s.length)return null;const o=e,a=s[o].listHeight;for(e++;e<s.length&&s[e].listHeight===a;)e++;return e-o>=2?rh(o===0&&e===s.length?s:s.slice(o,e),!1):s[o]}let n=t(),i=t();if(!i)return n;for(let o=t();o;o=t())Su(n,i)<=Su(i,o)?(n=vr(n,i),i=o):i=vr(i,o);return vr(n,i)}function rh(s,e=!1){if(s.length===0)return null;if(s.length===1)return s[0];let t=s.length;for(;t>3;){const n=t>>1;for(let i=0;i<n;i++){const r=i<<1;s[i]=lt.create23(s[r],s[r+1],r+3===t?s[r+2]:null,e)}t=n}return lt.create23(s[0],s[1],t>=3?s[2]:null,e)}function Su(s,e){return Math.abs(s.listHeight-e.listHeight)}function vr(s,e){return s.listHeight===e.listHeight?lt.create23(s,e,null,!1):s.listHeight>e.listHeight?Rp(s,e):Mp(e,s)}function Rp(s,e){s=s.toMutable();let t=s;const n=[];let i;for(;;){if(e.listHeight===t.listHeight){i=e;break}if(t.kind!==4)throw new Error("unexpected");n.push(t),t=t.makeLastElementMutable()}for(let r=n.length-1;r>=0;r--){const o=n[r];i?o.childrenLength>=3?i=lt.create23(o.unappendChild(),i,null,!1):(o.appendChildOfSameHeight(i),i=void 0):o.handleChildrenChanged()}return i?lt.create23(s,i,null,!1):s}function Mp(s,e){s=s.toMutable();let t=s;const n=[];for(;e.listHeight!==t.listHeight;){if(t.kind!==4)throw new Error("unexpected");n.push(t),t=t.makeFirstElementMutable()}let i=e;for(let r=n.length-1;r>=0;r--){const o=n[r];i?o.childrenLength>=3?i=lt.create23(i,o.unprependChild(),null,!1):(o.prependChildOfSameHeight(i),i=void 0):o.handleChildrenChanged()}return i?lt.create23(i,s,null,!1):s}class Pp{constructor(e){this.lastOffset=xe,this.nextNodes=[e],this.offsets=[xe],this.idxs=[]}readLongestNodeAt(e,t){if(En(e,this.lastOffset))throw new Error("Invalid offset");for(this.lastOffset=e;;){const n=Gn(this.nextNodes);if(!n)return;const i=Gn(this.offsets);if(En(e,i))return;if(En(i,e))if(ne(i,n.length)<=e)this.nextNodeAfterCurrent();else{const r=Ir(n);r!==-1?(this.nextNodes.push(n.getChild(r)),this.offsets.push(i),this.idxs.push(r)):this.nextNodeAfterCurrent()}else{if(t(n))return this.nextNodeAfterCurrent(),n;{const r=Ir(n);if(r===-1){this.nextNodeAfterCurrent();return}else this.nextNodes.push(n.getChild(r)),this.offsets.push(i),this.idxs.push(r)}}}}nextNodeAfterCurrent(){for(;;){const e=Gn(this.offsets),t=Gn(this.nextNodes);if(this.nextNodes.pop(),this.offsets.pop(),this.idxs.length===0)break;const n=Gn(this.nextNodes),i=Ir(n,this.idxs[this.idxs.length-1]);if(i!==-1){this.nextNodes.push(n.getChild(i)),this.offsets.push(ne(e,t.length)),this.idxs[this.idxs.length-1]=i;break}else this.idxs.pop()}}}function Ir(s,e=-1){for(;;){if(e++,e>=s.childrenLength)return-1;if(s.getChild(e))return e}}function Gn(s){return s.length>0?s[s.length-1]:void 0}function co(s,e,t,n){return new Ap(s,e,t,n).parseDocument()}class Ap{constructor(e,t,n,i){if(this.tokenizer=e,this.createImmutableLists=i,this._itemsConstructed=0,this._itemsFromCache=0,n&&i)throw new Error("Not supported");this.oldNodeReader=n?new Pp(n):void 0,this.positionMapper=new Sp(t)}parseDocument(){this._itemsConstructed=0,this._itemsFromCache=0;let e=this.parseList(Me.getEmpty(),0);return e||(e=lt.getEmpty()),e}parseList(e,t){const n=[];for(;;){let r=this.tryReadChildFromCache(e);if(!r){const o=this.tokenizer.peek();if(!o||o.kind===2&&o.bracketIds.intersects(e))break;r=this.parseChild(e,t+1)}r.kind===4&&r.childrenLength===0||n.push(r)}return this.oldNodeReader?yp(n):rh(n,this.createImmutableLists)}tryReadChildFromCache(e){if(this.oldNodeReader){const t=this.positionMapper.getDistanceToNextChange(this.tokenizer.offset);if(t===null||!Ms(t)){const n=this.oldNodeReader.readLongestNodeAt(this.positionMapper.getOffsetBeforeChange(this.tokenizer.offset),i=>t!==null&&!En(i.length,t)?!1:i.canBeReused(e));if(n)return this._itemsFromCache++,this.tokenizer.skip(n.length),n}}}parseChild(e,t){this._itemsConstructed++;const n=this.tokenizer.read();switch(n.kind){case 2:return new Np(n.bracketIds,n.length);case 0:return n.astNode;case 1:{if(t>300)return new Qt(n.length);const i=e.merge(n.bracketIds),r=this.parseList(i,t+1),o=this.tokenizer.peek();return o&&o.kind===2&&(o.bracketId===n.bracketId||o.bracketIds.intersects(n.bracketIds))?(this.tokenizer.read(),Ri.create(n.astNode,r,o.astNode)):Ri.create(n.astNode,r,null)}default:throw new Error("unexpected")}}}function ku(s,e){if(s.length===0)return e;if(e.length===0)return s;const t=new ki(vu(s)),n=vu(e);n.push({modified:!1,lengthBefore:void 0,lengthAfter:void 0});let i=t.dequeue();function r(u){if(u===void 0){const h=t.takeWhile(d=>!0)||[];return i&&h.unshift(i),h}const c=[];for(;i&&!Ms(u);){const[h,d]=i.splitAt(u);c.push(h),u=Ei(h.lengthAfter,u),i=d??t.dequeue()}return Ms(u)||c.push(new At(!1,u,u)),c}const o=[];function a(u,c,h){if(o.length>0&&th(o[o.length-1].endOffset,u)){const d=o[o.length-1];o[o.length-1]=new yi(d.startOffset,c,ne(d.newLength,h))}else o.push({startOffset:u,endOffset:c,newLength:h})}let l=xe;for(const u of n){const c=r(u.lengthBefore);if(u.modified){const h=wp(c,f=>f.lengthBefore),d=ne(l,h);a(l,d,u.lengthAfter),l=d}else for(const h of c){const d=l;l=ne(l,h.lengthBefore),h.modified&&a(d,l,h.lengthAfter)}}return o}class At{constructor(e,t,n){this.modified=e,this.lengthBefore=t,this.lengthAfter=n}splitAt(e){const t=Ei(e,this.lengthAfter);return th(t,xe)?[this,void 0]:this.modified?[new At(this.modified,this.lengthBefore,e),new At(this.modified,xe,t)]:[new At(this.modified,e,e),new At(this.modified,t,t)]}toString(){return`${this.modified?"M":"U"}:${Fe(this.lengthBefore)} -> ${Fe(this.lengthAfter)}`}}function vu(s){const e=[];let t=xe;for(const n of s){const i=Ei(t,n.startOffset);Ms(i)||e.push(new At(!1,i,i));const r=Ei(n.startOffset,n.endOffset);e.push(new At(!0,r,n.newLength)),t=n.endOffset}return e}class Dp extends oe{didLanguageChange(e){return this.brackets.didLanguageChange(e)}constructor(e,t){if(super(),this.textModel=e,this.getLanguageConfiguration=t,this.didChangeEmitter=new J,this.denseKeyProvider=new nh,this.brackets=new sh(this.denseKeyProvider,this.getLanguageConfiguration),this.onDidChange=this.didChangeEmitter.event,this.queuedTextEditsForInitialAstWithoutTokens=[],this.queuedTextEdits=[],e.tokenization.hasTokens)e.tokenization.backgroundTokenizationState===2?(this.initialAstWithoutTokens=void 0,this.astWithTokens=this.parseDocumentFromTextBuffer([],void 0,!1)):(this.initialAstWithoutTokens=this.parseDocumentFromTextBuffer([],void 0,!0),this.astWithTokens=this.initialAstWithoutTokens);else{const n=this.brackets.getSingleLanguageBracketTokens(this.textModel.getLanguageId()),i=new Tp(this.textModel.getValue(),n);this.initialAstWithoutTokens=co(i,[],void 0,!0),this.astWithTokens=this.initialAstWithoutTokens}}handleDidChangeBackgroundTokenizationState(){if(this.textModel.tokenization.backgroundTokenizationState===2){const e=this.initialAstWithoutTokens===void 0;this.initialAstWithoutTokens=void 0,e||this.didChangeEmitter.fire()}}handleDidChangeTokens({ranges:e}){const t=e.map(n=>new yi(le(n.fromLineNumber-1,0),le(n.toLineNumber,0),le(n.toLineNumber-n.fromLineNumber+1,0)));this.handleEdits(t,!0),this.initialAstWithoutTokens||this.didChangeEmitter.fire()}handleContentChanged(e){const t=yi.fromModelContentChanges(e.changes);this.handleEdits(t,!1)}handleEdits(e,t){const n=ku(this.queuedTextEdits,e);this.queuedTextEdits=n,this.initialAstWithoutTokens&&!t&&(this.queuedTextEditsForInitialAstWithoutTokens=ku(this.queuedTextEditsForInitialAstWithoutTokens,e))}flushQueue(){this.queuedTextEdits.length>0&&(this.astWithTokens=this.parseDocumentFromTextBuffer(this.queuedTextEdits,this.astWithTokens,!1),this.queuedTextEdits=[]),this.queuedTextEditsForInitialAstWithoutTokens.length>0&&(this.initialAstWithoutTokens&&(this.initialAstWithoutTokens=this.parseDocumentFromTextBuffer(this.queuedTextEditsForInitialAstWithoutTokens,this.initialAstWithoutTokens,!1)),this.queuedTextEditsForInitialAstWithoutTokens=[])}parseDocumentFromTextBuffer(e,t,n){const i=t,r=new ih(this.textModel,this.brackets);return co(r,e,i,n)}getBracketsInRange(e,t){this.flushQueue();const n=le(e.startLineNumber-1,e.startColumn-1),i=le(e.endLineNumber-1,e.endColumn-1);return new ei(r=>{const o=this.initialAstWithoutTokens||this.astWithTokens;ho(o,xe,o.length,n,i,r,0,0,new Map,t)})}getBracketPairsInRange(e,t){this.flushQueue();const n=_n(e.getStartPosition()),i=_n(e.getEndPosition());return new ei(r=>{const o=this.initialAstWithoutTokens||this.astWithTokens,a=new Op(r,t,this.textModel);fo(o,xe,o.length,n,i,a,0,new Map)})}getFirstBracketAfter(e){this.flushQueue();const t=this.initialAstWithoutTokens||this.astWithTokens;return ah(t,xe,t.length,_n(e))}getFirstBracketBefore(e){this.flushQueue();const t=this.initialAstWithoutTokens||this.astWithTokens;return oh(t,xe,t.length,_n(e))}}function oh(s,e,t,n){if(s.kind===4||s.kind===2){const i=[];for(const r of s.children)t=ne(e,r.length),i.push({nodeOffsetStart:e,nodeOffsetEnd:t}),e=t;for(let r=i.length-1;r>=0;r--){const{nodeOffsetStart:o,nodeOffsetEnd:a}=i[r];if(En(o,n)){const l=oh(s.children[r],o,a,n);if(l)return l}}return null}else{if(s.kind===3)return null;if(s.kind===1){const i=Yt(e,t);return{bracketInfo:s.bracketInfo,range:i}}}return null}function ah(s,e,t,n){if(s.kind===4||s.kind===2){for(const i of s.children){if(t=ne(e,i.length),En(n,t)){const r=ah(i,e,t,n);if(r)return r}e=t}return null}else{if(s.kind===3)return null;if(s.kind===1){const i=Yt(e,t);return{bracketInfo:s.bracketInfo,range:i}}}return null}function ho(s,e,t,n,i,r,o,a,l,u,c=!1){if(o>200)return!0;e:for(;;)switch(s.kind){case 4:{const h=s.childrenLength;for(let d=0;d<h;d++){const f=s.getChild(d);if(f){if(t=ne(e,f.length),yn(e,i)&&Jn(t,n)){if(Jn(t,i)){s=f;continue e}if(!ho(f,e,t,n,i,r,o,0,l,u))return!1}e=t}}return!0}case 2:{const h=!u||!s.closingBracket||s.closingBracket.bracketInfo.closesColorized(s.openingBracket.bracketInfo);let d=0;if(l){let m=l.get(s.openingBracket.text);m===void 0&&(m=0),d=m,h&&(m++,l.set(s.openingBracket.text,m))}const f=s.childrenLength;for(let m=0;m<f;m++){const p=s.getChild(m);if(p){if(t=ne(e,p.length),yn(e,i)&&Jn(t,n)){if(Jn(t,i)&&p.kind!==1){s=p,h?(o++,a=d+1):a=d;continue e}if((h||p.kind!==1||!s.closingBracket)&&!ho(p,e,t,n,i,r,h?o+1:o,h?d+1:d,l,u,!s.closingBracket))return!1}e=t}}return l==null||l.set(s.openingBracket.text,d),!0}case 3:{const h=Yt(e,t);return r(new wu(h,o-1,0,!0))}case 1:{const h=Yt(e,t);return r(new wu(h,o-1,a-1,c))}case 0:return!0}}class Op{constructor(e,t,n){this.push=e,this.includeMinIndentation=t,this.textModel=n}}function fo(s,e,t,n,i,r,o,a){var u;if(o>200)return!0;let l=!0;if(s.kind===2){let c=0;if(a){let f=a.get(s.openingBracket.text);f===void 0&&(f=0),c=f,f++,a.set(s.openingBracket.text,f)}const h=ne(e,s.openingBracket.length);let d=-1;if(r.includeMinIndentation&&(d=s.computeMinIndentation(e,r.textModel)),l=r.push(new Cp(Yt(e,t),Yt(e,h),s.closingBracket?Yt(ne(h,((u=s.child)==null?void 0:u.length)||xe),t):void 0,o,c,s,d)),e=h,l&&s.child){const f=s.child;if(t=ne(e,f.length),yn(e,i)&&Jn(t,n)&&(l=fo(f,e,t,n,i,r,o+1,a),!l))return!1}a==null||a.set(s.openingBracket.text,c)}else{let c=e;for(const h of s.children){const d=c;if(c=ne(c,h.length),yn(d,i)&&yn(n,c)&&(l=fo(h,d,c,n,i,r,o,a),!l))return!1}}return l}class Bp extends oe{get canBuildAST(){return this.textModel.getValueLength()<=5e6}constructor(e,t){super(),this.textModel=e,this.languageConfigurationService=t,this.bracketPairsTree=this._register(new Ls),this.onDidChangeEmitter=new J,this.onDidChange=this.onDidChangeEmitter.event,this.bracketsRequested=!1}handleLanguageConfigurationServiceChange(e){var t;(!e.languageId||(t=this.bracketPairsTree.value)!=null&&t.object.didLanguageChange(e.languageId))&&(this.bracketPairsTree.clear(),this.updateBracketPairsTree())}handleDidChangeOptions(e){this.bracketPairsTree.clear(),this.updateBracketPairsTree()}handleDidChangeLanguage(e){this.bracketPairsTree.clear(),this.updateBracketPairsTree()}handleDidChangeContent(e){var t;(t=this.bracketPairsTree.value)==null||t.object.handleContentChanged(e)}handleDidChangeBackgroundTokenizationState(){var e;(e=this.bracketPairsTree.value)==null||e.object.handleDidChangeBackgroundTokenizationState()}handleDidChangeTokens(e){var t;(t=this.bracketPairsTree.value)==null||t.object.handleDidChangeTokens(e)}updateBracketPairsTree(){if(this.bracketsRequested&&this.canBuildAST){if(!this.bracketPairsTree.value){const e=new tr;this.bracketPairsTree.value=Vp(e.add(new Dp(this.textModel,t=>this.languageConfigurationService.getLanguageConfiguration(t))),e),e.add(this.bracketPairsTree.value.object.onDidChange(t=>this.onDidChangeEmitter.fire(t))),this.onDidChangeEmitter.fire()}}else this.bracketPairsTree.value&&(this.bracketPairsTree.clear(),this.onDidChangeEmitter.fire())}getBracketPairsInRange(e){var t;return this.bracketsRequested=!0,this.updateBracketPairsTree(),((t=this.bracketPairsTree.value)==null?void 0:t.object.getBracketPairsInRange(e,!1))||ei.empty}getBracketPairsInRangeWithMinIndentation(e){var t;return this.bracketsRequested=!0,this.updateBracketPairsTree(),((t=this.bracketPairsTree.value)==null?void 0:t.object.getBracketPairsInRange(e,!0))||ei.empty}getBracketsInRange(e,t=!1){var n;return this.bracketsRequested=!0,this.updateBracketPairsTree(),((n=this.bracketPairsTree.value)==null?void 0:n.object.getBracketsInRange(e,t))||ei.empty}findMatchingBracketUp(e,t,n){const i=this.textModel.validatePosition(t),r=this.textModel.getLanguageIdAtPosition(i.lineNumber,i.column);if(this.canBuildAST){const o=this.languageConfigurationService.getLanguageConfiguration(r).bracketsNew.getClosingBracketInfo(e);if(!o)return null;const a=this.getBracketPairsInRange(w.fromPositions(t,t)).findLast(l=>o.closes(l.openingBracketInfo));return a?a.openingBracketRange:null}else{const o=e.toLowerCase(),a=this.languageConfigurationService.getLanguageConfiguration(r).brackets;if(!a)return null;const l=a.textIsBracket[o];return l?Yi(this._findMatchingBracketUp(l,i,Nr(n))):null}}matchBracket(e,t){if(this.canBuildAST){const n=this.getBracketPairsInRange(w.fromPositions(e,e)).filter(i=>i.closingBracketRange!==void 0&&(i.openingBracketRange.containsPosition(e)||i.closingBracketRange.containsPosition(e))).findLastMaxBy(Ot(i=>i.openingBracketRange.containsPosition(e)?i.openingBracketRange:i.closingBracketRange,w.compareRangesUsingStarts));return n?[n.openingBracketRange,n.closingBracketRange]:null}else{const n=Nr(t);return this._matchBracket(this.textModel.validatePosition(e),n)}}_establishBracketSearchOffsets(e,t,n,i){const r=t.getCount(),o=t.getLanguageId(i);let a=Math.max(0,e.column-1-n.maxBracketLength);for(let u=i-1;u>=0;u--){const c=t.getEndOffset(u);if(c<=a)break;if(et(t.getStandardTokenType(u))||t.getLanguageId(u)!==o){a=c;break}}let l=Math.min(t.getLineContent().length,e.column-1+n.maxBracketLength);for(let u=i+1;u<r;u++){const c=t.getStartOffset(u);if(c>=l)break;if(et(t.getStandardTokenType(u))||t.getLanguageId(u)!==o){l=c;break}}return{searchStartOffset:a,searchEndOffset:l}}_matchBracket(e,t){const n=e.lineNumber,i=this.textModel.tokenization.getLineTokens(n),r=this.textModel.getLineContent(n),o=i.findTokenIndexAtOffset(e.column-1);if(o<0)return null;const a=this.languageConfigurationService.getLanguageConfiguration(i.getLanguageId(o)).brackets;if(a&&!et(i.getStandardTokenType(o))){let{searchStartOffset:l,searchEndOffset:u}=this._establishBracketSearchOffsets(e,i,a,o),c=null;for(;;){const h=je.findNextBracketInRange(a.forwardRegex,n,r,l,u);if(!h)break;if(h.startColumn<=e.column&&e.column<=h.endColumn){const d=r.substring(h.startColumn-1,h.endColumn-1).toLowerCase(),f=this._matchFoundBracket(h,a.textIsBracket[d],a.textIsOpenBracket[d],t);if(f){if(f instanceof _t)return null;c=f}}l=h.endColumn-1}if(c)return c}if(o>0&&i.getStartOffset(o)===e.column-1){const l=o-1,u=this.languageConfigurationService.getLanguageConfiguration(i.getLanguageId(l)).brackets;if(u&&!et(i.getStandardTokenType(l))){const{searchStartOffset:c,searchEndOffset:h}=this._establishBracketSearchOffsets(e,i,u,l),d=je.findPrevBracketInRange(u.reversedRegex,n,r,c,h);if(d&&d.startColumn<=e.column&&e.column<=d.endColumn){const f=r.substring(d.startColumn-1,d.endColumn-1).toLowerCase(),m=this._matchFoundBracket(d,u.textIsBracket[f],u.textIsOpenBracket[f],t);if(m)return m instanceof _t?null:m}}}return null}_matchFoundBracket(e,t,n,i){if(!t)return null;const r=n?this._findMatchingBracketDown(t,e.getEndPosition(),i):this._findMatchingBracketUp(t,e.getStartPosition(),i);return r?r instanceof _t?r:[e,r]:null}_findMatchingBracketUp(e,t,n){const i=e.languageId,r=e.reversedRegex;let o=-1,a=0;const l=(u,c,h,d)=>{for(;;){if(n&&++a%100===0&&!n())return _t.INSTANCE;const f=je.findPrevBracketInRange(r,u,c,h,d);if(!f)break;const m=c.substring(f.startColumn-1,f.endColumn-1).toLowerCase();if(e.isOpen(m)?o++:e.isClose(m)&&o--,o===0)return f;d=f.startColumn-1}return null};for(let u=t.lineNumber;u>=1;u--){const c=this.textModel.tokenization.getLineTokens(u),h=c.getCount(),d=this.textModel.getLineContent(u);let f=h-1,m=d.length,p=d.length;u===t.lineNumber&&(f=c.findTokenIndexAtOffset(t.column-1),m=t.column-1,p=t.column-1);let C=!0;for(;f>=0;f--){const b=c.getLanguageId(f)===i&&!et(c.getStandardTokenType(f));if(b)C?m=c.getStartOffset(f):(m=c.getStartOffset(f),p=c.getEndOffset(f));else if(C&&m!==p){const L=l(u,d,m,p);if(L)return L}C=b}if(C&&m!==p){const b=l(u,d,m,p);if(b)return b}}return null}_findMatchingBracketDown(e,t,n){const i=e.languageId,r=e.forwardRegex;let o=1,a=0;const l=(c,h,d,f)=>{for(;;){if(n&&++a%100===0&&!n())return _t.INSTANCE;const m=je.findNextBracketInRange(r,c,h,d,f);if(!m)break;const p=h.substring(m.startColumn-1,m.endColumn-1).toLowerCase();if(e.isOpen(p)?o++:e.isClose(p)&&o--,o===0)return m;d=m.endColumn-1}return null},u=this.textModel.getLineCount();for(let c=t.lineNumber;c<=u;c++){const h=this.textModel.tokenization.getLineTokens(c),d=h.getCount(),f=this.textModel.getLineContent(c);let m=0,p=0,C=0;c===t.lineNumber&&(m=h.findTokenIndexAtOffset(t.column-1),p=t.column-1,C=t.column-1);let b=!0;for(;m<d;m++){const L=h.getLanguageId(m)===i&&!et(h.getStandardTokenType(m));if(L)b||(p=h.getStartOffset(m)),C=h.getEndOffset(m);else if(b&&p!==C){const _=l(c,f,p,C);if(_)return _}b=L}if(b&&p!==C){const L=l(c,f,p,C);if(L)return L}}return null}findPrevBracket(e){var o;const t=this.textModel.validatePosition(e);if(this.canBuildAST)return this.bracketsRequested=!0,this.updateBracketPairsTree(),((o=this.bracketPairsTree.value)==null?void 0:o.object.getFirstBracketBefore(t))||null;let n=null,i=null,r=null;for(let a=t.lineNumber;a>=1;a--){const l=this.textModel.tokenization.getLineTokens(a),u=l.getCount(),c=this.textModel.getLineContent(a);let h=u-1,d=c.length,f=c.length;if(a===t.lineNumber){h=l.findTokenIndexAtOffset(t.column-1),d=t.column-1,f=t.column-1;const p=l.getLanguageId(h);n!==p&&(n=p,i=this.languageConfigurationService.getLanguageConfiguration(n).brackets,r=this.languageConfigurationService.getLanguageConfiguration(n).bracketsNew)}let m=!0;for(;h>=0;h--){const p=l.getLanguageId(h);if(n!==p){if(i&&r&&m&&d!==f){const b=je.findPrevBracketInRange(i.reversedRegex,a,c,d,f);if(b)return this._toFoundBracket(r,b);m=!1}n=p,i=this.languageConfigurationService.getLanguageConfiguration(n).brackets,r=this.languageConfigurationService.getLanguageConfiguration(n).bracketsNew}const C=!!i&&!et(l.getStandardTokenType(h));if(C)m?d=l.getStartOffset(h):(d=l.getStartOffset(h),f=l.getEndOffset(h));else if(r&&i&&m&&d!==f){const b=je.findPrevBracketInRange(i.reversedRegex,a,c,d,f);if(b)return this._toFoundBracket(r,b)}m=C}if(r&&i&&m&&d!==f){const p=je.findPrevBracketInRange(i.reversedRegex,a,c,d,f);if(p)return this._toFoundBracket(r,p)}}return null}findNextBracket(e){var a;const t=this.textModel.validatePosition(e);if(this.canBuildAST)return this.bracketsRequested=!0,this.updateBracketPairsTree(),((a=this.bracketPairsTree.value)==null?void 0:a.object.getFirstBracketAfter(t))||null;const n=this.textModel.getLineCount();let i=null,r=null,o=null;for(let l=t.lineNumber;l<=n;l++){const u=this.textModel.tokenization.getLineTokens(l),c=u.getCount(),h=this.textModel.getLineContent(l);let d=0,f=0,m=0;if(l===t.lineNumber){d=u.findTokenIndexAtOffset(t.column-1),f=t.column-1,m=t.column-1;const C=u.getLanguageId(d);i!==C&&(i=C,r=this.languageConfigurationService.getLanguageConfiguration(i).brackets,o=this.languageConfigurationService.getLanguageConfiguration(i).bracketsNew)}let p=!0;for(;d<c;d++){const C=u.getLanguageId(d);if(i!==C){if(o&&r&&p&&f!==m){const L=je.findNextBracketInRange(r.forwardRegex,l,h,f,m);if(L)return this._toFoundBracket(o,L);p=!1}i=C,r=this.languageConfigurationService.getLanguageConfiguration(i).brackets,o=this.languageConfigurationService.getLanguageConfiguration(i).bracketsNew}const b=!!r&&!et(u.getStandardTokenType(d));if(b)p||(f=u.getStartOffset(d)),m=u.getEndOffset(d);else if(o&&r&&p&&f!==m){const L=je.findNextBracketInRange(r.forwardRegex,l,h,f,m);if(L)return this._toFoundBracket(o,L)}p=b}if(o&&r&&p&&f!==m){const C=je.findNextBracketInRange(r.forwardRegex,l,h,f,m);if(C)return this._toFoundBracket(o,C)}}return null}findEnclosingBrackets(e,t){const n=this.textModel.validatePosition(e);if(this.canBuildAST){const f=w.fromPositions(n),m=this.getBracketPairsInRange(w.fromPositions(n,n)).findLast(p=>p.closingBracketRange!==void 0&&p.range.strictContainsRange(f));return m?[m.openingBracketRange,m.closingBracketRange]:null}const i=Nr(t),r=this.textModel.getLineCount(),o=new Map;let a=[];const l=(f,m)=>{if(!o.has(f)){const p=[];for(let C=0,b=m?m.brackets.length:0;C<b;C++)p[C]=0;o.set(f,p)}a=o.get(f)};let u=0;const c=(f,m,p,C,b)=>{for(;;){if(i&&++u%100===0&&!i())return _t.INSTANCE;const L=je.findNextBracketInRange(f.forwardRegex,m,p,C,b);if(!L)break;const _=p.substring(L.startColumn-1,L.endColumn-1).toLowerCase(),k=f.textIsBracket[_];if(k&&(k.isOpen(_)?a[k.index]++:k.isClose(_)&&a[k.index]--,a[k.index]===-1))return this._matchFoundBracket(L,k,!1,i);C=L.endColumn-1}return null};let h=null,d=null;for(let f=n.lineNumber;f<=r;f++){const m=this.textModel.tokenization.getLineTokens(f),p=m.getCount(),C=this.textModel.getLineContent(f);let b=0,L=0,_=0;if(f===n.lineNumber){b=m.findTokenIndexAtOffset(n.column-1),L=n.column-1,_=n.column-1;const S=m.getLanguageId(b);h!==S&&(h=S,d=this.languageConfigurationService.getLanguageConfiguration(h).brackets,l(h,d))}let k=!0;for(;b<p;b++){const S=m.getLanguageId(b);if(h!==S){if(d&&k&&L!==_){const x=c(d,f,C,L,_);if(x)return Yi(x);k=!1}h=S,d=this.languageConfigurationService.getLanguageConfiguration(h).brackets,l(h,d)}const N=!!d&&!et(m.getStandardTokenType(b));if(N)k||(L=m.getStartOffset(b)),_=m.getEndOffset(b);else if(d&&k&&L!==_){const x=c(d,f,C,L,_);if(x)return Yi(x)}k=N}if(d&&k&&L!==_){const S=c(d,f,C,L,_);if(S)return Yi(S)}}return null}_toFoundBracket(e,t){if(!t)return null;let n=this.textModel.getValueInRange(t);n=n.toLowerCase();const i=e.getBracketInfo(n);return i?{range:t,bracketInfo:i}:null}}function Vp(s,e){return{object:s,dispose:()=>e==null?void 0:e.dispose()}}function Nr(s){if(typeof s>"u")return()=>!0;{const e=Date.now();return()=>Date.now()-e<=s}}const Qs=class Qs{constructor(){this._searchCanceledBrand=void 0}};Qs.INSTANCE=new Qs;let _t=Qs;function Yi(s){return s instanceof _t?null:s}class Wp extends oe{constructor(e){super(),this.textModel=e,this.colorProvider=new lh,this.onDidChangeEmitter=new J,this.onDidChange=this.onDidChangeEmitter.event,this.colorizationOptions=e.getOptions().bracketPairColorizationOptions,this._register(e.bracketPairs.onDidChange(t=>{this.onDidChangeEmitter.fire()}))}handleDidChangeOptions(e){this.colorizationOptions=this.textModel.getOptions().bracketPairColorizationOptions}getDecorationsInRange(e,t,n,i){return i?[]:t===void 0?[]:this.colorizationOptions.enabled?this.textModel.bracketPairs.getBracketsInRange(e,!0).map(o=>({id:`bracket${o.range.toString()}-${o.nestingLevel}`,options:{description:"BracketPairColorization",inlineClassName:this.colorProvider.getInlineClassName(o,this.colorizationOptions.independentColorPoolPerBracketType)},ownerId:0,range:o.range})).toArray():[]}getAllDecorations(e,t){return e===void 0?[]:this.colorizationOptions.enabled?this.getDecorationsInRange(new w(1,1,this.textModel.getLineCount(),1),e,t):[]}}class lh{constructor(){this.unexpectedClosingBracketClassName="unexpected-closing-bracket"}getInlineClassName(e,t){return e.isInvalid?this.unexpectedClosingBracketClassName:this.getInlineClassNameOfLevel(t?e.nestingLevelOfEqualBracketType:e.nestingLevel)}getInlineClassNameOfLevel(e){return`bracket-highlighting-${e%30}`}}Sc((s,e)=>{const t=[op,ap,lp,up,cp,hp],n=new lh;e.addRule(`.monaco-editor .${n.unexpectedClosingBracketClassName} { color: ${s.getColor(dp)}; }`);const i=t.map(r=>s.getColor(r)).filter(r=>!!r).filter(r=>!r.isTransparent());for(let r=0;r<30;r++){const o=i[r%i.length];e.addRule(`.monaco-editor .${n.getInlineClassNameOfLevel(r)} { color: ${o}; }`)}});function Ki(s){return s.replace(/\n/g,"\\n").replace(/\r/g,"\\r")}class we{get oldLength(){return this.oldText.length}get oldEnd(){return this.oldPosition+this.oldText.length}get newLength(){return this.newText.length}get newEnd(){return this.newPosition+this.newText.length}constructor(e,t,n,i){this.oldPosition=e,this.oldText=t,this.newPosition=n,this.newText=i}toString(){return this.oldText.length===0?`(insert@${this.oldPosition} "${Ki(this.newText)}")`:this.newText.length===0?`(delete@${this.oldPosition} "${Ki(this.oldText)}")`:`(replace@${this.oldPosition} "${Ki(this.oldText)}" with "${Ki(this.newText)}")`}static _writeStringSize(e){return 4+2*e.length}static _writeString(e,t,n){const i=t.length;Ze(e,i,n),n+=4;for(let r=0;r<i;r++)gd(e,t.charCodeAt(r),n),n+=2;return n}static _readString(e,t){const n=Xe(e,t);return t+=4,ng(e,t,n)}writeSize(){return 8+we._writeStringSize(this.oldText)+we._writeStringSize(this.newText)}write(e,t){return Ze(e,this.oldPosition,t),t+=4,Ze(e,this.newPosition,t),t+=4,t=we._writeString(e,this.oldText,t),t=we._writeString(e,this.newText,t),t}static read(e,t,n){const i=Xe(e,t);t+=4;const r=Xe(e,t);t+=4;const o=we._readString(e,t);t+=we._writeStringSize(o);const a=we._readString(e,t);return t+=we._writeStringSize(a),n.push(new we(i,o,r,a)),t}}function Fp(s,e){return s===null||s.length===0?e:new tt(s,e).compress()}class tt{constructor(e,t){this._prevEdits=e,this._currEdits=t,this._result=[],this._resultLen=0,this._prevLen=this._prevEdits.length,this._prevDeltaOffset=0,this._currLen=this._currEdits.length,this._currDeltaOffset=0}compress(){let e=0,t=0,n=this._getPrev(e),i=this._getCurr(t);for(;e<this._prevLen||t<this._currLen;){if(n===null){this._acceptCurr(i),i=this._getCurr(++t);continue}if(i===null){this._acceptPrev(n),n=this._getPrev(++e);continue}if(i.oldEnd<=n.newPosition){this._acceptCurr(i),i=this._getCurr(++t);continue}if(n.newEnd<=i.oldPosition){this._acceptPrev(n),n=this._getPrev(++e);continue}if(i.oldPosition<n.newPosition){const[u,c]=tt._splitCurr(i,n.newPosition-i.oldPosition);this._acceptCurr(u),i=c;continue}if(n.newPosition<i.oldPosition){const[u,c]=tt._splitPrev(n,i.oldPosition-n.newPosition);this._acceptPrev(u),n=c;continue}let a,l;if(i.oldEnd===n.newEnd)a=n,l=i,n=this._getPrev(++e),i=this._getCurr(++t);else if(i.oldEnd<n.newEnd){const[u,c]=tt._splitPrev(n,i.oldLength);a=u,l=i,n=c,i=this._getCurr(++t)}else{const[u,c]=tt._splitCurr(i,n.newLength);a=n,l=u,n=this._getPrev(++e),i=c}this._result[this._resultLen++]=new we(a.oldPosition,a.oldText,l.newPosition,l.newText),this._prevDeltaOffset+=a.newLength-a.oldLength,this._currDeltaOffset+=l.newLength-l.oldLength}const r=tt._merge(this._result);return tt._removeNoOps(r)}_acceptCurr(e){this._result[this._resultLen++]=tt._rebaseCurr(this._prevDeltaOffset,e),this._currDeltaOffset+=e.newLength-e.oldLength}_getCurr(e){return e<this._currLen?this._currEdits[e]:null}_acceptPrev(e){this._result[this._resultLen++]=tt._rebasePrev(this._currDeltaOffset,e),this._prevDeltaOffset+=e.newLength-e.oldLength}_getPrev(e){return e<this._prevLen?this._prevEdits[e]:null}static _rebaseCurr(e,t){return new we(t.oldPosition-e,t.oldText,t.newPosition,t.newText)}static _rebasePrev(e,t){return new we(t.oldPosition,t.oldText,t.newPosition+e,t.newText)}static _splitPrev(e,t){const n=e.newText.substr(0,t),i=e.newText.substr(t);return[new we(e.oldPosition,e.oldText,e.newPosition,n),new we(e.oldEnd,"",e.newPosition+t,i)]}static _splitCurr(e,t){const n=e.oldText.substr(0,t),i=e.oldText.substr(t);return[new we(e.oldPosition,n,e.newPosition,e.newText),new we(e.oldPosition+t,i,e.newEnd,"")]}static _merge(e){if(e.length===0)return e;const t=[];let n=0,i=e[0];for(let r=1;r<e.length;r++){const o=e[r];i.oldEnd===o.oldPosition?i=new we(i.oldPosition,i.oldText+o.oldText,i.newPosition,i.newText+o.newText):(t[n++]=i,i=o)}return t[n++]=i,t}static _removeNoOps(e){if(e.length===0)return e;const t=[];let n=0;for(let i=0;i<e.length;i++){const r=e[i];r.oldText!==r.newText&&(t[n++]=r)}return t}}function gn(s){return s.toString()}class me{static create(e,t){const n=e.getAlternativeVersionId(),i=go(e);return new me(n,n,i,i,t,t,[])}constructor(e,t,n,i,r,o,a){this.beforeVersionId=e,this.afterVersionId=t,this.beforeEOL=n,this.afterEOL=i,this.beforeCursorState=r,this.afterCursorState=o,this.changes=a}append(e,t,n,i,r){t.length>0&&(this.changes=Fp(this.changes,t)),this.afterEOL=n,this.afterVersionId=i,this.afterCursorState=r}static _writeSelectionsSize(e){return 4+4*4*(e?e.length:0)}static _writeSelections(e,t,n){if(Ze(e,t?t.length:0,n),n+=4,t)for(const i of t)Ze(e,i.selectionStartLineNumber,n),n+=4,Ze(e,i.selectionStartColumn,n),n+=4,Ze(e,i.positionLineNumber,n),n+=4,Ze(e,i.positionColumn,n),n+=4;return n}static _readSelections(e,t,n){const i=Xe(e,t);t+=4;for(let r=0;r<i;r++){const o=Xe(e,t);t+=4;const a=Xe(e,t);t+=4;const l=Xe(e,t);t+=4;const u=Xe(e,t);t+=4,n.push(new Z(o,a,l,u))}return t}serialize(){let e=10+me._writeSelectionsSize(this.beforeCursorState)+me._writeSelectionsSize(this.afterCursorState)+4;for(const i of this.changes)e+=i.writeSize();const t=new Uint8Array(e);let n=0;Ze(t,this.beforeVersionId,n),n+=4,Ze(t,this.afterVersionId,n),n+=4,pa(t,this.beforeEOL,n),n+=1,pa(t,this.afterEOL,n),n+=1,n=me._writeSelections(t,this.beforeCursorState,n),n=me._writeSelections(t,this.afterCursorState,n),Ze(t,this.changes.length,n),n+=4;for(const i of this.changes)n=i.write(t,n);return t.buffer}static deserialize(e){const t=new Uint8Array(e);let n=0;const i=Xe(t,n);n+=4;const r=Xe(t,n);n+=4;const o=Ca(t,n);n+=1;const a=Ca(t,n);n+=1;const l=[];n=me._readSelections(t,n,l);const u=[];n=me._readSelections(t,n,u);const c=Xe(t,n);n+=4;const h=[];for(let d=0;d<c;d++)n=we.read(t,n,h);return new me(i,r,o,a,l,u,h)}}class uh{get type(){return 0}get resource(){return ot.isUri(this.model)?this.model:this.model.uri}constructor(e,t,n,i){this.label=e,this.code=t,this.model=n,this._data=me.create(n,i)}toString(){return(this._data instanceof me?this._data:me.deserialize(this._data)).changes.map(t=>t.toString()).join(", ")}matchesResource(e){return(ot.isUri(this.model)?this.model:this.model.uri).toString()===e.toString()}setModel(e){this.model=e}canAppend(e){return this.model===e&&this._data instanceof me}append(e,t,n,i,r){this._data instanceof me&&this._data.append(e,t,n,i,r)}close(){this._data instanceof me&&(this._data=this._data.serialize())}open(){this._data instanceof me||(this._data=me.deserialize(this._data))}undo(){if(ot.isUri(this.model))throw new Error("Invalid SingleModelEditStackElement");this._data instanceof me&&(this._data=this._data.serialize());const e=me.deserialize(this._data);this.model._applyUndo(e.changes,e.beforeEOL,e.beforeVersionId,e.beforeCursorState)}redo(){if(ot.isUri(this.model))throw new Error("Invalid SingleModelEditStackElement");this._data instanceof me&&(this._data=this._data.serialize());const e=me.deserialize(this._data);this.model._applyRedo(e.changes,e.afterEOL,e.afterVersionId,e.afterCursorState)}heapSize(){return this._data instanceof me&&(this._data=this._data.serialize()),this._data.byteLength+168}}class zp{get resources(){return this._editStackElementsArr.map(e=>e.resource)}constructor(e,t,n){this.label=e,this.code=t,this.type=1,this._isOpen=!0,this._editStackElementsArr=n.slice(0),this._editStackElementsMap=new Map;for(const i of this._editStackElementsArr){const r=gn(i.resource);this._editStackElementsMap.set(r,i)}this._delegate=null}prepareUndoRedo(){if(this._delegate)return this._delegate.prepareUndoRedo(this)}matchesResource(e){const t=gn(e);return this._editStackElementsMap.has(t)}setModel(e){const t=gn(ot.isUri(e)?e:e.uri);this._editStackElementsMap.has(t)&&this._editStackElementsMap.get(t).setModel(e)}canAppend(e){if(!this._isOpen)return!1;const t=gn(e.uri);return this._editStackElementsMap.has(t)?this._editStackElementsMap.get(t).canAppend(e):!1}append(e,t,n,i,r){const o=gn(e.uri);this._editStackElementsMap.get(o).append(e,t,n,i,r)}close(){this._isOpen=!1}open(){}undo(){this._isOpen=!1;for(const e of this._editStackElementsArr)e.undo()}redo(){for(const e of this._editStackElementsArr)e.redo()}heapSize(e){const t=gn(e);return this._editStackElementsMap.has(t)?this._editStackElementsMap.get(t).heapSize():0}split(){return this._editStackElementsArr}toString(){const e=[];for(const t of this._editStackElementsArr)e.push(`${md(t.resource)}: ${t}`);return`{${e.join(", ")}}`}}function go(s){return s.getEOL()===`
`?0:1}function St(s){return s?s instanceof uh||s instanceof zp:!1}class qo{constructor(e,t){this._model=e,this._undoRedoService=t}pushStackElement(){const e=this._undoRedoService.getLastElement(this._model.uri);St(e)&&e.close()}popStackElement(){const e=this._undoRedoService.getLastElement(this._model.uri);St(e)&&e.open()}clear(){this._undoRedoService.removeElements(this._model.uri)}_getOrCreateEditStackElement(e,t){const n=this._undoRedoService.getLastElement(this._model.uri);if(St(n)&&n.canAppend(this._model))return n;const i=new uh(g("edit","Typing"),"undoredo.textBufferEdit",this._model,e);return this._undoRedoService.pushElement(i,t),i}pushEOL(e){const t=this._getOrCreateEditStackElement(null,void 0);this._model.setEOL(e),t.append(this._model,[],go(this._model),this._model.getAlternativeVersionId(),null)}pushEditOperation(e,t,n,i){const r=this._getOrCreateEditStackElement(e,i),o=this._model.applyEdits(t,!0),a=qo._computeCursorState(n,o),l=o.map((u,c)=>({index:c,textChange:u.textChange}));return l.sort((u,c)=>u.textChange.oldPosition===c.textChange.oldPosition?u.index-c.index:u.textChange.oldPosition-c.textChange.oldPosition),r.append(this._model,l.map(u=>u.textChange),go(this._model),this._model.getAlternativeVersionId(),a),a}static _computeCursorState(e,t){try{return e?e(t):null}catch(n){return Tt(n),null}}}class ch extends oe{constructor(){super(...arguments),this._isDisposed=!1}dispose(){super.dispose(),this._isDisposed=!0}assertNotDisposed(){if(this._isDisposed)throw new Error("TextModelPart is disposed!")}}function Hp(s,e){let t=0,n=0;const i=s.length;for(;n<i;){const r=s.charCodeAt(n);if(r===32)t++;else if(r===9)t=t-t%e+e;else break;n++}return n===i?-1:t}var Ds;(function(s){s[s.Disabled=0]="Disabled",s[s.EnabledForActive=1]="EnabledForActive",s[s.Enabled=2]="Enabled"})(Ds||(Ds={}));class Sn{constructor(e,t,n,i,r,o){if(this.visibleColumn=e,this.column=t,this.className=n,this.horizontalLine=i,this.forWrappedLinesAfterColumn=r,this.forWrappedLinesBeforeOrAtColumn=o,e!==-1==(t!==-1))throw new Error}}class ri{constructor(e,t){this.top=e,this.endColumn=t}}class jp extends ch{constructor(e,t){super(),this.textModel=e,this.languageConfigurationService=t}getLanguageConfiguration(e){return this.languageConfigurationService.getLanguageConfiguration(e)}_computeIndentLevel(e){return Hp(this.textModel.getLineContent(e+1),this.textModel.getOptions().tabSize)}getActiveIndentGuide(e,t,n){this.assertNotDisposed();const i=this.textModel.getLineCount();if(e<1||e>i)throw new he("Illegal value for lineNumber");const r=this.getLanguageConfiguration(this.textModel.getLanguageId()).foldingRules,o=!!(r&&r.offSide);let a=-2,l=-1,u=-2,c=-1;const h=x=>{if(a!==-1&&(a===-2||a>x-1)){a=-1,l=-1;for(let T=x-2;T>=0;T--){const E=this._computeIndentLevel(T);if(E>=0){a=T,l=E;break}}}if(u===-2){u=-1,c=-1;for(let T=x;T<i;T++){const E=this._computeIndentLevel(T);if(E>=0){u=T,c=E;break}}}};let d=-2,f=-1,m=-2,p=-1;const C=x=>{if(d===-2){d=-1,f=-1;for(let T=x-2;T>=0;T--){const E=this._computeIndentLevel(T);if(E>=0){d=T,f=E;break}}}if(m!==-1&&(m===-2||m<x-1)){m=-1,p=-1;for(let T=x;T<i;T++){const E=this._computeIndentLevel(T);if(E>=0){m=T,p=E;break}}}};let b=0,L=!0,_=0,k=!0,S=0,N=0;for(let x=0;L||k;x++){const T=e-x,E=e+x;x>1&&(T<1||T<t)&&(L=!1),x>1&&(E>i||E>n)&&(k=!1),x>5e4&&(L=!1,k=!1);let V=-1;if(L&&T>=1){const B=this._computeIndentLevel(T-1);B>=0?(u=T-1,c=B,V=Math.ceil(B/this.textModel.getOptions().indentSize)):(h(T),V=this._getIndentLevelForWhitespaceLine(o,l,c))}let P=-1;if(k&&E<=i){const B=this._computeIndentLevel(E-1);B>=0?(d=E-1,f=B,P=Math.ceil(B/this.textModel.getOptions().indentSize)):(C(E),P=this._getIndentLevelForWhitespaceLine(o,f,p))}if(x===0){N=V;continue}if(x===1){if(E<=i&&P>=0&&N+1===P){L=!1,b=E,_=E,S=P;continue}if(T>=1&&V>=0&&V-1===N){k=!1,b=T,_=T,S=V;continue}if(b=e,_=e,S=N,S===0)return{startLineNumber:b,endLineNumber:_,indent:S}}L&&(V>=S?b=T:L=!1),k&&(P>=S?_=E:k=!1)}return{startLineNumber:b,endLineNumber:_,indent:S}}getLinesBracketGuides(e,t,n,i){var h;const r=[];for(let d=e;d<=t;d++)r.push([]);const o=!0,a=this.textModel.bracketPairs.getBracketPairsInRangeWithMinIndentation(new w(e,1,t,this.textModel.getLineMaxColumn(t))).toArray();let l;if(n&&a.length>0){const d=(e<=n.lineNumber&&n.lineNumber<=t?a:this.textModel.bracketPairs.getBracketPairsInRange(w.fromPositions(n)).toArray()).filter(f=>w.strictContainsPosition(f.range,n));l=(h=pd(d,f=>o))==null?void 0:h.range}const u=this.textModel.getOptions().bracketPairColorizationOptions.independentColorPoolPerBracketType,c=new Up;for(const d of a){if(!d.closingBracketRange)continue;const f=l&&d.range.equalsRange(l);if(!f&&!i.includeInactive)continue;const m=c.getInlineClassName(d.nestingLevel,d.nestingLevelOfEqualBracketType,u)+(i.highlightActive&&f?" "+c.activeClassName:""),p=d.openingBracketRange.getStartPosition(),C=d.closingBracketRange.getStartPosition(),b=i.horizontalGuides===Ds.Enabled||i.horizontalGuides===Ds.EnabledForActive&&f;if(d.range.startLineNumber===d.range.endLineNumber){b&&r[d.range.startLineNumber-e].push(new Sn(-1,d.openingBracketRange.getEndPosition().column,m,new ri(!1,C.column),-1,-1));continue}const L=this.getVisibleColumnFromPosition(C),_=this.getVisibleColumnFromPosition(d.openingBracketRange.getStartPosition()),k=Math.min(_,L,d.minVisibleColumnIndentation+1);let S=!1;Ve(this.textModel.getLineContent(d.closingBracketRange.startLineNumber))<d.closingBracketRange.startColumn-1&&(S=!0);const T=Math.max(p.lineNumber,e),E=Math.min(C.lineNumber,t),V=S?1:0;for(let P=T;P<E+V;P++)r[P-e].push(new Sn(k,-1,m,null,P===p.lineNumber?p.column:-1,P===C.lineNumber?C.column:-1));b&&(p.lineNumber>=e&&_>k&&r[p.lineNumber-e].push(new Sn(k,-1,m,new ri(!1,p.column),-1,-1)),C.lineNumber<=t&&L>k&&r[C.lineNumber-e].push(new Sn(k,-1,m,new ri(!S,C.column),-1,-1)))}for(const d of r)d.sort((f,m)=>f.visibleColumn-m.visibleColumn);return r}getVisibleColumnFromPosition(e){return be.visibleColumnFromColumn(this.textModel.getLineContent(e.lineNumber),e.column,this.textModel.getOptions().tabSize)+1}getLinesIndentGuides(e,t){this.assertNotDisposed();const n=this.textModel.getLineCount();if(e<1||e>n)throw new Error("Illegal value for startLineNumber");if(t<1||t>n)throw new Error("Illegal value for endLineNumber");const i=this.textModel.getOptions(),r=this.getLanguageConfiguration(this.textModel.getLanguageId()).foldingRules,o=!!(r&&r.offSide),a=new Array(t-e+1);let l=-2,u=-1,c=-2,h=-1;for(let d=e;d<=t;d++){const f=d-e,m=this._computeIndentLevel(d-1);if(m>=0){l=d-1,u=m,a[f]=Math.ceil(m/i.indentSize);continue}if(l===-2){l=-1,u=-1;for(let p=d-2;p>=0;p--){const C=this._computeIndentLevel(p);if(C>=0){l=p,u=C;break}}}if(c!==-1&&(c===-2||c<d-1)){c=-1,h=-1;for(let p=d;p<n;p++){const C=this._computeIndentLevel(p);if(C>=0){c=p,h=C;break}}}a[f]=this._getIndentLevelForWhitespaceLine(o,u,h)}return a}_getIndentLevelForWhitespaceLine(e,t,n){const i=this.textModel.getOptions();return t===-1||n===-1?0:t<n?1+Math.floor(t/i.indentSize):t===n||e?Math.ceil(n/i.indentSize):1+Math.floor(n/i.indentSize)}}class Up{constructor(){this.activeClassName="indent-active"}getInlineClassName(e,t,n){return this.getInlineClassNameOfLevel(n?t:e)}getInlineClassNameOfLevel(e){return`bracket-indent-guide lvl-${e%30}`}}class qp{constructor(){this.spacesDiff=0,this.looksLikeAlignment=!1}}function Gp(s,e,t,n,i){i.spacesDiff=0,i.looksLikeAlignment=!1;let r;for(r=0;r<e&&r<n;r++){const d=s.charCodeAt(r),f=t.charCodeAt(r);if(d!==f)break}let o=0,a=0;for(let d=r;d<e;d++)s.charCodeAt(d)===32?o++:a++;let l=0,u=0;for(let d=r;d<n;d++)t.charCodeAt(d)===32?l++:u++;if(o>0&&a>0||l>0&&u>0)return;const c=Math.abs(a-u),h=Math.abs(o-l);if(c===0){i.spacesDiff=h,h>0&&0<=l-1&&l-1<s.length&&l<t.length&&t.charCodeAt(l)!==32&&s.charCodeAt(l-1)===32&&s.charCodeAt(s.length-1)===44&&(i.looksLikeAlignment=!0);return}if(h%c===0){i.spacesDiff=h/c;return}}function Iu(s,e,t){const n=Math.min(s.getLineCount(),1e4);let i=0,r=0,o="",a=0;const l=[2,4,6,8,3,5,7],u=8,c=[0,0,0,0,0,0,0,0,0],h=new qp;for(let m=1;m<=n;m++){const p=s.getLineLength(m),C=s.getLineContent(m),b=p<=65536;let L=!1,_=0,k=0,S=0;for(let x=0,T=p;x<T;x++){const E=b?C.charCodeAt(x):s.getLineCharCode(m,x);if(E===9)S++;else if(E===32)k++;else{L=!0,_=x;break}}if(!L||(S>0?i++:k>1&&r++,Gp(o,a,C,_,h),h.looksLikeAlignment&&!(t&&e===h.spacesDiff)))continue;const N=h.spacesDiff;N<=u&&c[N]++,o=C,a=_}let d=t;i!==r&&(d=i<r);let f=e;if(d){let m=d?0:.1*n;l.forEach(p=>{const C=c[p];C>m&&(m=C,f=p)}),f===4&&c[4]>0&&c[2]>0&&c[2]>=c[4]/2&&(f=2)}return{insertSpaces:d,tabSize:f}}function Ee(s){return(s.metadata&1)>>>0}function Y(s,e){s.metadata=s.metadata&254|e<<0}function _e(s){return(s.metadata&2)>>>1===1}function X(s,e){s.metadata=s.metadata&253|(e?1:0)<<1}function hh(s){return(s.metadata&4)>>>2===1}function Nu(s,e){s.metadata=s.metadata&251|(e?1:0)<<2}function dh(s){return(s.metadata&64)>>>6===1}function xu(s,e){s.metadata=s.metadata&191|(e?1:0)<<6}function $p(s){return(s.metadata&24)>>>3}function Tu(s,e){s.metadata=s.metadata&231|e<<3}function Qp(s){return(s.metadata&32)>>>5===1}function Eu(s,e){s.metadata=s.metadata&223|(e?1:0)<<5}class fh{constructor(e,t,n){this.metadata=0,this.parent=this,this.left=this,this.right=this,Y(this,1),this.start=t,this.end=n,this.delta=0,this.maxEnd=n,this.id=e,this.ownerId=0,this.options=null,Nu(this,!1),xu(this,!1),Tu(this,1),Eu(this,!1),this.cachedVersionId=0,this.cachedAbsoluteStart=t,this.cachedAbsoluteEnd=n,this.range=null,X(this,!1)}reset(e,t,n,i){this.start=t,this.end=n,this.maxEnd=n,this.cachedVersionId=e,this.cachedAbsoluteStart=t,this.cachedAbsoluteEnd=n,this.range=i}setOptions(e){this.options=e;const t=this.options.className;Nu(this,t==="squiggly-error"||t==="squiggly-warning"||t==="squiggly-info"),xu(this,this.options.glyphMarginClassName!==null),Tu(this,this.options.stickiness),Eu(this,this.options.collapseOnReplaceEdit)}setCachedOffsets(e,t,n){this.cachedVersionId!==n&&(this.range=null),this.cachedVersionId=n,this.cachedAbsoluteStart=e,this.cachedAbsoluteEnd=t}detach(){this.parent=null,this.left=null,this.right=null}}const D=new fh(null,0,0);D.parent=D;D.left=D;D.right=D;Y(D,0);class xr{constructor(){this.root=D,this.requestNormalizeDelta=!1}intervalSearch(e,t,n,i,r,o){return this.root===D?[]:nC(this,e,t,n,i,r,o)}search(e,t,n,i){return this.root===D?[]:tC(this,e,t,n,i)}collectNodesFromOwner(e){return Kp(this,e)}collectNodesPostOrder(){return eC(this)}insert(e){yu(this,e),this._normalizeDeltaIfNecessary()}delete(e){Ru(this,e),this._normalizeDeltaIfNecessary()}resolveNode(e,t){const n=e;let i=0;for(;e!==this.root;)e===e.parent.right&&(i+=e.parent.delta),e=e.parent;const r=n.start+i,o=n.end+i;n.setCachedOffsets(r,o,t)}acceptReplace(e,t,n,i){const r=Jp(this,e,e+t);for(let o=0,a=r.length;o<a;o++){const l=r[o];Ru(this,l)}this._normalizeDeltaIfNecessary(),Yp(this,e,e+t,n),this._normalizeDeltaIfNecessary();for(let o=0,a=r.length;o<a;o++){const l=r[o];l.start=l.cachedAbsoluteStart,l.end=l.cachedAbsoluteEnd,Xp(l,e,e+t,n,i),l.maxEnd=l.end,yu(this,l)}this._normalizeDeltaIfNecessary()}_normalizeDeltaIfNecessary(){this.requestNormalizeDelta&&(this.requestNormalizeDelta=!1,Zp(this))}}function Zp(s){let e=s.root,t=0;for(;e!==D;){if(e.left!==D&&!_e(e.left)){e=e.left;continue}if(e.right!==D&&!_e(e.right)){t+=e.delta,e=e.right;continue}e.start=t+e.start,e.end=t+e.end,e.delta=0,Bt(e),X(e,!0),X(e.left,!1),X(e.right,!1),e===e.parent.right&&(t-=e.parent.delta),e=e.parent}X(s.root,!1)}function mn(s,e,t,n){return s<t?!0:s>t||n===1?!1:n===2?!0:e}function Xp(s,e,t,n,i){const r=$p(s),o=r===0||r===2,a=r===1||r===2,l=t-e,u=n,c=Math.min(l,u),h=s.start;let d=!1;const f=s.end;let m=!1;e<=h&&f<=t&&Qp(s)&&(s.start=e,d=!0,s.end=e,m=!0);{const C=i?1:l>0?2:0;!d&&mn(h,o,e,C)&&(d=!0),!m&&mn(f,a,e,C)&&(m=!0)}if(c>0&&!i){const C=l>u?2:0;!d&&mn(h,o,e+c,C)&&(d=!0),!m&&mn(f,a,e+c,C)&&(m=!0)}{const C=i?1:0;!d&&mn(h,o,t,C)&&(s.start=e+u,d=!0),!m&&mn(f,a,t,C)&&(s.end=e+u,m=!0)}const p=u-l;d||(s.start=Math.max(0,h+p)),m||(s.end=Math.max(0,f+p)),s.start>s.end&&(s.end=s.start)}function Jp(s,e,t){let n=s.root,i=0,r=0,o=0,a=0;const l=[];let u=0;for(;n!==D;){if(_e(n)){X(n.left,!1),X(n.right,!1),n===n.parent.right&&(i-=n.parent.delta),n=n.parent;continue}if(!_e(n.left)){if(r=i+n.maxEnd,r<e){X(n,!0);continue}if(n.left!==D){n=n.left;continue}}if(o=i+n.start,o>t){X(n,!0);continue}if(a=i+n.end,a>=e&&(n.setCachedOffsets(o,a,0),l[u++]=n),X(n,!0),n.right!==D&&!_e(n.right)){i+=n.delta,n=n.right;continue}}return X(s.root,!1),l}function Yp(s,e,t,n){let i=s.root,r=0,o=0,a=0;const l=n-(t-e);for(;i!==D;){if(_e(i)){X(i.left,!1),X(i.right,!1),i===i.parent.right&&(r-=i.parent.delta),Bt(i),i=i.parent;continue}if(!_e(i.left)){if(o=r+i.maxEnd,o<e){X(i,!0);continue}if(i.left!==D){i=i.left;continue}}if(a=r+i.start,a>t){i.start+=l,i.end+=l,i.delta+=l,(i.delta<-1073741824||i.delta>1073741824)&&(s.requestNormalizeDelta=!0),X(i,!0);continue}if(X(i,!0),i.right!==D&&!_e(i.right)){r+=i.delta,i=i.right;continue}}X(s.root,!1)}function Kp(s,e){let t=s.root;const n=[];let i=0;for(;t!==D;){if(_e(t)){X(t.left,!1),X(t.right,!1),t=t.parent;continue}if(t.left!==D&&!_e(t.left)){t=t.left;continue}if(t.ownerId===e&&(n[i++]=t),X(t,!0),t.right!==D&&!_e(t.right)){t=t.right;continue}}return X(s.root,!1),n}function eC(s){let e=s.root;const t=[];let n=0;for(;e!==D;){if(_e(e)){X(e.left,!1),X(e.right,!1),e=e.parent;continue}if(e.left!==D&&!_e(e.left)){e=e.left;continue}if(e.right!==D&&!_e(e.right)){e=e.right;continue}t[n++]=e,X(e,!0)}return X(s.root,!1),t}function tC(s,e,t,n,i){let r=s.root,o=0,a=0,l=0;const u=[];let c=0;for(;r!==D;){if(_e(r)){X(r.left,!1),X(r.right,!1),r===r.parent.right&&(o-=r.parent.delta),r=r.parent;continue}if(r.left!==D&&!_e(r.left)){r=r.left;continue}a=o+r.start,l=o+r.end,r.setCachedOffsets(a,l,n);let h=!0;if(e&&r.ownerId&&r.ownerId!==e&&(h=!1),t&&hh(r)&&(h=!1),i&&!dh(r)&&(h=!1),h&&(u[c++]=r),X(r,!0),r.right!==D&&!_e(r.right)){o+=r.delta,r=r.right;continue}}return X(s.root,!1),u}function nC(s,e,t,n,i,r,o){let a=s.root,l=0,u=0,c=0,h=0;const d=[];let f=0;for(;a!==D;){if(_e(a)){X(a.left,!1),X(a.right,!1),a===a.parent.right&&(l-=a.parent.delta),a=a.parent;continue}if(!_e(a.left)){if(u=l+a.maxEnd,u<e){X(a,!0);continue}if(a.left!==D){a=a.left;continue}}if(c=l+a.start,c>t){X(a,!0);continue}if(h=l+a.end,h>=e){a.setCachedOffsets(c,h,r);let m=!0;n&&a.ownerId&&a.ownerId!==n&&(m=!1),i&&hh(a)&&(m=!1),o&&!dh(a)&&(m=!1),m&&(d[f++]=a)}if(X(a,!0),a.right!==D&&!_e(a.right)){l+=a.delta,a=a.right;continue}}return X(s.root,!1),d}function yu(s,e){if(s.root===D)return e.parent=D,e.left=D,e.right=D,Y(e,0),s.root=e,s.root;iC(s,e),yt(e.parent);let t=e;for(;t!==s.root&&Ee(t.parent)===1;)if(t.parent===t.parent.parent.left){const n=t.parent.parent.right;Ee(n)===1?(Y(t.parent,0),Y(n,0),Y(t.parent.parent,1),t=t.parent.parent):(t===t.parent.right&&(t=t.parent,oi(s,t)),Y(t.parent,0),Y(t.parent.parent,1),ai(s,t.parent.parent))}else{const n=t.parent.parent.left;Ee(n)===1?(Y(t.parent,0),Y(n,0),Y(t.parent.parent,1),t=t.parent.parent):(t===t.parent.left&&(t=t.parent,ai(s,t)),Y(t.parent,0),Y(t.parent.parent,1),oi(s,t.parent.parent))}return Y(s.root,0),e}function iC(s,e){let t=0,n=s.root;const i=e.start,r=e.end;for(;;)if(rC(i,r,n.start+t,n.end+t)<0)if(n.left===D){e.start-=t,e.end-=t,e.maxEnd-=t,n.left=e;break}else n=n.left;else if(n.right===D){e.start-=t+n.delta,e.end-=t+n.delta,e.maxEnd-=t+n.delta,n.right=e;break}else t+=n.delta,n=n.right;e.parent=n,e.left=D,e.right=D,Y(e,1)}function Ru(s,e){let t,n;if(e.left===D?(t=e.right,n=e,t.delta+=e.delta,(t.delta<-1073741824||t.delta>1073741824)&&(s.requestNormalizeDelta=!0),t.start+=e.delta,t.end+=e.delta):e.right===D?(t=e.left,n=e):(n=sC(e.right),t=n.right,t.start+=n.delta,t.end+=n.delta,t.delta+=n.delta,(t.delta<-1073741824||t.delta>1073741824)&&(s.requestNormalizeDelta=!0),n.start+=e.delta,n.end+=e.delta,n.delta=e.delta,(n.delta<-1073741824||n.delta>1073741824)&&(s.requestNormalizeDelta=!0)),n===s.root){s.root=t,Y(t,0),e.detach(),Tr(),Bt(t),s.root.parent=D;return}const i=Ee(n)===1;if(n===n.parent.left?n.parent.left=t:n.parent.right=t,n===e?t.parent=n.parent:(n.parent===e?t.parent=n:t.parent=n.parent,n.left=e.left,n.right=e.right,n.parent=e.parent,Y(n,Ee(e)),e===s.root?s.root=n:e===e.parent.left?e.parent.left=n:e.parent.right=n,n.left!==D&&(n.left.parent=n),n.right!==D&&(n.right.parent=n)),e.detach(),i){yt(t.parent),n!==e&&(yt(n),yt(n.parent)),Tr();return}yt(t),yt(t.parent),n!==e&&(yt(n),yt(n.parent));let r;for(;t!==s.root&&Ee(t)===0;)t===t.parent.left?(r=t.parent.right,Ee(r)===1&&(Y(r,0),Y(t.parent,1),oi(s,t.parent),r=t.parent.right),Ee(r.left)===0&&Ee(r.right)===0?(Y(r,1),t=t.parent):(Ee(r.right)===0&&(Y(r.left,0),Y(r,1),ai(s,r),r=t.parent.right),Y(r,Ee(t.parent)),Y(t.parent,0),Y(r.right,0),oi(s,t.parent),t=s.root)):(r=t.parent.left,Ee(r)===1&&(Y(r,0),Y(t.parent,1),ai(s,t.parent),r=t.parent.left),Ee(r.left)===0&&Ee(r.right)===0?(Y(r,1),t=t.parent):(Ee(r.left)===0&&(Y(r.right,0),Y(r,1),oi(s,r),r=t.parent.left),Y(r,Ee(t.parent)),Y(t.parent,0),Y(r.left,0),ai(s,t.parent),t=s.root));Y(t,0),Tr()}function sC(s){for(;s.left!==D;)s=s.left;return s}function Tr(){D.parent=D,D.delta=0,D.start=0,D.end=0}function oi(s,e){const t=e.right;t.delta+=e.delta,(t.delta<-1073741824||t.delta>1073741824)&&(s.requestNormalizeDelta=!0),t.start+=e.delta,t.end+=e.delta,e.right=t.left,t.left!==D&&(t.left.parent=e),t.parent=e.parent,e.parent===D?s.root=t:e===e.parent.left?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t,Bt(e),Bt(t)}function ai(s,e){const t=e.left;e.delta-=t.delta,(e.delta<-1073741824||e.delta>1073741824)&&(s.requestNormalizeDelta=!0),e.start-=t.delta,e.end-=t.delta,e.left=t.right,t.right!==D&&(t.right.parent=e),t.parent=e.parent,e.parent===D?s.root=t:e===e.parent.right?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t,Bt(e),Bt(t)}function gh(s){let e=s.end;if(s.left!==D){const t=s.left.maxEnd;t>e&&(e=t)}if(s.right!==D){const t=s.right.maxEnd+s.delta;t>e&&(e=t)}return e}function Bt(s){s.maxEnd=gh(s)}function yt(s){for(;s!==D;){const e=gh(s);if(s.maxEnd===e)return;s.maxEnd=e,s=s.parent}}function rC(s,e,t,n){return s===t?e-n:s-t}class mo{constructor(e,t){this.piece=e,this.color=t,this.size_left=0,this.lf_left=0,this.parent=this,this.left=this,this.right=this}next(){if(this.right!==M)return Go(this.right);let e=this;for(;e.parent!==M&&e.parent.left!==e;)e=e.parent;return e.parent===M?M:e.parent}prev(){if(this.left!==M)return mh(this.left);let e=this;for(;e.parent!==M&&e.parent.right!==e;)e=e.parent;return e.parent===M?M:e.parent}detach(){this.parent=null,this.left=null,this.right=null}}const M=new mo(null,0);M.parent=M;M.left=M;M.right=M;M.color=0;function Go(s){for(;s.left!==M;)s=s.left;return s}function mh(s){for(;s.right!==M;)s=s.right;return s}function $o(s){return s===M?0:s.size_left+s.piece.length+$o(s.right)}function Qo(s){return s===M?0:s.lf_left+s.piece.lineFeedCnt+Qo(s.right)}function Er(){M.parent=M}function li(s,e){const t=e.right;t.size_left+=e.size_left+(e.piece?e.piece.length:0),t.lf_left+=e.lf_left+(e.piece?e.piece.lineFeedCnt:0),e.right=t.left,t.left!==M&&(t.left.parent=e),t.parent=e.parent,e.parent===M?s.root=t:e.parent.left===e?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t}function ui(s,e){const t=e.left;e.left=t.right,t.right!==M&&(t.right.parent=e),t.parent=e.parent,e.size_left-=t.size_left+(t.piece?t.piece.length:0),e.lf_left-=t.lf_left+(t.piece?t.piece.lineFeedCnt:0),e.parent===M?s.root=t:e===e.parent.right?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t}function es(s,e){let t,n;if(e.left===M?(n=e,t=n.right):e.right===M?(n=e,t=n.left):(n=Go(e.right),t=n.right),n===s.root){s.root=t,t.color=0,e.detach(),Er(),s.root.parent=M;return}const i=n.color===1;if(n===n.parent.left?n.parent.left=t:n.parent.right=t,n===e?(t.parent=n.parent,Yn(s,t)):(n.parent===e?t.parent=n:t.parent=n.parent,Yn(s,t),n.left=e.left,n.right=e.right,n.parent=e.parent,n.color=e.color,e===s.root?s.root=n:e===e.parent.left?e.parent.left=n:e.parent.right=n,n.left!==M&&(n.left.parent=n),n.right!==M&&(n.right.parent=n),n.size_left=e.size_left,n.lf_left=e.lf_left,Yn(s,n)),e.detach(),t.parent.left===t){const o=$o(t),a=Qo(t);if(o!==t.parent.size_left||a!==t.parent.lf_left){const l=o-t.parent.size_left,u=a-t.parent.lf_left;t.parent.size_left=o,t.parent.lf_left=a,ht(s,t.parent,l,u)}}if(Yn(s,t.parent),i){Er();return}let r;for(;t!==s.root&&t.color===0;)t===t.parent.left?(r=t.parent.right,r.color===1&&(r.color=0,t.parent.color=1,li(s,t.parent),r=t.parent.right),r.left.color===0&&r.right.color===0?(r.color=1,t=t.parent):(r.right.color===0&&(r.left.color=0,r.color=1,ui(s,r),r=t.parent.right),r.color=t.parent.color,t.parent.color=0,r.right.color=0,li(s,t.parent),t=s.root)):(r=t.parent.left,r.color===1&&(r.color=0,t.parent.color=1,ui(s,t.parent),r=t.parent.left),r.left.color===0&&r.right.color===0?(r.color=1,t=t.parent):(r.left.color===0&&(r.right.color=0,r.color=1,li(s,r),r=t.parent.left),r.color=t.parent.color,t.parent.color=0,r.left.color=0,ui(s,t.parent),t=s.root));t.color=0,Er()}function Mu(s,e){for(Yn(s,e);e!==s.root&&e.parent.color===1;)if(e.parent===e.parent.parent.left){const t=e.parent.parent.right;t.color===1?(e.parent.color=0,t.color=0,e.parent.parent.color=1,e=e.parent.parent):(e===e.parent.right&&(e=e.parent,li(s,e)),e.parent.color=0,e.parent.parent.color=1,ui(s,e.parent.parent))}else{const t=e.parent.parent.left;t.color===1?(e.parent.color=0,t.color=0,e.parent.parent.color=1,e=e.parent.parent):(e===e.parent.left&&(e=e.parent,ui(s,e)),e.parent.color=0,e.parent.parent.color=1,li(s,e.parent.parent))}s.root.color=0}function ht(s,e,t,n){for(;e!==s.root&&e!==M;)e.parent.left===e&&(e.parent.size_left+=t,e.parent.lf_left+=n),e=e.parent}function Yn(s,e){let t=0,n=0;if(e!==s.root){for(;e!==s.root&&e===e.parent.right;)e=e.parent;if(e!==s.root)for(e=e.parent,t=$o(e.left)-e.size_left,n=Qo(e.left)-e.lf_left,e.size_left+=t,e.lf_left+=n;e!==s.root&&(t!==0||n!==0);)e.parent.left===e&&(e.parent.size_left+=t,e.parent.lf_left+=n),e=e.parent}}const ut=65535;function ph(s){let e;return s[s.length-1]<65536?e=new Uint16Array(s.length):e=new Uint32Array(s.length),e.set(s,0),e}class oC{constructor(e,t,n,i,r){this.lineStarts=e,this.cr=t,this.lf=n,this.crlf=i,this.isBasicASCII=r}}function ft(s,e=!0){const t=[0];let n=1;for(let i=0,r=s.length;i<r;i++){const o=s.charCodeAt(i);o===13?i+1<r&&s.charCodeAt(i+1)===10?(t[n++]=i+2,i++):t[n++]=i+1:o===10&&(t[n++]=i+1)}return e?ph(t):t}function aC(s,e){s.length=0,s[0]=0;let t=1,n=0,i=0,r=0,o=!0;for(let l=0,u=e.length;l<u;l++){const c=e.charCodeAt(l);c===13?l+1<u&&e.charCodeAt(l+1)===10?(r++,s[t++]=l+2,l++):(n++,s[t++]=l+1):c===10?(i++,s[t++]=l+1):o&&c!==9&&(c<32||c>126)&&(o=!1)}const a=new oC(ph(s),n,i,r,o);return s.length=0,a}class Re{constructor(e,t,n,i,r){this.bufferIndex=e,this.start=t,this.end=n,this.lineFeedCnt=i,this.length=r}}class Zt{constructor(e,t){this.buffer=e,this.lineStarts=t}}class lC{constructor(e,t){this._pieces=[],this._tree=e,this._BOM=t,this._index=0,e.root!==M&&e.iterate(e.root,n=>(n!==M&&this._pieces.push(n.piece),!0))}read(){return this._pieces.length===0?this._index===0?(this._index++,this._BOM):null:this._index>this._pieces.length-1?null:this._index===0?this._BOM+this._tree.getPieceContent(this._pieces[this._index++]):this._tree.getPieceContent(this._pieces[this._index++])}}class uC{constructor(e){this._limit=e,this._cache=[]}get(e){for(let t=this._cache.length-1;t>=0;t--){const n=this._cache[t];if(n.nodeStartOffset<=e&&n.nodeStartOffset+n.node.piece.length>=e)return n}return null}get2(e){for(let t=this._cache.length-1;t>=0;t--){const n=this._cache[t];if(n.nodeStartLineNumber&&n.nodeStartLineNumber<e&&n.nodeStartLineNumber+n.node.piece.lineFeedCnt>=e)return n}return null}set(e){this._cache.length>=this._limit&&this._cache.shift(),this._cache.push(e)}validate(e){let t=!1;const n=this._cache;for(let i=0;i<n.length;i++){const r=n[i];if(r.node.parent===null||r.nodeStartOffset>=e){n[i]=null,t=!0;continue}}if(t){const i=[];for(const r of n)r!==null&&i.push(r);this._cache=i}}}class cC{constructor(e,t,n){this.create(e,t,n)}create(e,t,n){this._buffers=[new Zt("",[0])],this._lastChangeBufferPos={line:0,column:0},this.root=M,this._lineCnt=1,this._length=0,this._EOL=t,this._EOLLength=t.length,this._EOLNormalized=n;let i=null;for(let r=0,o=e.length;r<o;r++)if(e[r].buffer.length>0){e[r].lineStarts||(e[r].lineStarts=ft(e[r].buffer));const a=new Re(r+1,{line:0,column:0},{line:e[r].lineStarts.length-1,column:e[r].buffer.length-e[r].lineStarts[e[r].lineStarts.length-1]},e[r].lineStarts.length-1,e[r].buffer.length);this._buffers.push(e[r]),i=this.rbInsertRight(i,a)}this._searchCache=new uC(1),this._lastVisitedLine={lineNumber:0,value:""},this.computeBufferMetadata()}normalizeEOL(e){const t=ut,n=t-Math.floor(t/3),i=n*2;let r="",o=0;const a=[];if(this.iterate(this.root,l=>{const u=this.getNodeContent(l),c=u.length;if(o<=n||o+c<i)return r+=u,o+=c,!0;const h=r.replace(/\r\n|\r|\n/g,e);return a.push(new Zt(h,ft(h))),r=u,o=c,!0}),o>0){const l=r.replace(/\r\n|\r|\n/g,e);a.push(new Zt(l,ft(l)))}this.create(a,e,!0)}getEOL(){return this._EOL}setEOL(e){this._EOL=e,this._EOLLength=this._EOL.length,this.normalizeEOL(e)}createSnapshot(e){return new lC(this,e)}getOffsetAt(e,t){let n=0,i=this.root;for(;i!==M;)if(i.left!==M&&i.lf_left+1>=e)i=i.left;else if(i.lf_left+i.piece.lineFeedCnt+1>=e){n+=i.size_left;const r=this.getAccumulatedValue(i,e-i.lf_left-2);return n+=r+t-1}else e-=i.lf_left+i.piece.lineFeedCnt,n+=i.size_left+i.piece.length,i=i.right;return n}getPositionAt(e){e=Math.floor(e),e=Math.max(0,e);let t=this.root,n=0;const i=e;for(;t!==M;)if(t.size_left!==0&&t.size_left>=e)t=t.left;else if(t.size_left+t.piece.length>=e){const r=this.getIndexOf(t,e-t.size_left);if(n+=t.lf_left+r.index,r.index===0){const o=this.getOffsetAt(n+1,1),a=i-o;return new I(n+1,a+1)}return new I(n+1,r.remainder+1)}else if(e-=t.size_left+t.piece.length,n+=t.lf_left+t.piece.lineFeedCnt,t.right===M){const r=this.getOffsetAt(n+1,1),o=i-e-r;return new I(n+1,o+1)}else t=t.right;return new I(1,1)}getValueInRange(e,t){if(e.startLineNumber===e.endLineNumber&&e.startColumn===e.endColumn)return"";const n=this.nodeAt2(e.startLineNumber,e.startColumn),i=this.nodeAt2(e.endLineNumber,e.endColumn),r=this.getValueInRange2(n,i);return t?t!==this._EOL||!this._EOLNormalized?r.replace(/\r\n|\r|\n/g,t):t===this.getEOL()&&this._EOLNormalized?r:r.replace(/\r\n|\r|\n/g,t):r}getValueInRange2(e,t){if(e.node===t.node){const a=e.node,l=this._buffers[a.piece.bufferIndex].buffer,u=this.offsetInBuffer(a.piece.bufferIndex,a.piece.start);return l.substring(u+e.remainder,u+t.remainder)}let n=e.node;const i=this._buffers[n.piece.bufferIndex].buffer,r=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);let o=i.substring(r+e.remainder,r+n.piece.length);for(n=n.next();n!==M;){const a=this._buffers[n.piece.bufferIndex].buffer,l=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);if(n===t.node){o+=a.substring(l,l+t.remainder);break}else o+=a.substr(l,n.piece.length);n=n.next()}return o}getLinesContent(){const e=[];let t=0,n="",i=!1;return this.iterate(this.root,r=>{if(r===M)return!0;const o=r.piece;let a=o.length;if(a===0)return!0;const l=this._buffers[o.bufferIndex].buffer,u=this._buffers[o.bufferIndex].lineStarts,c=o.start.line,h=o.end.line;let d=u[c]+o.start.column;if(i&&(l.charCodeAt(d)===10&&(d++,a--),e[t++]=n,n="",i=!1,a===0))return!0;if(c===h)return!this._EOLNormalized&&l.charCodeAt(d+a-1)===13?(i=!0,n+=l.substr(d,a-1)):n+=l.substr(d,a),!0;n+=this._EOLNormalized?l.substring(d,Math.max(d,u[c+1]-this._EOLLength)):l.substring(d,u[c+1]).replace(/(\r\n|\r|\n)$/,""),e[t++]=n;for(let f=c+1;f<h;f++)n=this._EOLNormalized?l.substring(u[f],u[f+1]-this._EOLLength):l.substring(u[f],u[f+1]).replace(/(\r\n|\r|\n)$/,""),e[t++]=n;return!this._EOLNormalized&&l.charCodeAt(u[h]+o.end.column-1)===13?(i=!0,o.end.column===0?t--:n=l.substr(u[h],o.end.column-1)):n=l.substr(u[h],o.end.column),!0}),i&&(e[t++]=n,n=""),e[t++]=n,e}getLength(){return this._length}getLineCount(){return this._lineCnt}getLineContent(e){return this._lastVisitedLine.lineNumber===e?this._lastVisitedLine.value:(this._lastVisitedLine.lineNumber=e,e===this._lineCnt?this._lastVisitedLine.value=this.getLineRawContent(e):this._EOLNormalized?this._lastVisitedLine.value=this.getLineRawContent(e,this._EOLLength):this._lastVisitedLine.value=this.getLineRawContent(e).replace(/(\r\n|\r|\n)$/,""),this._lastVisitedLine.value)}_getCharCode(e){if(e.remainder===e.node.piece.length){const t=e.node.next();if(!t)return 0;const n=this._buffers[t.piece.bufferIndex],i=this.offsetInBuffer(t.piece.bufferIndex,t.piece.start);return n.buffer.charCodeAt(i)}else{const t=this._buffers[e.node.piece.bufferIndex],i=this.offsetInBuffer(e.node.piece.bufferIndex,e.node.piece.start)+e.remainder;return t.buffer.charCodeAt(i)}}getLineCharCode(e,t){const n=this.nodeAt2(e,t+1);return this._getCharCode(n)}getLineLength(e){if(e===this.getLineCount()){const t=this.getOffsetAt(e,1);return this.getLength()-t}return this.getOffsetAt(e+1,1)-this.getOffsetAt(e,1)-this._EOLLength}findMatchesInNode(e,t,n,i,r,o,a,l,u,c,h){const d=this._buffers[e.piece.bufferIndex],f=this.offsetInBuffer(e.piece.bufferIndex,e.piece.start),m=this.offsetInBuffer(e.piece.bufferIndex,r),p=this.offsetInBuffer(e.piece.bufferIndex,o);let C;const b={line:0,column:0};let L,_;t._wordSeparators?(L=d.buffer.substring(m,p),_=k=>k+m,t.reset(0)):(L=d.buffer,_=k=>k,t.reset(m));do if(C=t.next(L),C){if(_(C.index)>=p)return c;this.positionInBuffer(e,_(C.index)-f,b);const k=this.getLineFeedCnt(e.piece.bufferIndex,r,b),S=b.line===r.line?b.column-r.column+i:b.column+1,N=S+C[0].length;if(h[c++]=$t(new w(n+k,S,n+k,N),C,l),_(C.index)+C[0].length>=p||c>=u)return c}while(C);return c}findMatchesLineByLine(e,t,n,i){const r=[];let o=0;const a=new wn(t.wordSeparators,t.regex);let l=this.nodeAt2(e.startLineNumber,e.startColumn);if(l===null)return[];const u=this.nodeAt2(e.endLineNumber,e.endColumn);if(u===null)return[];let c=this.positionInBuffer(l.node,l.remainder);const h=this.positionInBuffer(u.node,u.remainder);if(l.node===u.node)return this.findMatchesInNode(l.node,a,e.startLineNumber,e.startColumn,c,h,t,n,i,o,r),r;let d=e.startLineNumber,f=l.node;for(;f!==u.node;){const p=this.getLineFeedCnt(f.piece.bufferIndex,c,f.piece.end);if(p>=1){const b=this._buffers[f.piece.bufferIndex].lineStarts,L=this.offsetInBuffer(f.piece.bufferIndex,f.piece.start),_=b[c.line+p],k=d===e.startLineNumber?e.startColumn:1;if(o=this.findMatchesInNode(f,a,d,k,c,this.positionInBuffer(f,_-L),t,n,i,o,r),o>=i)return r;d+=p}const C=d===e.startLineNumber?e.startColumn-1:0;if(d===e.endLineNumber){const b=this.getLineContent(d).substring(C,e.endColumn-1);return o=this._findMatchesInLine(t,a,b,e.endLineNumber,C,o,r,n,i),r}if(o=this._findMatchesInLine(t,a,this.getLineContent(d).substr(C),d,C,o,r,n,i),o>=i)return r;d++,l=this.nodeAt2(d,1),f=l.node,c=this.positionInBuffer(l.node,l.remainder)}if(d===e.endLineNumber){const p=d===e.startLineNumber?e.startColumn-1:0,C=this.getLineContent(d).substring(p,e.endColumn-1);return o=this._findMatchesInLine(t,a,C,e.endLineNumber,p,o,r,n,i),r}const m=d===e.startLineNumber?e.startColumn:1;return o=this.findMatchesInNode(u.node,a,d,m,c,h,t,n,i,o,r),r}_findMatchesInLine(e,t,n,i,r,o,a,l,u){const c=e.wordSeparators;if(!l&&e.simpleSearch){const d=e.simpleSearch,f=d.length,m=n.length;let p=-f;for(;(p=n.indexOf(d,p+f))!==-1;)if((!c||Bo(c,n,m,p,f))&&(a[o++]=new Ns(new w(i,p+1+r,i,p+1+f+r),null),o>=u))return o;return o}let h;t.reset(0);do if(h=t.next(n),h&&(a[o++]=$t(new w(i,h.index+1+r,i,h.index+1+h[0].length+r),h,l),o>=u))return o;while(h);return o}insert(e,t,n=!1){if(this._EOLNormalized=this._EOLNormalized&&n,this._lastVisitedLine.lineNumber=0,this._lastVisitedLine.value="",this.root!==M){const{node:i,remainder:r,nodeStartOffset:o}=this.nodeAt(e),a=i.piece,l=a.bufferIndex,u=this.positionInBuffer(i,r);if(i.piece.bufferIndex===0&&a.end.line===this._lastChangeBufferPos.line&&a.end.column===this._lastChangeBufferPos.column&&o+a.length===e&&t.length<ut){this.appendToNode(i,t),this.computeBufferMetadata();return}if(o===e)this.insertContentToNodeLeft(t,i),this._searchCache.validate(e);else if(o+i.piece.length>e){const c=[];let h=new Re(a.bufferIndex,u,a.end,this.getLineFeedCnt(a.bufferIndex,u,a.end),this.offsetInBuffer(l,a.end)-this.offsetInBuffer(l,u));if(this.shouldCheckCRLF()&&this.endWithCR(t)&&this.nodeCharCodeAt(i,r)===10){const p={line:h.start.line+1,column:0};h=new Re(h.bufferIndex,p,h.end,this.getLineFeedCnt(h.bufferIndex,p,h.end),h.length-1),t+=`
`}if(this.shouldCheckCRLF()&&this.startWithLF(t))if(this.nodeCharCodeAt(i,r-1)===13){const p=this.positionInBuffer(i,r-1);this.deleteNodeTail(i,p),t="\r"+t,i.piece.length===0&&c.push(i)}else this.deleteNodeTail(i,u);else this.deleteNodeTail(i,u);const d=this.createNewPieces(t);h.length>0&&this.rbInsertRight(i,h);let f=i;for(let m=0;m<d.length;m++)f=this.rbInsertRight(f,d[m]);this.deleteNodes(c)}else this.insertContentToNodeRight(t,i)}else{const i=this.createNewPieces(t);let r=this.rbInsertLeft(null,i[0]);for(let o=1;o<i.length;o++)r=this.rbInsertRight(r,i[o])}this.computeBufferMetadata()}delete(e,t){if(this._lastVisitedLine.lineNumber=0,this._lastVisitedLine.value="",t<=0||this.root===M)return;const n=this.nodeAt(e),i=this.nodeAt(e+t),r=n.node,o=i.node;if(r===o){const d=this.positionInBuffer(r,n.remainder),f=this.positionInBuffer(r,i.remainder);if(n.nodeStartOffset===e){if(t===r.piece.length){const m=r.next();es(this,r),this.validateCRLFWithPrevNode(m),this.computeBufferMetadata();return}this.deleteNodeHead(r,f),this._searchCache.validate(e),this.validateCRLFWithPrevNode(r),this.computeBufferMetadata();return}if(n.nodeStartOffset+r.piece.length===e+t){this.deleteNodeTail(r,d),this.validateCRLFWithNextNode(r),this.computeBufferMetadata();return}this.shrinkNode(r,d,f),this.computeBufferMetadata();return}const a=[],l=this.positionInBuffer(r,n.remainder);this.deleteNodeTail(r,l),this._searchCache.validate(e),r.piece.length===0&&a.push(r);const u=this.positionInBuffer(o,i.remainder);this.deleteNodeHead(o,u),o.piece.length===0&&a.push(o);const c=r.next();for(let d=c;d!==M&&d!==o;d=d.next())a.push(d);const h=r.piece.length===0?r.prev():r;this.deleteNodes(a),this.validateCRLFWithNextNode(h),this.computeBufferMetadata()}insertContentToNodeLeft(e,t){const n=[];if(this.shouldCheckCRLF()&&this.endWithCR(e)&&this.startWithLF(t)){const o=t.piece,a={line:o.start.line+1,column:0},l=new Re(o.bufferIndex,a,o.end,this.getLineFeedCnt(o.bufferIndex,a,o.end),o.length-1);t.piece=l,e+=`
`,ht(this,t,-1,-1),t.piece.length===0&&n.push(t)}const i=this.createNewPieces(e);let r=this.rbInsertLeft(t,i[i.length-1]);for(let o=i.length-2;o>=0;o--)r=this.rbInsertLeft(r,i[o]);this.validateCRLFWithPrevNode(r),this.deleteNodes(n)}insertContentToNodeRight(e,t){this.adjustCarriageReturnFromNext(e,t)&&(e+=`
`);const n=this.createNewPieces(e),i=this.rbInsertRight(t,n[0]);let r=i;for(let o=1;o<n.length;o++)r=this.rbInsertRight(r,n[o]);this.validateCRLFWithPrevNode(i)}positionInBuffer(e,t,n){const i=e.piece,r=e.piece.bufferIndex,o=this._buffers[r].lineStarts,l=o[i.start.line]+i.start.column+t;let u=i.start.line,c=i.end.line,h=0,d=0,f=0;for(;u<=c&&(h=u+(c-u)/2|0,f=o[h],h!==c);)if(d=o[h+1],l<f)c=h-1;else if(l>=d)u=h+1;else break;return n?(n.line=h,n.column=l-f,null):{line:h,column:l-f}}getLineFeedCnt(e,t,n){if(n.column===0)return n.line-t.line;const i=this._buffers[e].lineStarts;if(n.line===i.length-1)return n.line-t.line;const r=i[n.line+1],o=i[n.line]+n.column;if(r>o+1)return n.line-t.line;const a=o-1;return this._buffers[e].buffer.charCodeAt(a)===13?n.line-t.line+1:n.line-t.line}offsetInBuffer(e,t){return this._buffers[e].lineStarts[t.line]+t.column}deleteNodes(e){for(let t=0;t<e.length;t++)es(this,e[t])}createNewPieces(e){if(e.length>ut){const c=[];for(;e.length>ut;){const d=e.charCodeAt(ut-1);let f;d===13||d>=55296&&d<=56319?(f=e.substring(0,ut-1),e=e.substring(ut-1)):(f=e.substring(0,ut),e=e.substring(ut));const m=ft(f);c.push(new Re(this._buffers.length,{line:0,column:0},{line:m.length-1,column:f.length-m[m.length-1]},m.length-1,f.length)),this._buffers.push(new Zt(f,m))}const h=ft(e);return c.push(new Re(this._buffers.length,{line:0,column:0},{line:h.length-1,column:e.length-h[h.length-1]},h.length-1,e.length)),this._buffers.push(new Zt(e,h)),c}let t=this._buffers[0].buffer.length;const n=ft(e,!1);let i=this._lastChangeBufferPos;if(this._buffers[0].lineStarts[this._buffers[0].lineStarts.length-1]===t&&t!==0&&this.startWithLF(e)&&this.endWithCR(this._buffers[0].buffer)){this._lastChangeBufferPos={line:this._lastChangeBufferPos.line,column:this._lastChangeBufferPos.column+1},i=this._lastChangeBufferPos;for(let c=0;c<n.length;c++)n[c]+=t+1;this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(n.slice(1)),this._buffers[0].buffer+="_"+e,t+=1}else{if(t!==0)for(let c=0;c<n.length;c++)n[c]+=t;this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(n.slice(1)),this._buffers[0].buffer+=e}const r=this._buffers[0].buffer.length,o=this._buffers[0].lineStarts.length-1,a=r-this._buffers[0].lineStarts[o],l={line:o,column:a},u=new Re(0,i,l,this.getLineFeedCnt(0,i,l),r-t);return this._lastChangeBufferPos=l,[u]}getLineRawContent(e,t=0){let n=this.root,i="";const r=this._searchCache.get2(e);if(r){n=r.node;const o=this.getAccumulatedValue(n,e-r.nodeStartLineNumber-1),a=this._buffers[n.piece.bufferIndex].buffer,l=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);if(r.nodeStartLineNumber+n.piece.lineFeedCnt===e)i=a.substring(l+o,l+n.piece.length);else{const u=this.getAccumulatedValue(n,e-r.nodeStartLineNumber);return a.substring(l+o,l+u-t)}}else{let o=0;const a=e;for(;n!==M;)if(n.left!==M&&n.lf_left>=e-1)n=n.left;else if(n.lf_left+n.piece.lineFeedCnt>e-1){const l=this.getAccumulatedValue(n,e-n.lf_left-2),u=this.getAccumulatedValue(n,e-n.lf_left-1),c=this._buffers[n.piece.bufferIndex].buffer,h=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);return o+=n.size_left,this._searchCache.set({node:n,nodeStartOffset:o,nodeStartLineNumber:a-(e-1-n.lf_left)}),c.substring(h+l,h+u-t)}else if(n.lf_left+n.piece.lineFeedCnt===e-1){const l=this.getAccumulatedValue(n,e-n.lf_left-2),u=this._buffers[n.piece.bufferIndex].buffer,c=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);i=u.substring(c+l,c+n.piece.length);break}else e-=n.lf_left+n.piece.lineFeedCnt,o+=n.size_left+n.piece.length,n=n.right}for(n=n.next();n!==M;){const o=this._buffers[n.piece.bufferIndex].buffer;if(n.piece.lineFeedCnt>0){const a=this.getAccumulatedValue(n,0),l=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);return i+=o.substring(l,l+a-t),i}else{const a=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);i+=o.substr(a,n.piece.length)}n=n.next()}return i}computeBufferMetadata(){let e=this.root,t=1,n=0;for(;e!==M;)t+=e.lf_left+e.piece.lineFeedCnt,n+=e.size_left+e.piece.length,e=e.right;this._lineCnt=t,this._length=n,this._searchCache.validate(this._length)}getIndexOf(e,t){const n=e.piece,i=this.positionInBuffer(e,t),r=i.line-n.start.line;if(this.offsetInBuffer(n.bufferIndex,n.end)-this.offsetInBuffer(n.bufferIndex,n.start)===t){const o=this.getLineFeedCnt(e.piece.bufferIndex,n.start,i);if(o!==r)return{index:o,remainder:0}}return{index:r,remainder:i.column}}getAccumulatedValue(e,t){if(t<0)return 0;const n=e.piece,i=this._buffers[n.bufferIndex].lineStarts,r=n.start.line+t+1;return r>n.end.line?i[n.end.line]+n.end.column-i[n.start.line]-n.start.column:i[r]-i[n.start.line]-n.start.column}deleteNodeTail(e,t){const n=e.piece,i=n.lineFeedCnt,r=this.offsetInBuffer(n.bufferIndex,n.end),o=t,a=this.offsetInBuffer(n.bufferIndex,o),l=this.getLineFeedCnt(n.bufferIndex,n.start,o),u=l-i,c=a-r,h=n.length+c;e.piece=new Re(n.bufferIndex,n.start,o,l,h),ht(this,e,c,u)}deleteNodeHead(e,t){const n=e.piece,i=n.lineFeedCnt,r=this.offsetInBuffer(n.bufferIndex,n.start),o=t,a=this.getLineFeedCnt(n.bufferIndex,o,n.end),l=this.offsetInBuffer(n.bufferIndex,o),u=a-i,c=r-l,h=n.length+c;e.piece=new Re(n.bufferIndex,o,n.end,a,h),ht(this,e,c,u)}shrinkNode(e,t,n){const i=e.piece,r=i.start,o=i.end,a=i.length,l=i.lineFeedCnt,u=t,c=this.getLineFeedCnt(i.bufferIndex,i.start,u),h=this.offsetInBuffer(i.bufferIndex,t)-this.offsetInBuffer(i.bufferIndex,r);e.piece=new Re(i.bufferIndex,i.start,u,c,h),ht(this,e,h-a,c-l);const d=new Re(i.bufferIndex,n,o,this.getLineFeedCnt(i.bufferIndex,n,o),this.offsetInBuffer(i.bufferIndex,o)-this.offsetInBuffer(i.bufferIndex,n)),f=this.rbInsertRight(e,d);this.validateCRLFWithPrevNode(f)}appendToNode(e,t){this.adjustCarriageReturnFromNext(t,e)&&(t+=`
`);const n=this.shouldCheckCRLF()&&this.startWithLF(t)&&this.endWithCR(e),i=this._buffers[0].buffer.length;this._buffers[0].buffer+=t;const r=ft(t,!1);for(let f=0;f<r.length;f++)r[f]+=i;if(n){const f=this._buffers[0].lineStarts[this._buffers[0].lineStarts.length-2];this._buffers[0].lineStarts.pop(),this._lastChangeBufferPos={line:this._lastChangeBufferPos.line-1,column:i-f}}this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(r.slice(1));const o=this._buffers[0].lineStarts.length-1,a=this._buffers[0].buffer.length-this._buffers[0].lineStarts[o],l={line:o,column:a},u=e.piece.length+t.length,c=e.piece.lineFeedCnt,h=this.getLineFeedCnt(0,e.piece.start,l),d=h-c;e.piece=new Re(e.piece.bufferIndex,e.piece.start,l,h,u),this._lastChangeBufferPos=l,ht(this,e,t.length,d)}nodeAt(e){let t=this.root;const n=this._searchCache.get(e);if(n)return{node:n.node,nodeStartOffset:n.nodeStartOffset,remainder:e-n.nodeStartOffset};let i=0;for(;t!==M;)if(t.size_left>e)t=t.left;else if(t.size_left+t.piece.length>=e){i+=t.size_left;const r={node:t,remainder:e-t.size_left,nodeStartOffset:i};return this._searchCache.set(r),r}else e-=t.size_left+t.piece.length,i+=t.size_left+t.piece.length,t=t.right;return null}nodeAt2(e,t){let n=this.root,i=0;for(;n!==M;)if(n.left!==M&&n.lf_left>=e-1)n=n.left;else if(n.lf_left+n.piece.lineFeedCnt>e-1){const r=this.getAccumulatedValue(n,e-n.lf_left-2),o=this.getAccumulatedValue(n,e-n.lf_left-1);return i+=n.size_left,{node:n,remainder:Math.min(r+t-1,o),nodeStartOffset:i}}else if(n.lf_left+n.piece.lineFeedCnt===e-1){const r=this.getAccumulatedValue(n,e-n.lf_left-2);if(r+t-1<=n.piece.length)return{node:n,remainder:r+t-1,nodeStartOffset:i};t-=n.piece.length-r;break}else e-=n.lf_left+n.piece.lineFeedCnt,i+=n.size_left+n.piece.length,n=n.right;for(n=n.next();n!==M;){if(n.piece.lineFeedCnt>0){const r=this.getAccumulatedValue(n,0),o=this.offsetOfNode(n);return{node:n,remainder:Math.min(t-1,r),nodeStartOffset:o}}else if(n.piece.length>=t-1){const r=this.offsetOfNode(n);return{node:n,remainder:t-1,nodeStartOffset:r}}else t-=n.piece.length;n=n.next()}return null}nodeCharCodeAt(e,t){if(e.piece.lineFeedCnt<1)return-1;const n=this._buffers[e.piece.bufferIndex],i=this.offsetInBuffer(e.piece.bufferIndex,e.piece.start)+t;return n.buffer.charCodeAt(i)}offsetOfNode(e){if(!e)return 0;let t=e.size_left;for(;e!==this.root;)e.parent.right===e&&(t+=e.parent.size_left+e.parent.piece.length),e=e.parent;return t}shouldCheckCRLF(){return!(this._EOLNormalized&&this._EOL===`
`)}startWithLF(e){if(typeof e=="string")return e.charCodeAt(0)===10;if(e===M||e.piece.lineFeedCnt===0)return!1;const t=e.piece,n=this._buffers[t.bufferIndex].lineStarts,i=t.start.line,r=n[i]+t.start.column;return i===n.length-1||n[i+1]>r+1?!1:this._buffers[t.bufferIndex].buffer.charCodeAt(r)===10}endWithCR(e){return typeof e=="string"?e.charCodeAt(e.length-1)===13:e===M||e.piece.lineFeedCnt===0?!1:this.nodeCharCodeAt(e,e.piece.length-1)===13}validateCRLFWithPrevNode(e){if(this.shouldCheckCRLF()&&this.startWithLF(e)){const t=e.prev();this.endWithCR(t)&&this.fixCRLF(t,e)}}validateCRLFWithNextNode(e){if(this.shouldCheckCRLF()&&this.endWithCR(e)){const t=e.next();this.startWithLF(t)&&this.fixCRLF(e,t)}}fixCRLF(e,t){const n=[],i=this._buffers[e.piece.bufferIndex].lineStarts;let r;e.piece.end.column===0?r={line:e.piece.end.line-1,column:i[e.piece.end.line]-i[e.piece.end.line-1]-1}:r={line:e.piece.end.line,column:e.piece.end.column-1};const o=e.piece.length-1,a=e.piece.lineFeedCnt-1;e.piece=new Re(e.piece.bufferIndex,e.piece.start,r,a,o),ht(this,e,-1,-1),e.piece.length===0&&n.push(e);const l={line:t.piece.start.line+1,column:0},u=t.piece.length-1,c=this.getLineFeedCnt(t.piece.bufferIndex,l,t.piece.end);t.piece=new Re(t.piece.bufferIndex,l,t.piece.end,c,u),ht(this,t,-1,-1),t.piece.length===0&&n.push(t);const h=this.createNewPieces(`\r
`);this.rbInsertRight(e,h[0]);for(let d=0;d<n.length;d++)es(this,n[d])}adjustCarriageReturnFromNext(e,t){if(this.shouldCheckCRLF()&&this.endWithCR(e)){const n=t.next();if(this.startWithLF(n)){if(e+=`
`,n.piece.length===1)es(this,n);else{const i=n.piece,r={line:i.start.line+1,column:0},o=i.length-1,a=this.getLineFeedCnt(i.bufferIndex,r,i.end);n.piece=new Re(i.bufferIndex,r,i.end,a,o),ht(this,n,-1,-1)}return!0}}return!1}iterate(e,t){if(e===M)return t(M);const n=this.iterate(e.left,t);return n&&t(e)&&this.iterate(e.right,t)}getNodeContent(e){if(e===M)return"";const t=this._buffers[e.piece.bufferIndex],n=e.piece,i=this.offsetInBuffer(n.bufferIndex,n.start),r=this.offsetInBuffer(n.bufferIndex,n.end);return t.buffer.substring(i,r)}getPieceContent(e){const t=this._buffers[e.bufferIndex],n=this.offsetInBuffer(e.bufferIndex,e.start),i=this.offsetInBuffer(e.bufferIndex,e.end);return t.buffer.substring(n,i)}rbInsertRight(e,t){const n=new mo(t,1);if(n.left=M,n.right=M,n.parent=M,n.size_left=0,n.lf_left=0,this.root===M)this.root=n,n.color=0;else if(e.right===M)e.right=n,n.parent=e;else{const r=Go(e.right);r.left=n,n.parent=r}return Mu(this,n),n}rbInsertLeft(e,t){const n=new mo(t,1);if(n.left=M,n.right=M,n.parent=M,n.size_left=0,n.lf_left=0,this.root===M)this.root=n,n.color=0;else if(e.left===M)e.left=n,n.parent=e;else{const i=mh(e.left);i.right=n,n.parent=i}return Mu(this,n),n}}class Rn extends oe{constructor(e,t,n,i,r,o,a){super(),this._onDidChangeContent=this._register(new J),this._BOM=t,this._mightContainNonBasicASCII=!o,this._mightContainRTL=i,this._mightContainUnusualLineTerminators=r,this._pieceTree=new cC(e,n,a)}mightContainRTL(){return this._mightContainRTL}mightContainUnusualLineTerminators(){return this._mightContainUnusualLineTerminators}resetMightContainUnusualLineTerminators(){this._mightContainUnusualLineTerminators=!1}mightContainNonBasicASCII(){return this._mightContainNonBasicASCII}getBOM(){return this._BOM}getEOL(){return this._pieceTree.getEOL()}createSnapshot(e){return this._pieceTree.createSnapshot(e?this._BOM:"")}getOffsetAt(e,t){return this._pieceTree.getOffsetAt(e,t)}getPositionAt(e){return this._pieceTree.getPositionAt(e)}getRangeAt(e,t){const n=e+t,i=this.getPositionAt(e),r=this.getPositionAt(n);return new w(i.lineNumber,i.column,r.lineNumber,r.column)}getValueInRange(e,t=0){if(e.isEmpty())return"";const n=this._getEndOfLine(t);return this._pieceTree.getValueInRange(e,n)}getValueLengthInRange(e,t=0){if(e.isEmpty())return 0;if(e.startLineNumber===e.endLineNumber)return e.endColumn-e.startColumn;const n=this.getOffsetAt(e.startLineNumber,e.startColumn),i=this.getOffsetAt(e.endLineNumber,e.endColumn);let r=0;const o=this._getEndOfLine(t),a=this.getEOL();if(o.length!==a.length){const l=o.length-a.length,u=e.endLineNumber-e.startLineNumber;r=l*u}return i-n+r}getCharacterCountInRange(e,t=0){if(this._mightContainNonBasicASCII){let n=0;const i=e.startLineNumber,r=e.endLineNumber;for(let o=i;o<=r;o++){const a=this.getLineContent(o),l=o===i?e.startColumn-1:0,u=o===r?e.endColumn-1:a.length;for(let c=l;c<u;c++)Ne(a.charCodeAt(c))?(n=n+1,c=c+1):n=n+1}return n+=this._getEndOfLine(t).length*(r-i),n}return this.getValueLengthInRange(e,t)}getLength(){return this._pieceTree.getLength()}getLineCount(){return this._pieceTree.getLineCount()}getLinesContent(){return this._pieceTree.getLinesContent()}getLineContent(e){return this._pieceTree.getLineContent(e)}getLineCharCode(e,t){return this._pieceTree.getLineCharCode(e,t)}getLineLength(e){return this._pieceTree.getLineLength(e)}getLineFirstNonWhitespaceColumn(e){const t=Ve(this.getLineContent(e));return t===-1?0:t+1}getLineLastNonWhitespaceColumn(e){const t=on(this.getLineContent(e));return t===-1?0:t+2}_getEndOfLine(e){switch(e){case 1:return`
`;case 2:return`\r
`;case 0:return this.getEOL();default:throw new Error("Unknown EOL preference")}}setEOL(e){this._pieceTree.setEOL(e)}applyEdits(e,t,n){let i=this._mightContainRTL,r=this._mightContainUnusualLineTerminators,o=this._mightContainNonBasicASCII,a=!0,l=[];for(let p=0;p<e.length;p++){const C=e[p];a&&C._isTracked&&(a=!1);const b=C.range;if(C.text){let N=!0;o||(N=!yo(C.text),o=N),!i&&N&&(i=vi(C.text)),!r&&N&&(r=mc(C.text))}let L="",_=0,k=0,S=0;if(C.text){let N;[_,k,S,N]=sn(C.text);const x=this.getEOL();N===0||N===(x===`\r
`?2:1)?L=C.text:L=C.text.replace(/\r\n|\r|\n/g,x)}l[p]={sortIndex:p,identifier:C.identifier||null,range:b,rangeOffset:this.getOffsetAt(b.startLineNumber,b.startColumn),rangeLength:this.getValueLengthInRange(b),text:L,eolCount:_,firstLineLength:k,lastLineLength:S,forceMoveMarkers:!!C.forceMoveMarkers,isAutoWhitespaceEdit:C.isAutoWhitespaceEdit||!1}}l.sort(Rn._sortOpsAscending);let u=!1;for(let p=0,C=l.length-1;p<C;p++){const b=l[p].range.getEndPosition(),L=l[p+1].range.getStartPosition();if(L.isBeforeOrEqual(b)){if(L.isBefore(b))throw new Error("Overlapping ranges are not allowed!");u=!0}}a&&(l=this._reduceOperations(l));const c=n||t?Rn._getInverseEditRanges(l):[],h=[];if(t)for(let p=0;p<l.length;p++){const C=l[p],b=c[p];if(C.isAutoWhitespaceEdit&&C.range.isEmpty())for(let L=b.startLineNumber;L<=b.endLineNumber;L++){let _="";L===b.startLineNumber&&(_=this.getLineContent(C.range.startLineNumber),Ve(_)!==-1)||h.push({lineNumber:L,oldContent:_})}}let d=null;if(n){let p=0;d=[];for(let C=0;C<l.length;C++){const b=l[C],L=c[C],_=this.getValueInRange(b.range),k=b.rangeOffset+p;p+=b.text.length-_.length,d[C]={sortIndex:b.sortIndex,identifier:b.identifier,range:L,text:_,textChange:new we(b.rangeOffset,_,k,b.text)}}u||d.sort((C,b)=>C.sortIndex-b.sortIndex)}this._mightContainRTL=i,this._mightContainUnusualLineTerminators=r,this._mightContainNonBasicASCII=o;const f=this._doApplyEdits(l);let m=null;if(t&&h.length>0){h.sort((p,C)=>C.lineNumber-p.lineNumber),m=[];for(let p=0,C=h.length;p<C;p++){const b=h[p].lineNumber;if(p>0&&h[p-1].lineNumber===b)continue;const L=h[p].oldContent,_=this.getLineContent(b);_.length===0||_===L||Ve(_)!==-1||m.push(b)}}return this._onDidChangeContent.fire(),new Pg(d,f,m)}_reduceOperations(e){return e.length<1e3?e:[this._toSingleEditOperation(e)]}_toSingleEditOperation(e){let t=!1;const n=e[0].range,i=e[e.length-1].range,r=new w(n.startLineNumber,n.startColumn,i.endLineNumber,i.endColumn);let o=n.startLineNumber,a=n.startColumn;const l=[];for(let f=0,m=e.length;f<m;f++){const p=e[f],C=p.range;t=t||p.forceMoveMarkers,l.push(this.getValueInRange(new w(o,a,C.startLineNumber,C.startColumn))),p.text.length>0&&l.push(p.text),o=C.endLineNumber,a=C.endColumn}const u=l.join(""),[c,h,d]=sn(u);return{sortIndex:0,identifier:e[0].identifier,range:r,rangeOffset:this.getOffsetAt(r.startLineNumber,r.startColumn),rangeLength:this.getValueLengthInRange(r,0),text:u,eolCount:c,firstLineLength:h,lastLineLength:d,forceMoveMarkers:t,isAutoWhitespaceEdit:!1}}_doApplyEdits(e){e.sort(Rn._sortOpsDescending);const t=[];for(let n=0;n<e.length;n++){const i=e[n],r=i.range.startLineNumber,o=i.range.startColumn,a=i.range.endLineNumber,l=i.range.endColumn;if(r===a&&o===l&&i.text.length===0)continue;i.text?(this._pieceTree.delete(i.rangeOffset,i.rangeLength),this._pieceTree.insert(i.rangeOffset,i.text,!0)):this._pieceTree.delete(i.rangeOffset,i.rangeLength);const u=new w(r,o,a,l);t.push({range:u,rangeLength:i.rangeLength,text:i.text,rangeOffset:i.rangeOffset,forceMoveMarkers:i.forceMoveMarkers})}return t}findMatchesLineByLine(e,t,n,i){return this._pieceTree.findMatchesLineByLine(e,t,n,i)}static _getInverseEditRanges(e){const t=[];let n=0,i=0,r=null;for(let o=0,a=e.length;o<a;o++){const l=e[o];let u,c;r?r.range.endLineNumber===l.range.startLineNumber?(u=n,c=i+(l.range.startColumn-r.range.endColumn)):(u=n+(l.range.startLineNumber-r.range.endLineNumber),c=l.range.startColumn):(u=l.range.startLineNumber,c=l.range.startColumn);let h;if(l.text.length>0){const d=l.eolCount+1;d===1?h=new w(u,c,u,c+l.firstLineLength):h=new w(u,c,u+d-1,l.lastLineLength+1)}else h=new w(u,c,u,c);n=h.endLineNumber,i=h.endColumn,t.push(h),r=l}return t}static _sortOpsAscending(e,t){const n=w.compareRangesUsingEnds(e.range,t.range);return n===0?e.sortIndex-t.sortIndex:n}static _sortOpsDescending(e,t){const n=w.compareRangesUsingEnds(e.range,t.range);return n===0?t.sortIndex-e.sortIndex:-n}}class hC{constructor(e,t,n,i,r,o,a,l,u){this._chunks=e,this._bom=t,this._cr=n,this._lf=i,this._crlf=r,this._containsRTL=o,this._containsUnusualLineTerminators=a,this._isBasicASCII=l,this._normalizeEOL=u}_getEOL(e){const t=this._cr+this._lf+this._crlf,n=this._cr+this._crlf;return t===0?e===1?`
`:`\r
`:n>t/2?`\r
`:`
`}create(e){const t=this._getEOL(e),n=this._chunks;if(this._normalizeEOL&&(t===`\r
`&&(this._cr>0||this._lf>0)||t===`
`&&(this._cr>0||this._crlf>0)))for(let r=0,o=n.length;r<o;r++){const a=n[r].buffer.replace(/\r\n|\r|\n/g,t),l=ft(a);n[r]=new Zt(a,l)}const i=new Rn(n,this._bom,t,this._containsRTL,this._containsUnusualLineTerminators,this._isBasicASCII,this._normalizeEOL);return{textBuffer:i,disposable:i}}}class Ch{constructor(){this.chunks=[],this.BOM="",this._hasPreviousChar=!1,this._previousChar=0,this._tmpLineStarts=[],this.cr=0,this.lf=0,this.crlf=0,this.containsRTL=!1,this.containsUnusualLineTerminators=!1,this.isBasicASCII=!0}acceptChunk(e){if(e.length===0)return;this.chunks.length===0&&fc(e)&&(this.BOM=Cd,e=e.substr(1));const t=e.charCodeAt(e.length-1);t===13||t>=55296&&t<=56319?(this._acceptChunk1(e.substr(0,e.length-1),!1),this._hasPreviousChar=!0,this._previousChar=t):(this._acceptChunk1(e,!1),this._hasPreviousChar=!1,this._previousChar=t)}_acceptChunk1(e,t){!t&&e.length===0||(this._hasPreviousChar?this._acceptChunk2(String.fromCharCode(this._previousChar)+e):this._acceptChunk2(e))}_acceptChunk2(e){const t=aC(this._tmpLineStarts,e);this.chunks.push(new Zt(e,t.lineStarts)),this.cr+=t.cr,this.lf+=t.lf,this.crlf+=t.crlf,t.isBasicASCII||(this.isBasicASCII=!1,this.containsRTL||(this.containsRTL=vi(e)),this.containsUnusualLineTerminators||(this.containsUnusualLineTerminators=mc(e)))}finish(e=!0){return this._finish(),new hC(this.chunks,this.BOM,this.cr,this.lf,this.crlf,this.containsRTL,this.containsUnusualLineTerminators,this.isBasicASCII,e)}_finish(){if(this.chunks.length===0&&this._acceptChunk1("",!0),this._hasPreviousChar){this._hasPreviousChar=!1;const e=this.chunks[this.chunks.length-1];e.buffer+=String.fromCharCode(this._previousChar);const t=ft(e.buffer);e.lineStarts=t,this._previousChar===13&&this.cr++}}}class dC{constructor(e){this._default=e,this._store=[]}get(e){return e<this._store.length?this._store[e]:this._default}set(e,t){for(;e>=this._store.length;)this._store[this._store.length]=this._default;this._store[e]=t}replace(e,t,n){if(e>=this._store.length)return;if(t===0){this.insert(e,n);return}else if(n===0){this.delete(e,t);return}const i=this._store.slice(0,e),r=this._store.slice(e+t),o=fC(n,this._default);this._store=i.concat(o,r)}delete(e,t){t===0||e>=this._store.length||this._store.splice(e,t)}insert(e,t){if(t===0||e>=this._store.length)return;const n=[];for(let i=0;i<t;i++)n[i]=this._default;this._store=Ks(this._store,e,n)}}function fC(s,e){const t=[];for(let n=0;n<s;n++)t[n]=e;return t}class gC{get startLineNumber(){return this._startLineNumber}get endLineNumber(){return this._startLineNumber+this._tokens.length-1}constructor(e,t){this._startLineNumber=e,this._tokens=t}getLineTokens(e){return this._tokens[e-this._startLineNumber]}appendLineTokens(e){this._tokens.push(e)}}class po{constructor(){this._tokens=[]}add(e,t){if(this._tokens.length>0){const n=this._tokens[this._tokens.length-1];if(n.endLineNumber+1===e){n.appendLineTokens(t);return}}this._tokens.push(new gC(e,[t]))}finalize(){return this._tokens}}class mC{constructor(e,t){this.tokenizationSupport=t,this.initialState=this.tokenizationSupport.getInitialState(),this.store=new Co(e)}getStartState(e){return this.store.getStartState(e,this.initialState)}getFirstInvalidLine(){return this.store.getFirstInvalidLine(this.initialState)}}class pC extends mC{constructor(e,t,n,i){super(e,t),this._textModel=n,this._languageIdCodec=i}updateTokensUntilLine(e,t){const n=this._textModel.getLanguageId();for(;;){const i=this.getFirstInvalidLine();if(!i||i.lineNumber>t)break;const r=this._textModel.getLineContent(i.lineNumber),o=$n(this._languageIdCodec,n,this.tokenizationSupport,r,!0,i.startState);e.add(i.lineNumber,o.tokens),this.store.setEndState(i.lineNumber,o.endState)}}getTokenTypeIfInsertingCharacter(e,t){const n=this.getStartState(e.lineNumber);if(!n)return 0;const i=this._textModel.getLanguageId(),r=this._textModel.getLineContent(e.lineNumber),o=r.substring(0,e.column-1)+t+r.substring(e.column-1),a=$n(this._languageIdCodec,i,this.tokenizationSupport,o,!0,n),l=new Te(a.tokens,o,this._languageIdCodec);if(l.getCount()===0)return 0;const u=l.findTokenIndexAtOffset(e.column-1);return l.getStandardTokenType(u)}tokenizeLineWithEdit(e,t,n){const i=e.lineNumber,r=e.column,o=this.getStartState(i);if(!o)return null;const a=this._textModel.getLineContent(i),l=a.substring(0,r-1)+n+a.substring(r-1+t),u=this._textModel.getLanguageIdAtPosition(i,0),c=$n(this._languageIdCodec,u,this.tokenizationSupport,l,!0,o);return new Te(c.tokens,l,this._languageIdCodec)}hasAccurateTokensForLine(e){const t=this.store.getFirstInvalidEndStateLineNumberOrMax();return e<t}isCheapToTokenize(e){const t=this.store.getFirstInvalidEndStateLineNumberOrMax();return e<t||e===t&&this._textModel.getLineLength(e)<2048}tokenizeHeuristically(e,t,n){if(n<=this.store.getFirstInvalidEndStateLineNumberOrMax())return{heuristicTokens:!1};if(t<=this.store.getFirstInvalidEndStateLineNumberOrMax())return this.updateTokensUntilLine(e,n),{heuristicTokens:!1};let i=this.guessStartState(t);const r=this._textModel.getLanguageId();for(let o=t;o<=n;o++){const a=this._textModel.getLineContent(o),l=$n(this._languageIdCodec,r,this.tokenizationSupport,a,!0,i);e.add(o,l.tokens),i=l.endState}return{heuristicTokens:!0}}guessStartState(e){let t=this._textModel.getLineFirstNonWhitespaceColumn(e);const n=[];let i=null;for(let a=e-1;t>1&&a>=1;a--){const l=this._textModel.getLineFirstNonWhitespaceColumn(a);if(l!==0&&l<t&&(n.push(this._textModel.getLineContent(a)),t=l,i=this.getStartState(a),i))break}i||(i=this.tokenizationSupport.getInitialState()),n.reverse();const r=this._textModel.getLanguageId();let o=i;for(const a of n)o=$n(this._languageIdCodec,r,this.tokenizationSupport,a,!1,o).endState;return o}}class Co{constructor(e){this.lineCount=e,this._tokenizationStateStore=new CC,this._invalidEndStatesLineNumbers=new bC,this._invalidEndStatesLineNumbers.addRange(new z(1,e+1))}getEndState(e){return this._tokenizationStateStore.getEndState(e)}setEndState(e,t){if(!t)throw new he("Cannot set null/undefined state");this._invalidEndStatesLineNumbers.delete(e);const n=this._tokenizationStateStore.setEndState(e,t);return n&&e<this.lineCount&&this._invalidEndStatesLineNumbers.addRange(new z(e+1,e+2)),n}acceptChange(e,t){this.lineCount+=t-e.length,this._tokenizationStateStore.acceptChange(e,t),this._invalidEndStatesLineNumbers.addRangeAndResize(new z(e.startLineNumber,e.endLineNumberExclusive),t)}acceptChanges(e){for(const t of e){const[n]=sn(t.text);this.acceptChange(new $(t.range.startLineNumber,t.range.endLineNumber+1),n+1)}}invalidateEndStateRange(e){this._invalidEndStatesLineNumbers.addRange(new z(e.startLineNumber,e.endLineNumberExclusive))}getFirstInvalidEndStateLineNumber(){return this._invalidEndStatesLineNumbers.min}getFirstInvalidEndStateLineNumberOrMax(){return this.getFirstInvalidEndStateLineNumber()||Number.MAX_SAFE_INTEGER}allStatesValid(){return this._invalidEndStatesLineNumbers.min===null}getStartState(e,t){return e===1?t:this.getEndState(e-1)}getFirstInvalidLine(e){const t=this.getFirstInvalidEndStateLineNumber();if(t===null)return null;const n=this.getStartState(t,e);if(!n)throw new he("Start state must be defined");return{lineNumber:t,startState:n}}}class CC{constructor(){this._lineEndStates=new dC(null)}getEndState(e){return this._lineEndStates.get(e)}setEndState(e,t){const n=this._lineEndStates.get(e);return n&&n.equals(t)?!1:(this._lineEndStates.set(e,t),!0)}acceptChange(e,t){let n=e.length;t>0&&n>0&&(n--,t--),this._lineEndStates.replace(e.startLineNumber,n,t)}}class bC{constructor(){this._ranges=[]}get min(){return this._ranges.length===0?null:this._ranges[0].start}delete(e){const t=this._ranges.findIndex(n=>n.contains(e));if(t!==-1){const n=this._ranges[t];n.start===e?n.endExclusive===e+1?this._ranges.splice(t,1):this._ranges[t]=new z(e+1,n.endExclusive):n.endExclusive===e+1?this._ranges[t]=new z(n.start,e):this._ranges.splice(t,1,new z(n.start,e),new z(e+1,n.endExclusive))}}addRange(e){z.addRange(e,this._ranges)}addRangeAndResize(e,t){let n=0;for(;!(n>=this._ranges.length||e.start<=this._ranges[n].endExclusive);)n++;let i=n;for(;!(i>=this._ranges.length||e.endExclusive<this._ranges[i].start);)i++;const r=t-e.length;for(let o=i;o<this._ranges.length;o++)this._ranges[o]=this._ranges[o].delta(r);if(n===i){const o=new z(e.start,e.start+t);o.isEmpty||this._ranges.splice(n,0,o)}else{const o=Math.min(e.start,this._ranges[n].start),a=Math.max(e.endExclusive,this._ranges[i-1].endExclusive),l=new z(o,a+r);l.isEmpty?this._ranges.splice(n,i-n):this._ranges.splice(n,i-n,l)}}toString(){return this._ranges.map(e=>e.toString()).join(" + ")}}function $n(s,e,t,n,i,r){let o=null;if(t)try{o=t.tokenizeEncoded(n,i,r.clone())}catch(a){Tt(a)}return o||(o=Qc(s.encodeLanguageId(e),r)),Te.convertToEndOffset(o.tokens,n.length),o}class LC{constructor(e,t){this._tokenizerWithStateStore=e,this._backgroundTokenStore=t,this._isDisposed=!1,this._isScheduled=!1}dispose(){this._isDisposed=!0}handleChanges(){this._beginBackgroundTokenization()}_beginBackgroundTokenization(){this._isScheduled||!this._tokenizerWithStateStore._textModel.isAttachedToEditor()||!this._hasLinesToTokenize()||(this._isScheduled=!0,bd(e=>{this._isScheduled=!1,this._backgroundTokenizeWithDeadline(e)}))}_backgroundTokenizeWithDeadline(e){const t=Date.now()+e.timeRemaining(),n=()=>{this._isDisposed||!this._tokenizerWithStateStore._textModel.isAttachedToEditor()||!this._hasLinesToTokenize()||(this._backgroundTokenizeForAtLeast1ms(),Date.now()<t?Ld(n):this._beginBackgroundTokenization())};n()}_backgroundTokenizeForAtLeast1ms(){const e=this._tokenizerWithStateStore._textModel.getLineCount(),t=new po,n=hc.create(!1);do if(n.elapsed()>1||this._tokenizeOneInvalidLine(t)>=e)break;while(this._hasLinesToTokenize());this._backgroundTokenStore.setTokens(t.finalize()),this.checkFinished()}_hasLinesToTokenize(){return this._tokenizerWithStateStore?!this._tokenizerWithStateStore.store.allStatesValid():!1}_tokenizeOneInvalidLine(e){var n;const t=(n=this._tokenizerWithStateStore)==null?void 0:n.getFirstInvalidLine();return t?(this._tokenizerWithStateStore.updateTokensUntilLine(e,t.lineNumber),t.lineNumber):this._tokenizerWithStateStore._textModel.getLineCount()+1}checkFinished(){this._isDisposed||this._tokenizerWithStateStore.store.allStatesValid()&&this._backgroundTokenStore.backgroundTokenizationFinished()}requestTokens(e,t){this._tokenizerWithStateStore.store.invalidateEndStateRange(new $(e,t))}}class wC{constructor(){this._onDidChangeVisibleRanges=new J,this.onDidChangeVisibleRanges=this._onDidChangeVisibleRanges.event,this._views=new Set}attachView(){const e=new _C(t=>{this._onDidChangeVisibleRanges.fire({view:e,state:t})});return this._views.add(e),e}detachView(e){this._views.delete(e),this._onDidChangeVisibleRanges.fire({view:e,state:void 0})}}class _C{constructor(e){this.handleStateChange=e}setVisibleLines(e,t){const n=e.map(i=>new $(i.startLineNumber,i.endLineNumber+1));this.handleStateChange({visibleLineRanges:n,stabilized:t})}}class SC extends oe{get lineRanges(){return this._lineRanges}constructor(e){super(),this._refreshTokens=e,this.runner=this._register(new pc(()=>this.update(),50)),this._computedLineRanges=[],this._lineRanges=[]}update(){wi(this._computedLineRanges,this._lineRanges,(e,t)=>e.equals(t))||(this._computedLineRanges=this._lineRanges,this._refreshTokens())}handleStateChange(e){this._lineRanges=e.visibleLineRanges,e.stabilized?(this.runner.cancel(),this.update()):this.runner.schedule()}}class bh extends oe{get backgroundTokenizationState(){return this._backgroundTokenizationState}constructor(e,t,n){super(),this._languageIdCodec=e,this._textModel=t,this.getLanguageId=n,this._backgroundTokenizationState=1,this._onDidChangeBackgroundTokenizationState=this._register(new J),this.onDidChangeBackgroundTokenizationState=this._onDidChangeBackgroundTokenizationState.event,this._onDidChangeTokens=this._register(new J),this.onDidChangeTokens=this._onDidChangeTokens.event}tokenizeIfCheap(e){this.isCheapToTokenize(e)&&this.forceTokenization(e)}}class Pu extends bh{constructor(e,t,n,i){super(t,n,i),this._treeSitterService=e,this._tokenizationSupport=null,this._initialize()}_initialize(){const e=this.getLanguageId();(!this._tokenizationSupport||this._lastLanguageId!==e)&&(this._lastLanguageId=e,this._tokenizationSupport=qr.get(e))}getLineTokens(e){const t=this._textModel.getLineContent(e);if(this._tokenizationSupport){const n=this._tokenizationSupport.tokenizeEncoded(e,this._textModel);if(n)return new Te(n,t,this._languageIdCodec)}return Te.createEmpty(t,this._languageIdCodec)}resetTokenization(e=!0){e&&this._onDidChangeTokens.fire({semanticTokensApplied:!1,ranges:[{fromLineNumber:1,toLineNumber:this._textModel.getLineCount()}]}),this._initialize()}handleDidChangeAttached(){}handleDidChangeContent(e){e.isFlush&&this.resetTokenization(!1)}forceTokenization(e){}hasAccurateTokensForLine(e){return!0}isCheapToTokenize(e){return!0}getTokenTypeIfInsertingCharacter(e,t,n){return 0}tokenizeLineWithEdit(e,t,n){return null}get hasTokens(){return this._treeSitterService.getParseResult(this._textModel)!==void 0}}const kC=ze("treeSitterParserService"),gt=new Uint32Array(0).buffer;class it{static deleteBeginning(e,t){return e===null||e===gt?e:it.delete(e,0,t)}static deleteEnding(e,t){if(e===null||e===gt)return e;const n=kt(e),i=n[n.length-2];return it.delete(e,t,i)}static delete(e,t,n){if(e===null||e===gt||t===n)return e;const i=kt(e),r=i.length>>>1;if(t===0&&i[i.length-2]===n)return gt;const o=Te.findIndexInTokensArray(i,t),a=o>0?i[o-1<<1]:0,l=i[o<<1];if(n<l){const f=n-t;for(let m=o;m<r;m++)i[m<<1]-=f;return e}let u,c;a!==t?(i[o<<1]=t,u=o+1<<1,c=t):(u=o<<1,c=a);const h=n-t;for(let f=o+1;f<r;f++){const m=i[f<<1]-h;m>c&&(i[u++]=m,i[u++]=i[(f<<1)+1],c=m)}if(u===i.length)return e;const d=new Uint32Array(u);return d.set(i.subarray(0,u),0),d.buffer}static append(e,t){if(t===gt)return e;if(e===gt)return t;if(e===null)return e;if(t===null)return null;const n=kt(e),i=kt(t),r=i.length>>>1,o=new Uint32Array(n.length+i.length);o.set(n,0);let a=n.length;const l=n[n.length-2];for(let u=0;u<r;u++)o[a++]=i[u<<1]+l,o[a++]=i[(u<<1)+1];return o.buffer}static insert(e,t,n){if(e===null||e===gt)return e;const i=kt(e),r=i.length>>>1;let o=Te.findIndexInTokensArray(i,t);o>0&&i[o-1<<1]===t&&o--;for(let a=o;a<r;a++)i[a<<1]+=n;return e}}function kt(s){return s instanceof Uint32Array?s:new Uint32Array(s)}class Pi{constructor(e){this._lineTokens=[],this._len=0,this._languageIdCodec=e}flush(){this._lineTokens=[],this._len=0}get hasTokens(){return this._lineTokens.length>0}getTokens(e,t,n){let i=null;if(t<this._len&&(i=this._lineTokens[t]),i!==null&&i!==gt)return new Te(kt(i),n,this._languageIdCodec);const r=new Uint32Array(2);return r[0]=n.length,r[1]=Au(this._languageIdCodec.encodeLanguageId(e)),new Te(r,n,this._languageIdCodec)}static _massageTokens(e,t,n){const i=n?kt(n):null;if(t===0){let r=!1;if(i&&i.length>1&&(r=wt.getLanguageId(i[1])!==e),!r)return gt}if(!i||i.length===0){const r=new Uint32Array(2);return r[0]=t,r[1]=Au(e),r.buffer}return i[i.length-2]=t,i.byteOffset===0&&i.byteLength===i.buffer.byteLength?i.buffer:i}_ensureLine(e){for(;e>=this._len;)this._lineTokens[this._len]=null,this._len++}_deleteLines(e,t){t!==0&&(e+t>this._len&&(t=this._len-e),this._lineTokens.splice(e,t),this._len-=t)}_insertLines(e,t){if(t===0)return;const n=[];for(let i=0;i<t;i++)n[i]=null;this._lineTokens=Ks(this._lineTokens,e,n),this._len+=t}setTokens(e,t,n,i,r){const o=Pi._massageTokens(this._languageIdCodec.encodeLanguageId(e),n,i);this._ensureLine(t);const a=this._lineTokens[t];return this._lineTokens[t]=o,r?!Pi._equals(a,o):!1}static _equals(e,t){if(!e||!t)return!e&&!t;const n=kt(e),i=kt(t);if(n.length!==i.length)return!1;for(let r=0,o=n.length;r<o;r++)if(n[r]!==i[r])return!1;return!0}acceptEdit(e,t,n){this._acceptDeleteRange(e),this._acceptInsertText(new I(e.startLineNumber,e.startColumn),t,n)}_acceptDeleteRange(e){const t=e.startLineNumber-1;if(t>=this._len)return;if(e.startLineNumber===e.endLineNumber){if(e.startColumn===e.endColumn)return;this._lineTokens[t]=it.delete(this._lineTokens[t],e.startColumn-1,e.endColumn-1);return}this._lineTokens[t]=it.deleteEnding(this._lineTokens[t],e.startColumn-1);const n=e.endLineNumber-1;let i=null;n<this._len&&(i=it.deleteBeginning(this._lineTokens[n],e.endColumn-1)),this._lineTokens[t]=it.append(this._lineTokens[t],i),this._deleteLines(e.startLineNumber,e.endLineNumber-e.startLineNumber)}_acceptInsertText(e,t,n){if(t===0&&n===0)return;const i=e.lineNumber-1;if(!(i>=this._len)){if(t===0){this._lineTokens[i]=it.insert(this._lineTokens[i],e.column-1,n);return}this._lineTokens[i]=it.deleteEnding(this._lineTokens[i],e.column-1),this._lineTokens[i]=it.insert(this._lineTokens[i],e.column-1,n),this._insertLines(e.lineNumber,t)}}setMultilineTokens(e,t){if(e.length===0)return{changes:[]};const n=[];for(let i=0,r=e.length;i<r;i++){const o=e[i];let a=0,l=0,u=!1;for(let c=o.startLineNumber;c<=o.endLineNumber;c++)u?(this.setTokens(t.getLanguageId(),c-1,t.getLineLength(c),o.getLineTokens(c),!1),l=c):this.setTokens(t.getLanguageId(),c-1,t.getLineLength(c),o.getLineTokens(c),!0)&&(u=!0,a=c,l=c);u&&n.push({fromLineNumber:a,toLineNumber:l})}return{changes:n}}}function Au(s){return(s<<0|0|0|32768|2<<24|1024)>>>0}class Zo{constructor(e){this._pieces=[],this._isComplete=!1,this._languageIdCodec=e}flush(){this._pieces=[],this._isComplete=!1}isEmpty(){return this._pieces.length===0}set(e,t){this._pieces=e||[],this._isComplete=t}setPartial(e,t){let n=e;if(t.length>0){const r=t[0].getRange(),o=t[t.length-1].getRange();if(!r||!o)return e;n=e.plusRange(r).plusRange(o)}let i=null;for(let r=0,o=this._pieces.length;r<o;r++){const a=this._pieces[r];if(a.endLineNumber<n.startLineNumber)continue;if(a.startLineNumber>n.endLineNumber){i=i||{index:r};break}if(a.removeTokens(n),a.isEmpty()){this._pieces.splice(r,1),r--,o--;continue}if(a.endLineNumber<n.startLineNumber)continue;if(a.startLineNumber>n.endLineNumber){i=i||{index:r};continue}const[l,u]=a.split(n);if(l.isEmpty()){i=i||{index:r};continue}u.isEmpty()||(this._pieces.splice(r,1,l,u),r++,o++,i=i||{index:r})}return i=i||{index:this._pieces.length},t.length>0&&(this._pieces=Ks(this._pieces,i.index,t)),n}isComplete(){return this._isComplete}addSparseTokens(e,t){if(t.getLineContent().length===0)return t;const n=this._pieces;if(n.length===0)return t;const i=Zo._findFirstPieceWithLine(n,e),r=n[i].getLineTokens(e);if(!r)return t;const o=t.getCount(),a=r.getCount();let l=0;const u=[];let c=0,h=0;const d=(f,m)=>{f!==h&&(h=f,u[c++]=f,u[c++]=m)};for(let f=0;f<a;f++){const m=r.getStartCharacter(f),p=r.getEndCharacter(f),C=r.getMetadata(f),b=((C&1?2048:0)|(C&2?4096:0)|(C&4?8192:0)|(C&8?16384:0)|(C&16?16744448:0)|(C&32?4278190080:0))>>>0,L=~b>>>0;for(;l<o&&t.getEndOffset(l)<=m;)d(t.getEndOffset(l),t.getMetadata(l)),l++;for(l<o&&t.getStartOffset(l)<m&&d(m,t.getMetadata(l));l<o&&t.getEndOffset(l)<p;)d(t.getEndOffset(l),t.getMetadata(l)&L|C&b),l++;if(l<o)d(p,t.getMetadata(l)&L|C&b),t.getEndOffset(l)===p&&l++;else{const _=Math.min(Math.max(0,l-1),o-1);d(p,t.getMetadata(_)&L|C&b)}}for(;l<o;)d(t.getEndOffset(l),t.getMetadata(l)),l++;return new Te(new Uint32Array(u),t.getLineContent(),this._languageIdCodec)}static _findFirstPieceWithLine(e,t){let n=0,i=e.length-1;for(;n<i;){let r=n+Math.floor((i-n)/2);if(e[r].endLineNumber<t)n=r+1;else if(e[r].startLineNumber>t)i=r-1;else{for(;r>n&&e[r-1].startLineNumber<=t&&t<=e[r-1].endLineNumber;)r--;return r}}return n}acceptEdit(e,t,n,i,r){for(const o of this._pieces)o.acceptEdit(e,t,n,i,r)}}var vC=function(s,e,t,n){var i=arguments.length,r=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,n);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(i<3?o(r):i>3?o(e,t,r):o(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},yr=function(s,e){return function(t,n){e(t,n,s)}},ds;let bo=ds=class extends ch{constructor(e,t,n,i,r,o,a){super(),this._textModel=e,this._bracketPairsTextModelPart=t,this._languageId=n,this._attachedViews=i,this._languageService=r,this._languageConfigurationService=o,this._treeSitterService=a,this._semanticTokens=new Zo(this._languageService.languageIdCodec),this._onDidChangeLanguage=this._register(new J),this.onDidChangeLanguage=this._onDidChangeLanguage.event,this._onDidChangeLanguageConfiguration=this._register(new J),this.onDidChangeLanguageConfiguration=this._onDidChangeLanguageConfiguration.event,this._onDidChangeTokens=this._register(new J),this.onDidChangeTokens=this._onDidChangeTokens.event,this._tokensDisposables=this._register(new tr),this._register(this._languageConfigurationService.onDidChange(l=>{l.affects(this._languageId)&&this._onDidChangeLanguageConfiguration.fire({})})),this._register(gc.filter(qr.onDidChange,l=>l.changedLanguages.includes(this._languageId))(()=>{this.createPreferredTokenProvider()})),this.createPreferredTokenProvider()}createGrammarTokens(){return this._register(new Du(this._languageService.languageIdCodec,this._textModel,()=>this._languageId,this._attachedViews))}createTreeSitterTokens(){return this._register(new Pu(this._treeSitterService,this._languageService.languageIdCodec,this._textModel,()=>this._languageId))}createTokens(e){var n;const t=this._tokens!==void 0;(n=this._tokens)==null||n.dispose(),this._tokens=e?this.createTreeSitterTokens():this.createGrammarTokens(),this._tokensDisposables.clear(),this._tokensDisposables.add(this._tokens.onDidChangeTokens(i=>{this._emitModelTokensChangedEvent(i)})),this._tokensDisposables.add(this._tokens.onDidChangeBackgroundTokenizationState(i=>{this._bracketPairsTextModelPart.handleDidChangeBackgroundTokenizationState()})),t&&this._tokens.resetTokenization()}createPreferredTokenProvider(){qr.get(this._languageId)?this._tokens instanceof Pu||this.createTokens(!0):this._tokens instanceof Du||this.createTokens(!1)}handleLanguageConfigurationServiceChange(e){e.affects(this._languageId)&&this._onDidChangeLanguageConfiguration.fire({})}handleDidChangeContent(e){if(e.isFlush)this._semanticTokens.flush();else if(!e.isEolChange)for(const t of e.changes){const[n,i,r]=sn(t.text);this._semanticTokens.acceptEdit(t.range,n,i,r,t.text.length>0?t.text.charCodeAt(0):0)}this._tokens.handleDidChangeContent(e)}handleDidChangeAttached(){this._tokens.handleDidChangeAttached()}getLineTokens(e){this.validateLineNumber(e);const t=this._tokens.getLineTokens(e);return this._semanticTokens.addSparseTokens(e,t)}_emitModelTokensChangedEvent(e){this._textModel._isDisposing()||(this._bracketPairsTextModelPart.handleDidChangeTokens(e),this._onDidChangeTokens.fire(e))}validateLineNumber(e){if(e<1||e>this._textModel.getLineCount())throw new he("Illegal value for lineNumber")}get hasTokens(){return this._tokens.hasTokens}resetTokenization(){this._tokens.resetTokenization()}get backgroundTokenizationState(){return this._tokens.backgroundTokenizationState}forceTokenization(e){this.validateLineNumber(e),this._tokens.forceTokenization(e)}hasAccurateTokensForLine(e){return this.validateLineNumber(e),this._tokens.hasAccurateTokensForLine(e)}isCheapToTokenize(e){return this.validateLineNumber(e),this._tokens.isCheapToTokenize(e)}tokenizeIfCheap(e){this.validateLineNumber(e),this._tokens.tokenizeIfCheap(e)}getTokenTypeIfInsertingCharacter(e,t,n){return this._tokens.getTokenTypeIfInsertingCharacter(e,t,n)}tokenizeLineWithEdit(e,t,n){return this._tokens.tokenizeLineWithEdit(e,t,n)}setSemanticTokens(e,t){this._semanticTokens.set(e,t),this._emitModelTokensChangedEvent({semanticTokensApplied:e!==null,ranges:[{fromLineNumber:1,toLineNumber:this._textModel.getLineCount()}]})}hasCompleteSemanticTokens(){return this._semanticTokens.isComplete()}hasSomeSemanticTokens(){return!this._semanticTokens.isEmpty()}setPartialSemanticTokens(e,t){if(this.hasCompleteSemanticTokens())return;const n=this._textModel.validateRange(this._semanticTokens.setPartial(e,t));this._emitModelTokensChangedEvent({semanticTokensApplied:!0,ranges:[{fromLineNumber:n.startLineNumber,toLineNumber:n.endLineNumber}]})}getWordAtPosition(e){this.assertNotDisposed();const t=this._textModel.validatePosition(e),n=this._textModel.getLineContent(t.lineNumber),i=this.getLineTokens(t.lineNumber),r=i.findTokenIndexAtOffset(t.column-1),[o,a]=ds._findLanguageBoundaries(i,r),l=Ii(t.column,this.getLanguageConfiguration(i.getLanguageId(r)).getWordDefinition(),n.substring(o,a),o);if(l&&l.startColumn<=e.column&&e.column<=l.endColumn)return l;if(r>0&&o===t.column-1){const[u,c]=ds._findLanguageBoundaries(i,r-1),h=Ii(t.column,this.getLanguageConfiguration(i.getLanguageId(r-1)).getWordDefinition(),n.substring(u,c),u);if(h&&h.startColumn<=e.column&&e.column<=h.endColumn)return h}return null}getLanguageConfiguration(e){return this._languageConfigurationService.getLanguageConfiguration(e)}static _findLanguageBoundaries(e,t){const n=e.getLanguageId(t);let i=0;for(let o=t;o>=0&&e.getLanguageId(o)===n;o--)i=e.getStartOffset(o);let r=e.getLineContent().length;for(let o=t,a=e.getCount();o<a&&e.getLanguageId(o)===n;o++)r=e.getEndOffset(o);return[i,r]}getWordUntilPosition(e){const t=this.getWordAtPosition(e);return t?{word:t.word.substr(0,e.column-t.startColumn),startColumn:t.startColumn,endColumn:e.column}:{word:"",startColumn:e.column,endColumn:e.column}}getLanguageId(){return this._languageId}getLanguageIdAtPosition(e,t){const n=this._textModel.validatePosition(new I(e,t)),i=this.getLineTokens(n.lineNumber);return i.getLanguageId(i.findTokenIndexAtOffset(n.column-1))}setLanguageId(e,t="api"){if(this._languageId===e)return;const n={oldLanguage:this._languageId,newLanguage:e,source:t};this._languageId=e,this._bracketPairsTextModelPart.handleDidChangeLanguage(n),this._tokens.resetTokenization(),this.createPreferredTokenProvider(),this._onDidChangeLanguage.fire(n),this._onDidChangeLanguageConfiguration.fire({})}};bo=ds=vC([yr(4,zi),yr(5,rr),yr(6,kC)],bo);class Du extends bh{constructor(e,t,n,i){super(e,t,n),this._tokenizer=null,this._defaultBackgroundTokenizer=null,this._backgroundTokenizer=this._register(new Ls),this._tokens=new Pi(this._languageIdCodec),this._debugBackgroundTokenizer=this._register(new Ls),this._attachedViewStates=this._register(new wd),this._register(nn.onDidChange(r=>{const o=this.getLanguageId();r.changedLanguages.indexOf(o)!==-1&&this.resetTokenization()})),this.resetTokenization(),this._register(i.onDidChangeVisibleRanges(({view:r,state:o})=>{if(o){let a=this._attachedViewStates.get(r);a||(a=new SC(()=>this.refreshRanges(a.lineRanges)),this._attachedViewStates.set(r,a)),a.handleStateChange(o)}else this._attachedViewStates.deleteAndDispose(r)}))}resetTokenization(e=!0){var r;this._tokens.flush(),(r=this._debugBackgroundTokens)==null||r.flush(),this._debugBackgroundStates&&(this._debugBackgroundStates=new Co(this._textModel.getLineCount())),e&&this._onDidChangeTokens.fire({semanticTokensApplied:!1,ranges:[{fromLineNumber:1,toLineNumber:this._textModel.getLineCount()}]});const t=()=>{if(this._textModel.isTooLargeForTokenization())return[null,null];const o=nn.get(this.getLanguageId());if(!o)return[null,null];let a;try{a=o.getInitialState()}catch(l){return Tt(l),[null,null]}return[o,a]},[n,i]=t();if(n&&i?this._tokenizer=new pC(this._textModel.getLineCount(),n,this._textModel,this._languageIdCodec):this._tokenizer=null,this._backgroundTokenizer.clear(),this._defaultBackgroundTokenizer=null,this._tokenizer){const o={setTokens:a=>{this.setTokens(a)},backgroundTokenizationFinished:()=>{if(this._backgroundTokenizationState===2)return;const a=2;this._backgroundTokenizationState=a,this._onDidChangeBackgroundTokenizationState.fire()},setEndState:(a,l)=>{var c;if(!this._tokenizer)return;const u=this._tokenizer.store.getFirstInvalidEndStateLineNumber();u!==null&&a>=u&&((c=this._tokenizer)==null||c.store.setEndState(a,l))}};n&&n.createBackgroundTokenizer&&!n.backgroundTokenizerShouldOnlyVerifyTokens&&(this._backgroundTokenizer.value=n.createBackgroundTokenizer(this._textModel,o)),!this._backgroundTokenizer.value&&!this._textModel.isTooLargeForTokenization()&&(this._backgroundTokenizer.value=this._defaultBackgroundTokenizer=new LC(this._tokenizer,o),this._defaultBackgroundTokenizer.handleChanges()),n!=null&&n.backgroundTokenizerShouldOnlyVerifyTokens&&n.createBackgroundTokenizer?(this._debugBackgroundTokens=new Pi(this._languageIdCodec),this._debugBackgroundStates=new Co(this._textModel.getLineCount()),this._debugBackgroundTokenizer.clear(),this._debugBackgroundTokenizer.value=n.createBackgroundTokenizer(this._textModel,{setTokens:a=>{var l;(l=this._debugBackgroundTokens)==null||l.setMultilineTokens(a,this._textModel)},backgroundTokenizationFinished(){},setEndState:(a,l)=>{var u;(u=this._debugBackgroundStates)==null||u.setEndState(a,l)}})):(this._debugBackgroundTokens=void 0,this._debugBackgroundStates=void 0,this._debugBackgroundTokenizer.value=void 0)}this.refreshAllVisibleLineTokens()}handleDidChangeAttached(){var e;(e=this._defaultBackgroundTokenizer)==null||e.handleChanges()}handleDidChangeContent(e){var t,n,i;if(e.isFlush)this.resetTokenization(!1);else if(!e.isEolChange){for(const r of e.changes){const[o,a]=sn(r.text);this._tokens.acceptEdit(r.range,o,a),(t=this._debugBackgroundTokens)==null||t.acceptEdit(r.range,o,a)}(n=this._debugBackgroundStates)==null||n.acceptChanges(e.changes),this._tokenizer&&this._tokenizer.store.acceptChanges(e.changes),(i=this._defaultBackgroundTokenizer)==null||i.handleChanges()}}setTokens(e){const{changes:t}=this._tokens.setMultilineTokens(e,this._textModel);return t.length>0&&this._onDidChangeTokens.fire({semanticTokensApplied:!1,ranges:t}),{changes:t}}refreshAllVisibleLineTokens(){const e=$.joinMany([...this._attachedViewStates].map(([t,n])=>n.lineRanges));this.refreshRanges(e)}refreshRanges(e){for(const t of e)this.refreshRange(t.startLineNumber,t.endLineNumberExclusive-1)}refreshRange(e,t){var o,a;if(!this._tokenizer)return;e=Math.max(1,Math.min(this._textModel.getLineCount(),e)),t=Math.min(this._textModel.getLineCount(),t);const n=new po,{heuristicTokens:i}=this._tokenizer.tokenizeHeuristically(n,e,t),r=this.setTokens(n.finalize());if(i)for(const l of r.changes)(o=this._backgroundTokenizer.value)==null||o.requestTokens(l.fromLineNumber,l.toLineNumber+1);(a=this._defaultBackgroundTokenizer)==null||a.checkFinished()}forceTokenization(e){var n,i;const t=new po;(n=this._tokenizer)==null||n.updateTokensUntilLine(t,e),this.setTokens(t.finalize()),(i=this._defaultBackgroundTokenizer)==null||i.checkFinished()}hasAccurateTokensForLine(e){return this._tokenizer?this._tokenizer.hasAccurateTokensForLine(e):!0}isCheapToTokenize(e){return this._tokenizer?this._tokenizer.isCheapToTokenize(e):!0}getLineTokens(e){var i;const t=this._textModel.getLineContent(e),n=this._tokens.getTokens(this._textModel.getLanguageId(),e-1,t);if(this._debugBackgroundTokens&&this._debugBackgroundStates&&this._tokenizer&&this._debugBackgroundStates.getFirstInvalidEndStateLineNumberOrMax()>e&&this._tokenizer.store.getFirstInvalidEndStateLineNumberOrMax()>e){const r=this._debugBackgroundTokens.getTokens(this._textModel.getLanguageId(),e-1,t);!n.equals(r)&&((i=this._debugBackgroundTokenizer.value)!=null&&i.reportMismatchingTokens)&&this._debugBackgroundTokenizer.value.reportMismatchingTokens(e)}return n}getTokenTypeIfInsertingCharacter(e,t,n){if(!this._tokenizer)return 0;const i=this._textModel.validatePosition(new I(e,t));return this.forceTokenization(i.lineNumber),this._tokenizer.getTokenTypeIfInsertingCharacter(i,n)}tokenizeLineWithEdit(e,t,n){if(!this._tokenizer)return null;const i=this._textModel.validatePosition(e);return this.forceTokenization(i.lineNumber),this._tokenizer.tokenizeLineWithEdit(i,t,n)}get hasTokens(){return this._tokens.hasTokens}}class IC{constructor(){this.changeType=1}}class Et{static applyInjectedText(e,t){if(!t||t.length===0)return e;let n="",i=0;for(const r of t)n+=e.substring(i,r.column-1),i=r.column-1,n+=r.options.content;return n+=e.substring(i),n}static fromDecorations(e){const t=[];for(const n of e)n.options.before&&n.options.before.content.length>0&&t.push(new Et(n.ownerId,n.range.startLineNumber,n.range.startColumn,n.options.before,0)),n.options.after&&n.options.after.content.length>0&&t.push(new Et(n.ownerId,n.range.endLineNumber,n.range.endColumn,n.options.after,1));return t.sort((n,i)=>n.lineNumber===i.lineNumber?n.column===i.column?n.order-i.order:n.column-i.column:n.lineNumber-i.lineNumber),t}constructor(e,t,n,i,r){this.ownerId=e,this.lineNumber=t,this.column=n,this.options=i,this.order=r}}class Ou{constructor(e,t,n){this.changeType=2,this.lineNumber=e,this.detail=t,this.injectedText=n}}class NC{constructor(e,t){this.changeType=3,this.fromLineNumber=e,this.toLineNumber=t}}class xC{constructor(e,t,n,i){this.changeType=4,this.injectedTexts=i,this.fromLineNumber=e,this.toLineNumber=t,this.detail=n}}class TC{constructor(){this.changeType=5}}class Mn{constructor(e,t,n,i){this.changes=e,this.versionId=t,this.isUndoing=n,this.isRedoing=i,this.resultingSelection=null}containsEvent(e){for(let t=0,n=this.changes.length;t<n;t++)if(this.changes[t].changeType===e)return!0;return!1}static merge(e,t){const n=[].concat(e.changes).concat(t.changes),i=t.versionId,r=e.isUndoing||t.isUndoing,o=e.isRedoing||t.isRedoing;return new Mn(n,i,r,o)}}class Lh{constructor(e){this.changes=e}}class Kt{constructor(e,t){this.rawContentChangedEvent=e,this.contentChangedEvent=t}merge(e){const t=Mn.merge(this.rawContentChangedEvent,e.rawContentChangedEvent),n=Kt._mergeChangeEvents(this.contentChangedEvent,e.contentChangedEvent);return new Kt(t,n)}static _mergeChangeEvents(e,t){const n=[].concat(e.changes).concat(t.changes),i=t.eol,r=t.versionId,o=e.isUndoing||t.isUndoing,a=e.isRedoing||t.isRedoing,l=e.isFlush||t.isFlush,u=e.isEolChange&&t.isEolChange;return{changes:n,eol:i,isEolChange:u,versionId:r,isUndoing:o,isRedoing:a,isFlush:l}}}var EC=function(s,e,t,n){var i=arguments.length,r=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,n);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(i<3?o(r):i>3?o(e,t,r):o(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},ts=function(s,e){return function(t,n){e(t,n,s)}},qt;function yC(s){const e=new Ch;return e.acceptChunk(s),e.finish()}function RC(s){const e=new Ch;let t;for(;typeof(t=s.read())=="string";)e.acceptChunk(t);return e.finish()}function Bu(s,e){let t;return typeof s=="string"?t=yC(s):Rg(s)?t=RC(s):t=s,t.create(e)}let ns=0;const MC=999,PC=1e4;class AC{constructor(e){this._source=e,this._eos=!1}read(){if(this._eos)return null;const e=[];let t=0,n=0;do{const i=this._source.read();if(i===null)return this._eos=!0,t===0?null:e.join("");if(i.length>0&&(e[t++]=i,n+=i.length),n>=64*1024)return e.join("")}while(!0)}}const Qn=()=>{throw new Error("Invalid change accessor")};var Ye;let Lo=(Ye=class extends oe{static resolveOptions(e,t){if(t.detectIndentation){const n=Iu(e,t.tabSize,t.insertSpaces);return new Cr({tabSize:n.tabSize,indentSize:"tabSize",insertSpaces:n.insertSpaces,trimAutoWhitespace:t.trimAutoWhitespace,defaultEOL:t.defaultEOL,bracketPairColorizationOptions:t.bracketPairColorizationOptions})}return new Cr(t)}get onDidChangeLanguage(){return this._tokenizationTextModelPart.onDidChangeLanguage}get onDidChangeLanguageConfiguration(){return this._tokenizationTextModelPart.onDidChangeLanguageConfiguration}get onDidChangeTokens(){return this._tokenizationTextModelPart.onDidChangeTokens}onDidChangeContent(e){return this._eventEmitter.slowEvent(t=>e(t.contentChangedEvent))}onDidChangeContentOrInjectedText(e){return _d(this._eventEmitter.fastEvent(t=>e(t)),this._onDidChangeInjectedText.event(t=>e(t)))}_isDisposing(){return this.__isDisposing}get tokenization(){return this._tokenizationTextModelPart}get bracketPairs(){return this._bracketPairs}get guides(){return this._guidesTextModelPart}constructor(e,t,n,i=null,r,o,a,l){super(),this._undoRedoService=r,this._languageService=o,this._languageConfigurationService=a,this.instantiationService=l,this._onWillDispose=this._register(new J),this.onWillDispose=this._onWillDispose.event,this._onDidChangeDecorations=this._register(new FC(m=>this.handleBeforeFireDecorationsChangedEvent(m))),this.onDidChangeDecorations=this._onDidChangeDecorations.event,this._onDidChangeOptions=this._register(new J),this.onDidChangeOptions=this._onDidChangeOptions.event,this._onDidChangeAttached=this._register(new J),this.onDidChangeAttached=this._onDidChangeAttached.event,this._onDidChangeInjectedText=this._register(new J),this._eventEmitter=this._register(new zC),this._languageSelectionListener=this._register(new Ls),this._deltaDecorationCallCnt=0,this._attachedViews=new wC,ns++,this.id="$model"+ns,this.isForSimpleWidget=n.isForSimpleWidget,typeof i>"u"||i===null?this._associatedResource=ot.parse("inmemory://model/"+ns):this._associatedResource=i,this._attachedEditorCount=0;const{textBuffer:u,disposable:c}=Bu(e,n.defaultEOL);this._buffer=u,this._bufferDisposable=c,this._options=qt.resolveOptions(this._buffer,n);const h=typeof t=="string"?t:t.languageId;typeof t!="string"&&(this._languageSelectionListener.value=t.onDidChange(()=>this._setLanguage(t.languageId))),this._bracketPairs=this._register(new Bp(this,this._languageConfigurationService)),this._guidesTextModelPart=this._register(new jp(this,this._languageConfigurationService)),this._decorationProvider=this._register(new Wp(this)),this._tokenizationTextModelPart=this.instantiationService.createInstance(bo,this,this._bracketPairs,h,this._attachedViews);const d=this._buffer.getLineCount(),f=this._buffer.getValueLengthInRange(new w(1,1,d,this._buffer.getLineLength(d)+1),0);n.largeFileOptimizations?(this._isTooLargeForTokenization=f>qt.LARGE_FILE_SIZE_THRESHOLD||d>qt.LARGE_FILE_LINE_COUNT_THRESHOLD,this._isTooLargeForHeapOperation=f>qt.LARGE_FILE_HEAP_OPERATION_THRESHOLD):(this._isTooLargeForTokenization=!1,this._isTooLargeForHeapOperation=!1),this._isTooLargeForSyncing=f>qt._MODEL_SYNC_LIMIT,this._versionId=1,this._alternativeVersionId=1,this._initialUndoRedoSnapshot=null,this._isDisposed=!1,this.__isDisposing=!1,this._instanceId=Cc(ns),this._lastDecorationId=0,this._decorations=Object.create(null),this._decorationsTree=new Vu,this._commandManager=new qo(this,this._undoRedoService),this._isUndoing=!1,this._isRedoing=!1,this._trimAutoWhitespaceLines=null,this._register(this._decorationProvider.onDidChange(()=>{this._onDidChangeDecorations.beginDeferredEmit(),this._onDidChangeDecorations.fire(),this._onDidChangeDecorations.endDeferredEmit()})),this._languageService.requestRichLanguageFeatures(h),this._register(this._languageConfigurationService.onDidChange(m=>{this._bracketPairs.handleLanguageConfigurationServiceChange(m),this._tokenizationTextModelPart.handleLanguageConfigurationServiceChange(m)}))}dispose(){this.__isDisposing=!0,this._onWillDispose.fire(),this._tokenizationTextModelPart.dispose(),this._isDisposed=!0,super.dispose(),this._bufferDisposable.dispose(),this.__isDisposing=!1;const e=new Rn([],"",`
`,!1,!1,!0,!0);e.dispose(),this._buffer=e,this._bufferDisposable=oe.None}_assertNotDisposed(){if(this._isDisposed)throw new he("Model is disposed!")}_emitContentChangedEvent(e,t){this.__isDisposing||(this._tokenizationTextModelPart.handleDidChangeContent(t),this._bracketPairs.handleDidChangeContent(t),this._eventEmitter.fire(new Kt(e,t)))}setValue(e){if(this._assertNotDisposed(),e==null)throw Sd();const{textBuffer:t,disposable:n}=Bu(e,this._options.defaultEOL);this._setValueFromTextBuffer(t,n)}_createContentChanged2(e,t,n,i,r,o,a,l){return{changes:[{range:e,rangeOffset:t,rangeLength:n,text:i}],eol:this._buffer.getEOL(),isEolChange:l,versionId:this.getVersionId(),isUndoing:r,isRedoing:o,isFlush:a}}_setValueFromTextBuffer(e,t){this._assertNotDisposed();const n=this.getFullModelRange(),i=this.getValueLengthInRange(n),r=this.getLineCount(),o=this.getLineMaxColumn(r);this._buffer=e,this._bufferDisposable.dispose(),this._bufferDisposable=t,this._increaseVersionId(),this._decorations=Object.create(null),this._decorationsTree=new Vu,this._commandManager.clear(),this._trimAutoWhitespaceLines=null,this._emitContentChangedEvent(new Mn([new IC],this._versionId,!1,!1),this._createContentChanged2(new w(1,1,r,o),0,i,this.getValue(),!1,!1,!0,!1))}setEOL(e){this._assertNotDisposed();const t=e===1?`\r
`:`
`;if(this._buffer.getEOL()===t)return;const n=this.getFullModelRange(),i=this.getValueLengthInRange(n),r=this.getLineCount(),o=this.getLineMaxColumn(r);this._onBeforeEOLChange(),this._buffer.setEOL(t),this._increaseVersionId(),this._onAfterEOLChange(),this._emitContentChangedEvent(new Mn([new TC],this._versionId,!1,!1),this._createContentChanged2(new w(1,1,r,o),0,i,this.getValue(),!1,!1,!1,!0))}_onBeforeEOLChange(){this._decorationsTree.ensureAllNodesHaveRanges(this)}_onAfterEOLChange(){const e=this.getVersionId(),t=this._decorationsTree.collectNodesPostOrder();for(let n=0,i=t.length;n<i;n++){const r=t[n],o=r.range,a=r.cachedAbsoluteStart-r.start,l=this._buffer.getOffsetAt(o.startLineNumber,o.startColumn),u=this._buffer.getOffsetAt(o.endLineNumber,o.endColumn);r.cachedAbsoluteStart=l,r.cachedAbsoluteEnd=u,r.cachedVersionId=e,r.start=l-a,r.end=u-a,Bt(r)}}onBeforeAttached(){return this._attachedEditorCount++,this._attachedEditorCount===1&&(this._tokenizationTextModelPart.handleDidChangeAttached(),this._onDidChangeAttached.fire(void 0)),this._attachedViews.attachView()}onBeforeDetached(e){this._attachedEditorCount--,this._attachedEditorCount===0&&(this._tokenizationTextModelPart.handleDidChangeAttached(),this._onDidChangeAttached.fire(void 0)),this._attachedViews.detachView(e)}isAttachedToEditor(){return this._attachedEditorCount>0}getAttachedEditorCount(){return this._attachedEditorCount}isTooLargeForSyncing(){return this._isTooLargeForSyncing}isTooLargeForTokenization(){return this._isTooLargeForTokenization}isTooLargeForHeapOperation(){return this._isTooLargeForHeapOperation}isDisposed(){return this._isDisposed}isDominatedByLongLines(){if(this._assertNotDisposed(),this.isTooLargeForTokenization())return!1;let e=0,t=0;const n=this._buffer.getLineCount();for(let i=1;i<=n;i++){const r=this._buffer.getLineLength(i);r>=PC?t+=r:e+=r}return t>e}get uri(){return this._associatedResource}getOptions(){return this._assertNotDisposed(),this._options}getFormattingOptions(){return{tabSize:this._options.indentSize,insertSpaces:this._options.insertSpaces}}updateOptions(e){this._assertNotDisposed();const t=typeof e.tabSize<"u"?e.tabSize:this._options.tabSize,n=typeof e.indentSize<"u"?e.indentSize:this._options.originalIndentSize,i=typeof e.insertSpaces<"u"?e.insertSpaces:this._options.insertSpaces,r=typeof e.trimAutoWhitespace<"u"?e.trimAutoWhitespace:this._options.trimAutoWhitespace,o=typeof e.bracketColorizationOptions<"u"?e.bracketColorizationOptions:this._options.bracketPairColorizationOptions,a=new Cr({tabSize:t,indentSize:n,insertSpaces:i,defaultEOL:this._options.defaultEOL,trimAutoWhitespace:r,bracketPairColorizationOptions:o});if(this._options.equals(a))return;const l=this._options.createChangeEvent(a);this._options=a,this._bracketPairs.handleDidChangeOptions(l),this._decorationProvider.handleDidChangeOptions(l),this._onDidChangeOptions.fire(l)}detectIndentation(e,t){this._assertNotDisposed();const n=Iu(this._buffer,t,e);this.updateOptions({insertSpaces:n.insertSpaces,tabSize:n.tabSize,indentSize:n.tabSize})}normalizeIndentation(e){return this._assertNotDisposed(),eh(e,this._options.indentSize,this._options.insertSpaces)}getVersionId(){return this._assertNotDisposed(),this._versionId}mightContainRTL(){return this._buffer.mightContainRTL()}mightContainUnusualLineTerminators(){return this._buffer.mightContainUnusualLineTerminators()}removeUnusualLineTerminators(e=null){const t=this.findMatches(kd.source,!1,!0,!1,null,!1,1073741824);this._buffer.resetMightContainUnusualLineTerminators(),this.pushEditOperations(e,t.map(n=>({range:n.range,text:null})),()=>null)}mightContainNonBasicASCII(){return this._buffer.mightContainNonBasicASCII()}getAlternativeVersionId(){return this._assertNotDisposed(),this._alternativeVersionId}getInitialUndoRedoSnapshot(){return this._assertNotDisposed(),this._initialUndoRedoSnapshot}getOffsetAt(e){this._assertNotDisposed();const t=this._validatePosition(e.lineNumber,e.column,0);return this._buffer.getOffsetAt(t.lineNumber,t.column)}getPositionAt(e){this._assertNotDisposed();const t=Math.min(this._buffer.getLength(),Math.max(0,e));return this._buffer.getPositionAt(t)}_increaseVersionId(){this._versionId=this._versionId+1,this._alternativeVersionId=this._versionId}_overwriteVersionId(e){this._versionId=e}_overwriteAlternativeVersionId(e){this._alternativeVersionId=e}_overwriteInitialUndoRedoSnapshot(e){this._initialUndoRedoSnapshot=e}getValue(e,t=!1){if(this._assertNotDisposed(),this.isTooLargeForHeapOperation())throw new he("Operation would exceed heap memory limits");const n=this.getFullModelRange(),i=this.getValueInRange(n,e);return t?this._buffer.getBOM()+i:i}createSnapshot(e=!1){return new AC(this._buffer.createSnapshot(e))}getValueLength(e,t=!1){this._assertNotDisposed();const n=this.getFullModelRange(),i=this.getValueLengthInRange(n,e);return t?this._buffer.getBOM().length+i:i}getValueInRange(e,t=0){return this._assertNotDisposed(),this._buffer.getValueInRange(this.validateRange(e),t)}getValueLengthInRange(e,t=0){return this._assertNotDisposed(),this._buffer.getValueLengthInRange(this.validateRange(e),t)}getCharacterCountInRange(e,t=0){return this._assertNotDisposed(),this._buffer.getCharacterCountInRange(this.validateRange(e),t)}getLineCount(){return this._assertNotDisposed(),this._buffer.getLineCount()}getLineContent(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new he("Illegal value for lineNumber");return this._buffer.getLineContent(e)}getLineLength(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new he("Illegal value for lineNumber");return this._buffer.getLineLength(e)}getLinesContent(){if(this._assertNotDisposed(),this.isTooLargeForHeapOperation())throw new he("Operation would exceed heap memory limits");return this._buffer.getLinesContent()}getEOL(){return this._assertNotDisposed(),this._buffer.getEOL()}getEndOfLineSequence(){return this._assertNotDisposed(),this._buffer.getEOL()===`
`?0:1}getLineMinColumn(e){return this._assertNotDisposed(),1}getLineMaxColumn(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new he("Illegal value for lineNumber");return this._buffer.getLineLength(e)+1}getLineFirstNonWhitespaceColumn(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new he("Illegal value for lineNumber");return this._buffer.getLineFirstNonWhitespaceColumn(e)}getLineLastNonWhitespaceColumn(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new he("Illegal value for lineNumber");return this._buffer.getLineLastNonWhitespaceColumn(e)}_validateRangeRelaxedNoAllocations(e){const t=this._buffer.getLineCount(),n=e.startLineNumber,i=e.startColumn;let r=Math.floor(typeof n=="number"&&!isNaN(n)?n:1),o=Math.floor(typeof i=="number"&&!isNaN(i)?i:1);if(r<1)r=1,o=1;else if(r>t)r=t,o=this.getLineMaxColumn(r);else if(o<=1)o=1;else{const h=this.getLineMaxColumn(r);o>=h&&(o=h)}const a=e.endLineNumber,l=e.endColumn;let u=Math.floor(typeof a=="number"&&!isNaN(a)?a:1),c=Math.floor(typeof l=="number"&&!isNaN(l)?l:1);if(u<1)u=1,c=1;else if(u>t)u=t,c=this.getLineMaxColumn(u);else if(c<=1)c=1;else{const h=this.getLineMaxColumn(u);c>=h&&(c=h)}return n===r&&i===o&&a===u&&l===c&&e instanceof w&&!(e instanceof Z)?e:new w(r,o,u,c)}_isValidPosition(e,t,n){if(typeof e!="number"||typeof t!="number"||isNaN(e)||isNaN(t)||e<1||t<1||(e|0)!==e||(t|0)!==t)return!1;const i=this._buffer.getLineCount();if(e>i)return!1;if(t===1)return!0;const r=this.getLineMaxColumn(e);if(t>r)return!1;if(n===1){const o=this._buffer.getLineCharCode(e,t-2);if(Ne(o))return!1}return!0}_validatePosition(e,t,n){const i=Math.floor(typeof e=="number"&&!isNaN(e)?e:1),r=Math.floor(typeof t=="number"&&!isNaN(t)?t:1),o=this._buffer.getLineCount();if(i<1)return new I(1,1);if(i>o)return new I(o,this.getLineMaxColumn(o));if(r<=1)return new I(i,1);const a=this.getLineMaxColumn(i);if(r>=a)return new I(i,a);if(n===1){const l=this._buffer.getLineCharCode(i,r-2);if(Ne(l))return new I(i,r-1)}return new I(i,r)}validatePosition(e){return this._assertNotDisposed(),e instanceof I&&this._isValidPosition(e.lineNumber,e.column,1)?e:this._validatePosition(e.lineNumber,e.column,1)}_isValidRange(e,t){const n=e.startLineNumber,i=e.startColumn,r=e.endLineNumber,o=e.endColumn;if(!this._isValidPosition(n,i,0)||!this._isValidPosition(r,o,0))return!1;if(t===1){const a=i>1?this._buffer.getLineCharCode(n,i-2):0,l=o>1&&o<=this._buffer.getLineLength(r)?this._buffer.getLineCharCode(r,o-2):0,u=Ne(a),c=Ne(l);return!u&&!c}return!0}validateRange(e){if(this._assertNotDisposed(),e instanceof w&&!(e instanceof Z)&&this._isValidRange(e,1))return e;const n=this._validatePosition(e.startLineNumber,e.startColumn,0),i=this._validatePosition(e.endLineNumber,e.endColumn,0),r=n.lineNumber,o=n.column,a=i.lineNumber,l=i.column;{const u=o>1?this._buffer.getLineCharCode(r,o-2):0,c=l>1&&l<=this._buffer.getLineLength(a)?this._buffer.getLineCharCode(a,l-2):0,h=Ne(u),d=Ne(c);return!h&&!d?new w(r,o,a,l):r===a&&o===l?new w(r,o-1,a,l-1):h&&d?new w(r,o-1,a,l+1):h?new w(r,o-1,a,l):new w(r,o,a,l+1)}}modifyPosition(e,t){this._assertNotDisposed();const n=this.getOffsetAt(e)+t;return this.getPositionAt(Math.min(this._buffer.getLength(),Math.max(0,n)))}getFullModelRange(){this._assertNotDisposed();const e=this.getLineCount();return new w(1,1,e,this.getLineMaxColumn(e))}findMatchesLineByLine(e,t,n,i){return this._buffer.findMatchesLineByLine(e,t,n,i)}findMatches(e,t,n,i,r,o,a=MC){this._assertNotDisposed();let l=null;t!==null&&(Array.isArray(t)||(t=[t]),t.every(h=>w.isIRange(h))&&(l=t.map(h=>this.validateRange(h)))),l===null&&(l=[this.getFullModelRange()]),l=l.sort((h,d)=>h.startLineNumber-d.startLineNumber||h.startColumn-d.startColumn);const u=[];u.push(l.reduce((h,d)=>w.areIntersecting(h,d)?h.plusRange(d):(u.push(h),d)));let c;if(!n&&e.indexOf(`
`)<0){const d=new dn(e,n,i,r).parseSearchRequest();if(!d)return[];c=f=>this.findMatchesLineByLine(f,d,o,a)}else c=h=>$i.findMatches(this,new dn(e,n,i,r),h,o,a);return u.map(c).reduce((h,d)=>h.concat(d),[])}findNextMatch(e,t,n,i,r,o){this._assertNotDisposed();const a=this.validatePosition(t);if(!n&&e.indexOf(`
`)<0){const u=new dn(e,n,i,r).parseSearchRequest();if(!u)return null;const c=this.getLineCount();let h=new w(a.lineNumber,a.column,c,this.getLineMaxColumn(c)),d=this.findMatchesLineByLine(h,u,o,1);return $i.findNextMatch(this,new dn(e,n,i,r),a,o),d.length>0||(h=new w(1,1,a.lineNumber,this.getLineMaxColumn(a.lineNumber)),d=this.findMatchesLineByLine(h,u,o,1),d.length>0)?d[0]:null}return $i.findNextMatch(this,new dn(e,n,i,r),a,o)}findPreviousMatch(e,t,n,i,r,o){this._assertNotDisposed();const a=this.validatePosition(t);return $i.findPreviousMatch(this,new dn(e,n,i,r),a,o)}pushStackElement(){this._commandManager.pushStackElement()}popStackElement(){this._commandManager.popStackElement()}pushEOL(e){if((this.getEOL()===`
`?0:1)!==e)try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),this._initialUndoRedoSnapshot===null&&(this._initialUndoRedoSnapshot=this._undoRedoService.createSnapshot(this.uri)),this._commandManager.pushEOL(e)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}_validateEditOperation(e){return e instanceof br?e:new br(e.identifier||null,this.validateRange(e.range),e.text,e.forceMoveMarkers||!1,e.isAutoWhitespaceEdit||!1,e._isTracked||!1)}_validateEditOperations(e){const t=[];for(let n=0,i=e.length;n<i;n++)t[n]=this._validateEditOperation(e[n]);return t}pushEditOperations(e,t,n,i){try{return this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),this._pushEditOperations(e,this._validateEditOperations(t),n,i)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}_pushEditOperations(e,t,n,i){if(this._options.trimAutoWhitespace&&this._trimAutoWhitespaceLines){const r=t.map(a=>({range:this.validateRange(a.range),text:a.text}));let o=!0;if(e)for(let a=0,l=e.length;a<l;a++){const u=e[a];let c=!1;for(let h=0,d=r.length;h<d;h++){const f=r[h].range,m=f.startLineNumber>u.endLineNumber,p=u.startLineNumber>f.endLineNumber;if(!m&&!p){c=!0;break}}if(!c){o=!1;break}}if(o)for(let a=0,l=this._trimAutoWhitespaceLines.length;a<l;a++){const u=this._trimAutoWhitespaceLines[a],c=this.getLineMaxColumn(u);let h=!0;for(let d=0,f=r.length;d<f;d++){const m=r[d].range,p=r[d].text;if(!(u<m.startLineNumber||u>m.endLineNumber)&&!(u===m.startLineNumber&&m.startColumn===c&&m.isEmpty()&&p&&p.length>0&&p.charAt(0)===`
`)&&!(u===m.startLineNumber&&m.startColumn===1&&m.isEmpty()&&p&&p.length>0&&p.charAt(p.length-1)===`
`)){h=!1;break}}if(h){const d=new w(u,1,u,c);t.push(new br(null,d,null,!1,!1,!1))}}this._trimAutoWhitespaceLines=null}return this._initialUndoRedoSnapshot===null&&(this._initialUndoRedoSnapshot=this._undoRedoService.createSnapshot(this.uri)),this._commandManager.pushEditOperation(e,t,n,i)}_applyUndo(e,t,n,i){const r=e.map(o=>{const a=this.getPositionAt(o.newPosition),l=this.getPositionAt(o.newEnd);return{range:new w(a.lineNumber,a.column,l.lineNumber,l.column),text:o.oldText}});this._applyUndoRedoEdits(r,t,!0,!1,n,i)}_applyRedo(e,t,n,i){const r=e.map(o=>{const a=this.getPositionAt(o.oldPosition),l=this.getPositionAt(o.oldEnd);return{range:new w(a.lineNumber,a.column,l.lineNumber,l.column),text:o.newText}});this._applyUndoRedoEdits(r,t,!1,!0,n,i)}_applyUndoRedoEdits(e,t,n,i,r,o){try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),this._isUndoing=n,this._isRedoing=i,this.applyEdits(e,!1),this.setEOL(t),this._overwriteAlternativeVersionId(r)}finally{this._isUndoing=!1,this._isRedoing=!1,this._eventEmitter.endDeferredEmit(o),this._onDidChangeDecorations.endDeferredEmit()}}applyEdits(e,t=!1){try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit();const n=this._validateEditOperations(e);return this._doApplyEdits(n,t)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}_doApplyEdits(e,t){const n=this._buffer.getLineCount(),i=this._buffer.applyEdits(e,this._options.trimAutoWhitespace,t),r=this._buffer.getLineCount(),o=i.changes;if(this._trimAutoWhitespaceLines=i.trimAutoWhitespaceLineNumbers,o.length!==0){for(let u=0,c=o.length;u<c;u++){const h=o[u];this._decorationsTree.acceptReplace(h.rangeOffset,h.rangeLength,h.text.length,h.forceMoveMarkers)}const a=[];this._increaseVersionId();let l=n;for(let u=0,c=o.length;u<c;u++){const h=o[u],[d]=sn(h.text);this._onDidChangeDecorations.fire();const f=h.range.startLineNumber,m=h.range.endLineNumber,p=m-f,C=d,b=Math.min(p,C),L=C-p,_=r-l-L+f,k=_,S=_+C,N=this._decorationsTree.getInjectedTextInInterval(this,this.getOffsetAt(new I(k,1)),this.getOffsetAt(new I(S,this.getLineMaxColumn(S))),0),x=Et.fromDecorations(N),T=new ki(x);for(let E=b;E>=0;E--){const V=f+E,P=_+E;T.takeFromEndWhile(O=>O.lineNumber>P);const B=T.takeFromEndWhile(O=>O.lineNumber===P);a.push(new Ou(V,this.getLineContent(P),B))}if(b<p){const E=f+b;a.push(new NC(E+1,m))}if(b<C){const E=new ki(x),V=f+b,P=C-b,B=r-l-P+V+1,O=[],U=[];for(let ue=0;ue<P;ue++){const ge=B+ue;U[ue]=this.getLineContent(ge),E.takeWhile(ae=>ae.lineNumber<ge),O[ue]=E.takeWhile(ae=>ae.lineNumber===ge)}a.push(new xC(V+1,f+C,U,O))}l+=L}this._emitContentChangedEvent(new Mn(a,this.getVersionId(),this._isUndoing,this._isRedoing),{changes:o,eol:this._buffer.getEOL(),isEolChange:!1,versionId:this.getVersionId(),isUndoing:this._isUndoing,isRedoing:this._isRedoing,isFlush:!1})}return i.reverseEdits===null?void 0:i.reverseEdits}undo(){return this._undoRedoService.undo(this.uri)}canUndo(){return this._undoRedoService.canUndo(this.uri)}redo(){return this._undoRedoService.redo(this.uri)}canRedo(){return this._undoRedoService.canRedo(this.uri)}handleBeforeFireDecorationsChangedEvent(e){if(e===null||e.size===0)return;const n=Array.from(e).map(i=>new Ou(i,this.getLineContent(i),this._getInjectedTextInLine(i)));this._onDidChangeInjectedText.fire(new Lh(n))}changeDecorations(e,t=0){this._assertNotDisposed();try{return this._onDidChangeDecorations.beginDeferredEmit(),this._changeDecorations(t,e)}finally{this._onDidChangeDecorations.endDeferredEmit()}}_changeDecorations(e,t){const n={addDecoration:(r,o)=>this._deltaDecorationsImpl(e,[],[{range:r,options:o}])[0],changeDecoration:(r,o)=>{this._changeDecorationImpl(r,o)},changeDecorationOptions:(r,o)=>{this._changeDecorationOptionsImpl(r,Fu(o))},removeDecoration:r=>{this._deltaDecorationsImpl(e,[r],[])},deltaDecorations:(r,o)=>r.length===0&&o.length===0?[]:this._deltaDecorationsImpl(e,r,o)};let i=null;try{i=t(n)}catch(r){Tt(r)}return n.addDecoration=Qn,n.changeDecoration=Qn,n.changeDecorationOptions=Qn,n.removeDecoration=Qn,n.deltaDecorations=Qn,i}deltaDecorations(e,t,n=0){if(this._assertNotDisposed(),e||(e=[]),e.length===0&&t.length===0)return[];try{return this._deltaDecorationCallCnt++,this._deltaDecorationCallCnt>1&&(console.warn("Invoking deltaDecorations recursively could lead to leaking decorations."),Tt(new Error("Invoking deltaDecorations recursively could lead to leaking decorations."))),this._onDidChangeDecorations.beginDeferredEmit(),this._deltaDecorationsImpl(n,e,t)}finally{this._onDidChangeDecorations.endDeferredEmit(),this._deltaDecorationCallCnt--}}_getTrackedRange(e){return this.getDecorationRange(e)}_setTrackedRange(e,t,n){const i=e?this._decorations[e]:null;if(!i)return t?this._deltaDecorationsImpl(0,[],[{range:t,options:Wu[n]}],!0)[0]:null;if(!t)return this._decorationsTree.delete(i),delete this._decorations[i.id],null;const r=this._validateRangeRelaxedNoAllocations(t),o=this._buffer.getOffsetAt(r.startLineNumber,r.startColumn),a=this._buffer.getOffsetAt(r.endLineNumber,r.endColumn);return this._decorationsTree.delete(i),i.reset(this.getVersionId(),o,a,r),i.setOptions(Wu[n]),this._decorationsTree.insert(i),i.id}removeAllDecorationsWithOwnerId(e){if(this._isDisposed)return;const t=this._decorationsTree.collectNodesFromOwner(e);for(let n=0,i=t.length;n<i;n++){const r=t[n];this._decorationsTree.delete(r),delete this._decorations[r.id]}}getDecorationOptions(e){const t=this._decorations[e];return t?t.options:null}getDecorationRange(e){const t=this._decorations[e];return t?this._decorationsTree.getNodeRange(this,t):null}getLineDecorations(e,t=0,n=!1){return e<1||e>this.getLineCount()?[]:this.getLinesDecorations(e,e,t,n)}getLinesDecorations(e,t,n=0,i=!1,r=!1){const o=this.getLineCount(),a=Math.min(o,Math.max(1,e)),l=Math.min(o,Math.max(1,t)),u=this.getLineMaxColumn(l),c=new w(a,1,l,u),h=this._getDecorationsInRange(c,n,i,r);return Fr(h,this._decorationProvider.getDecorationsInRange(c,n,i)),h}getDecorationsInRange(e,t=0,n=!1,i=!1,r=!1){const o=this.validateRange(e),a=this._getDecorationsInRange(o,t,n,r);return Fr(a,this._decorationProvider.getDecorationsInRange(o,t,n,i)),a}getOverviewRulerDecorations(e=0,t=!1){return this._decorationsTree.getAll(this,e,t,!0,!1)}getInjectedTextDecorations(e=0){return this._decorationsTree.getAllInjectedText(this,e)}_getInjectedTextInLine(e){const t=this._buffer.getOffsetAt(e,1),n=t+this._buffer.getLineLength(e),i=this._decorationsTree.getInjectedTextInInterval(this,t,n,0);return Et.fromDecorations(i).filter(r=>r.lineNumber===e)}getAllDecorations(e=0,t=!1){let n=this._decorationsTree.getAll(this,e,t,!1,!1);return n=n.concat(this._decorationProvider.getAllDecorations(e,t)),n}getAllMarginDecorations(e=0){return this._decorationsTree.getAll(this,e,!1,!1,!0)}_getDecorationsInRange(e,t,n,i){const r=this._buffer.getOffsetAt(e.startLineNumber,e.startColumn),o=this._buffer.getOffsetAt(e.endLineNumber,e.endColumn);return this._decorationsTree.getAllInInterval(this,r,o,t,n,i)}getRangeAt(e,t){return this._buffer.getRangeAt(e,t-e)}_changeDecorationImpl(e,t){const n=this._decorations[e];if(!n)return;if(n.options.after){const a=this.getDecorationRange(e);this._onDidChangeDecorations.recordLineAffectedByInjectedText(a.endLineNumber)}if(n.options.before){const a=this.getDecorationRange(e);this._onDidChangeDecorations.recordLineAffectedByInjectedText(a.startLineNumber)}const i=this._validateRangeRelaxedNoAllocations(t),r=this._buffer.getOffsetAt(i.startLineNumber,i.startColumn),o=this._buffer.getOffsetAt(i.endLineNumber,i.endColumn);this._decorationsTree.delete(n),n.reset(this.getVersionId(),r,o,i),this._decorationsTree.insert(n),this._onDidChangeDecorations.checkAffectedAndFire(n.options),n.options.after&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(i.endLineNumber),n.options.before&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(i.startLineNumber)}_changeDecorationOptionsImpl(e,t){const n=this._decorations[e];if(!n)return;const i=!!(n.options.overviewRuler&&n.options.overviewRuler.color),r=!!(t.overviewRuler&&t.overviewRuler.color);if(this._onDidChangeDecorations.checkAffectedAndFire(n.options),this._onDidChangeDecorations.checkAffectedAndFire(t),n.options.after||t.after){const l=this._decorationsTree.getNodeRange(this,n);this._onDidChangeDecorations.recordLineAffectedByInjectedText(l.endLineNumber)}if(n.options.before||t.before){const l=this._decorationsTree.getNodeRange(this,n);this._onDidChangeDecorations.recordLineAffectedByInjectedText(l.startLineNumber)}const o=i!==r,a=OC(t)!==fs(n);o||a?(this._decorationsTree.delete(n),n.setOptions(t),this._decorationsTree.insert(n)):n.setOptions(t)}_deltaDecorationsImpl(e,t,n,i=!1){const r=this.getVersionId(),o=t.length;let a=0;const l=n.length;let u=0;this._onDidChangeDecorations.beginDeferredEmit();try{const c=new Array(l);for(;a<o||u<l;){let h=null;if(a<o){do h=this._decorations[t[a++]];while(!h&&a<o);if(h){if(h.options.after){const d=this._decorationsTree.getNodeRange(this,h);this._onDidChangeDecorations.recordLineAffectedByInjectedText(d.endLineNumber)}if(h.options.before){const d=this._decorationsTree.getNodeRange(this,h);this._onDidChangeDecorations.recordLineAffectedByInjectedText(d.startLineNumber)}this._decorationsTree.delete(h),i||this._onDidChangeDecorations.checkAffectedAndFire(h.options)}}if(u<l){if(!h){const b=++this._lastDecorationId,L=`${this._instanceId};${b}`;h=new fh(L,0,0),this._decorations[L]=h}const d=n[u],f=this._validateRangeRelaxedNoAllocations(d.range),m=Fu(d.options),p=this._buffer.getOffsetAt(f.startLineNumber,f.startColumn),C=this._buffer.getOffsetAt(f.endLineNumber,f.endColumn);h.ownerId=e,h.reset(r,p,C,f),h.setOptions(m),h.options.after&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(f.endLineNumber),h.options.before&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(f.startLineNumber),i||this._onDidChangeDecorations.checkAffectedAndFire(m),this._decorationsTree.insert(h),c[u]=h.id,u++}else h&&delete this._decorations[h.id]}return c}finally{this._onDidChangeDecorations.endDeferredEmit()}}getLanguageId(){return this.tokenization.getLanguageId()}setLanguage(e,t){typeof e=="string"?(this._languageSelectionListener.clear(),this._setLanguage(e,t)):(this._languageSelectionListener.value=e.onDidChange(()=>this._setLanguage(e.languageId,t)),this._setLanguage(e.languageId,t))}_setLanguage(e,t){this.tokenization.setLanguageId(e,t),this._languageService.requestRichLanguageFeatures(e)}getLanguageIdAtPosition(e,t){return this.tokenization.getLanguageIdAtPosition(e,t)}getWordAtPosition(e){return this._tokenizationTextModelPart.getWordAtPosition(e)}getWordUntilPosition(e){return this._tokenizationTextModelPart.getWordUntilPosition(e)}normalizePosition(e,t){return e}getLineIndentColumn(e){return DC(this.getLineContent(e))+1}},qt=Ye,Ye._MODEL_SYNC_LIMIT=50*1024*1024,Ye.LARGE_FILE_SIZE_THRESHOLD=20*1024*1024,Ye.LARGE_FILE_LINE_COUNT_THRESHOLD=300*1e3,Ye.LARGE_FILE_HEAP_OPERATION_THRESHOLD=256*1024*1024,Ye.DEFAULT_CREATION_OPTIONS={isForSimpleWidget:!1,tabSize:ve.tabSize,indentSize:ve.indentSize,insertSpaces:ve.insertSpaces,detectIndentation:!1,defaultEOL:1,trimAutoWhitespace:ve.trimAutoWhitespace,largeFileOptimizations:ve.largeFileOptimizations,bracketPairColorizationOptions:ve.bracketPairColorizationOptions},Ye);Lo=qt=EC([ts(4,kc),ts(5,zi),ts(6,rr),ts(7,vc)],Lo);function DC(s){let e=0;for(const t of s)if(t===" "||t==="	")e++;else break;return e}function Rr(s){return!!(s.options.overviewRuler&&s.options.overviewRuler.color)}function OC(s){return!!s.after||!!s.before}function fs(s){return!!s.options.after||!!s.options.before}class Vu{constructor(){this._decorationsTree0=new xr,this._decorationsTree1=new xr,this._injectedTextDecorationsTree=new xr}ensureAllNodesHaveRanges(e){this.getAll(e,0,!1,!1,!1)}_ensureNodesHaveRanges(e,t){for(const n of t)n.range===null&&(n.range=e.getRangeAt(n.cachedAbsoluteStart,n.cachedAbsoluteEnd));return t}getAllInInterval(e,t,n,i,r,o){const a=e.getVersionId(),l=this._intervalSearch(t,n,i,r,a,o);return this._ensureNodesHaveRanges(e,l)}_intervalSearch(e,t,n,i,r,o){const a=this._decorationsTree0.intervalSearch(e,t,n,i,r,o),l=this._decorationsTree1.intervalSearch(e,t,n,i,r,o),u=this._injectedTextDecorationsTree.intervalSearch(e,t,n,i,r,o);return a.concat(l).concat(u)}getInjectedTextInInterval(e,t,n,i){const r=e.getVersionId(),o=this._injectedTextDecorationsTree.intervalSearch(t,n,i,!1,r,!1);return this._ensureNodesHaveRanges(e,o).filter(a=>a.options.showIfCollapsed||!a.range.isEmpty())}getAllInjectedText(e,t){const n=e.getVersionId(),i=this._injectedTextDecorationsTree.search(t,!1,n,!1);return this._ensureNodesHaveRanges(e,i).filter(r=>r.options.showIfCollapsed||!r.range.isEmpty())}getAll(e,t,n,i,r){const o=e.getVersionId(),a=this._search(t,n,i,o,r);return this._ensureNodesHaveRanges(e,a)}_search(e,t,n,i,r){if(n)return this._decorationsTree1.search(e,t,i,r);{const o=this._decorationsTree0.search(e,t,i,r),a=this._decorationsTree1.search(e,t,i,r),l=this._injectedTextDecorationsTree.search(e,t,i,r);return o.concat(a).concat(l)}}collectNodesFromOwner(e){const t=this._decorationsTree0.collectNodesFromOwner(e),n=this._decorationsTree1.collectNodesFromOwner(e),i=this._injectedTextDecorationsTree.collectNodesFromOwner(e);return t.concat(n).concat(i)}collectNodesPostOrder(){const e=this._decorationsTree0.collectNodesPostOrder(),t=this._decorationsTree1.collectNodesPostOrder(),n=this._injectedTextDecorationsTree.collectNodesPostOrder();return e.concat(t).concat(n)}insert(e){fs(e)?this._injectedTextDecorationsTree.insert(e):Rr(e)?this._decorationsTree1.insert(e):this._decorationsTree0.insert(e)}delete(e){fs(e)?this._injectedTextDecorationsTree.delete(e):Rr(e)?this._decorationsTree1.delete(e):this._decorationsTree0.delete(e)}getNodeRange(e,t){const n=e.getVersionId();return t.cachedVersionId!==n&&this._resolveNode(t,n),t.range===null&&(t.range=e.getRangeAt(t.cachedAbsoluteStart,t.cachedAbsoluteEnd)),t.range}_resolveNode(e,t){fs(e)?this._injectedTextDecorationsTree.resolveNode(e,t):Rr(e)?this._decorationsTree1.resolveNode(e,t):this._decorationsTree0.resolveNode(e,t)}acceptReplace(e,t,n,i){this._decorationsTree0.acceptReplace(e,t,n,i),this._decorationsTree1.acceptReplace(e,t,n,i),this._injectedTextDecorationsTree.acceptReplace(e,t,n,i)}}function Ke(s){return s.replace(/[^a-z0-9\-_]/gi," ")}class wh{constructor(e){this.color=e.color||"",this.darkColor=e.darkColor||""}}class BC extends wh{constructor(e){super(e),this._resolvedColor=null,this.position=typeof e.position=="number"?e.position:Is.Center}getColor(e){return this._resolvedColor||(e.type!=="light"&&this.darkColor?this._resolvedColor=this._resolveColor(this.darkColor,e):this._resolvedColor=this._resolveColor(this.color,e)),this._resolvedColor}invalidateCachedColor(){this._resolvedColor=null}_resolveColor(e,t){if(typeof e=="string")return e;const n=e?t.getColor(e.id):null;return n?n.toString():""}}class VC{constructor(e){this.position=(e==null?void 0:e.position)??xi.Center,this.persistLane=e==null?void 0:e.persistLane}}class WC extends wh{constructor(e){super(e),this.position=e.position,this.sectionHeaderStyle=e.sectionHeaderStyle??null,this.sectionHeaderText=e.sectionHeaderText??null}getColor(e){return this._resolvedColor||(e.type!=="light"&&this.darkColor?this._resolvedColor=this._resolveColor(this.darkColor,e):this._resolvedColor=this._resolveColor(this.color,e)),this._resolvedColor}invalidateCachedColor(){this._resolvedColor=void 0}_resolveColor(e,t){return typeof e=="string"?fe.fromHex(e):t.getColor(e.id)}}class Ai{static from(e){return e instanceof Ai?e:new Ai(e)}constructor(e){this.content=e.content||"",this.inlineClassName=e.inlineClassName||null,this.inlineClassNameAffectsLetterSpacing=e.inlineClassNameAffectsLetterSpacing||!1,this.attachedData=e.attachedData||null,this.cursorStops=e.cursorStops||null}}class $e{static register(e){return new $e(e)}static createDynamic(e){return new $e(e)}constructor(e){this.description=e.description,this.blockClassName=e.blockClassName?Ke(e.blockClassName):null,this.blockDoesNotCollapse=e.blockDoesNotCollapse??null,this.blockIsAfterEnd=e.blockIsAfterEnd??null,this.blockPadding=e.blockPadding??null,this.stickiness=e.stickiness||0,this.zIndex=e.zIndex||0,this.className=e.className?Ke(e.className):null,this.shouldFillLineOnLineBreak=e.shouldFillLineOnLineBreak??null,this.hoverMessage=e.hoverMessage||null,this.glyphMarginHoverMessage=e.glyphMarginHoverMessage||null,this.lineNumberHoverMessage=e.lineNumberHoverMessage||null,this.isWholeLine=e.isWholeLine||!1,this.showIfCollapsed=e.showIfCollapsed||!1,this.collapseOnReplaceEdit=e.collapseOnReplaceEdit||!1,this.overviewRuler=e.overviewRuler?new BC(e.overviewRuler):null,this.minimap=e.minimap?new WC(e.minimap):null,this.glyphMargin=e.glyphMarginClassName?new VC(e.glyphMargin):null,this.glyphMarginClassName=e.glyphMarginClassName?Ke(e.glyphMarginClassName):null,this.linesDecorationsClassName=e.linesDecorationsClassName?Ke(e.linesDecorationsClassName):null,this.lineNumberClassName=e.lineNumberClassName?Ke(e.lineNumberClassName):null,this.linesDecorationsTooltip=e.linesDecorationsTooltip?vd(e.linesDecorationsTooltip):null,this.firstLineDecorationClassName=e.firstLineDecorationClassName?Ke(e.firstLineDecorationClassName):null,this.marginClassName=e.marginClassName?Ke(e.marginClassName):null,this.inlineClassName=e.inlineClassName?Ke(e.inlineClassName):null,this.inlineClassNameAffectsLetterSpacing=e.inlineClassNameAffectsLetterSpacing||!1,this.beforeContentClassName=e.beforeContentClassName?Ke(e.beforeContentClassName):null,this.afterContentClassName=e.afterContentClassName?Ke(e.afterContentClassName):null,this.after=e.after?Ai.from(e.after):null,this.before=e.before?Ai.from(e.before):null,this.hideInCommentTokens=e.hideInCommentTokens??!1,this.hideInStringTokens=e.hideInStringTokens??!1}}$e.EMPTY=$e.register({description:"empty"});const Wu=[$e.register({description:"tracked-range-always-grows-when-typing-at-edges",stickiness:0}),$e.register({description:"tracked-range-never-grows-when-typing-at-edges",stickiness:1}),$e.register({description:"tracked-range-grows-only-when-typing-before",stickiness:2}),$e.register({description:"tracked-range-grows-only-when-typing-after",stickiness:3})];function Fu(s){return s instanceof $e?s:$e.createDynamic(s)}class FC extends oe{constructor(e){super(),this.handleBeforeFire=e,this._actual=this._register(new J),this.event=this._actual.event,this._affectedInjectedTextLines=null,this._deferredCnt=0,this._shouldFireDeferred=!1,this._affectsMinimap=!1,this._affectsOverviewRuler=!1,this._affectsGlyphMargin=!1,this._affectsLineNumber=!1}beginDeferredEmit(){this._deferredCnt++}endDeferredEmit(){var e;this._deferredCnt--,this._deferredCnt===0&&(this._shouldFireDeferred&&this.doFire(),(e=this._affectedInjectedTextLines)==null||e.clear(),this._affectedInjectedTextLines=null)}recordLineAffectedByInjectedText(e){this._affectedInjectedTextLines||(this._affectedInjectedTextLines=new Set),this._affectedInjectedTextLines.add(e)}checkAffectedAndFire(e){var t,n;this._affectsMinimap||(this._affectsMinimap=!!((t=e.minimap)!=null&&t.position)),this._affectsOverviewRuler||(this._affectsOverviewRuler=!!((n=e.overviewRuler)!=null&&n.color)),this._affectsGlyphMargin||(this._affectsGlyphMargin=!!e.glyphMarginClassName),this._affectsLineNumber||(this._affectsLineNumber=!!e.lineNumberClassName),this.tryFire()}fire(){this._affectsMinimap=!0,this._affectsOverviewRuler=!0,this._affectsGlyphMargin=!0,this.tryFire()}tryFire(){this._deferredCnt===0?this.doFire():this._shouldFireDeferred=!0}doFire(){this.handleBeforeFire(this._affectedInjectedTextLines);const e={affectsMinimap:this._affectsMinimap,affectsOverviewRuler:this._affectsOverviewRuler,affectsGlyphMargin:this._affectsGlyphMargin,affectsLineNumber:this._affectsLineNumber};this._shouldFireDeferred=!1,this._affectsMinimap=!1,this._affectsOverviewRuler=!1,this._affectsGlyphMargin=!1,this._actual.fire(e)}}class zC extends oe{constructor(){super(),this._fastEmitter=this._register(new J),this.fastEvent=this._fastEmitter.event,this._slowEmitter=this._register(new J),this.slowEvent=this._slowEmitter.event,this._deferredCnt=0,this._deferredEvent=null}beginDeferredEmit(){this._deferredCnt++}endDeferredEmit(e=null){if(this._deferredCnt--,this._deferredCnt===0&&this._deferredEvent!==null){this._deferredEvent.rawContentChangedEvent.resultingSelection=e;const t=this._deferredEvent;this._deferredEvent=null,this._fastEmitter.fire(t),this._slowEmitter.fire(t)}}fire(e){if(this._deferredCnt>0){this._deferredEvent?this._deferredEvent=this._deferredEvent.merge(e):this._deferredEvent=e;return}this._fastEmitter.fire(e),this._slowEmitter.fire(e)}}var HC=function(s,e,t,n){var i=arguments.length,r=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,n);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(i<3?o(r):i>3?o(e,t,r):o(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},is=function(s,e){return function(t,n){e(t,n,s)}},bn;function zt(s){return s.toString()}class jC{constructor(e,t,n){this.model=e,this._modelEventListeners=new tr,this.model=e,this._modelEventListeners.add(e.onWillDispose(()=>t(e))),this._modelEventListeners.add(e.onDidChangeLanguage(i=>n(e,i)))}dispose(){this._modelEventListeners.dispose()}}const UC=Cs||xt?1:2;class qC{constructor(e,t,n,i,r,o,a,l){this.uri=e,this.initialUndoRedoSnapshot=t,this.time=n,this.sharesUndoRedoStack=i,this.heapSize=r,this.sha1=o,this.versionId=a,this.alternativeVersionId=l}}var en;let zu=(en=class extends oe{constructor(e,t,n,i){super(),this._configurationService=e,this._resourcePropertiesService=t,this._undoRedoService=n,this._instantiationService=i,this._onModelAdded=this._register(new J),this.onModelAdded=this._onModelAdded.event,this._onModelRemoved=this._register(new J),this.onModelRemoved=this._onModelRemoved.event,this._onModelModeChanged=this._register(new J),this.onModelLanguageChanged=this._onModelModeChanged.event,this._modelCreationOptionsByLanguageAndResource=Object.create(null),this._models={},this._disposedModels=new Map,this._disposedModelsHeapSize=0,this._register(this._configurationService.onDidChangeConfiguration(r=>this._updateModelOptions(r))),this._updateModelOptions(void 0)}static _readModelOptions(e,t){var d;let n=ve.tabSize;if(e.editor&&typeof e.editor.tabSize<"u"){const f=parseInt(e.editor.tabSize,10);isNaN(f)||(n=f),n<1&&(n=1)}let i="tabSize";if(e.editor&&typeof e.editor.indentSize<"u"&&e.editor.indentSize!=="tabSize"){const f=parseInt(e.editor.indentSize,10);isNaN(f)||(i=Math.max(f,1))}let r=ve.insertSpaces;e.editor&&typeof e.editor.insertSpaces<"u"&&(r=e.editor.insertSpaces==="false"?!1:!!e.editor.insertSpaces);let o=UC;const a=e.eol;a===`\r
`?o=2:a===`
`&&(o=1);let l=ve.trimAutoWhitespace;e.editor&&typeof e.editor.trimAutoWhitespace<"u"&&(l=e.editor.trimAutoWhitespace==="false"?!1:!!e.editor.trimAutoWhitespace);let u=ve.detectIndentation;e.editor&&typeof e.editor.detectIndentation<"u"&&(u=e.editor.detectIndentation==="false"?!1:!!e.editor.detectIndentation);let c=ve.largeFileOptimizations;e.editor&&typeof e.editor.largeFileOptimizations<"u"&&(c=e.editor.largeFileOptimizations==="false"?!1:!!e.editor.largeFileOptimizations);let h=ve.bracketPairColorizationOptions;return(d=e.editor)!=null&&d.bracketPairColorization&&typeof e.editor.bracketPairColorization=="object"&&(h={enabled:!!e.editor.bracketPairColorization.enabled,independentColorPoolPerBracketType:!!e.editor.bracketPairColorization.independentColorPoolPerBracketType}),{isForSimpleWidget:t,tabSize:n,indentSize:i,insertSpaces:r,detectIndentation:u,defaultEOL:o,trimAutoWhitespace:l,largeFileOptimizations:c,bracketPairColorizationOptions:h}}_getEOL(e,t){if(e)return this._resourcePropertiesService.getEOL(e,t);const n=this._configurationService.getValue("files.eol",{overrideIdentifier:t});return n&&typeof n=="string"&&n!=="auto"?n:ba===3||ba===2?`
`:`\r
`}_shouldRestoreUndoStack(){const e=this._configurationService.getValue("files.restoreUndoStack");return typeof e=="boolean"?e:!0}getCreationOptions(e,t,n){const i=typeof e=="string"?e:e.languageId;let r=this._modelCreationOptionsByLanguageAndResource[i+t];if(!r){const o=this._configurationService.getValue("editor",{overrideIdentifier:i,resource:t}),a=this._getEOL(t,i);r=bn._readModelOptions({editor:o,eol:a},n),this._modelCreationOptionsByLanguageAndResource[i+t]=r}return r}_updateModelOptions(e){const t=this._modelCreationOptionsByLanguageAndResource;this._modelCreationOptionsByLanguageAndResource=Object.create(null);const n=Object.keys(this._models);for(let i=0,r=n.length;i<r;i++){const o=n[i],a=this._models[o],l=a.model.getLanguageId(),u=a.model.uri;if(e&&!e.affectsConfiguration("editor",{overrideIdentifier:l,resource:u})&&!e.affectsConfiguration("files.eol",{overrideIdentifier:l,resource:u}))continue;const c=t[l+u],h=this.getCreationOptions(l,u,a.model.isForSimpleWidget);bn._setModelOptionsForModel(a.model,h,c)}}static _setModelOptionsForModel(e,t,n){n&&n.defaultEOL!==t.defaultEOL&&e.getLineCount()===1&&e.setEOL(t.defaultEOL===1?0:1),!(n&&n.detectIndentation===t.detectIndentation&&n.insertSpaces===t.insertSpaces&&n.tabSize===t.tabSize&&n.indentSize===t.indentSize&&n.trimAutoWhitespace===t.trimAutoWhitespace&&bs(n.bracketPairColorizationOptions,t.bracketPairColorizationOptions))&&(t.detectIndentation?(e.detectIndentation(t.insertSpaces,t.tabSize),e.updateOptions({trimAutoWhitespace:t.trimAutoWhitespace,bracketColorizationOptions:t.bracketPairColorizationOptions})):e.updateOptions({insertSpaces:t.insertSpaces,tabSize:t.tabSize,indentSize:t.indentSize,trimAutoWhitespace:t.trimAutoWhitespace,bracketColorizationOptions:t.bracketPairColorizationOptions}))}_insertDisposedModel(e){this._disposedModels.set(zt(e.uri),e),this._disposedModelsHeapSize+=e.heapSize}_removeDisposedModel(e){const t=this._disposedModels.get(zt(e));return t&&(this._disposedModelsHeapSize-=t.heapSize),this._disposedModels.delete(zt(e)),t}_ensureDisposedModelsHeapSize(e){if(this._disposedModelsHeapSize>e){const t=[];for(this._disposedModels.forEach(n=>{n.sharesUndoRedoStack||t.push(n)}),t.sort((n,i)=>n.time-i.time);t.length>0&&this._disposedModelsHeapSize>e;){const n=t.shift();this._removeDisposedModel(n.uri),n.initialUndoRedoSnapshot!==null&&this._undoRedoService.restoreSnapshot(n.initialUndoRedoSnapshot)}}}_createModelData(e,t,n,i){const r=this.getCreationOptions(t,n,i),o=this._instantiationService.createInstance(Lo,e,t,r,n);if(n&&this._disposedModels.has(zt(n))){const u=this._removeDisposedModel(n),c=this._undoRedoService.getElements(n),h=this._getSHA1Computer(),d=h.canComputeSHA1(o)?h.computeSHA1(o)===u.sha1:!1;if(d||u.sharesUndoRedoStack){for(const f of c.past)St(f)&&f.matchesResource(n)&&f.setModel(o);for(const f of c.future)St(f)&&f.matchesResource(n)&&f.setModel(o);this._undoRedoService.setElementsValidFlag(n,!0,f=>St(f)&&f.matchesResource(n)),d&&(o._overwriteVersionId(u.versionId),o._overwriteAlternativeVersionId(u.alternativeVersionId),o._overwriteInitialUndoRedoSnapshot(u.initialUndoRedoSnapshot))}else u.initialUndoRedoSnapshot!==null&&this._undoRedoService.restoreSnapshot(u.initialUndoRedoSnapshot)}const a=zt(o.uri);if(this._models[a])throw new Error("ModelService: Cannot add model because it already exists!");const l=new jC(o,u=>this._onWillDispose(u),(u,c)=>this._onDidChangeLanguage(u,c));return this._models[a]=l,l}createModel(e,t,n,i=!1){let r;return t?r=this._createModelData(e,t,n,i):r=this._createModelData(e,at,n,i),this._onModelAdded.fire(r.model),r.model}getModels(){const e=[],t=Object.keys(this._models);for(let n=0,i=t.length;n<i;n++){const r=t[n];e.push(this._models[r].model)}return e}getModel(e){const t=zt(e),n=this._models[t];return n?n.model:null}_schemaShouldMaintainUndoRedoElements(e){return e.scheme===Ge.file||e.scheme===Ge.vscodeRemote||e.scheme===Ge.vscodeUserData||e.scheme===Ge.vscodeNotebookCell||e.scheme==="fake-fs"}_onWillDispose(e){const t=zt(e.uri),n=this._models[t],i=this._undoRedoService.getUriComparisonKey(e.uri)!==e.uri.toString();let r=!1,o=0;if(i||this._shouldRestoreUndoStack()&&this._schemaShouldMaintainUndoRedoElements(e.uri)){const u=this._undoRedoService.getElements(e.uri);if(u.past.length>0||u.future.length>0){for(const c of u.past)St(c)&&c.matchesResource(e.uri)&&(r=!0,o+=c.heapSize(e.uri),c.setModel(e.uri));for(const c of u.future)St(c)&&c.matchesResource(e.uri)&&(r=!0,o+=c.heapSize(e.uri),c.setModel(e.uri))}}const a=bn.MAX_MEMORY_FOR_CLOSED_FILES_UNDO_STACK,l=this._getSHA1Computer();if(r)if(!i&&(o>a||!l.canComputeSHA1(e))){const u=n.model.getInitialUndoRedoSnapshot();u!==null&&this._undoRedoService.restoreSnapshot(u)}else this._ensureDisposedModelsHeapSize(a-o),this._undoRedoService.setElementsValidFlag(e.uri,!1,u=>St(u)&&u.matchesResource(e.uri)),this._insertDisposedModel(new qC(e.uri,n.model.getInitialUndoRedoSnapshot(),Date.now(),i,o,l.computeSHA1(e),e.getVersionId(),e.getAlternativeVersionId()));else if(!i){const u=n.model.getInitialUndoRedoSnapshot();u!==null&&this._undoRedoService.restoreSnapshot(u)}delete this._models[t],n.dispose(),delete this._modelCreationOptionsByLanguageAndResource[e.getLanguageId()+e.uri],this._onModelRemoved.fire(e)}_onDidChangeLanguage(e,t){const n=t.oldLanguage,i=e.getLanguageId(),r=this.getCreationOptions(n,e.uri,e.isForSimpleWidget),o=this.getCreationOptions(i,e.uri,e.isForSimpleWidget);bn._setModelOptionsForModel(e,o,r),this._onModelModeChanged.fire({model:e,oldLanguageId:n})}_getSHA1Computer(){return new wo}},bn=en,en.MAX_MEMORY_FOR_CLOSED_FILES_UNDO_STACK=20*1024*1024,en);zu=bn=HC([is(0,Lc),is(1,Em),is(2,kc),is(3,vc)],zu);const Zs=class Zs{canComputeSHA1(e){return e.getValueLength()<=Zs.MAX_MODEL_SIZE}computeSHA1(e){const t=new Id,n=e.createSnapshot();let i;for(;i=n.read();)t.update(i);return t.digest()}};Zs.MAX_MODEL_SIZE=10*1024*1024;let wo=Zs;class GC{constructor(e,t,n,i,r){this._parsedThemeRuleBrand=void 0,this.token=e,this.index=t,this.fontStyle=n,this.foreground=i,this.background=r}}function $C(s){if(!s||!Array.isArray(s))return[];const e=[];let t=0;for(let n=0,i=s.length;n<i;n++){const r=s[n];let o=-1;if(typeof r.fontStyle=="string"){o=0;const u=r.fontStyle.split(" ");for(let c=0,h=u.length;c<h;c++)switch(u[c]){case"italic":o=o|1;break;case"bold":o=o|2;break;case"underline":o=o|4;break;case"strikethrough":o=o|8;break}}let a=null;typeof r.foreground=="string"&&(a=r.foreground);let l=null;typeof r.background=="string"&&(l=r.background),e[t++]=new GC(r.token||"",n,o,a,l)}return e}function QC(s,e){s.sort((c,h)=>{const d=eb(c.token,h.token);return d!==0?d:c.index-h.index});let t=0,n="000000",i="ffffff";for(;s.length>=1&&s[0].token==="";){const c=s.shift();c.fontStyle!==-1&&(t=c.fontStyle),c.foreground!==null&&(n=c.foreground),c.background!==null&&(i=c.background)}const r=new XC;for(const c of e)r.getId(c);const o=r.getId(n),a=r.getId(i),l=new Xo(t,o,a),u=new Jo(l);for(let c=0,h=s.length;c<h;c++){const d=s[c];u.insert(d.token,d.fontStyle,r.getId(d.foreground),r.getId(d.background))}return new JC(r,u)}const ZC=/^#?([0-9A-Fa-f]{6})([0-9A-Fa-f]{2})?$/;class XC{constructor(){this._lastColorId=0,this._id2color=[],this._color2id=new Map}getId(e){if(e===null)return 0;const t=e.match(ZC);if(!t)throw new Error("Illegal value for token color: "+e);e=t[1].toUpperCase();let n=this._color2id.get(e);return n||(n=++this._lastColorId,this._color2id.set(e,n),this._id2color[n]=fe.fromHex("#"+e),n)}getColorMap(){return this._id2color.slice(0)}}class JC{static createFromRawTokenTheme(e,t){return this.createFromParsedTokenTheme($C(e),t)}static createFromParsedTokenTheme(e,t){return QC(e,t)}constructor(e,t){this._colorMap=e,this._root=t,this._cache=new Map}getColorMap(){return this._colorMap.getColorMap()}_match(e){return this._root.match(e)}match(e,t){let n=this._cache.get(t);if(typeof n>"u"){const i=this._match(t),r=KC(t);n=(i.metadata|r<<8)>>>0,this._cache.set(t,n)}return(n|e<<0)>>>0}}const YC=/\b(comment|string|regex|regexp)\b/;function KC(s){const e=s.match(YC);if(!e)return 0;switch(e[1]){case"comment":return 1;case"string":return 2;case"regex":return 3;case"regexp":return 3}throw new Error("Unexpected match for standard token type!")}function eb(s,e){return s<e?-1:s>e?1:0}class Xo{constructor(e,t,n){this._themeTrieElementRuleBrand=void 0,this._fontStyle=e,this._foreground=t,this._background=n,this.metadata=(this._fontStyle<<11|this._foreground<<15|this._background<<24)>>>0}clone(){return new Xo(this._fontStyle,this._foreground,this._background)}acceptOverwrite(e,t,n){e!==-1&&(this._fontStyle=e),t!==0&&(this._foreground=t),n!==0&&(this._background=n),this.metadata=(this._fontStyle<<11|this._foreground<<15|this._background<<24)>>>0}}class Jo{constructor(e){this._themeTrieElementBrand=void 0,this._mainRule=e,this._children=new Map}match(e){if(e==="")return this._mainRule;const t=e.indexOf(".");let n,i;t===-1?(n=e,i=""):(n=e.substring(0,t),i=e.substring(t+1));const r=this._children.get(n);return typeof r<"u"?r.match(i):this._mainRule}insert(e,t,n,i){if(e===""){this._mainRule.acceptOverwrite(t,n,i);return}const r=e.indexOf(".");let o,a;r===-1?(o=e,a=""):(o=e.substring(0,r),a=e.substring(r+1));let l=this._children.get(o);typeof l>"u"&&(l=new Jo(this._mainRule.clone()),this._children.set(o,l)),l.insert(a,t,n,i)}}function d_(s){const e=[];for(let t=1,n=s.length;t<n;t++){const i=s[t];e[t]=`.mtk${t} { color: ${i}; }`}return e.push(".mtki { font-style: italic; }"),e.push(".mtkb { font-weight: bold; }"),e.push(".mtku { text-decoration: underline; text-underline-position: under; }"),e.push(".mtks { text-decoration: line-through; }"),e.push(".mtks.mtku { text-decoration: underline line-through; text-underline-position: under; }"),e.join(`
`)}const _h=[];function f_(s){_h.push(s)}function g_(){return _h.slice(0)}const m_={ICodeEditor:"vs.editor.ICodeEditor",IDiffEditor:"vs.editor.IDiffEditor"};class Dt{constructor(e,t,n,i){this.startColumn=e,this.endColumn=t,this.className=n,this.type=i,this._lineDecorationBrand=void 0}static _equals(e,t){return e.startColumn===t.startColumn&&e.endColumn===t.endColumn&&e.className===t.className&&e.type===t.type}static equalsArr(e,t){const n=e.length,i=t.length;if(n!==i)return!1;for(let r=0;r<n;r++)if(!Dt._equals(e[r],t[r]))return!1;return!0}static extractWrapped(e,t,n){if(e.length===0)return e;const i=t+1,r=n+1,o=n-t,a=[];let l=0;for(const u of e)u.endColumn<=i||u.startColumn>=r||(a[l++]=new Dt(Math.max(1,u.startColumn-i+1),Math.min(o+1,u.endColumn-i+1),u.className,u.type));return a}static filter(e,t,n,i){if(e.length===0)return[];const r=[];let o=0;for(let a=0,l=e.length;a<l;a++){const u=e[a],c=u.range;if(c.endLineNumber<t||c.startLineNumber>t||c.isEmpty()&&(u.type===0||u.type===3))continue;const h=c.startLineNumber===t?c.startColumn:n,d=c.endLineNumber===t?c.endColumn:i;r[o++]=new Dt(h,d,u.inlineClassName,u.type)}return r}static _typeCompare(e,t){const n=[2,0,1,3];return n[e]-n[t]}static compare(e,t){if(e.startColumn!==t.startColumn)return e.startColumn-t.startColumn;if(e.endColumn!==t.endColumn)return e.endColumn-t.endColumn;const n=Dt._typeCompare(e.type,t.type);return n!==0?n:e.className!==t.className?e.className<t.className?-1:1:0}}class Hu{constructor(e,t,n,i){this.startOffset=e,this.endOffset=t,this.className=n,this.metadata=i}}class Os{constructor(){this.stopOffsets=[],this.classNames=[],this.metadata=[],this.count=0}static _metadata(e){let t=0;for(let n=0,i=e.length;n<i;n++)t|=e[n];return t}consumeLowerThan(e,t,n){for(;this.count>0&&this.stopOffsets[0]<e;){let i=0;for(;i+1<this.count&&this.stopOffsets[i]===this.stopOffsets[i+1];)i++;n.push(new Hu(t,this.stopOffsets[i],this.classNames.join(" "),Os._metadata(this.metadata))),t=this.stopOffsets[i]+1,this.stopOffsets.splice(0,i+1),this.classNames.splice(0,i+1),this.metadata.splice(0,i+1),this.count-=i+1}return this.count>0&&t<e&&(n.push(new Hu(t,e-1,this.classNames.join(" "),Os._metadata(this.metadata))),t=e),t}insert(e,t,n){if(this.count===0||this.stopOffsets[this.count-1]<=e)this.stopOffsets.push(e),this.classNames.push(t),this.metadata.push(n);else for(let i=0;i<this.count;i++)if(this.stopOffsets[i]>=e){this.stopOffsets.splice(i,0,e),this.classNames.splice(i,0,t),this.metadata.splice(i,0,n);break}this.count++}}class tb{static normalize(e,t){if(t.length===0)return[];const n=[],i=new Os;let r=0;for(let o=0,a=t.length;o<a;o++){const l=t[o];let u=l.startColumn,c=l.endColumn;const h=l.className,d=l.type===1?2:l.type===2?4:0;if(u>1){const p=e.charCodeAt(u-2);Ne(p)&&u--}if(c>1){const p=e.charCodeAt(c-2);Ne(p)&&c--}const f=u-1,m=c-2;r=i.consumeLowerThan(f,r,n),i.count===0&&(r=f),i.insert(m,h,d)}return i.consumeLowerThan(1073741824,r,n),n}}class pe{constructor(e,t,n,i){this.endIndex=e,this.type=t,this.metadata=n,this.containsRTL=i,this._linePartBrand=void 0}isWhitespace(){return!!(this.metadata&1)}isPseudoAfter(){return!!(this.metadata&4)}}class p_{constructor(e,t){this.startOffset=e,this.endOffset=t}equals(e){return this.startOffset===e.startOffset&&this.endOffset===e.endOffset}}class C_{constructor(e,t,n,i,r,o,a,l,u,c,h,d,f,m,p,C,b,L,_){this.useMonospaceOptimizations=e,this.canUseHalfwidthRightwardsArrow=t,this.lineContent=n,this.continuesWithWrappedLine=i,this.isBasicASCII=r,this.containsRTL=o,this.fauxIndentLength=a,this.lineTokens=l,this.lineDecorations=u.sort(Dt.compare),this.tabSize=c,this.startVisibleColumn=h,this.spaceWidth=d,this.stopRenderingLineAfter=p,this.renderWhitespace=C==="all"?4:C==="boundary"?1:C==="selection"?2:C==="trailing"?3:0,this.renderControlCharacters=b,this.fontLigatures=L,this.selectionsOnLine=_&&_.sort((N,x)=>N.startOffset<x.startOffset?-1:1);const k=Math.abs(m-d),S=Math.abs(f-d);k<S?(this.renderSpaceWidth=m,this.renderSpaceCharCode=11825):(this.renderSpaceWidth=f,this.renderSpaceCharCode=183)}sameSelection(e){if(this.selectionsOnLine===null)return e===null;if(e===null||e.length!==this.selectionsOnLine.length)return!1;for(let t=0;t<this.selectionsOnLine.length;t++)if(!this.selectionsOnLine[t].equals(e[t]))return!1;return!0}equals(e){return this.useMonospaceOptimizations===e.useMonospaceOptimizations&&this.canUseHalfwidthRightwardsArrow===e.canUseHalfwidthRightwardsArrow&&this.lineContent===e.lineContent&&this.continuesWithWrappedLine===e.continuesWithWrappedLine&&this.isBasicASCII===e.isBasicASCII&&this.containsRTL===e.containsRTL&&this.fauxIndentLength===e.fauxIndentLength&&this.tabSize===e.tabSize&&this.startVisibleColumn===e.startVisibleColumn&&this.spaceWidth===e.spaceWidth&&this.renderSpaceWidth===e.renderSpaceWidth&&this.renderSpaceCharCode===e.renderSpaceCharCode&&this.stopRenderingLineAfter===e.stopRenderingLineAfter&&this.renderWhitespace===e.renderWhitespace&&this.renderControlCharacters===e.renderControlCharacters&&this.fontLigatures===e.fontLigatures&&Dt.equalsArr(this.lineDecorations,e.lineDecorations)&&this.lineTokens.equals(e.lineTokens)&&this.sameSelection(e.selectionsOnLine)}}class nb{constructor(e,t){this.partIndex=e,this.charIndex=t}}class st{static getPartIndex(e){return(e&4294901760)>>>16}static getCharIndex(e){return(e&65535)>>>0}constructor(e,t){this.length=e,this._data=new Uint32Array(this.length),this._horizontalOffset=new Uint32Array(this.length)}setColumnInfo(e,t,n,i){const r=(t<<16|n<<0)>>>0;this._data[e-1]=r,this._horizontalOffset[e-1]=i}getHorizontalOffset(e){return this._horizontalOffset.length===0?0:this._horizontalOffset[e-1]}charOffsetToPartData(e){return this.length===0?0:e<0?this._data[0]:e>=this.length?this._data[this.length-1]:this._data[e]}getDomPosition(e){const t=this.charOffsetToPartData(e-1),n=st.getPartIndex(t),i=st.getCharIndex(t);return new nb(n,i)}getColumn(e,t){return this.partDataToCharOffset(e.partIndex,t,e.charIndex)+1}partDataToCharOffset(e,t,n){if(this.length===0)return 0;const i=(e<<16|n<<0)>>>0;let r=0,o=this.length-1;for(;r+1<o;){const p=r+o>>>1,C=this._data[p];if(C===i)return p;C>i?o=p:r=p}if(r===o)return r;const a=this._data[r],l=this._data[o];if(a===i)return r;if(l===i)return o;const u=st.getPartIndex(a),c=st.getCharIndex(a),h=st.getPartIndex(l);let d;u!==h?d=t:d=st.getCharIndex(l);const f=n-c,m=d-n;return f<=m?r:o}}class _o{constructor(e,t,n){this._renderLineOutputBrand=void 0,this.characterMapping=e,this.containsRTL=t,this.containsForeignElements=n}}function ib(s,e){if(s.lineContent.length===0){if(s.lineDecorations.length>0){e.appendString("<span>");let t=0,n=0,i=0;for(const o of s.lineDecorations)(o.type===1||o.type===2)&&(e.appendString('<span class="'),e.appendString(o.className),e.appendString('"></span>'),o.type===1&&(i|=1,t++),o.type===2&&(i|=2,n++));e.appendString("</span>");const r=new st(1,t+n);return r.setColumnInfo(1,t,0,0),new _o(r,!1,i)}return e.appendString("<span><span></span></span>"),new _o(new st(0,0),!1,0)}return db(ob(s),e)}class sb{constructor(e,t,n,i){this.characterMapping=e,this.html=t,this.containsRTL=n,this.containsForeignElements=i}}function b_(s){const e=new sg(1e4),t=ib(s,e);return new sb(t.characterMapping,e.build(),t.containsRTL,t.containsForeignElements)}class rb{constructor(e,t,n,i,r,o,a,l,u,c,h,d,f,m,p,C){this.fontIsMonospace=e,this.canUseHalfwidthRightwardsArrow=t,this.lineContent=n,this.len=i,this.isOverflowing=r,this.overflowingCharCount=o,this.parts=a,this.containsForeignElements=l,this.fauxIndentLength=u,this.tabSize=c,this.startVisibleColumn=h,this.containsRTL=d,this.spaceWidth=f,this.renderSpaceCharCode=m,this.renderWhitespace=p,this.renderControlCharacters=C}}function ob(s){const e=s.lineContent;let t,n,i;s.stopRenderingLineAfter!==-1&&s.stopRenderingLineAfter<e.length?(t=!0,n=e.length-s.stopRenderingLineAfter,i=s.stopRenderingLineAfter):(t=!1,n=0,i=e.length);let r=ab(e,s.containsRTL,s.lineTokens,s.fauxIndentLength,i);s.renderControlCharacters&&!s.isBasicASCII&&(r=ub(e,r)),(s.renderWhitespace===4||s.renderWhitespace===1||s.renderWhitespace===2&&s.selectionsOnLine||s.renderWhitespace===3&&!s.continuesWithWrappedLine)&&(r=cb(s,e,i,r));let o=0;if(s.lineDecorations.length>0){for(let a=0,l=s.lineDecorations.length;a<l;a++){const u=s.lineDecorations[a];u.type===3||u.type===1?o|=1:u.type===2&&(o|=2)}r=hb(e,i,r,s.lineDecorations)}return s.containsRTL||(r=lb(e,r,!s.isBasicASCII||s.fontLigatures)),new rb(s.useMonospaceOptimizations,s.canUseHalfwidthRightwardsArrow,e,i,t,n,r,o,s.fauxIndentLength,s.tabSize,s.startVisibleColumn,s.containsRTL,s.spaceWidth,s.renderSpaceCharCode,s.renderWhitespace,s.renderControlCharacters)}function ab(s,e,t,n,i){const r=[];let o=0;n>0&&(r[o++]=new pe(n,"",0,!1));let a=n;for(let l=0,u=t.getCount();l<u;l++){const c=t.getEndOffset(l);if(c<=n)continue;const h=t.getClassName(l);if(c>=i){const f=e?vi(s.substring(a,i)):!1;r[o++]=new pe(i,h,0,f);break}const d=e?vi(s.substring(a,c)):!1;r[o++]=new pe(c,h,0,d),a=c}return r}function lb(s,e,t){let n=0;const i=[];let r=0;if(t)for(let o=0,a=e.length;o<a;o++){const l=e[o],u=l.endIndex;if(n+50<u){const c=l.type,h=l.metadata,d=l.containsRTL;let f=-1,m=n;for(let p=n;p<u;p++)s.charCodeAt(p)===32&&(f=p),f!==-1&&p-m>=50&&(i[r++]=new pe(f+1,c,h,d),m=f+1,f=-1);m!==u&&(i[r++]=new pe(u,c,h,d))}else i[r++]=l;n=u}else for(let o=0,a=e.length;o<a;o++){const l=e[o],u=l.endIndex,c=u-n;if(c>50){const h=l.type,d=l.metadata,f=l.containsRTL,m=Math.ceil(c/50);for(let p=1;p<m;p++){const C=n+p*50;i[r++]=new pe(C,h,d,f)}i[r++]=new pe(u,h,d,f)}else i[r++]=l;n=u}return i}function Sh(s){return s<32?s!==9:s===127||s>=8234&&s<=8238||s>=8294&&s<=8297||s>=8206&&s<=8207||s===1564}function ub(s,e){const t=[];let n=new pe(0,"",0,!1),i=0;for(const r of e){const o=r.endIndex;for(;i<o;i++){const a=s.charCodeAt(i);Sh(a)&&(i>n.endIndex&&(n=new pe(i,r.type,r.metadata,r.containsRTL),t.push(n)),n=new pe(i+1,"mtkcontrol",r.metadata,!1),t.push(n))}i>n.endIndex&&(n=new pe(o,r.type,r.metadata,r.containsRTL),t.push(n))}return t}function cb(s,e,t,n){const i=s.continuesWithWrappedLine,r=s.fauxIndentLength,o=s.tabSize,a=s.startVisibleColumn,l=s.useMonospaceOptimizations,u=s.selectionsOnLine,c=s.renderWhitespace===1,h=s.renderWhitespace===3,d=s.renderSpaceWidth!==s.spaceWidth,f=[];let m=0,p=0,C=n[p].type,b=n[p].containsRTL,L=n[p].endIndex;const _=n.length;let k=!1,S=Ve(e),N;S===-1?(k=!0,S=t,N=t):N=on(e);let x=!1,T=0,E=u&&u[T],V=a%o;for(let B=r;B<t;B++){const O=e.charCodeAt(B);E&&B>=E.endOffset&&(T++,E=u&&u[T]);let U;if(B<S||B>N)U=!0;else if(O===9)U=!0;else if(O===32)if(c)if(x)U=!0;else{const ue=B+1<t?e.charCodeAt(B+1):0;U=ue===32||ue===9}else U=!0;else U=!1;if(U&&u&&(U=!!E&&E.startOffset<=B&&E.endOffset>B),U&&h&&(U=k||B>N),U&&b&&B>=S&&B<=N&&(U=!1),x){if(!U||!l&&V>=o){if(d){const ue=m>0?f[m-1].endIndex:r;for(let ge=ue+1;ge<=B;ge++)f[m++]=new pe(ge,"mtkw",1,!1)}else f[m++]=new pe(B,"mtkw",1,!1);V=V%o}}else(B===L||U&&B>r)&&(f[m++]=new pe(B,C,0,b),V=V%o);for(O===9?V=o:Bi(O)?V+=2:V++,x=U;B===L&&(p++,p<_);)C=n[p].type,b=n[p].containsRTL,L=n[p].endIndex}let P=!1;if(x)if(i&&c){const B=t>0?e.charCodeAt(t-1):0,O=t>1?e.charCodeAt(t-2):0;B===32&&O!==32&&O!==9||(P=!0)}else P=!0;if(P)if(d){const B=m>0?f[m-1].endIndex:r;for(let O=B+1;O<=t;O++)f[m++]=new pe(O,"mtkw",1,!1)}else f[m++]=new pe(t,"mtkw",1,!1);else f[m++]=new pe(t,C,0,b);return f}function hb(s,e,t,n){n.sort(Dt.compare);const i=tb.normalize(s,n),r=i.length;let o=0;const a=[];let l=0,u=0;for(let h=0,d=t.length;h<d;h++){const f=t[h],m=f.endIndex,p=f.type,C=f.metadata,b=f.containsRTL;for(;o<r&&i[o].startOffset<m;){const L=i[o];if(L.startOffset>u&&(u=L.startOffset,a[l++]=new pe(u,p,C,b)),L.endOffset+1<=m)u=L.endOffset+1,a[l++]=new pe(u,p+" "+L.className,C|L.metadata,b),o++;else{u=m,a[l++]=new pe(u,p+" "+L.className,C|L.metadata,b);break}}m>u&&(u=m,a[l++]=new pe(u,p,C,b))}const c=t[t.length-1].endIndex;if(o<r&&i[o].startOffset===c)for(;o<r&&i[o].startOffset===c;){const h=i[o];a[l++]=new pe(u,h.className,h.metadata,!1),o++}return a}function db(s,e){const t=s.fontIsMonospace,n=s.canUseHalfwidthRightwardsArrow,i=s.containsForeignElements,r=s.lineContent,o=s.len,a=s.isOverflowing,l=s.overflowingCharCount,u=s.parts,c=s.fauxIndentLength,h=s.tabSize,d=s.startVisibleColumn,f=s.containsRTL,m=s.spaceWidth,p=s.renderSpaceCharCode,C=s.renderWhitespace,b=s.renderControlCharacters,L=new st(o+1,u.length);let _=!1,k=0,S=d,N=0,x=0,T=0;f?e.appendString('<span dir="ltr">'):e.appendString("<span>");for(let E=0,V=u.length;E<V;E++){const P=u[E],B=P.endIndex,O=P.type,U=P.containsRTL,ue=C!==0&&P.isWhitespace(),ge=ue&&!t&&(O==="mtkw"||!i),ae=k===B&&P.isPseudoAfter();if(N=0,e.appendString("<span "),U&&e.appendString('style="unicode-bidi:isolate" '),e.appendString('class="'),e.appendString(ge?"mtkz":O),e.appendASCIICharCode(34),ue){let se=0;{let Q=k,ie=S;for(;Q<B;Q++){const Oe=(r.charCodeAt(Q)===9?h-ie%h:1)|0;se+=Oe,Q>=c&&(ie+=Oe)}}for(ge&&(e.appendString(' style="width:'),e.appendString(String(m*se)),e.appendString('px"')),e.appendASCIICharCode(62);k<B;k++){L.setColumnInfo(k+1,E-T,N,x),T=0;const Q=r.charCodeAt(k);let ie,ce;if(Q===9){ie=h-S%h|0,ce=ie,!n||ce>1?e.appendCharCode(8594):e.appendCharCode(65515);for(let Oe=2;Oe<=ce;Oe++)e.appendCharCode(160)}else ie=2,ce=1,e.appendCharCode(p),e.appendCharCode(8204);N+=ie,x+=ce,k>=c&&(S+=ce)}}else for(e.appendASCIICharCode(62);k<B;k++){L.setColumnInfo(k+1,E-T,N,x),T=0;const se=r.charCodeAt(k);let Q=1,ie=1;switch(se){case 9:Q=h-S%h,ie=Q;for(let ce=1;ce<=Q;ce++)e.appendCharCode(160);break;case 32:e.appendCharCode(160);break;case 60:e.appendString("&lt;");break;case 62:e.appendString("&gt;");break;case 38:e.appendString("&amp;");break;case 0:b?e.appendCharCode(9216):e.appendString("&#00;");break;case 65279:case 8232:case 8233:case 133:e.appendCharCode(65533);break;default:Bi(se)&&ie++,b&&se<32?e.appendCharCode(9216+se):b&&se===127?e.appendCharCode(9249):b&&Sh(se)?(e.appendString("[U+"),e.appendString(fb(se)),e.appendString("]"),Q=8,ie=Q):e.appendCharCode(se)}N+=Q,x+=ie,k>=c&&(S+=ie)}ae?T++:T=0,k>=o&&!_&&P.isPseudoAfter()&&(_=!0,L.setColumnInfo(k+1,E,N,x)),e.appendString("</span>")}return _||L.setColumnInfo(o+1,u.length-1,N,x),a&&(e.appendString('<span class="mtkoverflow">'),e.appendString(g("showMore","Show more ({0})",gb(l))),e.appendString("</span>")),e.appendString("</span>"),new _o(L,f,i)}function fb(s){return s.toString(16).toUpperCase().padStart(4,"0")}function gb(s){return s<1024?g("overflow.chars","{0} chars",s):s<1024*1024?`${(s/1024).toFixed(1)} KB`:`${(s/1024/1024).toFixed(1)} MB`}class ju{constructor(e,t,n,i){this._viewportBrand=void 0,this.top=e|0,this.left=t|0,this.width=n|0,this.height=i|0}}class mb{constructor(e,t){this.tabSize=e,this.data=t}}class Yo{constructor(e,t,n,i,r,o,a){this._viewLineDataBrand=void 0,this.content=e,this.continuesWithWrappedLine=t,this.minColumn=n,this.maxColumn=i,this.startVisibleColumn=r,this.tokens=o,this.inlineDecorations=a}}class Bs{constructor(e,t,n,i,r,o,a,l,u,c){this.minColumn=e,this.maxColumn=t,this.content=n,this.continuesWithWrappedLine=i,this.isBasicASCII=Bs.isBasicASCII(n,o),this.containsRTL=Bs.containsRTL(n,this.isBasicASCII,r),this.tokens=a,this.inlineDecorations=l,this.tabSize=u,this.startVisibleColumn=c}static isBasicASCII(e,t){return t?yo(e):!0}static containsRTL(e,t,n){return!t&&n?vi(e):!1}}class gs{constructor(e,t,n){this.range=e,this.inlineClassName=t,this.type=n}}class pb{constructor(e,t,n,i){this.startOffset=e,this.endOffset=t,this.inlineClassName=n,this.inlineClassNameAffectsLetterSpacing=i}toInlineDecoration(e){return new gs(new w(e,this.startOffset+1,e,this.endOffset+1),this.inlineClassName,this.inlineClassNameAffectsLetterSpacing?3:0)}}class Cb{constructor(e,t){this._viewModelDecorationBrand=void 0,this.range=e,this.options=t}}class Ko{constructor(e,t,n){this.color=e,this.zIndex=t,this.data=n}static compareByRenderingProps(e,t){return e.zIndex===t.zIndex?e.color<t.color?-1:e.color>t.color?1:0:e.zIndex-t.zIndex}static equals(e,t){return e.color===t.color&&e.zIndex===t.zIndex&&wi(e.data,t.data)}static equalsArr(e,t){return wi(e,t,Ko.equals)}}class L_ extends oe{constructor(){super(),this._shouldRender=!0}shouldRender(){return this._shouldRender}forceShouldRender(){this._shouldRender=!0}setShouldRender(){this._shouldRender=!0}onDidRender(){this._shouldRender=!1}onCompositionStart(e){return!1}onCompositionEnd(e){return!1}onConfigurationChanged(e){return!1}onCursorStateChanged(e){return!1}onDecorationsChanged(e){return!1}onFlushed(e){return!1}onFocusChanged(e){return!1}onLanguageConfigurationChanged(e){return!1}onLineMappingChanged(e){return!1}onLinesChanged(e){return!1}onLinesDeleted(e){return!1}onLinesInserted(e){return!1}onRevealRangeRequest(e){return!1}onScrollChanged(e){return!1}onThemeChanged(e){return!1}onTokensChanged(e){return!1}onTokensColorsChanged(e){return!1}onZonesChanged(e){return!1}handleEvents(e){let t=!1;for(let n=0,i=e.length;n<i;n++){const r=e[n];switch(r.type){case 0:this.onCompositionStart(r)&&(t=!0);break;case 1:this.onCompositionEnd(r)&&(t=!0);break;case 2:this.onConfigurationChanged(r)&&(t=!0);break;case 3:this.onCursorStateChanged(r)&&(t=!0);break;case 4:this.onDecorationsChanged(r)&&(t=!0);break;case 5:this.onFlushed(r)&&(t=!0);break;case 6:this.onFocusChanged(r)&&(t=!0);break;case 7:this.onLanguageConfigurationChanged(r)&&(t=!0);break;case 8:this.onLineMappingChanged(r)&&(t=!0);break;case 9:this.onLinesChanged(r)&&(t=!0);break;case 10:this.onLinesDeleted(r)&&(t=!0);break;case 11:this.onLinesInserted(r)&&(t=!0);break;case 12:this.onRevealRangeRequest(r)&&(t=!0);break;case 13:this.onScrollChanged(r)&&(t=!0);break;case 15:this.onTokensChanged(r)&&(t=!0);break;case 14:this.onThemeChanged(r)&&(t=!0);break;case 16:this.onTokensColorsChanged(r)&&(t=!0);break;case 17:this.onZonesChanged(r)&&(t=!0);break;default:console.info("View received unknown event: "),console.info(r)}}t&&(this._shouldRender=!0)}}class Vs{static whitespaceVisibleColumn(e,t,n){const i=e.length;let r=0,o=-1,a=-1;for(let l=0;l<i;l++){if(l===t)return[o,a,r];switch(r%n===0&&(o=l,a=r),e.charCodeAt(l)){case 32:r+=1;break;case 9:r=be.nextRenderTabStop(r,n);break;default:return[-1,-1,-1]}}return t===i?[o,a,r]:[-1,-1,-1]}static atomicPosition(e,t,n,i){const r=e.length,[o,a,l]=Vs.whitespaceVisibleColumn(e,t,n);if(l===-1)return-1;let u;switch(i){case 0:u=!0;break;case 1:u=!1;break;case 2:if(l%n===0)return t;u=l%n<=n/2;break}if(u){if(o===-1)return-1;let d=a;for(let f=o;f<r;++f){if(d===a+n)return o;switch(e.charCodeAt(f)){case 32:d+=1;break;case 9:d=be.nextRenderTabStop(d,n);break;default:return-1}}return d===a+n?o:-1}const c=be.nextRenderTabStop(l,n);let h=l;for(let d=t;d<r;d++){if(h===c)return d;switch(e.charCodeAt(d)){case 32:h+=1;break;case 9:h=be.nextRenderTabStop(h,n);break;default:return-1}}return h===c?r:-1}}const bb=()=>!0,Lb=()=>!1,wb=s=>s===" "||s==="	";class pn{static shouldRecreate(e){return e.hasChanged(146)||e.hasChanged(132)||e.hasChanged(37)||e.hasChanged(77)||e.hasChanged(79)||e.hasChanged(80)||e.hasChanged(6)||e.hasChanged(7)||e.hasChanged(11)||e.hasChanged(9)||e.hasChanged(10)||e.hasChanged(14)||e.hasChanged(129)||e.hasChanged(50)||e.hasChanged(92)||e.hasChanged(131)}constructor(e,t,n,i){this.languageConfigurationService=i,this._cursorMoveConfigurationBrand=void 0,this._languageId=e;const r=n.options,o=r.get(146),a=r.get(50);this.readOnly=r.get(92),this.tabSize=t.tabSize,this.indentSize=t.indentSize,this.insertSpaces=t.insertSpaces,this.stickyTabStops=r.get(117),this.lineHeight=a.lineHeight,this.typicalHalfwidthCharacterWidth=a.typicalHalfwidthCharacterWidth,this.pageSize=Math.max(1,Math.floor(o.height/this.lineHeight)-2),this.useTabStops=r.get(129),this.wordSeparators=r.get(132),this.emptySelectionClipboard=r.get(37),this.copyWithSyntaxHighlighting=r.get(25),this.multiCursorMergeOverlapping=r.get(77),this.multiCursorPaste=r.get(79),this.multiCursorLimit=r.get(80),this.autoClosingBrackets=r.get(6),this.autoClosingComments=r.get(7),this.autoClosingQuotes=r.get(11),this.autoClosingDelete=r.get(9),this.autoClosingOvertype=r.get(10),this.autoSurround=r.get(14),this.autoIndent=r.get(12),this.wordSegmenterLocales=r.get(131),this.surroundingPairs={},this._electricChars=null,this.shouldAutoCloseBefore={quote:this._getShouldAutoClose(e,this.autoClosingQuotes,!0),comment:this._getShouldAutoClose(e,this.autoClosingComments,!1),bracket:this._getShouldAutoClose(e,this.autoClosingBrackets,!1)},this.autoClosingPairs=this.languageConfigurationService.getLanguageConfiguration(e).getAutoClosingPairs();const l=this.languageConfigurationService.getLanguageConfiguration(e).getSurroundingPairs();if(l)for(const c of l)this.surroundingPairs[c.open]=c.close;const u=this.languageConfigurationService.getLanguageConfiguration(e).comments;this.blockCommentStartToken=(u==null?void 0:u.blockCommentStartToken)??null}get electricChars(){var e;if(!this._electricChars){this._electricChars={};const t=(e=this.languageConfigurationService.getLanguageConfiguration(this._languageId).electricCharacter)==null?void 0:e.getElectricCharacters();if(t)for(const n of t)this._electricChars[n]=!0}return this._electricChars}onElectricCharacter(e,t,n){const i=Jt(t,n-1),r=this.languageConfigurationService.getLanguageConfiguration(i.languageId).electricCharacter;return r?r.onElectricCharacter(e,i,n-i.firstCharOffset):null}normalizeIndentation(e){return eh(e,this.indentSize,this.insertSpaces)}_getShouldAutoClose(e,t,n){switch(t){case"beforeWhitespace":return wb;case"languageDefined":return this._getLanguageDefinedShouldAutoClose(e,n);case"always":return bb;case"never":return Lb}}_getLanguageDefinedShouldAutoClose(e,t){const n=this.languageConfigurationService.getLanguageConfiguration(e).getAutoCloseBeforeSet(t);return i=>n.indexOf(i)!==-1}visibleColumnFromColumn(e,t){return be.visibleColumnFromColumn(e.getLineContent(t.lineNumber),t.column,this.tabSize)}columnFromVisibleColumn(e,t,n){const i=be.columnFromVisibleColumn(e.getLineContent(t),n,this.tabSize),r=e.getLineMinColumn(t);if(i<r)return r;const o=e.getLineMaxColumn(t);return i>o?o:i}}class H{static fromModelState(e){return new _b(e)}static fromViewState(e){return new Sb(e)}static fromModelSelection(e){const t=Z.liftSelection(e),n=new Le(w.fromPositions(t.getSelectionStart()),0,0,t.getPosition(),0);return H.fromModelState(n)}static fromModelSelections(e){const t=[];for(let n=0,i=e.length;n<i;n++)t[n]=this.fromModelSelection(e[n]);return t}constructor(e,t){this._cursorStateBrand=void 0,this.modelState=e,this.viewState=t}equals(e){return this.viewState.equals(e.viewState)&&this.modelState.equals(e.modelState)}}class _b{constructor(e){this.modelState=e,this.viewState=null}}class Sb{constructor(e){this.modelState=null,this.viewState=e}}class Le{constructor(e,t,n,i,r){this.selectionStart=e,this.selectionStartKind=t,this.selectionStartLeftoverVisibleColumns=n,this.position=i,this.leftoverVisibleColumns=r,this._singleCursorStateBrand=void 0,this.selection=Le._computeSelection(this.selectionStart,this.position)}equals(e){return this.selectionStartLeftoverVisibleColumns===e.selectionStartLeftoverVisibleColumns&&this.leftoverVisibleColumns===e.leftoverVisibleColumns&&this.selectionStartKind===e.selectionStartKind&&this.position.equals(e.position)&&this.selectionStart.equalsRange(e.selectionStart)}hasSelection(){return!this.selection.isEmpty()||!this.selectionStart.isEmpty()}move(e,t,n,i){return e?new Le(this.selectionStart,this.selectionStartKind,this.selectionStartLeftoverVisibleColumns,new I(t,n),i):new Le(new w(t,n,t,n),0,i,new I(t,n),i)}static _computeSelection(e,t){return e.isEmpty()||!t.isBeforeOrEqual(e.getStartPosition())?Z.fromPositions(e.getStartPosition(),t):Z.fromPositions(e.getEndPosition(),t)}}class ye{constructor(e,t,n){this._editOperationResultBrand=void 0,this.type=e,this.commands=t,this.shouldPushStackElementBefore=n.shouldPushStackElementBefore,this.shouldPushStackElementAfter=n.shouldPushStackElementAfter}}function Vt(s){return s==="'"||s==='"'||s==="`"}class kh{static columnSelect(e,t,n,i,r,o){const a=Math.abs(r-n)+1,l=n>r,u=i>o,c=i<o,h=[];for(let d=0;d<a;d++){const f=n+(l?-d:d),m=e.columnFromVisibleColumn(t,f,i),p=e.columnFromVisibleColumn(t,f,o),C=e.visibleColumnFromColumn(t,new I(f,m)),b=e.visibleColumnFromColumn(t,new I(f,p));c&&(C>o||b<i)||u&&(b>i||C<o)||h.push(new Le(new w(f,m,f,m),0,0,new I(f,p),0))}if(h.length===0)for(let d=0;d<a;d++){const f=n+(l?-d:d),m=t.getLineMaxColumn(f);h.push(new Le(new w(f,m,f,m),0,0,new I(f,m),0))}return{viewStates:h,reversed:l,fromLineNumber:n,fromVisualColumn:i,toLineNumber:r,toVisualColumn:o}}static columnSelectLeft(e,t,n){let i=n.toViewVisualColumn;return i>0&&i--,kh.columnSelect(e,t,n.fromViewLineNumber,n.fromViewVisualColumn,n.toViewLineNumber,i)}static columnSelectRight(e,t,n){let i=0;const r=Math.min(n.fromViewLineNumber,n.toViewLineNumber),o=Math.max(n.fromViewLineNumber,n.toViewLineNumber);for(let l=r;l<=o;l++){const u=t.getLineMaxColumn(l),c=e.visibleColumnFromColumn(t,new I(l,u));i=Math.max(i,c)}let a=n.toViewVisualColumn;return a<i&&a++,this.columnSelect(e,t,n.fromViewLineNumber,n.fromViewVisualColumn,n.toViewLineNumber,a)}static columnSelectUp(e,t,n,i){const r=i?e.pageSize:1,o=Math.max(1,n.toViewLineNumber-r);return this.columnSelect(e,t,n.fromViewLineNumber,n.fromViewVisualColumn,o,n.toViewVisualColumn)}static columnSelectDown(e,t,n,i){const r=i?e.pageSize:1,o=Math.min(t.getLineCount(),n.toViewLineNumber+r);return this.columnSelect(e,t,n.fromViewLineNumber,n.fromViewVisualColumn,o,n.toViewVisualColumn)}}class Pe{constructor(e,t,n=!1){this._range=e,this._text=t,this.insertsAutoWhitespace=n}getEditOperations(e,t){t.addTrackedEditOperation(this._range,this._text)}computeCursorState(e,t){const i=t.getInverseEditOperations()[0].range;return Z.fromPositions(i.getEndPosition())}}class w_{constructor(e,t){this._range=e,this._text=t}getEditOperations(e,t){t.addTrackedEditOperation(this._range,this._text)}computeCursorState(e,t){const i=t.getInverseEditOperations()[0].range;return Z.fromRange(i,0)}}class ms{constructor(e,t,n=!1){this._range=e,this._text=t,this.insertsAutoWhitespace=n}getEditOperations(e,t){t.addTrackedEditOperation(this._range,this._text)}computeCursorState(e,t){const i=t.getInverseEditOperations()[0].range;return Z.fromPositions(i.getStartPosition())}}class Ws{constructor(e,t,n,i,r=!1){this._range=e,this._text=t,this._columnDeltaOffset=i,this._lineNumberDeltaOffset=n,this.insertsAutoWhitespace=r}getEditOperations(e,t){t.addTrackedEditOperation(this._range,this._text)}computeCursorState(e,t){const i=t.getInverseEditOperations()[0].range;return Z.fromPositions(i.getEndPosition().delta(this._lineNumberDeltaOffset,this._columnDeltaOffset))}}class kb{constructor(e,t,n,i=!1){this._range=e,this._text=t,this._initialSelection=n,this._forceMoveMarkers=i,this._selectionId=null}getEditOperations(e,t){t.addTrackedEditOperation(this._range,this._text,this._forceMoveMarkers),this._selectionId=t.trackSelection(this._initialSelection)}computeCursorState(e,t){return t.getTrackedSelection(this._selectionId)}}class Mr{constructor(e,t,n){this._cursorPositionBrand=void 0,this.lineNumber=e,this.column=t,this.leftoverVisibleColumns=n}}class j{static leftPosition(e,t){if(t.column>e.getLineMinColumn(t.lineNumber))return t.delta(void 0,-Nd(e.getLineContent(t.lineNumber),t.column-1));if(t.lineNumber>1){const n=t.lineNumber-1;return new I(n,e.getLineMaxColumn(n))}else return t}static leftPositionAtomicSoftTabs(e,t,n){if(t.column<=e.getLineIndentColumn(t.lineNumber)){const i=e.getLineMinColumn(t.lineNumber),r=e.getLineContent(t.lineNumber),o=Vs.atomicPosition(r,t.column-1,n,0);if(o!==-1&&o+1>=i)return new I(t.lineNumber,o+1)}return this.leftPosition(e,t)}static left(e,t,n){const i=e.stickyTabStops?j.leftPositionAtomicSoftTabs(t,n,e.tabSize):j.leftPosition(t,n);return new Mr(i.lineNumber,i.column,0)}static moveLeft(e,t,n,i,r){let o,a;if(n.hasSelection()&&!i)o=n.selection.startLineNumber,a=n.selection.startColumn;else{const l=n.position.delta(void 0,-(r-1)),u=t.normalizePosition(j.clipPositionColumn(l,t),0),c=j.left(e,t,u);o=c.lineNumber,a=c.column}return n.move(i,o,a,0)}static clipPositionColumn(e,t){return new I(e.lineNumber,j.clipRange(e.column,t.getLineMinColumn(e.lineNumber),t.getLineMaxColumn(e.lineNumber)))}static clipRange(e,t,n){return e<t?t:e>n?n:e}static rightPosition(e,t,n){return n<e.getLineMaxColumn(t)?n=n+bc(e.getLineContent(t),n-1):t<e.getLineCount()&&(t=t+1,n=e.getLineMinColumn(t)),new I(t,n)}static rightPositionAtomicSoftTabs(e,t,n,i,r){if(n<e.getLineIndentColumn(t)){const o=e.getLineContent(t),a=Vs.atomicPosition(o,n-1,i,1);if(a!==-1)return new I(t,a+1)}return this.rightPosition(e,t,n)}static right(e,t,n){const i=e.stickyTabStops?j.rightPositionAtomicSoftTabs(t,n.lineNumber,n.column,e.tabSize,e.indentSize):j.rightPosition(t,n.lineNumber,n.column);return new Mr(i.lineNumber,i.column,0)}static moveRight(e,t,n,i,r){let o,a;if(n.hasSelection()&&!i)o=n.selection.endLineNumber,a=n.selection.endColumn;else{const l=n.position.delta(void 0,r-1),u=t.normalizePosition(j.clipPositionColumn(l,t),1),c=j.right(e,t,u);o=c.lineNumber,a=c.column}return n.move(i,o,a,0)}static vertical(e,t,n,i,r,o,a,l){const u=be.visibleColumnFromColumn(t.getLineContent(n),i,e.tabSize)+r,c=t.getLineCount(),h=n===1&&i===1,d=n===c&&i===t.getLineMaxColumn(n),f=o<n?h:d;if(n=o,n<1?(n=1,a?i=t.getLineMinColumn(n):i=Math.min(t.getLineMaxColumn(n),i)):n>c?(n=c,a?i=t.getLineMaxColumn(n):i=Math.min(t.getLineMaxColumn(n),i)):i=e.columnFromVisibleColumn(t,n,u),f?r=0:r=u-be.visibleColumnFromColumn(t.getLineContent(n),i,e.tabSize),l!==void 0){const m=new I(n,i),p=t.normalizePosition(m,l);r=r+(i-p.column),n=p.lineNumber,i=p.column}return new Mr(n,i,r)}static down(e,t,n,i,r,o,a){return this.vertical(e,t,n,i,r,n+o,a,4)}static moveDown(e,t,n,i,r){let o,a;n.hasSelection()&&!i?(o=n.selection.endLineNumber,a=n.selection.endColumn):(o=n.position.lineNumber,a=n.position.column);let l=0,u;do if(u=j.down(e,t,o+l,a,n.leftoverVisibleColumns,r,!0),t.normalizePosition(new I(u.lineNumber,u.column),2).lineNumber>o)break;while(l++<10&&o+l<t.getLineCount());return n.move(i,u.lineNumber,u.column,u.leftoverVisibleColumns)}static translateDown(e,t,n){const i=n.selection,r=j.down(e,t,i.selectionStartLineNumber,i.selectionStartColumn,n.selectionStartLeftoverVisibleColumns,1,!1),o=j.down(e,t,i.positionLineNumber,i.positionColumn,n.leftoverVisibleColumns,1,!1);return new Le(new w(r.lineNumber,r.column,r.lineNumber,r.column),0,r.leftoverVisibleColumns,new I(o.lineNumber,o.column),o.leftoverVisibleColumns)}static up(e,t,n,i,r,o,a){return this.vertical(e,t,n,i,r,n-o,a,3)}static moveUp(e,t,n,i,r){let o,a;n.hasSelection()&&!i?(o=n.selection.startLineNumber,a=n.selection.startColumn):(o=n.position.lineNumber,a=n.position.column);const l=j.up(e,t,o,a,n.leftoverVisibleColumns,r,!0);return n.move(i,l.lineNumber,l.column,l.leftoverVisibleColumns)}static translateUp(e,t,n){const i=n.selection,r=j.up(e,t,i.selectionStartLineNumber,i.selectionStartColumn,n.selectionStartLeftoverVisibleColumns,1,!1),o=j.up(e,t,i.positionLineNumber,i.positionColumn,n.leftoverVisibleColumns,1,!1);return new Le(new w(r.lineNumber,r.column,r.lineNumber,r.column),0,r.leftoverVisibleColumns,new I(o.lineNumber,o.column),o.leftoverVisibleColumns)}static _isBlankLine(e,t){return e.getLineFirstNonWhitespaceColumn(t)===0}static moveToPrevBlankLine(e,t,n,i){let r=n.position.lineNumber;for(;r>1&&this._isBlankLine(t,r);)r--;for(;r>1&&!this._isBlankLine(t,r);)r--;return n.move(i,r,t.getLineMinColumn(r),0)}static moveToNextBlankLine(e,t,n,i){const r=t.getLineCount();let o=n.position.lineNumber;for(;o<r&&this._isBlankLine(t,o);)o++;for(;o<r&&!this._isBlankLine(t,o);)o++;return n.move(i,o,t.getLineMinColumn(o),0)}static moveToBeginningOfLine(e,t,n,i){const r=n.position.lineNumber,o=t.getLineMinColumn(r),a=t.getLineFirstNonWhitespaceColumn(r)||o;let l;return n.position.column===a?l=o:l=a,n.move(i,r,l,0)}static moveToEndOfLine(e,t,n,i,r){const o=n.position.lineNumber,a=t.getLineMaxColumn(o);return n.move(i,o,a,r?1073741824-a:0)}static moveToBeginningOfBuffer(e,t,n,i){return n.move(i,1,1,0)}static moveToEndOfBuffer(e,t,n,i){const r=t.getLineCount(),o=t.getLineMaxColumn(r);return n.move(i,r,o,0)}}class Di{static deleteRight(e,t,n,i){const r=[];let o=e!==3;for(let a=0,l=i.length;a<l;a++){const u=i[a];let c=u;if(c.isEmpty()){const h=u.getPosition(),d=j.right(t,n,h);c=new w(d.lineNumber,d.column,h.lineNumber,h.column)}if(c.isEmpty()){r[a]=null;continue}c.startLineNumber!==c.endLineNumber&&(o=!0),r[a]=new Pe(c,"")}return[o,r]}static isAutoClosingPairDelete(e,t,n,i,r,o,a){if(t==="never"&&n==="never"||e==="never")return!1;for(let l=0,u=o.length;l<u;l++){const c=o[l],h=c.getPosition();if(!c.isEmpty())return!1;const d=r.getLineContent(h.lineNumber);if(h.column<2||h.column>=d.length+1)return!1;const f=d.charAt(h.column-2),m=i.get(f);if(!m)return!1;if(Vt(f)){if(n==="never")return!1}else if(t==="never")return!1;const p=d.charAt(h.column-1);let C=!1;for(const b of m)b.open===f&&b.close===p&&(C=!0);if(!C)return!1;if(e==="auto"){let b=!1;for(let L=0,_=a.length;L<_;L++){const k=a[L];if(h.lineNumber===k.startLineNumber&&h.column===k.startColumn){b=!0;break}}if(!b)return!1}}return!0}static _runAutoClosingPairDelete(e,t,n){const i=[];for(let r=0,o=n.length;r<o;r++){const a=n[r].getPosition(),l=new w(a.lineNumber,a.column-1,a.lineNumber,a.column+1);i[r]=new Pe(l,"")}return[!0,i]}static deleteLeft(e,t,n,i,r){if(this.isAutoClosingPairDelete(t.autoClosingDelete,t.autoClosingBrackets,t.autoClosingQuotes,t.autoClosingPairs.autoClosingPairsOpenByEnd,n,i,r))return this._runAutoClosingPairDelete(t,n,i);const o=[];let a=e!==2;for(let l=0,u=i.length;l<u;l++){const c=Di.getDeleteRange(i[l],n,t);if(c.isEmpty()){o[l]=null;continue}c.startLineNumber!==c.endLineNumber&&(a=!0),o[l]=new Pe(c,"")}return[a,o]}static getDeleteRange(e,t,n){if(!e.isEmpty())return e;const i=e.getPosition();if(n.useTabStops&&i.column>1){const r=t.getLineContent(i.lineNumber),o=Ve(r),a=o===-1?r.length+1:o+1;if(i.column<=a){const l=n.visibleColumnFromColumn(t,i),u=be.prevIndentTabStop(l,n.indentSize),c=n.columnFromVisibleColumn(t,i.lineNumber,u);return new w(i.lineNumber,c,i.lineNumber,i.column)}}return w.fromPositions(Di.getPositionAfterDeleteLeft(i,t),i)}static getPositionAfterDeleteLeft(e,t){if(e.column>1){const n=xd(e.column-1,t.getLineContent(e.lineNumber));return e.with(void 0,n+1)}else if(e.lineNumber>1){const n=e.lineNumber-1;return new I(n,t.getLineMaxColumn(n))}else return e}static cut(e,t,n){const i=[];let r=null;n.sort((o,a)=>I.compare(o.getStartPosition(),a.getEndPosition()));for(let o=0,a=n.length;o<a;o++){const l=n[o];if(l.isEmpty())if(e.emptySelectionClipboard){const u=l.getPosition();let c,h,d,f;u.lineNumber<t.getLineCount()?(c=u.lineNumber,h=1,d=u.lineNumber+1,f=1):u.lineNumber>1&&(r==null?void 0:r.endLineNumber)!==u.lineNumber?(c=u.lineNumber-1,h=t.getLineMaxColumn(u.lineNumber-1),d=u.lineNumber,f=t.getLineMaxColumn(u.lineNumber)):(c=u.lineNumber,h=1,d=u.lineNumber,f=t.getLineMaxColumn(u.lineNumber));const m=new w(c,h,d,f);r=m,m.isEmpty()?i[o]=null:i[o]=new Pe(m,"")}else i[o]=null;else i[o]=new Pe(l,"")}return new ye(0,i,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!0})}}class q{static _createWord(e,t,n,i,r){return{start:i,end:r,wordType:t,nextCharClass:n}}static _createIntlWord(e,t){return{start:e.index,end:e.index+e.segment.length,wordType:1,nextCharClass:t}}static _findPreviousWordOnLine(e,t,n){const i=t.getLineContent(n.lineNumber);return this._doFindPreviousWordOnLine(i,e,n)}static _doFindPreviousWordOnLine(e,t,n){let i=0;const r=t.findPrevIntlWordBeforeOrAtOffset(e,n.column-2);for(let o=n.column-2;o>=0;o--){const a=e.charCodeAt(o),l=t.get(a);if(r&&o===r.index)return this._createIntlWord(r,l);if(l===0){if(i===2)return this._createWord(e,i,l,o+1,this._findEndOfWord(e,t,i,o+1));i=1}else if(l===2){if(i===1)return this._createWord(e,i,l,o+1,this._findEndOfWord(e,t,i,o+1));i=2}else if(l===1&&i!==0)return this._createWord(e,i,l,o+1,this._findEndOfWord(e,t,i,o+1))}return i!==0?this._createWord(e,i,1,0,this._findEndOfWord(e,t,i,0)):null}static _findEndOfWord(e,t,n,i){const r=t.findNextIntlWordAtOrAfterOffset(e,i),o=e.length;for(let a=i;a<o;a++){const l=e.charCodeAt(a),u=t.get(l);if(r&&a===r.index+r.segment.length||u===1||n===1&&u===2||n===2&&u===0)return a}return o}static _findNextWordOnLine(e,t,n){const i=t.getLineContent(n.lineNumber);return this._doFindNextWordOnLine(i,e,n)}static _doFindNextWordOnLine(e,t,n){let i=0;const r=e.length,o=t.findNextIntlWordAtOrAfterOffset(e,n.column-1);for(let a=n.column-1;a<r;a++){const l=e.charCodeAt(a),u=t.get(l);if(o&&a===o.index)return this._createIntlWord(o,u);if(u===0){if(i===2)return this._createWord(e,i,u,this._findStartOfWord(e,t,i,a-1),a);i=1}else if(u===2){if(i===1)return this._createWord(e,i,u,this._findStartOfWord(e,t,i,a-1),a);i=2}else if(u===1&&i!==0)return this._createWord(e,i,u,this._findStartOfWord(e,t,i,a-1),a)}return i!==0?this._createWord(e,i,1,this._findStartOfWord(e,t,i,r-1),r):null}static _findStartOfWord(e,t,n,i){const r=t.findPrevIntlWordBeforeOrAtOffset(e,i);for(let o=i;o>=0;o--){const a=e.charCodeAt(o),l=t.get(a);if(r&&o===r.index)return o;if(l===1||n===1&&l===2||n===2&&l===0)return o+1}return 0}static moveWordLeft(e,t,n,i,r){let o=n.lineNumber,a=n.column;a===1&&o>1&&(o=o-1,a=t.getLineMaxColumn(o));let l=q._findPreviousWordOnLine(e,t,new I(o,a));if(i===0)return new I(o,l?l.start+1:1);if(i===1)return!r&&l&&l.wordType===2&&l.end-l.start===1&&l.nextCharClass===0&&(l=q._findPreviousWordOnLine(e,t,new I(o,l.start+1))),new I(o,l?l.start+1:1);if(i===3){for(;l&&l.wordType===2;)l=q._findPreviousWordOnLine(e,t,new I(o,l.start+1));return new I(o,l?l.start+1:1)}return l&&a<=l.end+1&&(l=q._findPreviousWordOnLine(e,t,new I(o,l.start+1))),new I(o,l?l.end+1:1)}static _moveWordPartLeft(e,t){const n=t.lineNumber,i=e.getLineMaxColumn(n);if(t.column===1)return n>1?new I(n-1,e.getLineMaxColumn(n-1)):t;const r=e.getLineContent(n);for(let o=t.column-1;o>1;o--){const a=r.charCodeAt(o-2),l=r.charCodeAt(o-1);if(a===95&&l!==95)return new I(n,o);if(a===45&&l!==45)return new I(n,o);if((Hi(a)||ji(a))&&cn(l))return new I(n,o);if(cn(a)&&cn(l)&&o+1<i){const u=r.charCodeAt(o);if(Hi(u)||ji(u))return new I(n,o)}}return new I(n,1)}static moveWordRight(e,t,n,i){let r=n.lineNumber,o=n.column,a=!1;o===t.getLineMaxColumn(r)&&r<t.getLineCount()&&(a=!0,r=r+1,o=1);let l=q._findNextWordOnLine(e,t,new I(r,o));if(i===2)l&&l.wordType===2&&l.end-l.start===1&&l.nextCharClass===0&&(l=q._findNextWordOnLine(e,t,new I(r,l.end+1))),l?o=l.end+1:o=t.getLineMaxColumn(r);else if(i===3){for(a&&(o=0);l&&(l.wordType===2||l.start+1<=o);)l=q._findNextWordOnLine(e,t,new I(r,l.end+1));l?o=l.start+1:o=t.getLineMaxColumn(r)}else l&&!a&&o>=l.start+1&&(l=q._findNextWordOnLine(e,t,new I(r,l.end+1))),l?o=l.start+1:o=t.getLineMaxColumn(r);return new I(r,o)}static _moveWordPartRight(e,t){const n=t.lineNumber,i=e.getLineMaxColumn(n);if(t.column===i)return n<e.getLineCount()?new I(n+1,1):t;const r=e.getLineContent(n);for(let o=t.column+1;o<i;o++){const a=r.charCodeAt(o-2),l=r.charCodeAt(o-1);if(a!==95&&l===95)return new I(n,o);if(a!==45&&l===45)return new I(n,o);if((Hi(a)||ji(a))&&cn(l))return new I(n,o);if(cn(a)&&cn(l)&&o+1<i){const u=r.charCodeAt(o);if(Hi(u)||ji(u))return new I(n,o)}}return new I(n,i)}static _deleteWordLeftWhitespace(e,t){const n=e.getLineContent(t.lineNumber),i=t.column-2,r=on(n,i);return r+1<i?new w(t.lineNumber,r+2,t.lineNumber,t.column):null}static deleteWordLeft(e,t){const n=e.wordSeparators,i=e.model,r=e.selection,o=e.whitespaceHeuristics;if(!r.isEmpty())return r;if(Di.isAutoClosingPairDelete(e.autoClosingDelete,e.autoClosingBrackets,e.autoClosingQuotes,e.autoClosingPairs.autoClosingPairsOpenByEnd,e.model,[e.selection],e.autoClosedCharacters)){const h=e.selection.getPosition();return new w(h.lineNumber,h.column-1,h.lineNumber,h.column+1)}const a=new I(r.positionLineNumber,r.positionColumn);let l=a.lineNumber,u=a.column;if(l===1&&u===1)return null;if(o){const h=this._deleteWordLeftWhitespace(i,a);if(h)return h}let c=q._findPreviousWordOnLine(n,i,a);return t===0?c?u=c.start+1:u>1?u=1:(l--,u=i.getLineMaxColumn(l)):(c&&u<=c.end+1&&(c=q._findPreviousWordOnLine(n,i,new I(l,c.start+1))),c?u=c.end+1:u>1?u=1:(l--,u=i.getLineMaxColumn(l))),new w(l,u,a.lineNumber,a.column)}static deleteInsideWord(e,t,n){if(!n.isEmpty())return n;const i=new I(n.positionLineNumber,n.positionColumn),r=this._deleteInsideWordWhitespace(t,i);return r||this._deleteInsideWordDetermineDeleteRange(e,t,i)}static _charAtIsWhitespace(e,t){const n=e.charCodeAt(t);return n===32||n===9}static _deleteInsideWordWhitespace(e,t){const n=e.getLineContent(t.lineNumber),i=n.length;if(i===0)return null;let r=Math.max(t.column-2,0);if(!this._charAtIsWhitespace(n,r))return null;let o=Math.min(t.column-1,i-1);if(!this._charAtIsWhitespace(n,o))return null;for(;r>0&&this._charAtIsWhitespace(n,r-1);)r--;for(;o+1<i&&this._charAtIsWhitespace(n,o+1);)o++;return new w(t.lineNumber,r+1,t.lineNumber,o+2)}static _deleteInsideWordDetermineDeleteRange(e,t,n){const i=t.getLineContent(n.lineNumber),r=i.length;if(r===0)return n.lineNumber>1?new w(n.lineNumber-1,t.getLineMaxColumn(n.lineNumber-1),n.lineNumber,1):n.lineNumber<t.getLineCount()?new w(n.lineNumber,1,n.lineNumber+1,1):new w(n.lineNumber,1,n.lineNumber,1);const o=h=>h.start+1<=n.column&&n.column<=h.end+1,a=(h,d)=>(h=Math.min(h,n.column),d=Math.max(d,n.column),new w(n.lineNumber,h,n.lineNumber,d)),l=h=>{let d=h.start+1,f=h.end+1,m=!1;for(;f-1<r&&this._charAtIsWhitespace(i,f-1);)m=!0,f++;if(!m)for(;d>1&&this._charAtIsWhitespace(i,d-2);)d--;return a(d,f)},u=q._findPreviousWordOnLine(e,t,n);if(u&&o(u))return l(u);const c=q._findNextWordOnLine(e,t,n);return c&&o(c)?l(c):u&&c?a(u.end+1,c.start+1):u?a(u.start+1,u.end+1):c?a(c.start+1,c.end+1):a(1,r+1)}static _deleteWordPartLeft(e,t){if(!t.isEmpty())return t;const n=t.getPosition(),i=q._moveWordPartLeft(e,n);return new w(n.lineNumber,n.column,i.lineNumber,i.column)}static _findFirstNonWhitespaceChar(e,t){const n=e.length;for(let i=t;i<n;i++){const r=e.charAt(i);if(r!==" "&&r!=="	")return i}return n}static _deleteWordRightWhitespace(e,t){const n=e.getLineContent(t.lineNumber),i=t.column-1,r=this._findFirstNonWhitespaceChar(n,i);return i+1<r?new w(t.lineNumber,t.column,t.lineNumber,r+1):null}static deleteWordRight(e,t){const n=e.wordSeparators,i=e.model,r=e.selection,o=e.whitespaceHeuristics;if(!r.isEmpty())return r;const a=new I(r.positionLineNumber,r.positionColumn);let l=a.lineNumber,u=a.column;const c=i.getLineCount(),h=i.getLineMaxColumn(l);if(l===c&&u===h)return null;if(o){const f=this._deleteWordRightWhitespace(i,a);if(f)return f}let d=q._findNextWordOnLine(n,i,a);return t===2?d?u=d.end+1:u<h||l===c?u=h:(l++,d=q._findNextWordOnLine(n,i,new I(l,1)),d?u=d.start+1:u=i.getLineMaxColumn(l)):(d&&u>=d.start+1&&(d=q._findNextWordOnLine(n,i,new I(l,d.end+1))),d?u=d.start+1:u<h||l===c?u=h:(l++,d=q._findNextWordOnLine(n,i,new I(l,1)),d?u=d.start+1:u=i.getLineMaxColumn(l))),new w(l,u,a.lineNumber,a.column)}static _deleteWordPartRight(e,t){if(!t.isEmpty())return t;const n=t.getPosition(),i=q._moveWordPartRight(e,n);return new w(n.lineNumber,n.column,i.lineNumber,i.column)}static _createWordAtPosition(e,t,n){const i=new w(t,n.start+1,t,n.end+1);return{word:e.getValueInRange(i),startColumn:i.startColumn,endColumn:i.endColumn}}static getWordAtPosition(e,t,n,i){const r=vs(t,n),o=q._findPreviousWordOnLine(r,e,i);if(o&&o.wordType===1&&o.start<=i.column-1&&i.column-1<=o.end)return q._createWordAtPosition(e,i.lineNumber,o);const a=q._findNextWordOnLine(r,e,i);return a&&a.wordType===1&&a.start<=i.column-1&&i.column-1<=a.end?q._createWordAtPosition(e,i.lineNumber,a):null}static word(e,t,n,i,r){const o=vs(e.wordSeparators,e.wordSegmenterLocales),a=q._findPreviousWordOnLine(o,t,r),l=q._findNextWordOnLine(o,t,r);if(!i){let f,m;return a&&a.wordType===1&&a.start<=r.column-1&&r.column-1<=a.end?(f=a.start+1,m=a.end+1):l&&l.wordType===1&&l.start<=r.column-1&&r.column-1<=l.end?(f=l.start+1,m=l.end+1):(a?f=a.end+1:f=1,l?m=l.start+1:m=t.getLineMaxColumn(r.lineNumber)),new Le(new w(r.lineNumber,f,r.lineNumber,m),1,0,new I(r.lineNumber,m),0)}let u,c;a&&a.wordType===1&&a.start<r.column-1&&r.column-1<a.end?(u=a.start+1,c=a.end+1):l&&l.wordType===1&&l.start<r.column-1&&r.column-1<l.end?(u=l.start+1,c=l.end+1):(u=r.column,c=r.column);const h=r.lineNumber;let d;if(n.selectionStart.containsPosition(r))d=n.selectionStart.endColumn;else if(r.isBeforeOrEqual(n.selectionStart.getStartPosition())){d=u;const f=new I(h,d);n.selectionStart.containsPosition(f)&&(d=n.selectionStart.endColumn)}else{d=c;const f=new I(h,d);n.selectionStart.containsPosition(f)&&(d=n.selectionStart.startColumn)}return n.move(!0,h,d,0)}}class __ extends q{static deleteWordPartLeft(e){const t=ss([q.deleteWordLeft(e,0),q.deleteWordLeft(e,2),q._deleteWordPartLeft(e.model,e.selection)]);return t.sort(w.compareRangesUsingEnds),t[2]}static deleteWordPartRight(e){const t=ss([q.deleteWordRight(e,0),q.deleteWordRight(e,2),q._deleteWordPartRight(e.model,e.selection)]);return t.sort(w.compareRangesUsingStarts),t[0]}static moveWordPartLeft(e,t,n,i){const r=ss([q.moveWordLeft(e,t,n,0,i),q.moveWordLeft(e,t,n,2,i),q._moveWordPartLeft(t,n)]);return r.sort(I.compare),r[2]}static moveWordPartRight(e,t,n){const i=ss([q.moveWordRight(e,t,n,0),q.moveWordRight(e,t,n,2),q._moveWordPartRight(t,n)]);return i.sort(I.compare),i[0]}}function ss(s){return s.filter(e=>!!e)}class S_{static addCursorDown(e,t,n){const i=[];let r=0;for(let o=0,a=t.length;o<a;o++){const l=t[o];i[r++]=new H(l.modelState,l.viewState),n?i[r++]=H.fromModelState(j.translateDown(e.cursorConfig,e.model,l.modelState)):i[r++]=H.fromViewState(j.translateDown(e.cursorConfig,e,l.viewState))}return i}static addCursorUp(e,t,n){const i=[];let r=0;for(let o=0,a=t.length;o<a;o++){const l=t[o];i[r++]=new H(l.modelState,l.viewState),n?i[r++]=H.fromModelState(j.translateUp(e.cursorConfig,e.model,l.modelState)):i[r++]=H.fromViewState(j.translateUp(e.cursorConfig,e,l.viewState))}return i}static moveToBeginningOfLine(e,t,n){const i=[];for(let r=0,o=t.length;r<o;r++){const a=t[r];i[r]=this._moveToLineStart(e,a,n)}return i}static _moveToLineStart(e,t,n){const i=t.viewState.position.column,r=t.modelState.position.column,o=i===r,a=t.viewState.position.lineNumber,l=e.getLineFirstNonWhitespaceColumn(a);return!o&&!(i===l)?this._moveToLineStartByView(e,t,n):this._moveToLineStartByModel(e,t,n)}static _moveToLineStartByView(e,t,n){return H.fromViewState(j.moveToBeginningOfLine(e.cursorConfig,e,t.viewState,n))}static _moveToLineStartByModel(e,t,n){return H.fromModelState(j.moveToBeginningOfLine(e.cursorConfig,e.model,t.modelState,n))}static moveToEndOfLine(e,t,n,i){const r=[];for(let o=0,a=t.length;o<a;o++){const l=t[o];r[o]=this._moveToLineEnd(e,l,n,i)}return r}static _moveToLineEnd(e,t,n,i){const r=t.viewState.position,o=e.getLineMaxColumn(r.lineNumber),a=r.column===o,l=t.modelState.position,u=e.model.getLineMaxColumn(l.lineNumber),c=o-r.column===u-l.column;return a||c?this._moveToLineEndByModel(e,t,n,i):this._moveToLineEndByView(e,t,n,i)}static _moveToLineEndByView(e,t,n,i){return H.fromViewState(j.moveToEndOfLine(e.cursorConfig,e,t.viewState,n,i))}static _moveToLineEndByModel(e,t,n,i){return H.fromModelState(j.moveToEndOfLine(e.cursorConfig,e.model,t.modelState,n,i))}static expandLineSelection(e,t){const n=[];for(let i=0,r=t.length;i<r;i++){const o=t[i],a=o.modelState.selection.startLineNumber,l=e.model.getLineCount();let u=o.modelState.selection.endLineNumber,c;u===l?c=e.model.getLineMaxColumn(l):(u++,c=1),n[i]=H.fromModelState(new Le(new w(a,1,a,1),0,0,new I(u,c),0))}return n}static moveToBeginningOfBuffer(e,t,n){const i=[];for(let r=0,o=t.length;r<o;r++){const a=t[r];i[r]=H.fromModelState(j.moveToBeginningOfBuffer(e.cursorConfig,e.model,a.modelState,n))}return i}static moveToEndOfBuffer(e,t,n){const i=[];for(let r=0,o=t.length;r<o;r++){const a=t[r];i[r]=H.fromModelState(j.moveToEndOfBuffer(e.cursorConfig,e.model,a.modelState,n))}return i}static selectAll(e,t){const n=e.model.getLineCount(),i=e.model.getLineMaxColumn(n);return H.fromModelState(new Le(new w(1,1,1,1),0,0,new I(n,i),0))}static line(e,t,n,i,r){const o=e.model.validatePosition(i),a=r?e.coordinatesConverter.validateViewPosition(new I(r.lineNumber,r.column),o):e.coordinatesConverter.convertModelPositionToViewPosition(o);if(!n){const u=e.model.getLineCount();let c=o.lineNumber+1,h=1;return c>u&&(c=u,h=e.model.getLineMaxColumn(c)),H.fromModelState(new Le(new w(o.lineNumber,1,c,h),2,0,new I(c,h),0))}const l=t.modelState.selectionStart.getStartPosition().lineNumber;if(o.lineNumber<l)return H.fromViewState(t.viewState.move(!0,a.lineNumber,1,0));if(o.lineNumber>l){const u=e.getLineCount();let c=a.lineNumber+1,h=1;return c>u&&(c=u,h=e.getLineMaxColumn(c)),H.fromViewState(t.viewState.move(!0,c,h,0))}else{const u=t.modelState.selectionStart.getEndPosition();return H.fromModelState(t.modelState.move(!0,u.lineNumber,u.column,0))}}static word(e,t,n,i){const r=e.model.validatePosition(i);return H.fromModelState(q.word(e.cursorConfig,e.model,t.modelState,n,r))}static cancelSelection(e,t){if(!t.modelState.hasSelection())return new H(t.modelState,t.viewState);const n=t.viewState.position.lineNumber,i=t.viewState.position.column;return H.fromViewState(new Le(new w(n,i,n,i),0,0,new I(n,i),0))}static moveTo(e,t,n,i,r){if(n){if(t.modelState.selectionStartKind===1)return this.word(e,t,n,i);if(t.modelState.selectionStartKind===2)return this.line(e,t,n,i,r)}const o=e.model.validatePosition(i),a=r?e.coordinatesConverter.validateViewPosition(new I(r.lineNumber,r.column),o):e.coordinatesConverter.convertModelPositionToViewPosition(o);return H.fromViewState(t.viewState.move(n,a.lineNumber,a.column,0))}static simpleMove(e,t,n,i,r,o){switch(n){case 0:return o===4?this._moveHalfLineLeft(e,t,i):this._moveLeft(e,t,i,r);case 1:return o===4?this._moveHalfLineRight(e,t,i):this._moveRight(e,t,i,r);case 2:return o===2?this._moveUpByViewLines(e,t,i,r):this._moveUpByModelLines(e,t,i,r);case 3:return o===2?this._moveDownByViewLines(e,t,i,r):this._moveDownByModelLines(e,t,i,r);case 4:return o===2?t.map(a=>H.fromViewState(j.moveToPrevBlankLine(e.cursorConfig,e,a.viewState,i))):t.map(a=>H.fromModelState(j.moveToPrevBlankLine(e.cursorConfig,e.model,a.modelState,i)));case 5:return o===2?t.map(a=>H.fromViewState(j.moveToNextBlankLine(e.cursorConfig,e,a.viewState,i))):t.map(a=>H.fromModelState(j.moveToNextBlankLine(e.cursorConfig,e.model,a.modelState,i)));case 6:return this._moveToViewMinColumn(e,t,i);case 7:return this._moveToViewFirstNonWhitespaceColumn(e,t,i);case 8:return this._moveToViewCenterColumn(e,t,i);case 9:return this._moveToViewMaxColumn(e,t,i);case 10:return this._moveToViewLastNonWhitespaceColumn(e,t,i);default:return null}}static viewportMove(e,t,n,i,r){const o=e.getCompletelyVisibleViewRange(),a=e.coordinatesConverter.convertViewRangeToModelRange(o);switch(n){case 11:{const l=this._firstLineNumberInRange(e.model,a,r),u=e.model.getLineFirstNonWhitespaceColumn(l);return[this._moveToModelPosition(e,t[0],i,l,u)]}case 13:{const l=this._lastLineNumberInRange(e.model,a,r),u=e.model.getLineFirstNonWhitespaceColumn(l);return[this._moveToModelPosition(e,t[0],i,l,u)]}case 12:{const l=Math.round((a.startLineNumber+a.endLineNumber)/2),u=e.model.getLineFirstNonWhitespaceColumn(l);return[this._moveToModelPosition(e,t[0],i,l,u)]}case 14:{const l=[];for(let u=0,c=t.length;u<c;u++){const h=t[u];l[u]=this.findPositionInViewportIfOutside(e,h,o,i)}return l}default:return null}}static findPositionInViewportIfOutside(e,t,n,i){const r=t.viewState.position.lineNumber;if(n.startLineNumber<=r&&r<=n.endLineNumber-1)return new H(t.modelState,t.viewState);{let o;r>n.endLineNumber-1?o=n.endLineNumber-1:r<n.startLineNumber?o=n.startLineNumber:o=r;const a=j.vertical(e.cursorConfig,e,r,t.viewState.position.column,t.viewState.leftoverVisibleColumns,o,!1);return H.fromViewState(t.viewState.move(i,a.lineNumber,a.column,a.leftoverVisibleColumns))}}static _firstLineNumberInRange(e,t,n){let i=t.startLineNumber;return t.startColumn!==e.getLineMinColumn(i)&&i++,Math.min(t.endLineNumber,i+n-1)}static _lastLineNumberInRange(e,t,n){let i=t.startLineNumber;return t.startColumn!==e.getLineMinColumn(i)&&i++,Math.max(i,t.endLineNumber-n+1)}static _moveLeft(e,t,n,i){return t.map(r=>H.fromViewState(j.moveLeft(e.cursorConfig,e,r.viewState,n,i)))}static _moveHalfLineLeft(e,t,n){const i=[];for(let r=0,o=t.length;r<o;r++){const a=t[r],l=a.viewState.position.lineNumber,u=Math.round(e.getLineLength(l)/2);i[r]=H.fromViewState(j.moveLeft(e.cursorConfig,e,a.viewState,n,u))}return i}static _moveRight(e,t,n,i){return t.map(r=>H.fromViewState(j.moveRight(e.cursorConfig,e,r.viewState,n,i)))}static _moveHalfLineRight(e,t,n){const i=[];for(let r=0,o=t.length;r<o;r++){const a=t[r],l=a.viewState.position.lineNumber,u=Math.round(e.getLineLength(l)/2);i[r]=H.fromViewState(j.moveRight(e.cursorConfig,e,a.viewState,n,u))}return i}static _moveDownByViewLines(e,t,n,i){const r=[];for(let o=0,a=t.length;o<a;o++){const l=t[o];r[o]=H.fromViewState(j.moveDown(e.cursorConfig,e,l.viewState,n,i))}return r}static _moveDownByModelLines(e,t,n,i){const r=[];for(let o=0,a=t.length;o<a;o++){const l=t[o];r[o]=H.fromModelState(j.moveDown(e.cursorConfig,e.model,l.modelState,n,i))}return r}static _moveUpByViewLines(e,t,n,i){const r=[];for(let o=0,a=t.length;o<a;o++){const l=t[o];r[o]=H.fromViewState(j.moveUp(e.cursorConfig,e,l.viewState,n,i))}return r}static _moveUpByModelLines(e,t,n,i){const r=[];for(let o=0,a=t.length;o<a;o++){const l=t[o];r[o]=H.fromModelState(j.moveUp(e.cursorConfig,e.model,l.modelState,n,i))}return r}static _moveToViewPosition(e,t,n,i,r){return H.fromViewState(t.viewState.move(n,i,r,0))}static _moveToModelPosition(e,t,n,i,r){return H.fromModelState(t.modelState.move(n,i,r,0))}static _moveToViewMinColumn(e,t,n){const i=[];for(let r=0,o=t.length;r<o;r++){const a=t[r],l=a.viewState.position.lineNumber,u=e.getLineMinColumn(l);i[r]=this._moveToViewPosition(e,a,n,l,u)}return i}static _moveToViewFirstNonWhitespaceColumn(e,t,n){const i=[];for(let r=0,o=t.length;r<o;r++){const a=t[r],l=a.viewState.position.lineNumber,u=e.getLineFirstNonWhitespaceColumn(l);i[r]=this._moveToViewPosition(e,a,n,l,u)}return i}static _moveToViewCenterColumn(e,t,n){const i=[];for(let r=0,o=t.length;r<o;r++){const a=t[r],l=a.viewState.position.lineNumber,u=Math.round((e.getLineMaxColumn(l)+e.getLineMinColumn(l))/2);i[r]=this._moveToViewPosition(e,a,n,l,u)}return i}static _moveToViewMaxColumn(e,t,n){const i=[];for(let r=0,o=t.length;r<o;r++){const a=t[r],l=a.viewState.position.lineNumber,u=e.getLineMaxColumn(l);i[r]=this._moveToViewPosition(e,a,n,l,u)}return i}static _moveToViewLastNonWhitespaceColumn(e,t,n){const i=[];for(let r=0,o=t.length;r<o;r++){const a=t[r],l=a.viewState.position.lineNumber,u=e.getLineLastNonWhitespaceColumn(l);i[r]=this._moveToViewPosition(e,a,n,l,u)}return i}}var Uu;(function(s){const e=function(n){if(!Td(n))return!1;const i=n;return!(!La(i.to)||!ur(i.select)&&!Ed(i.select)||!ur(i.by)&&!La(i.by)||!ur(i.value)&&!yd(i.value))};s.metadata={description:"Move cursor to a logical position in the view",args:[{name:"Cursor move argument object",description:`Property-value pairs that can be passed through this argument:
					* 'to': A mandatory logical position value providing where to move the cursor.
						\`\`\`
						'left', 'right', 'up', 'down', 'prevBlankLine', 'nextBlankLine',
						'wrappedLineStart', 'wrappedLineEnd', 'wrappedLineColumnCenter'
						'wrappedLineFirstNonWhitespaceCharacter', 'wrappedLineLastNonWhitespaceCharacter'
						'viewPortTop', 'viewPortCenter', 'viewPortBottom', 'viewPortIfOutside'
						\`\`\`
					* 'by': Unit to move. Default is computed based on 'to' value.
						\`\`\`
						'line', 'wrappedLine', 'character', 'halfLine'
						\`\`\`
					* 'value': Number of units to move. Default is '1'.
					* 'select': If 'true' makes the selection. Default is 'false'.
				`,constraint:e,schema:{type:"object",required:["to"],properties:{to:{type:"string",enum:["left","right","up","down","prevBlankLine","nextBlankLine","wrappedLineStart","wrappedLineEnd","wrappedLineColumnCenter","wrappedLineFirstNonWhitespaceCharacter","wrappedLineLastNonWhitespaceCharacter","viewPortTop","viewPortCenter","viewPortBottom","viewPortIfOutside"]},by:{type:"string",enum:["line","wrappedLine","character","halfLine"]},value:{type:"number",default:1},select:{type:"boolean",default:!1}}}}]},s.RawDirection={Left:"left",Right:"right",Up:"up",Down:"down",PrevBlankLine:"prevBlankLine",NextBlankLine:"nextBlankLine",WrappedLineStart:"wrappedLineStart",WrappedLineFirstNonWhitespaceCharacter:"wrappedLineFirstNonWhitespaceCharacter",WrappedLineColumnCenter:"wrappedLineColumnCenter",WrappedLineEnd:"wrappedLineEnd",WrappedLineLastNonWhitespaceCharacter:"wrappedLineLastNonWhitespaceCharacter",ViewPortTop:"viewPortTop",ViewPortCenter:"viewPortCenter",ViewPortBottom:"viewPortBottom",ViewPortIfOutside:"viewPortIfOutside"},s.RawUnit={Line:"line",WrappedLine:"wrappedLine",Character:"character",HalfLine:"halfLine"};function t(n){if(!n.to)return null;let i;switch(n.to){case s.RawDirection.Left:i=0;break;case s.RawDirection.Right:i=1;break;case s.RawDirection.Up:i=2;break;case s.RawDirection.Down:i=3;break;case s.RawDirection.PrevBlankLine:i=4;break;case s.RawDirection.NextBlankLine:i=5;break;case s.RawDirection.WrappedLineStart:i=6;break;case s.RawDirection.WrappedLineFirstNonWhitespaceCharacter:i=7;break;case s.RawDirection.WrappedLineColumnCenter:i=8;break;case s.RawDirection.WrappedLineEnd:i=9;break;case s.RawDirection.WrappedLineLastNonWhitespaceCharacter:i=10;break;case s.RawDirection.ViewPortTop:i=11;break;case s.RawDirection.ViewPortBottom:i=13;break;case s.RawDirection.ViewPortCenter:i=12;break;case s.RawDirection.ViewPortIfOutside:i=14;break;default:return null}let r=0;switch(n.by){case s.RawUnit.Line:r=1;break;case s.RawUnit.WrappedLine:r=2;break;case s.RawUnit.Character:r=3;break;case s.RawUnit.HalfLine:r=4;break}return{direction:i,unit:r,select:!!n.select,value:n.value||1}}s.parse=t})(Uu||(Uu={}));class vh{constructor(e,t,n){this._indentRulesSupport=t,this._indentationLineProcessor=new Ih(e,n)}shouldIncrease(e,t){const n=this._indentationLineProcessor.getProcessedLine(e,t);return this._indentRulesSupport.shouldIncrease(n)}shouldDecrease(e,t){const n=this._indentationLineProcessor.getProcessedLine(e,t);return this._indentRulesSupport.shouldDecrease(n)}shouldIgnore(e,t){const n=this._indentationLineProcessor.getProcessedLine(e,t);return this._indentRulesSupport.shouldIgnore(n)}shouldIndentNextLine(e,t){const n=this._indentationLineProcessor.getProcessedLine(e,t);return this._indentRulesSupport.shouldIndentNextLine(n)}}class ea{constructor(e,t){this.model=e,this.indentationLineProcessor=new Ih(e,t)}getProcessedTokenContextAroundRange(e){const t=this._getProcessedTokensBeforeRange(e),n=this._getProcessedTokensAfterRange(e),i=this._getProcessedPreviousLineTokens(e);return{beforeRangeProcessedTokens:t,afterRangeProcessedTokens:n,previousLineProcessedTokens:i}}_getProcessedTokensBeforeRange(e){this.model.tokenization.forceTokenization(e.startLineNumber);const t=this.model.tokenization.getLineTokens(e.startLineNumber),n=Jt(t,e.startColumn-1);let i;if(ta(this.model,e.getStartPosition())){const o=e.startColumn-1-n.firstCharOffset,a=n.firstCharOffset,l=a+o;i=t.sliceAndInflate(a,l,0)}else{const o=e.startColumn-1;i=t.sliceAndInflate(0,o,0)}return this.indentationLineProcessor.getProcessedTokens(i)}_getProcessedTokensAfterRange(e){const t=e.isEmpty()?e.getStartPosition():e.getEndPosition();this.model.tokenization.forceTokenization(t.lineNumber);const n=this.model.tokenization.getLineTokens(t.lineNumber),i=Jt(n,t.column-1),r=t.column-1-i.firstCharOffset,o=i.firstCharOffset+r,a=i.firstCharOffset+i.getLineLength(),l=n.sliceAndInflate(o,a,0);return this.indentationLineProcessor.getProcessedTokens(l)}_getProcessedPreviousLineTokens(e){const t=f=>{this.model.tokenization.forceTokenization(f);const m=this.model.tokenization.getLineTokens(f),p=this.model.getLineMaxColumn(f)-1;return Jt(m,p)};this.model.tokenization.forceTokenization(e.startLineNumber);const n=this.model.tokenization.getLineTokens(e.startLineNumber),i=Jt(n,e.startColumn-1),r=Te.createEmpty("",i.languageIdCodec),o=e.startLineNumber-1;if(o===0||!(i.firstCharOffset===0))return r;const u=t(o);if(!(i.languageId===u.languageId))return r;const h=u.toIViewLineTokens();return this.indentationLineProcessor.getProcessedTokens(h)}}class Ih{constructor(e,t){this.model=e,this.languageConfigurationService=t}getProcessedLine(e,t){var o,a;const n=(l,u)=>{const c=ke(l);return u+l.substring(c.length)};(a=(o=this.model.tokenization).forceTokenization)==null||a.call(o,e);const i=this.model.tokenization.getLineTokens(e);let r=this.getProcessedTokens(i).getLineContent();return t!==void 0&&(r=n(r,t)),r}getProcessedTokens(e){const t=l=>l===2||l===3||l===1,n=e.getLanguageId(0),r=this.languageConfigurationService.getLanguageConfiguration(n).bracketsNew.getBracketRegExp({global:!0}),o=[];return e.forEach(l=>{const u=e.getStandardTokenType(l);let c=e.getTokenText(l);t(u)&&(c=c.replace(r,""));const h=e.getMetadata(l);o.push({text:c,metadata:h})}),Te.createFromTextAndMetadata(o,e.languageIdCodec)}}function ta(s,e){s.tokenization.forceTokenization(e.lineNumber);const t=s.tokenization.getLineTokens(e.lineNumber),n=Jt(t,e.column-1),i=n.firstCharOffset===0,r=t.getLanguageId(0)===n.languageId;return!i&&!r}function na(s,e,t,n){e.tokenization.forceTokenization(t.startLineNumber);const i=e.getLanguageIdAtPosition(t.startLineNumber,t.startColumn),r=n.getLanguageConfiguration(i);if(!r)return null;const a=new ea(e,n).getProcessedTokenContextAroundRange(t),l=a.previousLineProcessedTokens.getLineContent(),u=a.beforeRangeProcessedTokens.getLineContent(),c=a.afterRangeProcessedTokens.getLineContent(),h=r.onEnter(s,l,u,c);if(!h)return null;const d=h.indentAction;let f=h.appendText;const m=h.removeText||0;f?d===Ce.Indent&&(f="	"+f):d===Ce.Indent||d===Ce.IndentOutdent?f="	":f="";let p=Oc(e,t.startLineNumber,t.startColumn);return m&&(p=p.substring(0,p.length-m)),{indentAction:d,appendText:f,removeText:m,indentation:p}}var vb=function(s,e,t,n){var i=arguments.length,r=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,n);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(i<3?o(r):i>3?o(e,t,r):o(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r},Ib=function(s,e){return function(t,n){e(t,n,s)}},ps;const Pr=Object.create(null);function Ht(s,e){if(e<=0)return"";Pr[s]||(Pr[s]=["",s]);const t=Pr[s];for(let n=t.length;n<=e;n++)t[n]=t[n-1]+s;return t[e]}let rn=ps=class{static unshiftIndent(e,t,n,i,r){const o=be.visibleColumnFromColumn(e,t,n);if(r){const a=Ht(" ",i),u=be.prevIndentTabStop(o,i)/i;return Ht(a,u)}else{const a="	",u=be.prevRenderTabStop(o,n)/n;return Ht(a,u)}}static shiftIndent(e,t,n,i,r){const o=be.visibleColumnFromColumn(e,t,n);if(r){const a=Ht(" ",i),u=be.nextIndentTabStop(o,i)/i;return Ht(a,u)}else{const a="	",u=be.nextRenderTabStop(o,n)/n;return Ht(a,u)}}constructor(e,t,n){this._languageConfigurationService=n,this._opts=t,this._selection=e,this._selectionId=null,this._useLastEditRangeForCursorEndPosition=!1,this._selectionStartColumnStaysPut=!1}_addEditOperation(e,t,n){this._useLastEditRangeForCursorEndPosition?e.addTrackedEditOperation(t,n):e.addEditOperation(t,n)}getEditOperations(e,t){const n=this._selection.startLineNumber;let i=this._selection.endLineNumber;this._selection.endColumn===1&&n!==i&&(i=i-1);const{tabSize:r,indentSize:o,insertSpaces:a}=this._opts,l=n===i;if(this._opts.useTabStops){this._selection.isEmpty()&&/^\s*$/.test(e.getLineContent(n))&&(this._useLastEditRangeForCursorEndPosition=!0);let u=0,c=0;for(let h=n;h<=i;h++,u=c){c=0;const d=e.getLineContent(h);let f=Ve(d);if(this._opts.isUnshift&&(d.length===0||f===0)||!l&&!this._opts.isUnshift&&d.length===0)continue;if(f===-1&&(f=d.length),h>1&&be.visibleColumnFromColumn(d,f+1,r)%o!==0&&e.tokenization.isCheapToTokenize(h-1)){const C=na(this._opts.autoIndent,e,new w(h-1,e.getLineMaxColumn(h-1),h-1,e.getLineMaxColumn(h-1)),this._languageConfigurationService);if(C){if(c=u,C.appendText)for(let b=0,L=C.appendText.length;b<L&&c<o&&C.appendText.charCodeAt(b)===32;b++)c++;C.removeText&&(c=Math.max(0,c-C.removeText));for(let b=0;b<c&&!(f===0||d.charCodeAt(f-1)!==32);b++)f--}}if(this._opts.isUnshift&&f===0)continue;let m;this._opts.isUnshift?m=ps.unshiftIndent(d,f+1,r,o,a):m=ps.shiftIndent(d,f+1,r,o,a),this._addEditOperation(t,new w(h,1,h,f+1),m),h===n&&!this._selection.isEmpty()&&(this._selectionStartColumnStaysPut=this._selection.startColumn<=f+1)}}else{!this._opts.isUnshift&&this._selection.isEmpty()&&e.getLineLength(n)===0&&(this._useLastEditRangeForCursorEndPosition=!0);const u=a?Ht(" ",o):"	";for(let c=n;c<=i;c++){const h=e.getLineContent(c);let d=Ve(h);if(!(this._opts.isUnshift&&(h.length===0||d===0))&&!(!l&&!this._opts.isUnshift&&h.length===0)&&(d===-1&&(d=h.length),!(this._opts.isUnshift&&d===0)))if(this._opts.isUnshift){d=Math.min(d,o);for(let f=0;f<d;f++)if(h.charCodeAt(f)===9){d=f+1;break}this._addEditOperation(t,new w(c,1,c,d+1),"")}else this._addEditOperation(t,new w(c,1,c,1),u),c===n&&!this._selection.isEmpty()&&(this._selectionStartColumnStaysPut=this._selection.startColumn===1)}}this._selectionId=t.trackSelection(this._selection)}computeCursorState(e,t){if(this._useLastEditRangeForCursorEndPosition){const i=t.getInverseEditOperations()[0];return new Z(i.range.endLineNumber,i.range.endColumn,i.range.endLineNumber,i.range.endColumn)}const n=t.getTrackedSelection(this._selectionId);if(this._selectionStartColumnStaysPut){const i=this._selection.startColumn;return n.startColumn<=i?n:n.getDirection()===0?new Z(n.startLineNumber,i,n.endLineNumber,n.endColumn):new Z(n.endLineNumber,n.endColumn,n.startLineNumber,i)}return n}};rn=ps=vb([Ib(2,rr)],rn);class Nb{constructor(e,t,n){this._range=e,this._charBeforeSelection=t,this._charAfterSelection=n}getEditOperations(e,t){t.addTrackedEditOperation(new w(this._range.startLineNumber,this._range.startColumn,this._range.startLineNumber,this._range.startColumn),this._charBeforeSelection),t.addTrackedEditOperation(new w(this._range.endLineNumber,this._range.endColumn,this._range.endLineNumber,this._range.endColumn),this._charAfterSelection)}computeCursorState(e,t){const n=t.getInverseEditOperations(),i=n[0].range,r=n[1].range;return new Z(i.endLineNumber,i.endColumn,r.endLineNumber,r.endColumn-this._charAfterSelection.length)}}class xb{constructor(e,t,n){this._position=e,this._text=t,this._charAfter=n}getEditOperations(e,t){t.addTrackedEditOperation(new w(this._position.lineNumber,this._position.column,this._position.lineNumber,this._position.column),this._text+this._charAfter)}computeCursorState(e,t){const i=t.getInverseEditOperations()[0].range;return new Z(i.endLineNumber,i.startColumn,i.endLineNumber,i.endColumn-this._charAfter.length)}}function Tb(s,e,t){const n=s.tokenization.getLanguageIdAtPosition(e,0);if(e>1){let i,r=-1;for(i=e-1;i>=1;i--){if(s.tokenization.getLanguageIdAtPosition(i,0)!==n)return r;const o=s.getLineContent(i);if(t.shouldIgnore(i)||/^\s+$/.test(o)||o===""){r=i;continue}return i}}return-1}function Oi(s,e,t,n=!0,i){if(s<4)return null;const r=i.getLanguageConfiguration(e.tokenization.getLanguageId()).indentRulesSupport;if(!r)return null;const o=new vh(e,r,i);if(t<=1)return{indentation:"",action:null};for(let l=t-1;l>0&&e.getLineContent(l)==="";l--)if(l===1)return{indentation:"",action:null};const a=Tb(e,t,o);if(a<0)return null;if(a<1)return{indentation:"",action:null};if(o.shouldIncrease(a)||o.shouldIndentNextLine(a)){const l=e.getLineContent(a);return{indentation:ke(l),action:Ce.Indent,line:a}}else if(o.shouldDecrease(a)){const l=e.getLineContent(a);return{indentation:ke(l),action:null,line:a}}else{if(a===1)return{indentation:ke(e.getLineContent(a)),action:null,line:a};const l=a-1,u=r.getIndentMetadata(e.getLineContent(l));if(!(u&3)&&u&4){let c=0;for(let h=l-1;h>0;h--)if(!o.shouldIndentNextLine(h)){c=h;break}return{indentation:ke(e.getLineContent(c+1)),action:null,line:c+1}}if(n)return{indentation:ke(e.getLineContent(a)),action:null,line:a};for(let c=a;c>0;c--){if(o.shouldIncrease(c))return{indentation:ke(e.getLineContent(c)),action:Ce.Indent,line:c};if(o.shouldIndentNextLine(c)){let h=0;for(let d=c-1;d>0;d--)if(!o.shouldIndentNextLine(c)){h=d;break}return{indentation:ke(e.getLineContent(h+1)),action:null,line:h+1}}else if(o.shouldDecrease(c))return{indentation:ke(e.getLineContent(c)),action:null,line:c}}return{indentation:ke(e.getLineContent(1)),action:null,line:1}}}function v_(s,e,t,n,i,r){if(s<4)return null;const o=r.getLanguageConfiguration(t);if(!o)return null;const a=r.getLanguageConfiguration(t).indentRulesSupport;if(!a)return null;const l=new vh(e,a,r),u=Oi(s,e,n,void 0,r);if(u){const c=u.line;if(c!==void 0){let h=!0;for(let d=c;d<n-1;d++)if(!/^\s*$/.test(e.getLineContent(d))){h=!1;break}if(h){const d=o.onEnter(s,"",e.getLineContent(c),"");if(d){let f=ke(e.getLineContent(c));return d.removeText&&(f=f.substring(0,f.length-d.removeText)),d.indentAction===Ce.Indent||d.indentAction===Ce.IndentOutdent?f=i.shiftIndent(f):d.indentAction===Ce.Outdent&&(f=i.unshiftIndent(f)),l.shouldDecrease(n)&&(f=i.unshiftIndent(f)),d.appendText&&(f+=d.appendText),ke(f)}}}return l.shouldDecrease(n)?u.action===Ce.Indent?u.indentation:i.unshiftIndent(u.indentation):u.action===Ce.Indent?i.shiftIndent(u.indentation):u.indentation}return null}function Eb(s,e,t,n,i){if(s<4)return null;const r=e.getLanguageIdAtPosition(t.startLineNumber,t.startColumn),o=i.getLanguageConfiguration(r).indentRulesSupport;if(!o)return null;e.tokenization.forceTokenization(t.startLineNumber);const l=new ea(e,i).getProcessedTokenContextAroundRange(t),u=l.afterRangeProcessedTokens,c=l.beforeRangeProcessedTokens,h=ke(c.getLineContent()),d=Rb(e,t.startLineNumber,c),f=ta(e,t.getStartPosition()),m=e.getLineContent(t.startLineNumber),p=ke(m),C=Oi(s,d,t.startLineNumber+1,void 0,i);if(!C){const L=f?p:h;return{beforeEnter:L,afterEnter:L}}let b=f?p:C.indentation;return C.action===Ce.Indent&&(b=n.shiftIndent(b)),o.shouldDecrease(u.getLineContent())&&(b=n.unshiftIndent(b)),{beforeEnter:f?p:h,afterEnter:b}}function yb(s,e,t,n,i,r){const o=s.autoIndent;if(o<4||ta(e,t.getStartPosition()))return null;const l=e.getLanguageIdAtPosition(t.startLineNumber,t.startColumn),u=r.getLanguageConfiguration(l).indentRulesSupport;if(!u)return null;const h=new ea(e,r).getProcessedTokenContextAroundRange(t),d=h.beforeRangeProcessedTokens.getLineContent(),f=h.afterRangeProcessedTokens.getLineContent(),m=d+f,p=d+n+f;if(!u.shouldDecrease(m)&&u.shouldDecrease(p)){const b=Oi(o,e,t.startLineNumber,!1,r);if(!b)return null;let L=b.indentation;return b.action!==Ce.Indent&&(L=i.unshiftIndent(L)),L}const C=t.startLineNumber-1;if(C>0){const b=e.getLineContent(C);if(u.shouldIndentNextLine(b)&&u.shouldIncrease(p)){const L=Oi(o,e,t.startLineNumber,!1,r),_=L==null?void 0:L.indentation;if(_!==void 0){const k=e.getLineContent(t.startLineNumber),S=ke(k),x=i.shiftIndent(_)===S,T=/^\s*$/.test(m),E=s.autoClosingPairs.autoClosingPairsOpenByEnd.get(n),P=E&&E.length>0&&T;if(x&&P)return _}}}return null}function I_(s,e,t){const n=t.getLanguageConfiguration(s.getLanguageId()).indentRulesSupport;return!n||e<1||e>s.getLineCount()?null:n.getIndentMetadata(s.getLineContent(e))}function Rb(s,e,t){return{tokenization:{getLineTokens:i=>i===e?t:s.tokenization.getLineTokens(i),getLanguageId:()=>s.getLanguageId(),getLanguageIdAtPosition:(i,r)=>s.getLanguageIdAtPosition(i,r)},getLineContent:i=>i===e?t.getLineContent():s.getLineContent(i)}}class Mb{static getEdits(e,t,n,i,r){if(!r&&this._isAutoIndentType(e,t,n)){const o=[];for(const l of n){const u=this._findActualIndentationForSelection(e,t,l,i);if(u===null)return;o.push({selection:l,indentation:u})}const a=So.getAutoClosingPairClose(e,t,n,i,!1);return this._getIndentationAndAutoClosingPairEdits(e,t,o,i,a)}}static _isAutoIndentType(e,t,n){if(e.autoIndent<4)return!1;for(let i=0,r=n.length;i<r;i++)if(!t.tokenization.isCheapToTokenize(n[i].getEndPosition().lineNumber))return!1;return!0}static _findActualIndentationForSelection(e,t,n,i){const r=yb(e,t,n,i,{shiftIndent:a=>ra(e,a),unshiftIndent:a=>Fs(e,a)},e.languageConfigurationService);if(r===null)return null;const o=Oc(t,n.startLineNumber,n.startColumn);return r===e.normalizeIndentation(o)?null:r}static _getIndentationAndAutoClosingPairEdits(e,t,n,i,r){const o=n.map(({selection:l,indentation:u})=>{if(r!==null){const c=this._getEditFromIndentationAndSelection(e,t,u,l,i,!1);return new Ub(c,l,i,r)}else{const c=this._getEditFromIndentationAndSelection(e,t,u,l,i,!0);return Gt(c.range,c.text,!1)}}),a={shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!1};return new ye(4,o,a)}static _getEditFromIndentationAndSelection(e,t,n,i,r,o=!0){const a=i.startLineNumber,l=t.getLineFirstNonWhitespaceColumn(a);let u=e.normalizeIndentation(n);if(l!==0){const h=t.getLineContent(a);u+=h.substring(l-1,i.startColumn-1)}return u+=o?r:"",{range:new w(a,1,i.endLineNumber,i.endColumn),text:u}}}class Pb{static getEdits(e,t,n,i,r,o){if(Nh(t,n,i,r,o))return this._runAutoClosingOvertype(e,i,o)}static _runAutoClosingOvertype(e,t,n){const i=[];for(let r=0,o=t.length;r<o;r++){const l=t[r].getPosition(),u=new w(l.lineNumber,l.column,l.lineNumber,l.column+1);i[r]=new Pe(u,n)}return new ye(4,i,{shouldPushStackElementBefore:or(e,4),shouldPushStackElementAfter:!1})}}class Ab{static getEdits(e,t,n,i,r){if(Nh(e,t,n,i,r)){const o=n.map(a=>new Pe(new w(a.positionLineNumber,a.positionColumn,a.positionLineNumber,a.positionColumn+1),"",!1));return new ye(4,o,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!1})}}}class So{static getEdits(e,t,n,i,r,o){if(!o){const a=this.getAutoClosingPairClose(e,t,n,i,r);if(a!==null)return this._runAutoClosingOpenCharType(n,i,r,a)}}static _runAutoClosingOpenCharType(e,t,n,i){const r=[];for(let o=0,a=e.length;o<a;o++){const l=e[o];r[o]=new jb(l,t,!n,i)}return new ye(4,r,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!1})}static getAutoClosingPairClose(e,t,n,i,r){for(const m of n)if(!m.isEmpty())return null;const o=n.map(m=>{const p=m.getPosition();return r?{lineNumber:p.lineNumber,beforeColumn:p.column-i.length,afterColumn:p.column}:{lineNumber:p.lineNumber,beforeColumn:p.column,afterColumn:p.column}}),a=this._findAutoClosingPairOpen(e,t,o.map(m=>new I(m.lineNumber,m.beforeColumn)),i);if(!a)return null;let l,u;if(Vt(i)?(l=e.autoClosingQuotes,u=e.shouldAutoCloseBefore.quote):(e.blockCommentStartToken?a.open.includes(e.blockCommentStartToken):!1)?(l=e.autoClosingComments,u=e.shouldAutoCloseBefore.comment):(l=e.autoClosingBrackets,u=e.shouldAutoCloseBefore.bracket),l==="never")return null;const h=this._findContainedAutoClosingPair(e,a),d=h?h.close:"";let f=!0;for(const m of o){const{lineNumber:p,beforeColumn:C,afterColumn:b}=m,L=t.getLineContent(p),_=L.substring(0,C-1),k=L.substring(b-1);if(k.startsWith(d)||(f=!1),k.length>0){const T=k.charAt(0);if(!this._isBeforeClosingBrace(e,k)&&!u(T))return null}if(a.open.length===1&&(i==="'"||i==='"')&&l!=="always"){const T=vs(e.wordSeparators,[]);if(_.length>0){const E=_.charCodeAt(_.length-1);if(T.get(E)===0)return null}}if(!t.tokenization.isCheapToTokenize(p))return null;t.tokenization.forceTokenization(p);const S=t.tokenization.getLineTokens(p),N=Jt(S,C-1);if(!a.shouldAutoClose(N,C-N.firstCharOffset))return null;const x=a.findNeutralCharacter();if(x){const T=t.tokenization.getTokenTypeIfInsertingCharacter(p,C,x);if(!a.isOK(T))return null}}return f?a.close.substring(0,a.close.length-d.length):a.close}static _findContainedAutoClosingPair(e,t){if(t.open.length<=1)return null;const n=t.close.charAt(t.close.length-1),i=e.autoClosingPairs.autoClosingPairsCloseByEnd.get(n)||[];let r=null;for(const o of i)o.open!==t.open&&t.open.includes(o.open)&&t.close.endsWith(o.close)&&(!r||o.open.length>r.open.length)&&(r=o);return r}static _findAutoClosingPairOpen(e,t,n,i){const r=e.autoClosingPairs.autoClosingPairsOpenByEnd.get(i);if(!r)return null;let o=null;for(const a of r)if(o===null||a.open.length>o.open.length){let l=!0;for(const u of n)if(t.getValueInRange(new w(u.lineNumber,u.column-a.open.length+1,u.lineNumber,u.column))+i!==a.open){l=!1;break}l&&(o=a)}return o}static _isBeforeClosingBrace(e,t){const n=t.charAt(0),i=e.autoClosingPairs.autoClosingPairsOpenByStart.get(n)||[],r=e.autoClosingPairs.autoClosingPairsCloseByStart.get(n)||[],o=i.some(l=>t.startsWith(l.open)),a=r.some(l=>t.startsWith(l.close));return!o&&a}}class Db{static getEdits(e,t,n,i,r){if(!r&&this._isSurroundSelectionType(e,t,n,i))return this._runSurroundSelectionType(e,n,i)}static _runSurroundSelectionType(e,t,n){const i=[];for(let r=0,o=t.length;r<o;r++){const a=t[r],l=e.surroundingPairs[n];i[r]=new Nb(a,n,l)}return new ye(0,i,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!0})}static _isSurroundSelectionType(e,t,n,i){if(!xh(e,i)||!e.surroundingPairs.hasOwnProperty(i))return!1;const r=Vt(i);for(const o of n){if(o.isEmpty())return!1;let a=!0;for(let l=o.startLineNumber;l<=o.endLineNumber;l++){const u=t.getLineContent(l),c=l===o.startLineNumber?o.startColumn-1:0,h=l===o.endLineNumber?o.endColumn-1:u.length,d=u.substring(c,h);if(/[^ \t]/.test(d)){a=!1;break}}if(a)return!1;if(r&&o.startLineNumber===o.endLineNumber&&o.startColumn+1===o.endColumn){const l=t.getValueInRange(o);if(Vt(l))return!1}}return!0}}class Ob{static getEdits(e,t,n,i,r,o){if(!o&&this._isTypeInterceptorElectricChar(t,n,i)){const a=this._typeInterceptorElectricChar(e,t,n,i[0],r);if(a)return a}}static _isTypeInterceptorElectricChar(e,t,n){return!!(n.length===1&&t.tokenization.isCheapToTokenize(n[0].getEndPosition().lineNumber))}static _typeInterceptorElectricChar(e,t,n,i,r){if(!t.electricChars.hasOwnProperty(r)||!i.isEmpty())return null;const o=i.getPosition();n.tokenization.forceTokenization(o.lineNumber);const a=n.tokenization.getLineTokens(o.lineNumber);let l;try{l=t.onElectricCharacter(r,a,o.column)}catch(u){return Tt(u),null}if(!l)return null;if(l.matchOpenBracket){const u=(a.getLineContent()+r).lastIndexOf(l.matchOpenBracket)+1,c=n.bracketPairs.findMatchingBracketUp(l.matchOpenBracket,{lineNumber:o.lineNumber,column:u},500);if(c){if(c.startLineNumber===o.lineNumber)return null;const h=n.getLineContent(c.startLineNumber),d=ke(h),f=t.normalizeIndentation(d),m=n.getLineContent(o.lineNumber),p=n.getLineFirstNonWhitespaceColumn(o.lineNumber)||o.column,C=m.substring(p-1,o.column-1),b=f+C+r,L=new w(o.lineNumber,1,o.lineNumber,o.column),_=new Pe(L,b);return new ye(sa(b,e),[_],{shouldPushStackElementBefore:!1,shouldPushStackElementAfter:!0})}}return null}}class Bb{static getEdits(e,t,n){const i=[];for(let o=0,a=t.length;o<a;o++)i[o]=new Pe(t[o],n);const r=sa(n,e);return new ye(r,i,{shouldPushStackElementBefore:or(e,r),shouldPushStackElementAfter:!1})}}class Vb{static getEdits(e,t,n,i,r){if(!r&&i===`
`){const o=[];for(let a=0,l=n.length;a<l;a++)o[a]=this._enter(e,t,!1,n[a]);return new ye(4,o,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!1})}}static _enter(e,t,n,i){if(e.autoIndent===0)return Gt(i,`
`,n);if(!t.tokenization.isCheapToTokenize(i.getStartPosition().lineNumber)||e.autoIndent===1){const l=t.getLineContent(i.startLineNumber),u=ke(l).substring(0,i.startColumn-1);return Gt(i,`
`+e.normalizeIndentation(u),n)}const r=na(e.autoIndent,t,i,e.languageConfigurationService);if(r){if(r.indentAction===Ce.None)return Gt(i,`
`+e.normalizeIndentation(r.indentation+r.appendText),n);if(r.indentAction===Ce.Indent)return Gt(i,`
`+e.normalizeIndentation(r.indentation+r.appendText),n);if(r.indentAction===Ce.IndentOutdent){const l=e.normalizeIndentation(r.indentation),u=e.normalizeIndentation(r.indentation+r.appendText),c=`
`+u+`
`+l;return n?new ms(i,c,!0):new Ws(i,c,-1,u.length-l.length,!0)}else if(r.indentAction===Ce.Outdent){const l=Fs(e,r.indentation);return Gt(i,`
`+e.normalizeIndentation(l+r.appendText),n)}}const o=t.getLineContent(i.startLineNumber),a=ke(o).substring(0,i.startColumn-1);if(e.autoIndent>=4){const l=Eb(e.autoIndent,t,i,{unshiftIndent:u=>Fs(e,u),shiftIndent:u=>ra(e,u),normalizeIndentation:u=>e.normalizeIndentation(u)},e.languageConfigurationService);if(l){let u=e.visibleColumnFromColumn(t,i.getEndPosition());const c=i.endColumn,h=t.getLineContent(i.endLineNumber),d=Ve(h);if(d>=0?i=i.setEndPosition(i.endLineNumber,Math.max(i.endColumn,d+1)):i=i.setEndPosition(i.endLineNumber,t.getLineMaxColumn(i.endLineNumber)),n)return new ms(i,`
`+e.normalizeIndentation(l.afterEnter),!0);{let f=0;return c<=d+1&&(e.insertSpaces||(u=Math.ceil(u/e.indentSize)),f=Math.min(u+1-e.normalizeIndentation(l.afterEnter).length-1,0)),new Ws(i,`
`+e.normalizeIndentation(l.afterEnter),0,f,!0)}}}return Gt(i,`
`+e.normalizeIndentation(a),n)}static lineInsertBefore(e,t,n){if(t===null||n===null)return[];const i=[];for(let r=0,o=n.length;r<o;r++){let a=n[r].positionLineNumber;if(a===1)i[r]=new ms(new w(1,1,1,1),`
`);else{a--;const l=t.getLineMaxColumn(a);i[r]=this._enter(e,t,!1,new w(a,l,a,l))}}return i}static lineInsertAfter(e,t,n){if(t===null||n===null)return[];const i=[];for(let r=0,o=n.length;r<o;r++){const a=n[r].positionLineNumber,l=t.getLineMaxColumn(a);i[r]=this._enter(e,t,!1,new w(a,l,a,l))}return i}static lineBreakInsert(e,t,n){const i=[];for(let r=0,o=n.length;r<o;r++)i[r]=this._enter(e,t,!0,n[r]);return i}}class Wb{static getEdits(e,t,n,i,r,o){const a=this._distributePasteToCursors(e,n,i,r,o);return a?(n=n.sort(w.compareRangesUsingStarts),this._distributedPaste(e,t,n,a)):this._simplePaste(e,t,n,i,r)}static _distributePasteToCursors(e,t,n,i,r){if(i||t.length===1)return null;if(r&&r.length===t.length)return r;if(e.multiCursorPaste==="spread"){n.charCodeAt(n.length-1)===10&&(n=n.substring(0,n.length-1)),n.charCodeAt(n.length-1)===13&&(n=n.substring(0,n.length-1));const o=er(n);if(o.length===t.length)return o}return null}static _distributedPaste(e,t,n,i){const r=[];for(let o=0,a=n.length;o<a;o++)r[o]=new Pe(n[o],i[o]);return new ye(0,r,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!0})}static _simplePaste(e,t,n,i,r){const o=[];for(let a=0,l=n.length;a<l;a++){const u=n[a],c=u.getPosition();if(r&&!u.isEmpty()&&(r=!1),r&&i.indexOf(`
`)!==i.length-1&&(r=!1),r){const h=new w(c.lineNumber,1,c.lineNumber,1);o[a]=new kb(h,i,u,!0)}else o[a]=new Pe(u,i)}return new ye(0,o,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!0})}}class Fb{static getEdits(e,t,n,i,r,o,a,l){const u=i.map(c=>this._compositionType(n,c,r,o,a,l));return new ye(4,u,{shouldPushStackElementBefore:or(e,4),shouldPushStackElementAfter:!1})}static _compositionType(e,t,n,i,r,o){if(!t.isEmpty())return null;const a=t.getPosition(),l=Math.max(1,a.column-i),u=Math.min(e.getLineMaxColumn(a.lineNumber),a.column+r),c=new w(a.lineNumber,l,a.lineNumber,u);return e.getValueInRange(c)===n&&o===0?null:new Ws(c,n,0,o)}}class zb{static getEdits(e,t,n){const i=[];for(let o=0,a=t.length;o<a;o++)i[o]=new Pe(t[o],n);const r=sa(n,e);return new ye(r,i,{shouldPushStackElementBefore:or(e,r),shouldPushStackElementAfter:!1})}}class Hb{static getCommands(e,t,n){const i=[];for(let r=0,o=n.length;r<o;r++){const a=n[r];if(a.isEmpty()){const l=t.getLineContent(a.startLineNumber);if(/^\s*$/.test(l)&&t.tokenization.isCheapToTokenize(a.startLineNumber)){let u=this._goodIndentForLine(e,t,a.startLineNumber);u=u||"	";const c=e.normalizeIndentation(u);if(!l.startsWith(c)){i[r]=new Pe(new w(a.startLineNumber,1,a.startLineNumber,l.length+1),c,!0);continue}}i[r]=this._replaceJumpToNextIndent(e,t,a,!0)}else{if(a.startLineNumber===a.endLineNumber){const l=t.getLineMaxColumn(a.startLineNumber);if(a.startColumn!==1||a.endColumn!==l){i[r]=this._replaceJumpToNextIndent(e,t,a,!1);continue}}i[r]=new rn(a,{isUnshift:!1,tabSize:e.tabSize,indentSize:e.indentSize,insertSpaces:e.insertSpaces,useTabStops:e.useTabStops,autoIndent:e.autoIndent},e.languageConfigurationService)}}return i}static _goodIndentForLine(e,t,n){let i=null,r="";const o=Oi(e.autoIndent,t,n,!1,e.languageConfigurationService);if(o)i=o.action,r=o.indentation;else if(n>1){let a;for(a=n-1;a>=1;a--){const c=t.getLineContent(a);if(on(c)>=0)break}if(a<1)return null;const l=t.getLineMaxColumn(a),u=na(e.autoIndent,t,new w(a,l,a,l),e.languageConfigurationService);u&&(r=u.indentation+u.appendText)}return i&&(i===Ce.Indent&&(r=ra(e,r)),i===Ce.Outdent&&(r=Fs(e,r)),r=e.normalizeIndentation(r)),r||null}static _replaceJumpToNextIndent(e,t,n,i){let r="";const o=n.getStartPosition();if(e.insertSpaces){const a=e.visibleColumnFromColumn(t,o),l=e.indentSize,u=l-a%l;for(let c=0;c<u;c++)r+=" "}else r="	";return new Pe(n,r,i)}}class ia extends Ws{constructor(e,t,n,i,r,o){super(e,t,n,i),this._openCharacter=r,this._closeCharacter=o,this.closeCharacterRange=null,this.enclosingRange=null}_computeCursorStateWithRange(e,t,n){return this.closeCharacterRange=new w(t.startLineNumber,t.endColumn-this._closeCharacter.length,t.endLineNumber,t.endColumn),this.enclosingRange=new w(t.startLineNumber,t.endColumn-this._openCharacter.length-this._closeCharacter.length,t.endLineNumber,t.endColumn),super.computeCursorState(e,n)}}class jb extends ia{constructor(e,t,n,i){const r=(n?t:"")+i,o=0,a=-i.length;super(e,r,o,a,t,i)}computeCursorState(e,t){const i=t.getInverseEditOperations()[0].range;return this._computeCursorStateWithRange(e,i,t)}}class Ub extends ia{constructor(e,t,n,i){const r=n+i,o=0,a=n.length;super(t,r,o,a,n,i),this._autoIndentationEdit=e,this._autoClosingEdit={range:t,text:r}}getEditOperations(e,t){t.addTrackedEditOperation(this._autoIndentationEdit.range,this._autoIndentationEdit.text),t.addTrackedEditOperation(this._autoClosingEdit.range,this._autoClosingEdit.text)}computeCursorState(e,t){const n=t.getInverseEditOperations();if(n.length!==2)throw new Error("There should be two inverse edit operations!");const i=n[0].range,r=n[1].range,o=i.plusRange(r);return this._computeCursorStateWithRange(e,o,t)}}function sa(s,e){return s===" "?e===5||e===6?6:5:4}function or(s,e){return Gu(s)&&!Gu(e)?!0:s===5?!1:qu(s)!==qu(e)}function qu(s){return s===6||s===5?"space":s}function Gu(s){return s===4||s===5||s===6}function Nh(s,e,t,n,i){if(s.autoClosingOvertype==="never"||!s.autoClosingPairs.autoClosingPairsCloseSingleChar.has(i))return!1;for(let r=0,o=t.length;r<o;r++){const a=t[r];if(!a.isEmpty())return!1;const l=a.getPosition(),u=e.getLineContent(l.lineNumber);if(u.charAt(l.column-1)!==i)return!1;const h=Vt(i);if((l.column>2?u.charCodeAt(l.column-2):0)===92&&h)return!1;if(s.autoClosingOvertype==="auto"){let f=!1;for(let m=0,p=n.length;m<p;m++){const C=n[m];if(l.lineNumber===C.startLineNumber&&l.column===C.startColumn){f=!0;break}}if(!f)return!1}}return!0}function Gt(s,e,t){return t?new ms(s,e,!0):new Pe(s,e,!0)}function ra(s,e,t){return t=t||1,rn.shiftIndent(e,e.length+t,s.tabSize,s.indentSize,s.insertSpaces)}function Fs(s,e,t){return t=t||1,rn.unshiftIndent(e,e.length+t,s.tabSize,s.indentSize,s.insertSpaces)}function xh(s,e){return Vt(e)?s.autoSurround==="quotes"||s.autoSurround==="languageDefined":s.autoSurround==="brackets"||s.autoSurround==="languageDefined"}class Zn{static indent(e,t,n){if(t===null||n===null)return[];const i=[];for(let r=0,o=n.length;r<o;r++)i[r]=new rn(n[r],{isUnshift:!1,tabSize:e.tabSize,indentSize:e.indentSize,insertSpaces:e.insertSpaces,useTabStops:e.useTabStops,autoIndent:e.autoIndent},e.languageConfigurationService);return i}static outdent(e,t,n){const i=[];for(let r=0,o=n.length;r<o;r++)i[r]=new rn(n[r],{isUnshift:!0,tabSize:e.tabSize,indentSize:e.indentSize,insertSpaces:e.insertSpaces,useTabStops:e.useTabStops,autoIndent:e.autoIndent},e.languageConfigurationService);return i}static paste(e,t,n,i,r,o){return Wb.getEdits(e,t,n,i,r,o)}static tab(e,t,n){return Hb.getCommands(e,t,n)}static compositionType(e,t,n,i,r,o,a,l){return Fb.getEdits(e,t,n,i,r,o,a,l)}static compositionEndWithInterceptors(e,t,n,i,r,o){if(!i)return null;let a=null;for(const d of i)if(a===null)a=d.insertedText;else if(a!==d.insertedText)return null;if(!a||a.length!==1)return null;const l=a;let u=!1;for(const d of i)if(d.deletedText.length!==0){u=!0;break}if(u){if(!xh(t,l)||!t.surroundingPairs.hasOwnProperty(l))return null;const d=Vt(l);for(const p of i)if(p.deletedSelectionStart!==0||p.deletedSelectionEnd!==p.deletedText.length||/^[ \t]+$/.test(p.deletedText)||d&&Vt(p.deletedText))return null;const f=[];for(const p of r){if(!p.isEmpty())return null;f.push(p.getPosition())}if(f.length!==i.length)return null;const m=[];for(let p=0,C=f.length;p<C;p++)m.push(new xb(f[p],i[p].deletedText,t.surroundingPairs[l]));return new ye(4,m,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!1})}const c=Ab.getEdits(t,n,r,o,l);if(c!==void 0)return c;const h=So.getEdits(t,n,r,l,!0,!1);return h!==void 0?h:null}static typeWithInterceptors(e,t,n,i,r,o,a){const l=Vb.getEdits(n,i,r,a,e);if(l!==void 0)return l;const u=Mb.getEdits(n,i,r,a,e);if(u!==void 0)return u;const c=Pb.getEdits(t,n,i,r,o,a);if(c!==void 0)return c;const h=So.getEdits(n,i,r,a,!1,e);if(h!==void 0)return h;const d=Db.getEdits(n,i,r,a,e);if(d!==void 0)return d;const f=Ob.getEdits(t,n,i,r,a,e);return f!==void 0?f:Bb.getEdits(t,r,a)}static typeWithoutInterceptors(e,t,n,i,r){return zb.getEdits(e,i,r)}}class qb{constructor(e,t,n,i,r,o){this.deletedText=e,this.deletedSelectionStart=t,this.deletedSelectionEnd=n,this.insertedText=i,this.insertedSelectionStart=r,this.insertedSelectionEnd=o}}var $u;(function(s){s.editorSimpleInput=new W("editorSimpleInput",!1,!0),s.editorTextFocus=new W("editorTextFocus",!1,g("editorTextFocus","Whether the editor text has focus (cursor is blinking)")),s.focus=new W("editorFocus",!1,g("editorFocus","Whether the editor or an editor widget has focus (e.g. focus is in the find widget)")),s.textInputFocus=new W("textInputFocus",!1,g("textInputFocus","Whether an editor or a rich text input has focus (cursor is blinking)")),s.readOnly=new W("editorReadonly",!1,g("editorReadonly","Whether the editor is read-only")),s.inDiffEditor=new W("inDiffEditor",!1,g("inDiffEditor","Whether the context is a diff editor")),s.isEmbeddedDiffEditor=new W("isEmbeddedDiffEditor",!1,g("isEmbeddedDiffEditor","Whether the context is an embedded diff editor")),s.inMultiDiffEditor=new W("inMultiDiffEditor",!1,g("inMultiDiffEditor","Whether the context is a multi diff editor")),s.multiDiffEditorAllCollapsed=new W("multiDiffEditorAllCollapsed",void 0,g("multiDiffEditorAllCollapsed","Whether all files in multi diff editor are collapsed")),s.hasChanges=new W("diffEditorHasChanges",!1,g("diffEditorHasChanges","Whether the diff editor has changes")),s.comparingMovedCode=new W("comparingMovedCode",!1,g("comparingMovedCode","Whether a moved code block is selected for comparison")),s.accessibleDiffViewerVisible=new W("accessibleDiffViewerVisible",!1,g("accessibleDiffViewerVisible","Whether the accessible diff viewer is visible")),s.diffEditorRenderSideBySideInlineBreakpointReached=new W("diffEditorRenderSideBySideInlineBreakpointReached",!1,g("diffEditorRenderSideBySideInlineBreakpointReached","Whether the diff editor render side by side inline breakpoint is reached")),s.diffEditorInlineMode=new W("diffEditorInlineMode",!1,g("diffEditorInlineMode","Whether inline mode is active")),s.diffEditorOriginalWritable=new W("diffEditorOriginalWritable",!1,g("diffEditorOriginalWritable","Whether modified is writable in the diff editor")),s.diffEditorModifiedWritable=new W("diffEditorModifiedWritable",!1,g("diffEditorModifiedWritable","Whether modified is writable in the diff editor")),s.diffEditorOriginalUri=new W("diffEditorOriginalUri","",g("diffEditorOriginalUri","The uri of the original document")),s.diffEditorModifiedUri=new W("diffEditorModifiedUri","",g("diffEditorModifiedUri","The uri of the modified document")),s.columnSelection=new W("editorColumnSelection",!1,g("editorColumnSelection","Whether `editor.columnSelection` is enabled")),s.writable=s.readOnly.toNegated(),s.hasNonEmptySelection=new W("editorHasSelection",!1,g("editorHasSelection","Whether the editor has text selected")),s.hasOnlyEmptySelection=s.hasNonEmptySelection.toNegated(),s.hasMultipleSelections=new W("editorHasMultipleSelections",!1,g("editorHasMultipleSelections","Whether the editor has multiple selections")),s.hasSingleSelection=s.hasMultipleSelections.toNegated(),s.tabMovesFocus=new W("editorTabMovesFocus",!1,g("editorTabMovesFocus","Whether `Tab` will move focus out of the editor")),s.tabDoesNotMoveFocus=s.tabMovesFocus.toNegated(),s.isInEmbeddedEditor=new W("isInEmbeddedEditor",!1,!0),s.canUndo=new W("canUndo",!1,!0),s.canRedo=new W("canRedo",!1,!0),s.hoverVisible=new W("editorHoverVisible",!1,g("editorHoverVisible","Whether the editor hover is visible")),s.hoverFocused=new W("editorHoverFocused",!1,g("editorHoverFocused","Whether the editor hover is focused")),s.stickyScrollFocused=new W("stickyScrollFocused",!1,g("stickyScrollFocused","Whether the sticky scroll is focused")),s.stickyScrollVisible=new W("stickyScrollVisible",!1,g("stickyScrollVisible","Whether the sticky scroll is visible")),s.standaloneColorPickerVisible=new W("standaloneColorPickerVisible",!1,g("standaloneColorPickerVisible","Whether the standalone color picker is visible")),s.standaloneColorPickerFocused=new W("standaloneColorPickerFocused",!1,g("standaloneColorPickerFocused","Whether the standalone color picker is focused")),s.inCompositeEditor=new W("inCompositeEditor",void 0,g("inCompositeEditor","Whether the editor is part of a larger editor (e.g. notebooks)")),s.notInCompositeEditor=s.inCompositeEditor.toNegated(),s.languageId=new W("editorLangId","",g("editorLangId","The language identifier of the editor")),s.hasCompletionItemProvider=new W("editorHasCompletionItemProvider",!1,g("editorHasCompletionItemProvider","Whether the editor has a completion item provider")),s.hasCodeActionsProvider=new W("editorHasCodeActionsProvider",!1,g("editorHasCodeActionsProvider","Whether the editor has a code actions provider")),s.hasCodeLensProvider=new W("editorHasCodeLensProvider",!1,g("editorHasCodeLensProvider","Whether the editor has a code lens provider")),s.hasDefinitionProvider=new W("editorHasDefinitionProvider",!1,g("editorHasDefinitionProvider","Whether the editor has a definition provider")),s.hasDeclarationProvider=new W("editorHasDeclarationProvider",!1,g("editorHasDeclarationProvider","Whether the editor has a declaration provider")),s.hasImplementationProvider=new W("editorHasImplementationProvider",!1,g("editorHasImplementationProvider","Whether the editor has an implementation provider")),s.hasTypeDefinitionProvider=new W("editorHasTypeDefinitionProvider",!1,g("editorHasTypeDefinitionProvider","Whether the editor has a type definition provider")),s.hasHoverProvider=new W("editorHasHoverProvider",!1,g("editorHasHoverProvider","Whether the editor has a hover provider")),s.hasDocumentHighlightProvider=new W("editorHasDocumentHighlightProvider",!1,g("editorHasDocumentHighlightProvider","Whether the editor has a document highlight provider")),s.hasDocumentSymbolProvider=new W("editorHasDocumentSymbolProvider",!1,g("editorHasDocumentSymbolProvider","Whether the editor has a document symbol provider")),s.hasReferenceProvider=new W("editorHasReferenceProvider",!1,g("editorHasReferenceProvider","Whether the editor has a reference provider")),s.hasRenameProvider=new W("editorHasRenameProvider",!1,g("editorHasRenameProvider","Whether the editor has a rename provider")),s.hasSignatureHelpProvider=new W("editorHasSignatureHelpProvider",!1,g("editorHasSignatureHelpProvider","Whether the editor has a signature help provider")),s.hasInlayHintsProvider=new W("editorHasInlayHintsProvider",!1,g("editorHasInlayHintsProvider","Whether the editor has an inline hints provider")),s.hasDocumentFormattingProvider=new W("editorHasDocumentFormattingProvider",!1,g("editorHasDocumentFormattingProvider","Whether the editor has a document formatting provider")),s.hasDocumentSelectionFormattingProvider=new W("editorHasDocumentSelectionFormattingProvider",!1,g("editorHasDocumentSelectionFormattingProvider","Whether the editor has a document selection formatting provider")),s.hasMultipleDocumentFormattingProvider=new W("editorHasMultipleDocumentFormattingProvider",!1,g("editorHasMultipleDocumentFormattingProvider","Whether the editor has multiple document formatting providers")),s.hasMultipleDocumentSelectionFormattingProvider=new W("editorHasMultipleDocumentSelectionFormattingProvider",!1,g("editorHasMultipleDocumentSelectionFormattingProvider","Whether the editor has multiple document selection formatting providers"))})($u||($u={}));const Mt=class Mt{constructor(e,t,n,i){this._rgba8Brand=void 0,this.r=Mt._clamp(e),this.g=Mt._clamp(t),this.b=Mt._clamp(n),this.a=Mt._clamp(i)}equals(e){return this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}static _clamp(e){return e<0?0:e>255?255:e|0}};Mt.Empty=new Mt(0,0,0,0);let ci=Mt;const Xs=class Xs extends oe{static getInstance(){return this._INSTANCE||(this._INSTANCE=Rd(new Xs)),this._INSTANCE}constructor(){super(),this._onDidChange=new J,this.onDidChange=this._onDidChange.event,this._updateColorMap(),this._register(nn.onDidChange(e=>{e.changedColorMap&&this._updateColorMap()}))}_updateColorMap(){const e=nn.getColorMap();if(!e){this._colors=[ci.Empty],this._backgroundIsLight=!0;return}this._colors=[ci.Empty];for(let n=1;n<e.length;n++){const i=e[n].rgba;this._colors[n]=new ci(i.r,i.g,i.b,Math.round(i.a*255))}const t=e[2].getRelativeLuminance();this._backgroundIsLight=t>=.5,this._onDidChange.fire(void 0)}getColor(e){return(e<1||e>=this._colors.length)&&(e=2),this._colors[e]}backgroundIsLight(){return this._backgroundIsLight}};Xs._INSTANCE=null;let ko=Xs;class Qu{constructor(e,t,n){this._colorZoneBrand=void 0,this.from=e|0,this.to=t|0,this.colorId=n|0}static compare(e,t){return e.colorId===t.colorId?e.from===t.from?e.to-t.to:e.from-t.from:e.colorId-t.colorId}}class Gb{constructor(e,t,n,i){this._overviewRulerZoneBrand=void 0,this.startLineNumber=e,this.endLineNumber=t,this.heightInLines=n,this.color=i,this._colorZone=null}static compare(e,t){return e.color===t.color?e.startLineNumber===t.startLineNumber?e.heightInLines===t.heightInLines?e.endLineNumber-t.endLineNumber:e.heightInLines-t.heightInLines:e.startLineNumber-t.startLineNumber:e.color<t.color?-1:1}setColorZone(e){this._colorZone=e}getColorZones(){return this._colorZone}}class N_{constructor(e){this._getVerticalOffsetForLine=e,this._zones=[],this._colorZonesInvalid=!1,this._lineHeight=0,this._domWidth=0,this._domHeight=0,this._outerHeight=0,this._pixelRatio=1,this._lastAssignedId=0,this._color2Id=Object.create(null),this._id2Color=[]}getId2Color(){return this._id2Color}setZones(e){this._zones=e,this._zones.sort(Gb.compare)}setLineHeight(e){return this._lineHeight===e?!1:(this._lineHeight=e,this._colorZonesInvalid=!0,!0)}setPixelRatio(e){this._pixelRatio=e,this._colorZonesInvalid=!0}getDOMWidth(){return this._domWidth}getCanvasWidth(){return this._domWidth*this._pixelRatio}setDOMWidth(e){return this._domWidth===e?!1:(this._domWidth=e,this._colorZonesInvalid=!0,!0)}getDOMHeight(){return this._domHeight}getCanvasHeight(){return this._domHeight*this._pixelRatio}setDOMHeight(e){return this._domHeight===e?!1:(this._domHeight=e,this._colorZonesInvalid=!0,!0)}getOuterHeight(){return this._outerHeight}setOuterHeight(e){return this._outerHeight===e?!1:(this._outerHeight=e,this._colorZonesInvalid=!0,!0)}resolveColorZones(){const e=this._colorZonesInvalid,t=Math.floor(this._lineHeight),n=Math.floor(this.getCanvasHeight()),i=Math.floor(this._outerHeight),r=n/i,o=Math.floor(4*this._pixelRatio/2),a=[];for(let l=0,u=this._zones.length;l<u;l++){const c=this._zones[l];if(!e){const k=c.getColorZones();if(k){a.push(k);continue}}const h=this._getVerticalOffsetForLine(c.startLineNumber),d=c.heightInLines===0?this._getVerticalOffsetForLine(c.endLineNumber)+t:h+c.heightInLines*t,f=Math.floor(r*h),m=Math.floor(r*d);let p=Math.floor((f+m)/2),C=m-p;C<o&&(C=o),p-C<0&&(p=C),p+C>n&&(p=n-C);const b=c.color;let L=this._color2Id[b];L||(L=++this._lastAssignedId,this._color2Id[b]=L,this._id2Color[L]=b);const _=new Qu(p-C,p+C,L);c.setColorZone(_),a.push(_)}return this._colorZonesInvalid=!1,a.sort(Qu.compare),a}}class x_{constructor(e,t,n,i){this.selections=e,this.startLineNumber=t.startLineNumber|0,this.endLineNumber=t.endLineNumber|0,this.relativeVerticalOffset=t.relativeVerticalOffset,this.bigNumbersDelta=t.bigNumbersDelta|0,this.lineHeight=t.lineHeight|0,this.whitespaceViewportData=n,this._model=i,this.visibleRange=new w(t.startLineNumber,this._model.getLineMinColumn(t.startLineNumber),t.endLineNumber,this._model.getLineMaxColumn(t.endLineNumber))}getViewLineRenderingData(e){return this._model.getViewportViewLineRenderingData(this.visibleRange,e)}getDecorationsInViewport(){return this._model.getDecorationsInViewport(this.visibleRange)}}class $b{get type(){return this._theme.type}get value(){return this._theme}constructor(e){this._theme=e}update(e){this._theme=e}getColor(e){return this._theme.getColor(e)}}class T_{constructor(e,t,n){this.configuration=e,this.theme=new $b(t),this.viewModel=n,this.viewLayout=n.viewLayout}addEventHandler(e){this.viewModel.addViewEventHandler(e)}removeEventHandler(e){this.viewModel.removeViewEventHandler(e)}}class Ar{constructor(e,t,n,i,r){this.injectionOffsets=e,this.injectionOptions=t,this.breakOffsets=n,this.breakOffsetsVisibleColumn=i,this.wrappedTextIndentLength=r}getOutputLineCount(){return this.breakOffsets.length}getMinOutputOffset(e){return e>0?this.wrappedTextIndentLength:0}getLineLength(e){const t=e>0?this.breakOffsets[e-1]:0;let i=this.breakOffsets[e]-t;return e>0&&(i+=this.wrappedTextIndentLength),i}getMaxOutputOffset(e){return this.getLineLength(e)}translateToInputOffset(e,t){e>0&&(t=Math.max(0,t-this.wrappedTextIndentLength));let i=e===0?t:this.breakOffsets[e-1]+t;if(this.injectionOffsets!==null)for(let r=0;r<this.injectionOffsets.length&&i>this.injectionOffsets[r];r++)i<this.injectionOffsets[r]+this.injectionOptions[r].content.length?i=this.injectionOffsets[r]:i-=this.injectionOptions[r].content.length;return i}translateToOutputPosition(e,t=2){let n=e;if(this.injectionOffsets!==null)for(let i=0;i<this.injectionOffsets.length&&!(e<this.injectionOffsets[i]||t!==1&&e===this.injectionOffsets[i]);i++)n+=this.injectionOptions[i].content.length;return this.offsetInInputWithInjectionsToOutputPosition(n,t)}offsetInInputWithInjectionsToOutputPosition(e,t=2){let n=0,i=this.breakOffsets.length-1,r=0,o=0;for(;n<=i;){r=n+(i-n)/2|0;const l=this.breakOffsets[r];if(o=r>0?this.breakOffsets[r-1]:0,t===0)if(e<=o)i=r-1;else if(e>l)n=r+1;else break;else if(e<o)i=r-1;else if(e>=l)n=r+1;else break}let a=e-o;return r>0&&(a+=this.wrappedTextIndentLength),new rs(r,a)}normalizeOutputPosition(e,t,n){if(this.injectionOffsets!==null){const i=this.outputPositionToOffsetInInputWithInjections(e,t),r=this.normalizeOffsetInInputWithInjectionsAroundInjections(i,n);if(r!==i)return this.offsetInInputWithInjectionsToOutputPosition(r,n)}if(n===0){if(e>0&&t===this.getMinOutputOffset(e))return new rs(e-1,this.getMaxOutputOffset(e-1))}else if(n===1){const i=this.getOutputLineCount()-1;if(e<i&&t===this.getMaxOutputOffset(e))return new rs(e+1,this.getMinOutputOffset(e+1))}return new rs(e,t)}outputPositionToOffsetInInputWithInjections(e,t){return e>0&&(t=Math.max(0,t-this.wrappedTextIndentLength)),(e>0?this.breakOffsets[e-1]:0)+t}normalizeOffsetInInputWithInjectionsAroundInjections(e,t){const n=this.getInjectedTextAtOffset(e);if(!n)return e;if(t===2){if(e===n.offsetInInputWithInjections+n.length&&Zu(this.injectionOptions[n.injectedTextIndex].cursorStops))return n.offsetInInputWithInjections+n.length;{let i=n.offsetInInputWithInjections;if(Xu(this.injectionOptions[n.injectedTextIndex].cursorStops))return i;let r=n.injectedTextIndex-1;for(;r>=0&&this.injectionOffsets[r]===this.injectionOffsets[n.injectedTextIndex]&&!(Zu(this.injectionOptions[r].cursorStops)||(i-=this.injectionOptions[r].content.length,Xu(this.injectionOptions[r].cursorStops)));)r--;return i}}else if(t===1||t===4){let i=n.offsetInInputWithInjections+n.length,r=n.injectedTextIndex;for(;r+1<this.injectionOffsets.length&&this.injectionOffsets[r+1]===this.injectionOffsets[r];)i+=this.injectionOptions[r+1].content.length,r++;return i}else if(t===0||t===3){let i=n.offsetInInputWithInjections,r=n.injectedTextIndex;for(;r-1>=0&&this.injectionOffsets[r-1]===this.injectionOffsets[r];)i-=this.injectionOptions[r-1].content.length,r--;return i}uc()}getInjectedText(e,t){const n=this.outputPositionToOffsetInInputWithInjections(e,t),i=this.getInjectedTextAtOffset(n);return i?{options:this.injectionOptions[i.injectedTextIndex]}:null}getInjectedTextAtOffset(e){const t=this.injectionOffsets,n=this.injectionOptions;if(t!==null){let i=0;for(let r=0;r<t.length;r++){const o=n[r].content.length,a=t[r]+i,l=t[r]+i+o;if(a>e)break;if(e<=l)return{injectedTextIndex:r,offsetInInputWithInjections:a,length:o};i+=o}}}}function Zu(s){return s==null?!0:s===On.Right||s===On.Both}function Xu(s){return s==null?!0:s===On.Left||s===On.Both}class rs{constructor(e,t){this.outputLineIndex=e,this.outputOffset=t}toString(){return`${this.outputLineIndex}:${this.outputOffset}`}toPosition(e){return new I(e+this.outputLineIndex,this.outputOffset+1)}}class E_{constructor(e,t,n,i,r,o,a){this.id=e,this.label=t,this.alias=n,this.metadata=i,this._precondition=r,this._run=o,this._contextKeyService=a}isSupported(){return this._contextKeyService.contextMatchesRules(this._precondition)}run(e){return this.isSupported()?this._run(e):Promise.resolve(void 0)}}class Th{static create(e){return new Th(e.get(135),e.get(134))}constructor(e,t){this.classifier=new Qb(e,t)}createLineBreaksComputer(e,t,n,i,r){const o=[],a=[],l=[];return{addRequest:(u,c,h)=>{o.push(u),a.push(c),l.push(h)},finalize:()=>{const u=e.typicalFullwidthCharacterWidth/e.typicalHalfwidthCharacterWidth,c=[];for(let h=0,d=o.length;h<d;h++){const f=a[h],m=l[h];m&&!m.injectionOptions&&!f?c[h]=Zb(this.classifier,m,o[h],t,n,u,i,r):c[h]=Xb(this.classifier,o[h],f,t,n,u,i,r)}return vo.length=0,Io.length=0,c}}}}class Qb extends Fn{constructor(e,t){super(0);for(let n=0;n<e.length;n++)this.set(e.charCodeAt(n),1);for(let n=0;n<t.length;n++)this.set(t.charCodeAt(n),2)}get(e){return e>=0&&e<256?this._asciiMap[e]:e>=12352&&e<=12543||e>=13312&&e<=19903||e>=19968&&e<=40959?3:this._map.get(e)||this._defaultValue}}let vo=[],Io=[];function Zb(s,e,t,n,i,r,o,a){if(i===-1)return null;const l=t.length;if(l<=1)return null;const u=a==="keepAll",c=e.breakOffsets,h=e.breakOffsetsVisibleColumn,d=Eh(t,n,i,r,o),f=i-d,m=vo,p=Io;let C=0,b=0,L=0,_=i;const k=c.length;let S=0;if(S>=0){let N=Math.abs(h[S]-_);for(;S+1<k;){const x=Math.abs(h[S+1]-_);if(x>=N)break;N=x,S++}}for(;S<k;){let N=S<0?0:c[S],x=S<0?0:h[S];b>N&&(N=b,x=L);let T=0,E=0,V=0,P=0;if(x<=_){let O=x,U=N===0?0:t.charCodeAt(N-1),ue=N===0?0:s.get(U),ge=!0;for(let ae=N;ae<l;ae++){const se=ae,Q=t.charCodeAt(ae);let ie,ce;if(Ne(Q)?(ae++,ie=0,ce=2):(ie=s.get(Q),ce=hi(Q,O,n,r)),se>b&&No(U,ue,Q,ie,u)&&(T=se,E=O),O+=ce,O>_){se>b?(V=se,P=O-ce):(V=ae+1,P=O),O-E>f&&(T=0),ge=!1;break}U=Q,ue=ie}if(ge){C>0&&(m[C]=c[c.length-1],p[C]=h[c.length-1],C++);break}}if(T===0){let O=x,U=t.charCodeAt(N),ue=s.get(U),ge=!1;for(let ae=N-1;ae>=b;ae--){const se=ae+1,Q=t.charCodeAt(ae);if(Q===9){ge=!0;break}let ie,ce;if(Md(Q)?(ae--,ie=0,ce=2):(ie=s.get(Q),ce=Bi(Q)?r:1),O<=_){if(V===0&&(V=se,P=O),O<=_-f)break;if(No(Q,ie,U,ue,u)){T=se,E=O;break}}O-=ce,U=Q,ue=ie}if(T!==0){const ae=f-(P-E);if(ae<=n){const se=t.charCodeAt(V);let Q;Ne(se)?Q=2:Q=hi(se,P,n,r),ae-Q<0&&(T=0)}}if(ge){S--;continue}}if(T===0&&(T=V,E=P),T<=b){const O=t.charCodeAt(b);Ne(O)?(T=b+2,E=L+2):(T=b+1,E=L+hi(O,L,n,r))}for(b=T,m[C]=T,L=E,p[C]=E,C++,_=E+f;S<0||S<k&&h[S]<E;)S++;let B=Math.abs(h[S]-_);for(;S+1<k;){const O=Math.abs(h[S+1]-_);if(O>=B)break;B=O,S++}}return C===0?null:(m.length=C,p.length=C,vo=e.breakOffsets,Io=e.breakOffsetsVisibleColumn,e.breakOffsets=m,e.breakOffsetsVisibleColumn=p,e.wrappedTextIndentLength=d,e)}function Xb(s,e,t,n,i,r,o,a){const l=Et.applyInjectedText(e,t);let u,c;if(t&&t.length>0?(u=t.map(E=>E.options),c=t.map(E=>E.column-1)):(u=null,c=null),i===-1)return u?new Ar(c,u,[l.length],[],0):null;const h=l.length;if(h<=1)return u?new Ar(c,u,[l.length],[],0):null;const d=a==="keepAll",f=Eh(l,n,i,r,o),m=i-f,p=[],C=[];let b=0,L=0,_=0,k=i,S=l.charCodeAt(0),N=s.get(S),x=hi(S,0,n,r),T=1;Ne(S)&&(x+=1,S=l.charCodeAt(1),N=s.get(S),T++);for(let E=T;E<h;E++){const V=E,P=l.charCodeAt(E);let B,O;Ne(P)?(E++,B=0,O=2):(B=s.get(P),O=hi(P,x,n,r)),No(S,N,P,B,d)&&(L=V,_=x),x+=O,x>k&&((L===0||x-_>m)&&(L=V,_=x-O),p[b]=L,C[b]=_,b++,k=_+m,L=0),S=P,N=B}return b===0&&(!t||t.length===0)?null:(p[b]=h,C[b]=x,new Ar(c,u,p,C,f))}function hi(s,e,t,n){return s===9?t-e%t:Bi(s)||s<32?n:1}function Ju(s,e){return e-s%e}function No(s,e,t,n,i){return t!==32&&(e===2&&n!==2||e!==1&&n===1||!i&&e===3&&n!==2||!i&&n===3&&e!==1)}function Eh(s,e,t,n,i){let r=0;if(i!==0){const o=Ve(s);if(o!==-1){for(let l=0;l<o;l++){const u=s.charCodeAt(l)===9?Ju(r,e):1;r+=u}const a=i===3?2:i===2?1:0;for(let l=0;l<a;l++){const u=Ju(r,e);r+=u}r+n>t&&(r=0)}}return r}class zs{constructor(e){this._selTrackedRange=null,this._trackSelection=!0,this._setState(e,new Le(new w(1,1,1,1),0,0,new I(1,1),0),new Le(new w(1,1,1,1),0,0,new I(1,1),0))}dispose(e){this._removeTrackedRange(e)}startTrackingSelection(e){this._trackSelection=!0,this._updateTrackedRange(e)}stopTrackingSelection(e){this._trackSelection=!1,this._removeTrackedRange(e)}_updateTrackedRange(e){this._trackSelection&&(this._selTrackedRange=e.model._setTrackedRange(this._selTrackedRange,this.modelState.selection,0))}_removeTrackedRange(e){this._selTrackedRange=e.model._setTrackedRange(this._selTrackedRange,null,0)}asCursorState(){return new H(this.modelState,this.viewState)}readSelectionFromMarkers(e){const t=e.model._getTrackedRange(this._selTrackedRange);return this.modelState.selection.isEmpty()&&!t.isEmpty()?Z.fromRange(t.collapseToEnd(),this.modelState.selection.getDirection()):Z.fromRange(t,this.modelState.selection.getDirection())}ensureValidState(e){this._setState(e,this.modelState,this.viewState)}setState(e,t,n){this._setState(e,t,n)}static _validatePositionWithCache(e,t,n,i){return t.equals(n)?i:e.normalizePosition(t,2)}static _validateViewState(e,t){const n=t.position,i=t.selectionStart.getStartPosition(),r=t.selectionStart.getEndPosition(),o=e.normalizePosition(n,2),a=this._validatePositionWithCache(e,i,n,o),l=this._validatePositionWithCache(e,r,i,a);return n.equals(o)&&i.equals(a)&&r.equals(l)?t:new Le(w.fromPositions(a,l),t.selectionStartKind,t.selectionStartLeftoverVisibleColumns+i.column-a.column,o,t.leftoverVisibleColumns+n.column-o.column)}_setState(e,t,n){if(n&&(n=zs._validateViewState(e.viewModel,n)),t){const i=e.model.validateRange(t.selectionStart),r=t.selectionStart.equalsRange(i)?t.selectionStartLeftoverVisibleColumns:0,o=e.model.validatePosition(t.position),a=t.position.equals(o)?t.leftoverVisibleColumns:0;t=new Le(i,t.selectionStartKind,r,o,a)}else{if(!n)return;const i=e.model.validateRange(e.coordinatesConverter.convertViewRangeToModelRange(n.selectionStart)),r=e.model.validatePosition(e.coordinatesConverter.convertViewPositionToModelPosition(n.position));t=new Le(i,n.selectionStartKind,n.selectionStartLeftoverVisibleColumns,r,n.leftoverVisibleColumns)}if(n){const i=e.coordinatesConverter.validateViewRange(n.selectionStart,t.selectionStart),r=e.coordinatesConverter.validateViewPosition(n.position,t.position);n=new Le(i,t.selectionStartKind,t.selectionStartLeftoverVisibleColumns,r,t.leftoverVisibleColumns)}else{const i=e.coordinatesConverter.convertModelPositionToViewPosition(new I(t.selectionStart.startLineNumber,t.selectionStart.startColumn)),r=e.coordinatesConverter.convertModelPositionToViewPosition(new I(t.selectionStart.endLineNumber,t.selectionStart.endColumn)),o=new w(i.lineNumber,i.column,r.lineNumber,r.column),a=e.coordinatesConverter.convertModelPositionToViewPosition(t.position);n=new Le(o,t.selectionStartKind,t.selectionStartLeftoverVisibleColumns,a,t.leftoverVisibleColumns)}this.modelState=t,this.viewState=n,this._updateTrackedRange(e)}}class Yu{constructor(e){this.context=e,this.cursors=[new zs(e)],this.lastAddedCursorIndex=0}dispose(){for(const e of this.cursors)e.dispose(this.context)}startTrackingSelections(){for(const e of this.cursors)e.startTrackingSelection(this.context)}stopTrackingSelections(){for(const e of this.cursors)e.stopTrackingSelection(this.context)}updateContext(e){this.context=e}ensureValidState(){for(const e of this.cursors)e.ensureValidState(this.context)}readSelectionFromMarkers(){return this.cursors.map(e=>e.readSelectionFromMarkers(this.context))}getAll(){return this.cursors.map(e=>e.asCursorState())}getViewPositions(){return this.cursors.map(e=>e.viewState.position)}getTopMostViewPosition(){return Pd(this.cursors,Ot(e=>e.viewState.position,I.compare)).viewState.position}getBottomMostViewPosition(){return Ad(this.cursors,Ot(e=>e.viewState.position,I.compare)).viewState.position}getSelections(){return this.cursors.map(e=>e.modelState.selection)}getViewSelections(){return this.cursors.map(e=>e.viewState.selection)}setSelections(e){this.setStates(H.fromModelSelections(e))}getPrimaryCursor(){return this.cursors[0].asCursorState()}setStates(e){e!==null&&(this.cursors[0].setState(this.context,e[0].modelState,e[0].viewState),this._setSecondaryStates(e.slice(1)))}_setSecondaryStates(e){const t=this.cursors.length-1,n=e.length;if(t<n){const i=n-t;for(let r=0;r<i;r++)this._addSecondaryCursor()}else if(t>n){const i=t-n;for(let r=0;r<i;r++)this._removeSecondaryCursor(this.cursors.length-2)}for(let i=0;i<n;i++)this.cursors[i+1].setState(this.context,e[i].modelState,e[i].viewState)}killSecondaryCursors(){this._setSecondaryStates([])}_addSecondaryCursor(){this.cursors.push(new zs(this.context)),this.lastAddedCursorIndex=this.cursors.length-1}getLastAddedCursorIndex(){return this.cursors.length===1||this.lastAddedCursorIndex===0?0:this.lastAddedCursorIndex}_removeSecondaryCursor(e){this.lastAddedCursorIndex>=e+1&&this.lastAddedCursorIndex--,this.cursors[e+1].dispose(this.context),this.cursors.splice(e+1,1)}normalize(){if(this.cursors.length===1)return;const e=this.cursors.slice(0),t=[];for(let n=0,i=e.length;n<i;n++)t.push({index:n,selection:e[n].modelState.selection});t.sort(Ot(n=>n.selection,w.compareRangesUsingStarts));for(let n=0;n<t.length-1;n++){const i=t[n],r=t[n+1],o=i.selection,a=r.selection;if(!this.context.cursorConfig.multiCursorMergeOverlapping)continue;let l;if(a.isEmpty()||o.isEmpty()?l=a.getStartPosition().isBeforeOrEqual(o.getEndPosition()):l=a.getStartPosition().isBefore(o.getEndPosition()),l){const u=i.index<r.index?n:n+1,c=i.index<r.index?n+1:n,h=t[c].index,d=t[u].index,f=t[c].selection,m=t[u].selection;if(!f.equalsSelection(m)){const p=f.plusRange(m),C=f.selectionStartLineNumber===f.startLineNumber&&f.selectionStartColumn===f.startColumn,b=m.selectionStartLineNumber===m.startLineNumber&&m.selectionStartColumn===m.startColumn;let L;h===this.lastAddedCursorIndex?(L=C,this.lastAddedCursorIndex=d):L=b;let _;L?_=new Z(p.startLineNumber,p.startColumn,p.endLineNumber,p.endColumn):_=new Z(p.endLineNumber,p.endColumn,p.startLineNumber,p.startColumn),t[u].selection=_;const k=H.fromModelSelection(_);e[d].setState(this.context,k.modelState,k.viewState)}for(const p of t)p.index>h&&p.index--;e.splice(h,1),t.splice(c,1),this._removeSecondaryCursor(h-1),n--}}}}class Ku{constructor(e,t,n,i){this._cursorContextBrand=void 0,this.model=e,this.viewModel=t,this.coordinatesConverter=n,this.cursorConfig=i}}class Jb{constructor(){this.type=0}}class Yb{constructor(){this.type=1}}class Kb{constructor(e){this.type=2,this._source=e}hasChanged(e){return this._source.hasChanged(e)}}class eL{constructor(e,t,n){this.selections=e,this.modelSelections=t,this.reason=n,this.type=3}}class jt{constructor(e){this.type=4,e?(this.affectsMinimap=e.affectsMinimap,this.affectsOverviewRuler=e.affectsOverviewRuler,this.affectsGlyphMargin=e.affectsGlyphMargin,this.affectsLineNumber=e.affectsLineNumber):(this.affectsMinimap=!0,this.affectsOverviewRuler=!0,this.affectsGlyphMargin=!0,this.affectsLineNumber=!0)}}class os{constructor(){this.type=5}}class tL{constructor(e){this.type=6,this.isFocused=e}}class nL{constructor(){this.type=7}}class as{constructor(){this.type=8}}class yh{constructor(e,t){this.fromLineNumber=e,this.count=t,this.type=9}}class xo{constructor(e,t){this.type=10,this.fromLineNumber=e,this.toLineNumber=t}}class To{constructor(e,t){this.type=11,this.fromLineNumber=e,this.toLineNumber=t}}class di{constructor(e,t,n,i,r,o,a){this.source=e,this.minimalReveal=t,this.range=n,this.selections=i,this.verticalType=r,this.revealHorizontal=o,this.scrollType=a,this.type=12}}class iL{constructor(e){this.type=13,this.scrollWidth=e.scrollWidth,this.scrollLeft=e.scrollLeft,this.scrollHeight=e.scrollHeight,this.scrollTop=e.scrollTop,this.scrollWidthChanged=e.scrollWidthChanged,this.scrollLeftChanged=e.scrollLeftChanged,this.scrollHeightChanged=e.scrollHeightChanged,this.scrollTopChanged=e.scrollTopChanged}}class sL{constructor(e){this.theme=e,this.type=14}}class rL{constructor(e){this.type=15,this.ranges=e}}class oL{constructor(){this.type=16}}let aL=class{constructor(){this.type=17}};class lL extends oe{constructor(){super(),this._onEvent=this._register(new J),this.onEvent=this._onEvent.event,this._eventHandlers=[],this._viewEventQueue=null,this._isConsumingViewEventQueue=!1,this._collector=null,this._collectorCnt=0,this._outgoingEvents=[]}emitOutgoingEvent(e){this._addOutgoingEvent(e),this._emitOutgoingEvents()}_addOutgoingEvent(e){for(let t=0,n=this._outgoingEvents.length;t<n;t++){const i=this._outgoingEvents[t].kind===e.kind?this._outgoingEvents[t].attemptToMerge(e):null;if(i){this._outgoingEvents[t]=i;return}}this._outgoingEvents.push(e)}_emitOutgoingEvents(){for(;this._outgoingEvents.length>0;){if(this._collector||this._isConsumingViewEventQueue)return;const e=this._outgoingEvents.shift();e.isNoOp()||this._onEvent.fire(e)}}addViewEventHandler(e){for(let t=0,n=this._eventHandlers.length;t<n;t++)this._eventHandlers[t]===e&&console.warn("Detected duplicate listener in ViewEventDispatcher",e);this._eventHandlers.push(e)}removeViewEventHandler(e){for(let t=0;t<this._eventHandlers.length;t++)if(this._eventHandlers[t]===e){this._eventHandlers.splice(t,1);break}}beginEmitViewEvents(){return this._collectorCnt++,this._collectorCnt===1&&(this._collector=new uL),this._collector}endEmitViewEvents(){if(this._collectorCnt--,this._collectorCnt===0){const e=this._collector.outgoingEvents,t=this._collector.viewEvents;this._collector=null;for(const n of e)this._addOutgoingEvent(n);t.length>0&&this._emitMany(t)}this._emitOutgoingEvents()}emitSingleViewEvent(e){try{this.beginEmitViewEvents().emitViewEvent(e)}finally{this.endEmitViewEvents()}}_emitMany(e){this._viewEventQueue?this._viewEventQueue=this._viewEventQueue.concat(e):this._viewEventQueue=e,this._isConsumingViewEventQueue||this._consumeViewEventQueue()}_consumeViewEventQueue(){try{this._isConsumingViewEventQueue=!0,this._doConsumeQueue()}finally{this._isConsumingViewEventQueue=!1}}_doConsumeQueue(){for(;this._viewEventQueue;){const e=this._viewEventQueue;this._viewEventQueue=null;const t=this._eventHandlers.slice(0);for(const n of t)n.handleEvents(e)}}}class uL{constructor(){this.viewEvents=[],this.outgoingEvents=[]}emitViewEvent(e){this.viewEvents.push(e)}emitOutgoingEvent(e){this.outgoingEvents.push(e)}}class oa{constructor(e,t,n,i){this.kind=0,this._oldContentWidth=e,this._oldContentHeight=t,this.contentWidth=n,this.contentHeight=i,this.contentWidthChanged=this._oldContentWidth!==this.contentWidth,this.contentHeightChanged=this._oldContentHeight!==this.contentHeight}isNoOp(){return!this.contentWidthChanged&&!this.contentHeightChanged}attemptToMerge(e){return e.kind!==this.kind?null:new oa(this._oldContentWidth,this._oldContentHeight,e.contentWidth,e.contentHeight)}}class aa{constructor(e,t){this.kind=1,this.oldHasFocus=e,this.hasFocus=t}isNoOp(){return this.oldHasFocus===this.hasFocus}attemptToMerge(e){return e.kind!==this.kind?null:new aa(this.oldHasFocus,e.hasFocus)}}class la{constructor(e,t,n,i,r,o,a,l){this.kind=2,this._oldScrollWidth=e,this._oldScrollLeft=t,this._oldScrollHeight=n,this._oldScrollTop=i,this.scrollWidth=r,this.scrollLeft=o,this.scrollHeight=a,this.scrollTop=l,this.scrollWidthChanged=this._oldScrollWidth!==this.scrollWidth,this.scrollLeftChanged=this._oldScrollLeft!==this.scrollLeft,this.scrollHeightChanged=this._oldScrollHeight!==this.scrollHeight,this.scrollTopChanged=this._oldScrollTop!==this.scrollTop}isNoOp(){return!this.scrollWidthChanged&&!this.scrollLeftChanged&&!this.scrollHeightChanged&&!this.scrollTopChanged}attemptToMerge(e){return e.kind!==this.kind?null:new la(this._oldScrollWidth,this._oldScrollLeft,this._oldScrollHeight,this._oldScrollTop,e.scrollWidth,e.scrollLeft,e.scrollHeight,e.scrollTop)}}class cL{constructor(){this.kind=3}isNoOp(){return!1}attemptToMerge(e){return e.kind!==this.kind?null:this}}class hL{constructor(){this.kind=4}isNoOp(){return!1}attemptToMerge(e){return e.kind!==this.kind?null:this}}class Hs{constructor(e,t,n,i,r,o,a){this.kind=6,this.oldSelections=e,this.selections=t,this.oldModelVersionId=n,this.modelVersionId=i,this.source=r,this.reason=o,this.reachedMaxCursorCount=a}static _selectionsAreEqual(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;const n=e.length,i=t.length;if(n!==i)return!1;for(let r=0;r<n;r++)if(!e[r].equalsSelection(t[r]))return!1;return!0}isNoOp(){return Hs._selectionsAreEqual(this.oldSelections,this.selections)&&this.oldModelVersionId===this.modelVersionId}attemptToMerge(e){return e.kind!==this.kind?null:new Hs(this.oldSelections,e.selections,this.oldModelVersionId,e.modelVersionId,e.source,e.reason,this.reachedMaxCursorCount||e.reachedMaxCursorCount)}}class dL{constructor(){this.kind=5}isNoOp(){return!1}attemptToMerge(e){return e.kind!==this.kind?null:this}}class fL{constructor(e){this.event=e,this.kind=7}isNoOp(){return!1}attemptToMerge(e){return null}}class gL{constructor(e){this.event=e,this.kind=8}isNoOp(){return!1}attemptToMerge(e){return null}}class mL{constructor(e){this.event=e,this.kind=9}isNoOp(){return!1}attemptToMerge(e){return null}}class pL{constructor(e){this.event=e,this.kind=10}isNoOp(){return!1}attemptToMerge(e){return null}}class CL{constructor(e){this.event=e,this.kind=11}isNoOp(){return!1}attemptToMerge(e){return null}}class bL{constructor(e){this.event=e,this.kind=12}isNoOp(){return!1}attemptToMerge(e){return null}}class LL extends oe{constructor(e,t,n,i){super(),this._model=e,this._knownModelVersionId=this._model.getVersionId(),this._viewModel=t,this._coordinatesConverter=n,this.context=new Ku(this._model,this._viewModel,this._coordinatesConverter,i),this._cursors=new Yu(this.context),this._hasFocus=!1,this._isHandling=!1,this._compositionState=null,this._columnSelectData=null,this._autoClosedActions=[],this._prevEditOperationType=0}dispose(){this._cursors.dispose(),this._autoClosedActions=zr(this._autoClosedActions),super.dispose()}updateConfiguration(e){this.context=new Ku(this._model,this._viewModel,this._coordinatesConverter,e),this._cursors.updateContext(this.context)}onLineMappingChanged(e){this._knownModelVersionId===this._model.getVersionId()&&this.setStates(e,"viewModel",0,this.getCursorStates())}setHasFocus(e){this._hasFocus=e}_validateAutoClosedActions(){if(this._autoClosedActions.length>0){const e=this._cursors.getSelections();for(let t=0;t<this._autoClosedActions.length;t++){const n=this._autoClosedActions[t];n.isValid(e)||(n.dispose(),this._autoClosedActions.splice(t,1),t--)}}}getPrimaryCursorState(){return this._cursors.getPrimaryCursor()}getLastAddedCursorIndex(){return this._cursors.getLastAddedCursorIndex()}getCursorStates(){return this._cursors.getAll()}setStates(e,t,n,i){let r=!1;const o=this.context.cursorConfig.multiCursorLimit;i!==null&&i.length>o&&(i=i.slice(0,o),r=!0);const a=fi.from(this._model,this);return this._cursors.setStates(i),this._cursors.normalize(),this._columnSelectData=null,this._validateAutoClosedActions(),this._emitStateChangedIfNecessary(e,t,n,a,r)}setCursorColumnSelectData(e){this._columnSelectData=e}revealAll(e,t,n,i,r,o){const a=this._cursors.getViewPositions();let l=null,u=null;a.length>1?u=this._cursors.getViewSelections():l=w.fromPositions(a[0],a[0]),e.emitViewEvent(new di(t,n,l,u,i,r,o))}revealPrimary(e,t,n,i,r,o){const l=[this._cursors.getPrimaryCursor().viewState.selection];e.emitViewEvent(new di(t,n,null,l,i,r,o))}saveState(){const e=[],t=this._cursors.getSelections();for(let n=0,i=t.length;n<i;n++){const r=t[n];e.push({inSelectionMode:!r.isEmpty(),selectionStart:{lineNumber:r.selectionStartLineNumber,column:r.selectionStartColumn},position:{lineNumber:r.positionLineNumber,column:r.positionColumn}})}return e}restoreState(e,t){const n=[];for(let i=0,r=t.length;i<r;i++){const o=t[i];let a=1,l=1;o.position&&o.position.lineNumber&&(a=o.position.lineNumber),o.position&&o.position.column&&(l=o.position.column);let u=a,c=l;o.selectionStart&&o.selectionStart.lineNumber&&(u=o.selectionStart.lineNumber),o.selectionStart&&o.selectionStart.column&&(c=o.selectionStart.column),n.push({selectionStartLineNumber:u,selectionStartColumn:c,positionLineNumber:a,positionColumn:l})}this.setStates(e,"restoreState",0,H.fromModelSelections(n)),this.revealAll(e,"restoreState",!1,0,!0,1)}onModelContentChanged(e,t){if(t instanceof Lh){if(this._isHandling)return;this._isHandling=!0;try{this.setStates(e,"modelChange",0,this.getCursorStates())}finally{this._isHandling=!1}}else{const n=t.rawContentChangedEvent;if(this._knownModelVersionId=n.versionId,this._isHandling)return;const i=n.containsEvent(1);if(this._prevEditOperationType=0,i)this._cursors.dispose(),this._cursors=new Yu(this.context),this._validateAutoClosedActions(),this._emitStateChangedIfNecessary(e,"model",1,null,!1);else if(this._hasFocus&&n.resultingSelection&&n.resultingSelection.length>0){const r=H.fromModelSelections(n.resultingSelection);this.setStates(e,"modelChange",n.isUndoing?5:n.isRedoing?6:2,r)&&this.revealAll(e,"modelChange",!1,0,!0,0)}else{const r=this._cursors.readSelectionFromMarkers();this.setStates(e,"modelChange",2,H.fromModelSelections(r))}}}getSelection(){return this._cursors.getPrimaryCursor().modelState.selection}getTopMostViewPosition(){return this._cursors.getTopMostViewPosition()}getBottomMostViewPosition(){return this._cursors.getBottomMostViewPosition()}getCursorColumnSelectData(){if(this._columnSelectData)return this._columnSelectData;const e=this._cursors.getPrimaryCursor(),t=e.viewState.selectionStart.getStartPosition(),n=e.viewState.position;return{isReal:!1,fromViewLineNumber:t.lineNumber,fromViewVisualColumn:this.context.cursorConfig.visibleColumnFromColumn(this._viewModel,t),toViewLineNumber:n.lineNumber,toViewVisualColumn:this.context.cursorConfig.visibleColumnFromColumn(this._viewModel,n)}}getSelections(){return this._cursors.getSelections()}setSelections(e,t,n,i){this.setStates(e,t,i,H.fromModelSelections(n))}getPrevEditOperationType(){return this._prevEditOperationType}setPrevEditOperationType(e){this._prevEditOperationType=e}_pushAutoClosedAction(e,t){const n=[],i=[];for(let a=0,l=e.length;a<l;a++)n.push({range:e[a],options:{description:"auto-closed-character",inlineClassName:"auto-closed-character",stickiness:1}}),i.push({range:t[a],options:{description:"auto-closed-enclosing",stickiness:1}});const r=this._model.deltaDecorations([],n),o=this._model.deltaDecorations([],i);this._autoClosedActions.push(new ec(this._model,r,o))}_executeEditOperation(e){if(!e)return;e.shouldPushStackElementBefore&&this._model.pushStackElement();const t=wL.executeCommands(this._model,this._cursors.getSelections(),e.commands);if(t){this._interpretCommandResult(t);const n=[],i=[];for(let r=0;r<e.commands.length;r++){const o=e.commands[r];o instanceof ia&&o.enclosingRange&&o.closeCharacterRange&&(n.push(o.closeCharacterRange),i.push(o.enclosingRange))}n.length>0&&this._pushAutoClosedAction(n,i),this._prevEditOperationType=e.type}e.shouldPushStackElementAfter&&this._model.pushStackElement()}_interpretCommandResult(e){(!e||e.length===0)&&(e=this._cursors.readSelectionFromMarkers()),this._columnSelectData=null,this._cursors.setSelections(e),this._cursors.normalize()}_emitStateChangedIfNecessary(e,t,n,i,r){const o=fi.from(this._model,this);if(o.equals(i))return!1;const a=this._cursors.getSelections(),l=this._cursors.getViewSelections();if(e.emitViewEvent(new eL(l,a,n)),!i||i.cursorState.length!==o.cursorState.length||o.cursorState.some((u,c)=>!u.modelState.equals(i.cursorState[c].modelState))){const u=i?i.cursorState.map(h=>h.modelState.selection):null,c=i?i.modelVersionId:0;e.emitOutgoingEvent(new Hs(u,a,c,o.modelVersionId,t||"keyboard",n,r))}return!0}_findAutoClosingPairs(e){if(!e.length)return null;const t=[];for(let n=0,i=e.length;n<i;n++){const r=e[n];if(!r.text||r.text.indexOf(`
`)>=0)return null;const o=r.text.match(/([)\]}>'"`])([^)\]}>'"`]*)$/);if(!o)return null;const a=o[1],l=this.context.cursorConfig.autoClosingPairs.autoClosingPairsCloseSingleChar.get(a);if(!l||l.length!==1)return null;const u=l[0].open,c=r.text.length-o[2].length-1,h=r.text.lastIndexOf(u,c-1);if(h===-1)return null;t.push([h,c])}return t}executeEdits(e,t,n,i){let r=null;t==="snippet"&&(r=this._findAutoClosingPairs(n)),r&&(n[0]._isTracked=!0);const o=[],a=[],l=this._model.pushEditOperations(this.getSelections(),n,u=>{if(r)for(let h=0,d=r.length;h<d;h++){const[f,m]=r[h],p=u[h],C=p.range.startLineNumber,b=p.range.startColumn-1+f,L=p.range.startColumn-1+m;o.push(new w(C,L+1,C,L+2)),a.push(new w(C,b+1,C,L+2))}const c=i(u);return c&&(this._isHandling=!0),c});l&&(this._isHandling=!1,this.setSelections(e,t,l,0)),o.length>0&&this._pushAutoClosedAction(o,a)}_executeEdit(e,t,n,i=0){if(this.context.cursorConfig.readOnly)return;const r=fi.from(this._model,this);this._cursors.stopTrackingSelections(),this._isHandling=!0;try{this._cursors.ensureValidState(),e()}catch(o){Tt(o)}this._isHandling=!1,this._cursors.startTrackingSelections(),this._validateAutoClosedActions(),this._emitStateChangedIfNecessary(t,n,i,r,!1)&&this.revealAll(t,n,!1,0,!0,0)}getAutoClosedCharacters(){return ec.getAllAutoClosedCharacters(this._autoClosedActions)}startComposition(e){this._compositionState=new gi(this._model,this.getSelections())}endComposition(e,t){const n=this._compositionState?this._compositionState.deduceOutcome(this._model,this.getSelections()):null;this._compositionState=null,this._executeEdit(()=>{t==="keyboard"&&this._executeEditOperation(Zn.compositionEndWithInterceptors(this._prevEditOperationType,this.context.cursorConfig,this._model,n,this.getSelections(),this.getAutoClosedCharacters()))},e,t)}type(e,t,n){this._executeEdit(()=>{if(n==="keyboard"){const i=t.length;let r=0;for(;r<i;){const o=bc(t,r),a=t.substr(r,o);this._executeEditOperation(Zn.typeWithInterceptors(!!this._compositionState,this._prevEditOperationType,this.context.cursorConfig,this._model,this.getSelections(),this.getAutoClosedCharacters(),a)),r+=o}}else this._executeEditOperation(Zn.typeWithoutInterceptors(this._prevEditOperationType,this.context.cursorConfig,this._model,this.getSelections(),t))},e,n)}compositionType(e,t,n,i,r,o){if(t.length===0&&n===0&&i===0){if(r!==0){const a=this.getSelections().map(l=>{const u=l.getPosition();return new Z(u.lineNumber,u.column+r,u.lineNumber,u.column+r)});this.setSelections(e,o,a,0)}return}this._executeEdit(()=>{this._executeEditOperation(Zn.compositionType(this._prevEditOperationType,this.context.cursorConfig,this._model,this.getSelections(),t,n,i,r))},e,o)}paste(e,t,n,i,r){this._executeEdit(()=>{this._executeEditOperation(Zn.paste(this.context.cursorConfig,this._model,this.getSelections(),t,n,i||[]))},e,r,4)}cut(e,t){this._executeEdit(()=>{this._executeEditOperation(Di.cut(this.context.cursorConfig,this._model,this.getSelections()))},e,t)}executeCommand(e,t,n){this._executeEdit(()=>{this._cursors.killSecondaryCursors(),this._executeEditOperation(new ye(0,[t],{shouldPushStackElementBefore:!1,shouldPushStackElementAfter:!1}))},e,n)}executeCommands(e,t,n){this._executeEdit(()=>{this._executeEditOperation(new ye(0,t,{shouldPushStackElementBefore:!1,shouldPushStackElementAfter:!1}))},e,n)}}class fi{static from(e,t){return new fi(e.getVersionId(),t.getCursorStates())}constructor(e,t){this.modelVersionId=e,this.cursorState=t}equals(e){if(!e||this.modelVersionId!==e.modelVersionId||this.cursorState.length!==e.cursorState.length)return!1;for(let t=0,n=this.cursorState.length;t<n;t++)if(!this.cursorState[t].equals(e.cursorState[t]))return!1;return!0}}class ec{static getAllAutoClosedCharacters(e){let t=[];for(const n of e)t=t.concat(n.getAutoClosedCharactersRanges());return t}constructor(e,t,n){this._model=e,this._autoClosedCharactersDecorations=t,this._autoClosedEnclosingDecorations=n}dispose(){this._autoClosedCharactersDecorations=this._model.deltaDecorations(this._autoClosedCharactersDecorations,[]),this._autoClosedEnclosingDecorations=this._model.deltaDecorations(this._autoClosedEnclosingDecorations,[])}getAutoClosedCharactersRanges(){const e=[];for(let t=0;t<this._autoClosedCharactersDecorations.length;t++){const n=this._model.getDecorationRange(this._autoClosedCharactersDecorations[t]);n&&e.push(n)}return e}isValid(e){const t=[];for(let n=0;n<this._autoClosedEnclosingDecorations.length;n++){const i=this._model.getDecorationRange(this._autoClosedEnclosingDecorations[n]);if(i&&(t.push(i),i.startLineNumber!==i.endLineNumber))return!1}t.sort(w.compareRangesUsingStarts),e.sort(w.compareRangesUsingStarts);for(let n=0;n<e.length;n++)if(n>=t.length||!t[n].strictContainsRange(e[n]))return!1;return!0}}class wL{static executeCommands(e,t,n){const i={model:e,selectionsBefore:t,trackedRanges:[],trackedRangesDirection:[]},r=this._innerExecuteCommands(i,n);for(let o=0,a=i.trackedRanges.length;o<a;o++)i.model._setTrackedRange(i.trackedRanges[o],null,0);return r}static _innerExecuteCommands(e,t){if(this._arrayIsEmpty(t))return null;const n=this._getEditOperations(e,t);if(n.operations.length===0)return null;const i=n.operations,r=this._getLoserCursorMap(i);if(r.hasOwnProperty("0"))return console.warn("Ignoring commands"),null;const o=[];for(let u=0,c=i.length;u<c;u++)r.hasOwnProperty(i[u].identifier.major.toString())||o.push(i[u]);n.hadTrackedEditOperation&&o.length>0&&(o[0]._isTracked=!0);let a=e.model.pushEditOperations(e.selectionsBefore,o,u=>{const c=[];for(let f=0;f<e.selectionsBefore.length;f++)c[f]=[];for(const f of u)f.identifier&&c[f.identifier.major].push(f);const h=(f,m)=>f.identifier.minor-m.identifier.minor,d=[];for(let f=0;f<e.selectionsBefore.length;f++)c[f].length>0?(c[f].sort(h),d[f]=t[f].computeCursorState(e.model,{getInverseEditOperations:()=>c[f],getTrackedSelection:m=>{const p=parseInt(m,10),C=e.model._getTrackedRange(e.trackedRanges[p]);return e.trackedRangesDirection[p]===0?new Z(C.startLineNumber,C.startColumn,C.endLineNumber,C.endColumn):new Z(C.endLineNumber,C.endColumn,C.startLineNumber,C.startColumn)}})):d[f]=e.selectionsBefore[f];return d});a||(a=e.selectionsBefore);const l=[];for(const u in r)r.hasOwnProperty(u)&&l.push(parseInt(u,10));l.sort((u,c)=>c-u);for(const u of l)a.splice(u,1);return a}static _arrayIsEmpty(e){for(let t=0,n=e.length;t<n;t++)if(e[t])return!1;return!0}static _getEditOperations(e,t){let n=[],i=!1;for(let r=0,o=t.length;r<o;r++){const a=t[r];if(a){const l=this._getEditOperationsFromCommand(e,r,a);n=n.concat(l.operations),i=i||l.hadTrackedEditOperation}}return{operations:n,hadTrackedEditOperation:i}}static _getEditOperationsFromCommand(e,t,n){const i=[];let r=0;const o=(h,d,f=!1)=>{w.isEmpty(h)&&d===""||i.push({identifier:{major:t,minor:r++},range:h,text:d,forceMoveMarkers:f,isAutoWhitespaceEdit:n.insertsAutoWhitespace})};let a=!1;const c={addEditOperation:o,addTrackedEditOperation:(h,d,f)=>{a=!0,o(h,d,f)},trackSelection:(h,d)=>{const f=Z.liftSelection(h);let m;if(f.isEmpty())if(typeof d=="boolean")d?m=2:m=3;else{const b=e.model.getLineMaxColumn(f.startLineNumber);f.startColumn===b?m=2:m=3}else m=1;const p=e.trackedRanges.length,C=e.model._setTrackedRange(null,f,m);return e.trackedRanges[p]=C,e.trackedRangesDirection[p]=f.getDirection(),p.toString()}};try{n.getEditOperations(e.model,c)}catch(h){return Tt(h),{operations:[],hadTrackedEditOperation:!1}}return{operations:i,hadTrackedEditOperation:a}}static _getLoserCursorMap(e){e=e.slice(0),e.sort((n,i)=>-w.compareRangesUsingEnds(n.range,i.range));const t={};for(let n=1;n<e.length;n++){const i=e[n-1],r=e[n];if(w.getStartPosition(i.range).isBefore(w.getEndPosition(r.range))){let o;i.identifier.major>r.identifier.major?o=i.identifier.major:o=r.identifier.major,t[o.toString()]=!0;for(let a=0;a<e.length;a++)e[a].identifier.major===o&&(e.splice(a,1),a<n&&n--,a--);n>0&&n--}}return t}}class _L{constructor(e,t,n){this.text=e,this.startSelection=t,this.endSelection=n}}class gi{static _capture(e,t){const n=[];for(const i of t){if(i.startLineNumber!==i.endLineNumber)return null;n.push(new _L(e.getLineContent(i.startLineNumber),i.startColumn-1,i.endColumn-1))}return n}constructor(e,t){this._original=gi._capture(e,t)}deduceOutcome(e,t){if(!this._original)return null;const n=gi._capture(e,t);if(!n||this._original.length!==n.length)return null;const i=[];for(let r=0,o=this._original.length;r<o;r++)i.push(gi._deduceOutcome(this._original[r],n[r]));return i}static _deduceOutcome(e,t){const n=Math.min(e.startSelection,t.startSelection,Dd(e.text,t.text)),i=Math.min(e.text.length-e.endSelection,t.text.length-t.endSelection,Od(e.text,t.text)),r=e.text.substring(n,e.text.length-i),o=t.text.substring(n,t.text.length-i);return new qb(r,e.startSelection-n,e.endSelection-n,o,t.startSelection-n,t.endSelection-n)}}class SL{constructor(){this._hasPending=!1,this._inserts=[],this._changes=[],this._removes=[]}insert(e){this._hasPending=!0,this._inserts.push(e)}change(e){this._hasPending=!0,this._changes.push(e)}remove(e){this._hasPending=!0,this._removes.push(e)}mustCommit(){return this._hasPending}commit(e){if(!this._hasPending)return;const t=this._inserts,n=this._changes,i=this._removes;this._hasPending=!1,this._inserts=[],this._changes=[],this._removes=[],e._commitPendingChanges(t,n,i)}}class kL{constructor(e,t,n,i,r){this.id=e,this.afterLineNumber=t,this.ordinal=n,this.height=i,this.minWidth=r,this.prefixSum=0}}const Li=class Li{constructor(e,t,n,i){this._instanceId=Cc(++Li.INSTANCE_COUNT),this._pendingChanges=new SL,this._lastWhitespaceId=0,this._arr=[],this._prefixSumValidIndex=-1,this._minWidth=-1,this._lineCount=e,this._lineHeight=t,this._paddingTop=n,this._paddingBottom=i}static findInsertionIndex(e,t,n){let i=0,r=e.length;for(;i<r;){const o=i+r>>>1;t===e[o].afterLineNumber?n<e[o].ordinal?r=o:i=o+1:t<e[o].afterLineNumber?r=o:i=o+1}return i}setLineHeight(e){this._checkPendingChanges(),this._lineHeight=e}setPadding(e,t){this._paddingTop=e,this._paddingBottom=t}onFlushed(e){this._checkPendingChanges(),this._lineCount=e}changeWhitespace(e){let t=!1;try{e({insertWhitespace:(i,r,o,a)=>{t=!0,i=i|0,r=r|0,o=o|0,a=a|0;const l=this._instanceId+ ++this._lastWhitespaceId;return this._pendingChanges.insert(new kL(l,i,r,o,a)),l},changeOneWhitespace:(i,r,o)=>{t=!0,r=r|0,o=o|0,this._pendingChanges.change({id:i,newAfterLineNumber:r,newHeight:o})},removeWhitespace:i=>{t=!0,this._pendingChanges.remove({id:i})}})}finally{this._pendingChanges.commit(this)}return t}_commitPendingChanges(e,t,n){if((e.length>0||n.length>0)&&(this._minWidth=-1),e.length+t.length+n.length<=1){for(const l of e)this._insertWhitespace(l);for(const l of t)this._changeOneWhitespace(l.id,l.newAfterLineNumber,l.newHeight);for(const l of n){const u=this._findWhitespaceIndex(l.id);u!==-1&&this._removeWhitespace(u)}return}const i=new Set;for(const l of n)i.add(l.id);const r=new Map;for(const l of t)r.set(l.id,l);const o=l=>{const u=[];for(const c of l)if(!i.has(c.id)){if(r.has(c.id)){const h=r.get(c.id);c.afterLineNumber=h.newAfterLineNumber,c.height=h.newHeight}u.push(c)}return u},a=o(this._arr).concat(o(e));a.sort((l,u)=>l.afterLineNumber===u.afterLineNumber?l.ordinal-u.ordinal:l.afterLineNumber-u.afterLineNumber),this._arr=a,this._prefixSumValidIndex=-1}_checkPendingChanges(){this._pendingChanges.mustCommit()&&this._pendingChanges.commit(this)}_insertWhitespace(e){const t=Li.findInsertionIndex(this._arr,e.afterLineNumber,e.ordinal);this._arr.splice(t,0,e),this._prefixSumValidIndex=Math.min(this._prefixSumValidIndex,t-1)}_findWhitespaceIndex(e){const t=this._arr;for(let n=0,i=t.length;n<i;n++)if(t[n].id===e)return n;return-1}_changeOneWhitespace(e,t,n){const i=this._findWhitespaceIndex(e);if(i!==-1&&(this._arr[i].height!==n&&(this._arr[i].height=n,this._prefixSumValidIndex=Math.min(this._prefixSumValidIndex,i-1)),this._arr[i].afterLineNumber!==t)){const r=this._arr[i];this._removeWhitespace(i),r.afterLineNumber=t,this._insertWhitespace(r)}}_removeWhitespace(e){this._arr.splice(e,1),this._prefixSumValidIndex=Math.min(this._prefixSumValidIndex,e-1)}onLinesDeleted(e,t){this._checkPendingChanges(),e=e|0,t=t|0,this._lineCount-=t-e+1;for(let n=0,i=this._arr.length;n<i;n++){const r=this._arr[n].afterLineNumber;e<=r&&r<=t?this._arr[n].afterLineNumber=e-1:r>t&&(this._arr[n].afterLineNumber-=t-e+1)}}onLinesInserted(e,t){this._checkPendingChanges(),e=e|0,t=t|0,this._lineCount+=t-e+1;for(let n=0,i=this._arr.length;n<i;n++){const r=this._arr[n].afterLineNumber;e<=r&&(this._arr[n].afterLineNumber+=t-e+1)}}getWhitespacesTotalHeight(){return this._checkPendingChanges(),this._arr.length===0?0:this.getWhitespacesAccumulatedHeight(this._arr.length-1)}getWhitespacesAccumulatedHeight(e){this._checkPendingChanges(),e=e|0;let t=Math.max(0,this._prefixSumValidIndex+1);t===0&&(this._arr[0].prefixSum=this._arr[0].height,t++);for(let n=t;n<=e;n++)this._arr[n].prefixSum=this._arr[n-1].prefixSum+this._arr[n].height;return this._prefixSumValidIndex=Math.max(this._prefixSumValidIndex,e),this._arr[e].prefixSum}getLinesTotalHeight(){this._checkPendingChanges();const e=this._lineHeight*this._lineCount,t=this.getWhitespacesTotalHeight();return e+t+this._paddingTop+this._paddingBottom}getWhitespaceAccumulatedHeightBeforeLineNumber(e){this._checkPendingChanges(),e=e|0;const t=this._findLastWhitespaceBeforeLineNumber(e);return t===-1?0:this.getWhitespacesAccumulatedHeight(t)}_findLastWhitespaceBeforeLineNumber(e){e=e|0;const t=this._arr;let n=0,i=t.length-1;for(;n<=i;){const o=(i-n|0)/2|0,a=n+o|0;if(t[a].afterLineNumber<e){if(a+1>=t.length||t[a+1].afterLineNumber>=e)return a;n=a+1|0}else i=a-1|0}return-1}_findFirstWhitespaceAfterLineNumber(e){e=e|0;const n=this._findLastWhitespaceBeforeLineNumber(e)+1;return n<this._arr.length?n:-1}getFirstWhitespaceIndexAfterLineNumber(e){return this._checkPendingChanges(),e=e|0,this._findFirstWhitespaceAfterLineNumber(e)}getVerticalOffsetForLineNumber(e,t=!1){this._checkPendingChanges(),e=e|0;let n;e>1?n=this._lineHeight*(e-1):n=0;const i=this.getWhitespaceAccumulatedHeightBeforeLineNumber(e-(t?1:0));return n+i+this._paddingTop}getVerticalOffsetAfterLineNumber(e,t=!1){this._checkPendingChanges(),e=e|0;const n=this._lineHeight*e,i=this.getWhitespaceAccumulatedHeightBeforeLineNumber(e+(t?1:0));return n+i+this._paddingTop}getWhitespaceMinWidth(){if(this._checkPendingChanges(),this._minWidth===-1){let e=0;for(let t=0,n=this._arr.length;t<n;t++)e=Math.max(e,this._arr[t].minWidth);this._minWidth=e}return this._minWidth}isAfterLines(e){this._checkPendingChanges();const t=this.getLinesTotalHeight();return e>t}isInTopPadding(e){return this._paddingTop===0?!1:(this._checkPendingChanges(),e<this._paddingTop)}isInBottomPadding(e){if(this._paddingBottom===0)return!1;this._checkPendingChanges();const t=this.getLinesTotalHeight();return e>=t-this._paddingBottom}getLineNumberAtOrAfterVerticalOffset(e){if(this._checkPendingChanges(),e=e|0,e<0)return 1;const t=this._lineCount|0,n=this._lineHeight;let i=1,r=t;for(;i<r;){const o=(i+r)/2|0,a=this.getVerticalOffsetForLineNumber(o)|0;if(e>=a+n)i=o+1;else{if(e>=a)return o;r=o}}return i>t?t:i}getLinesViewportData(e,t){this._checkPendingChanges(),e=e|0,t=t|0;const n=this._lineHeight,i=this.getLineNumberAtOrAfterVerticalOffset(e)|0,r=this.getVerticalOffsetForLineNumber(i)|0;let o=this._lineCount|0,a=this.getFirstWhitespaceIndexAfterLineNumber(i)|0;const l=this.getWhitespacesCount()|0;let u,c;a===-1?(a=l,c=o+1,u=0):(c=this.getAfterLineNumberForWhitespaceIndex(a)|0,u=this.getHeightForWhitespaceIndex(a)|0);let h=r,d=h;const f=5e5;let m=0;r>=f&&(m=Math.floor(r/f)*f,m=Math.floor(m/n)*n,d-=m);const p=[],C=e+(t-e)/2;let b=-1;for(let S=i;S<=o;S++){if(b===-1){const N=h,x=h+n;(N<=C&&C<x||N>C)&&(b=S)}for(h+=n,p[S-i]=d,d+=n;c===S;)d+=u,h+=u,a++,a>=l?c=o+1:(c=this.getAfterLineNumberForWhitespaceIndex(a)|0,u=this.getHeightForWhitespaceIndex(a)|0);if(h>=t){o=S;break}}b===-1&&(b=o);const L=this.getVerticalOffsetForLineNumber(o)|0;let _=i,k=o;return _<k&&r<e&&_++,_<k&&L+n>t&&k--,{bigNumbersDelta:m,startLineNumber:i,endLineNumber:o,relativeVerticalOffset:p,centeredLineNumber:b,completelyVisibleStartLineNumber:_,completelyVisibleEndLineNumber:k,lineHeight:this._lineHeight}}getVerticalOffsetForWhitespaceIndex(e){this._checkPendingChanges(),e=e|0;const t=this.getAfterLineNumberForWhitespaceIndex(e);let n;t>=1?n=this._lineHeight*t:n=0;let i;return e>0?i=this.getWhitespacesAccumulatedHeight(e-1):i=0,n+i+this._paddingTop}getWhitespaceIndexAtOrAfterVerticallOffset(e){this._checkPendingChanges(),e=e|0;let t=0,n=this.getWhitespacesCount()-1;if(n<0)return-1;const i=this.getVerticalOffsetForWhitespaceIndex(n),r=this.getHeightForWhitespaceIndex(n);if(e>=i+r)return-1;for(;t<n;){const o=Math.floor((t+n)/2),a=this.getVerticalOffsetForWhitespaceIndex(o),l=this.getHeightForWhitespaceIndex(o);if(e>=a+l)t=o+1;else{if(e>=a)return o;n=o}}return t}getWhitespaceAtVerticalOffset(e){this._checkPendingChanges(),e=e|0;const t=this.getWhitespaceIndexAtOrAfterVerticallOffset(e);if(t<0||t>=this.getWhitespacesCount())return null;const n=this.getVerticalOffsetForWhitespaceIndex(t);if(n>e)return null;const i=this.getHeightForWhitespaceIndex(t),r=this.getIdForWhitespaceIndex(t),o=this.getAfterLineNumberForWhitespaceIndex(t);return{id:r,afterLineNumber:o,verticalOffset:n,height:i}}getWhitespaceViewportData(e,t){this._checkPendingChanges(),e=e|0,t=t|0;const n=this.getWhitespaceIndexAtOrAfterVerticallOffset(e),i=this.getWhitespacesCount()-1;if(n<0)return[];const r=[];for(let o=n;o<=i;o++){const a=this.getVerticalOffsetForWhitespaceIndex(o),l=this.getHeightForWhitespaceIndex(o);if(a>=t)break;r.push({id:this.getIdForWhitespaceIndex(o),afterLineNumber:this.getAfterLineNumberForWhitespaceIndex(o),verticalOffset:a,height:l})}return r}getWhitespaces(){return this._checkPendingChanges(),this._arr.slice(0)}getWhitespacesCount(){return this._checkPendingChanges(),this._arr.length}getIdForWhitespaceIndex(e){return this._checkPendingChanges(),e=e|0,this._arr[e].id}getAfterLineNumberForWhitespaceIndex(e){return this._checkPendingChanges(),e=e|0,this._arr[e].afterLineNumber}getHeightForWhitespaceIndex(e){return this._checkPendingChanges(),e=e|0,this._arr[e].height}};Li.INSTANCE_COUNT=0;let Eo=Li;const vL=125;class Kn{constructor(e,t,n,i){e=e|0,t=t|0,n=n|0,i=i|0,e<0&&(e=0),t<0&&(t=0),n<0&&(n=0),i<0&&(i=0),this.width=e,this.contentWidth=t,this.scrollWidth=Math.max(e,t),this.height=n,this.contentHeight=i,this.scrollHeight=Math.max(n,i)}equals(e){return this.width===e.width&&this.contentWidth===e.contentWidth&&this.height===e.height&&this.contentHeight===e.contentHeight}}class IL extends oe{constructor(e,t){super(),this._onDidContentSizeChange=this._register(new J),this.onDidContentSizeChange=this._onDidContentSizeChange.event,this._dimensions=new Kn(0,0,0,0),this._scrollable=this._register(new Bd({forceIntegerValues:!0,smoothScrollDuration:e,scheduleAtNextAnimationFrame:t})),this.onDidScroll=this._scrollable.onScroll}getScrollable(){return this._scrollable}setSmoothScrollDuration(e){this._scrollable.setSmoothScrollDuration(e)}validateScrollPosition(e){return this._scrollable.validateScrollPosition(e)}getScrollDimensions(){return this._dimensions}setScrollDimensions(e){if(this._dimensions.equals(e))return;const t=this._dimensions;this._dimensions=e,this._scrollable.setScrollDimensions({width:e.width,scrollWidth:e.scrollWidth,height:e.height,scrollHeight:e.scrollHeight},!0);const n=t.contentWidth!==e.contentWidth,i=t.contentHeight!==e.contentHeight;(n||i)&&this._onDidContentSizeChange.fire(new oa(t.contentWidth,t.contentHeight,e.contentWidth,e.contentHeight))}getFutureScrollPosition(){return this._scrollable.getFutureScrollPosition()}getCurrentScrollPosition(){return this._scrollable.getCurrentScrollPosition()}setScrollPositionNow(e){this._scrollable.setScrollPositionNow(e)}setScrollPositionSmooth(e){this._scrollable.setScrollPositionSmooth(e)}hasPendingScrollAnimation(){return this._scrollable.hasPendingScrollAnimation()}}class NL extends oe{constructor(e,t,n){super(),this._configuration=e;const i=this._configuration.options,r=i.get(146),o=i.get(84);this._linesLayout=new Eo(t,i.get(67),o.top,o.bottom),this._maxLineWidth=0,this._overlayWidgetsMinWidth=0,this._scrollable=this._register(new IL(0,n)),this._configureSmoothScrollDuration(),this._scrollable.setScrollDimensions(new Kn(r.contentWidth,0,r.height,0)),this.onDidScroll=this._scrollable.onDidScroll,this.onDidContentSizeChange=this._scrollable.onDidContentSizeChange,this._updateHeight()}dispose(){super.dispose()}getScrollable(){return this._scrollable.getScrollable()}onHeightMaybeChanged(){this._updateHeight()}_configureSmoothScrollDuration(){this._scrollable.setSmoothScrollDuration(this._configuration.options.get(115)?vL:0)}onConfigurationChanged(e){const t=this._configuration.options;if(e.hasChanged(67)&&this._linesLayout.setLineHeight(t.get(67)),e.hasChanged(84)){const n=t.get(84);this._linesLayout.setPadding(n.top,n.bottom)}if(e.hasChanged(146)){const n=t.get(146),i=n.contentWidth,r=n.height,o=this._scrollable.getScrollDimensions(),a=o.contentWidth;this._scrollable.setScrollDimensions(new Kn(i,o.contentWidth,r,this._getContentHeight(i,r,a)))}else this._updateHeight();e.hasChanged(115)&&this._configureSmoothScrollDuration()}onFlushed(e){this._linesLayout.onFlushed(e)}onLinesDeleted(e,t){this._linesLayout.onLinesDeleted(e,t)}onLinesInserted(e,t){this._linesLayout.onLinesInserted(e,t)}_getHorizontalScrollbarHeight(e,t){const i=this._configuration.options.get(104);return i.horizontal===2||e>=t?0:i.horizontalScrollbarSize}_getContentHeight(e,t,n){const i=this._configuration.options;let r=this._linesLayout.getLinesTotalHeight();return i.get(106)?r+=Math.max(0,t-i.get(67)-i.get(84).bottom):i.get(104).ignoreHorizontalScrollbarInContentHeight||(r+=this._getHorizontalScrollbarHeight(e,n)),r}_updateHeight(){const e=this._scrollable.getScrollDimensions(),t=e.width,n=e.height,i=e.contentWidth;this._scrollable.setScrollDimensions(new Kn(t,e.contentWidth,n,this._getContentHeight(t,n,i)))}getCurrentViewport(){const e=this._scrollable.getScrollDimensions(),t=this._scrollable.getCurrentScrollPosition();return new ju(t.scrollTop,t.scrollLeft,e.width,e.height)}getFutureViewport(){const e=this._scrollable.getScrollDimensions(),t=this._scrollable.getFutureScrollPosition();return new ju(t.scrollTop,t.scrollLeft,e.width,e.height)}_computeContentWidth(){const e=this._configuration.options,t=this._maxLineWidth,n=e.get(147),i=e.get(50),r=e.get(146);if(n.isViewportWrapping){const o=e.get(73);return t>r.contentWidth+i.typicalHalfwidthCharacterWidth&&o.enabled&&o.side==="right"?t+r.verticalScrollbarWidth:t}else{const o=e.get(105)*i.typicalHalfwidthCharacterWidth,a=this._linesLayout.getWhitespaceMinWidth();return Math.max(t+o+r.verticalScrollbarWidth,a,this._overlayWidgetsMinWidth)}}setMaxLineWidth(e){this._maxLineWidth=e,this._updateContentWidth()}setOverlayWidgetsMinWidth(e){this._overlayWidgetsMinWidth=e,this._updateContentWidth()}_updateContentWidth(){const e=this._scrollable.getScrollDimensions();this._scrollable.setScrollDimensions(new Kn(e.width,this._computeContentWidth(),e.height,e.contentHeight)),this._updateHeight()}saveState(){const e=this._scrollable.getFutureScrollPosition(),t=e.scrollTop,n=this._linesLayout.getLineNumberAtOrAfterVerticalOffset(t),i=this._linesLayout.getWhitespaceAccumulatedHeightBeforeLineNumber(n);return{scrollTop:t,scrollTopWithoutViewZones:t-i,scrollLeft:e.scrollLeft}}changeWhitespace(e){const t=this._linesLayout.changeWhitespace(e);return t&&this.onHeightMaybeChanged(),t}getVerticalOffsetForLineNumber(e,t=!1){return this._linesLayout.getVerticalOffsetForLineNumber(e,t)}getVerticalOffsetAfterLineNumber(e,t=!1){return this._linesLayout.getVerticalOffsetAfterLineNumber(e,t)}isAfterLines(e){return this._linesLayout.isAfterLines(e)}isInTopPadding(e){return this._linesLayout.isInTopPadding(e)}isInBottomPadding(e){return this._linesLayout.isInBottomPadding(e)}getLineNumberAtVerticalOffset(e){return this._linesLayout.getLineNumberAtOrAfterVerticalOffset(e)}getWhitespaceAtVerticalOffset(e){return this._linesLayout.getWhitespaceAtVerticalOffset(e)}getLinesViewportData(){const e=this.getCurrentViewport();return this._linesLayout.getLinesViewportData(e.top,e.top+e.height)}getLinesViewportDataAtScrollTop(e){const t=this._scrollable.getScrollDimensions();return e+t.height>t.scrollHeight&&(e=t.scrollHeight-t.height),e<0&&(e=0),this._linesLayout.getLinesViewportData(e,e+t.height)}getWhitespaceViewportData(){const e=this.getCurrentViewport();return this._linesLayout.getWhitespaceViewportData(e.top,e.top+e.height)}getWhitespaces(){return this._linesLayout.getWhitespaces()}getContentWidth(){return this._scrollable.getScrollDimensions().contentWidth}getScrollWidth(){return this._scrollable.getScrollDimensions().scrollWidth}getContentHeight(){return this._scrollable.getScrollDimensions().contentHeight}getScrollHeight(){return this._scrollable.getScrollDimensions().scrollHeight}getCurrentScrollLeft(){return this._scrollable.getCurrentScrollPosition().scrollLeft}getCurrentScrollTop(){return this._scrollable.getCurrentScrollPosition().scrollTop}validateScrollPosition(e){return this._scrollable.validateScrollPosition(e)}setScrollPosition(e,t){t===1?this._scrollable.setScrollPositionNow(e):this._scrollable.setScrollPositionSmooth(e)}hasPendingScrollAnimation(){return this._scrollable.hasPendingScrollAnimation()}deltaScrollNow(e,t){const n=this._scrollable.getCurrentScrollPosition();this._scrollable.setScrollPositionNow({scrollLeft:n.scrollLeft+e,scrollTop:n.scrollTop+t})}}class xL{constructor(e,t,n,i,r){this.editorId=e,this.model=t,this.configuration=n,this._linesCollection=i,this._coordinatesConverter=r,this._decorationsCache=Object.create(null),this._cachedModelDecorationsResolver=null,this._cachedModelDecorationsResolverViewRange=null}_clearCachedModelDecorationsResolver(){this._cachedModelDecorationsResolver=null,this._cachedModelDecorationsResolverViewRange=null}dispose(){this._decorationsCache=Object.create(null),this._clearCachedModelDecorationsResolver()}reset(){this._decorationsCache=Object.create(null),this._clearCachedModelDecorationsResolver()}onModelDecorationsChanged(){this._decorationsCache=Object.create(null),this._clearCachedModelDecorationsResolver()}onLineMappingChanged(){this._decorationsCache=Object.create(null),this._clearCachedModelDecorationsResolver()}_getOrCreateViewModelDecoration(e){const t=e.id;let n=this._decorationsCache[t];if(!n){const i=e.range,r=e.options;let o;if(r.isWholeLine){const a=this._coordinatesConverter.convertModelPositionToViewPosition(new I(i.startLineNumber,1),0,!1,!0),l=this._coordinatesConverter.convertModelPositionToViewPosition(new I(i.endLineNumber,this.model.getLineMaxColumn(i.endLineNumber)),1);o=new w(a.lineNumber,a.column,l.lineNumber,l.column)}else o=this._coordinatesConverter.convertModelRangeToViewRange(i,1);n=new Cb(o,r),this._decorationsCache[t]=n}return n}getMinimapDecorationsInRange(e){return this._getDecorationsInRange(e,!0,!1).decorations}getDecorationsViewportData(e){let t=this._cachedModelDecorationsResolver!==null;return t=t&&e.equalsRange(this._cachedModelDecorationsResolverViewRange),t||(this._cachedModelDecorationsResolver=this._getDecorationsInRange(e,!1,!1),this._cachedModelDecorationsResolverViewRange=e),this._cachedModelDecorationsResolver}getInlineDecorationsOnLine(e,t=!1,n=!1){const i=new w(e,this._linesCollection.getViewLineMinColumn(e),e,this._linesCollection.getViewLineMaxColumn(e));return this._getDecorationsInRange(i,t,n).inlineDecorations[0]}_getDecorationsInRange(e,t,n){const i=this._linesCollection.getDecorationsInRange(e,this.editorId,xc(this.configuration.options),t,n),r=e.startLineNumber,o=e.endLineNumber,a=[];let l=0;const u=[];for(let c=r;c<=o;c++)u[c-r]=[];for(let c=0,h=i.length;c<h;c++){const d=i[c],f=d.options;if(!TL(this.model,d))continue;const m=this._getOrCreateViewModelDecoration(d),p=m.range;if(a[l++]=m,f.inlineClassName){const C=new gs(p,f.inlineClassName,f.inlineClassNameAffectsLetterSpacing?3:0),b=Math.max(r,p.startLineNumber),L=Math.min(o,p.endLineNumber);for(let _=b;_<=L;_++)u[_-r].push(C)}if(f.beforeContentClassName&&r<=p.startLineNumber&&p.startLineNumber<=o){const C=new gs(new w(p.startLineNumber,p.startColumn,p.startLineNumber,p.startColumn),f.beforeContentClassName,1);u[p.startLineNumber-r].push(C)}if(f.afterContentClassName&&r<=p.endLineNumber&&p.endLineNumber<=o){const C=new gs(new w(p.endLineNumber,p.endColumn,p.endLineNumber,p.endColumn),f.afterContentClassName,2);u[p.endLineNumber-r].push(C)}}return{decorations:a,inlineDecorations:u}}}function TL(s,e){return!(e.options.hideInCommentTokens&&EL(s,e)||e.options.hideInStringTokens&&yL(s,e))}function EL(s,e){return Rh(s,e.range,t=>t===1)}function yL(s,e){return Rh(s,e.range,t=>t===2)}function Rh(s,e,t){for(let n=e.startLineNumber;n<=e.endLineNumber;n++){const i=s.tokenization.getLineTokens(n),r=n===e.startLineNumber,o=n===e.endLineNumber;let a=r?i.findTokenIndexAtOffset(e.startColumn-1):0;for(;a<i.getCount()&&!(o&&i.getStartOffset(a)>e.endColumn-1);){if(!t(i.getStandardTokenType(a)))return!1;a++}}return!0}function Dr(s,e){return s===null?e?js.INSTANCE:Us.INSTANCE:new RL(s,e)}class RL{constructor(e,t){this._projectionData=e,this._isVisible=t}isVisible(){return this._isVisible}setVisible(e){return this._isVisible=e,this}getProjectionData(){return this._projectionData}getViewLineCount(){return this._isVisible?this._projectionData.getOutputLineCount():0}getViewLineContent(e,t,n){this._assertVisible();const i=n>0?this._projectionData.breakOffsets[n-1]:0,r=this._projectionData.breakOffsets[n];let o;if(this._projectionData.injectionOffsets!==null){const a=this._projectionData.injectionOffsets.map((u,c)=>new Et(0,0,u+1,this._projectionData.injectionOptions[c],0));o=Et.applyInjectedText(e.getLineContent(t),a).substring(i,r)}else o=e.getValueInRange({startLineNumber:t,startColumn:i+1,endLineNumber:t,endColumn:r+1});return n>0&&(o=tc(this._projectionData.wrappedTextIndentLength)+o),o}getViewLineLength(e,t,n){return this._assertVisible(),this._projectionData.getLineLength(n)}getViewLineMinColumn(e,t,n){return this._assertVisible(),this._projectionData.getMinOutputOffset(n)+1}getViewLineMaxColumn(e,t,n){return this._assertVisible(),this._projectionData.getMaxOutputOffset(n)+1}getViewLineData(e,t,n){const i=new Array;return this.getViewLinesData(e,t,n,1,0,[!0],i),i[0]}getViewLinesData(e,t,n,i,r,o,a){this._assertVisible();const l=this._projectionData,u=l.injectionOffsets,c=l.injectionOptions;let h=null;if(u){h=[];let f=0,m=0;for(let p=0;p<l.getOutputLineCount();p++){const C=new Array;h[p]=C;const b=p>0?l.breakOffsets[p-1]:0,L=l.breakOffsets[p];for(;m<u.length;){const _=c[m].content.length,k=u[m]+f,S=k+_;if(k>L)break;if(b<S){const N=c[m];if(N.inlineClassName){const x=p>0?l.wrappedTextIndentLength:0,T=x+Math.max(k-b,0),E=x+Math.min(S-b,L-b);T!==E&&C.push(new pb(T,E,N.inlineClassName,N.inlineClassNameAffectsLetterSpacing))}}if(S<=L)f+=_,m++;else break}}}let d;u?d=e.tokenization.getLineTokens(t).withInserted(u.map((f,m)=>({offset:f,text:c[m].content,tokenMetadata:Te.defaultTokenMetadata}))):d=e.tokenization.getLineTokens(t);for(let f=n;f<n+i;f++){const m=r+f-n;if(!o[m]){a[m]=null;continue}a[m]=this._getViewLineData(d,h?h[f]:null,f)}}_getViewLineData(e,t,n){this._assertVisible();const i=this._projectionData,r=n>0?i.wrappedTextIndentLength:0,o=n>0?i.breakOffsets[n-1]:0,a=i.breakOffsets[n],l=e.sliceAndInflate(o,a,r);let u=l.getLineContent();n>0&&(u=tc(i.wrappedTextIndentLength)+u);const c=this._projectionData.getMinOutputOffset(n)+1,h=u.length+1,d=n+1<this.getViewLineCount(),f=n===0?0:i.breakOffsetsVisibleColumn[n-1];return new Yo(u,d,c,h,f,l,t)}getModelColumnOfViewPosition(e,t){return this._assertVisible(),this._projectionData.translateToInputOffset(e,t-1)+1}getViewPositionOfModelPosition(e,t,n=2){return this._assertVisible(),this._projectionData.translateToOutputPosition(t-1,n).toPosition(e)}getViewLineNumberOfModelPosition(e,t){this._assertVisible();const n=this._projectionData.translateToOutputPosition(t-1);return e+n.outputLineIndex}normalizePosition(e,t,n){const i=t.lineNumber-e;return this._projectionData.normalizeOutputPosition(e,t.column-1,n).toPosition(i)}getInjectedTextAt(e,t){return this._projectionData.getInjectedText(e,t-1)}_assertVisible(){if(!this._isVisible)throw new Error("Not supported")}}const Js=class Js{constructor(){}isVisible(){return!0}setVisible(e){return e?this:Us.INSTANCE}getProjectionData(){return null}getViewLineCount(){return 1}getViewLineContent(e,t,n){return e.getLineContent(t)}getViewLineLength(e,t,n){return e.getLineLength(t)}getViewLineMinColumn(e,t,n){return e.getLineMinColumn(t)}getViewLineMaxColumn(e,t,n){return e.getLineMaxColumn(t)}getViewLineData(e,t,n){const i=e.tokenization.getLineTokens(t),r=i.getLineContent();return new Yo(r,!1,1,r.length+1,0,i.inflate(),null)}getViewLinesData(e,t,n,i,r,o,a){if(!o[r]){a[r]=null;return}a[r]=this.getViewLineData(e,t,0)}getModelColumnOfViewPosition(e,t){return t}getViewPositionOfModelPosition(e,t){return new I(e,t)}getViewLineNumberOfModelPosition(e,t){return e}normalizePosition(e,t,n){return t}getInjectedTextAt(e,t){return null}};Js.INSTANCE=new Js;let js=Js;const Ys=class Ys{constructor(){}isVisible(){return!1}setVisible(e){return e?js.INSTANCE:this}getProjectionData(){return null}getViewLineCount(){return 0}getViewLineContent(e,t,n){throw new Error("Not supported")}getViewLineLength(e,t,n){throw new Error("Not supported")}getViewLineMinColumn(e,t,n){throw new Error("Not supported")}getViewLineMaxColumn(e,t,n){throw new Error("Not supported")}getViewLineData(e,t,n){throw new Error("Not supported")}getViewLinesData(e,t,n,i,r,o,a){throw new Error("Not supported")}getModelColumnOfViewPosition(e,t){throw new Error("Not supported")}getViewPositionOfModelPosition(e,t){throw new Error("Not supported")}getViewLineNumberOfModelPosition(e,t){throw new Error("Not supported")}normalizePosition(e,t,n){throw new Error("Not supported")}getInjectedTextAt(e,t){throw new Error("Not supported")}};Ys.INSTANCE=new Ys;let Us=Ys;const Or=[""];function tc(s){if(s>=Or.length)for(let e=1;e<=s;e++)Or[e]=ML(e);return Or[s]}function ML(s){return new Array(s+1).join(" ")}class PL{constructor(e,t,n,i,r,o,a,l,u,c){this._editorId=e,this.model=t,this._validModelVersionId=-1,this._domLineBreaksComputerFactory=n,this._monospaceLineBreaksComputerFactory=i,this.fontInfo=r,this.tabSize=o,this.wrappingStrategy=a,this.wrappingColumn=l,this.wrappingIndent=u,this.wordBreak=c,this._constructLines(!0,null)}dispose(){this.hiddenAreasDecorationIds=this.model.deltaDecorations(this.hiddenAreasDecorationIds,[])}createCoordinatesConverter(){return new DL(this)}_constructLines(e,t){this.modelLineProjections=[],e&&(this.hiddenAreasDecorationIds=this.model.deltaDecorations(this.hiddenAreasDecorationIds,[]));const n=this.model.getLinesContent(),i=this.model.getInjectedTextDecorations(this._editorId),r=n.length,o=this.createLineBreaksComputer(),a=new ki(Et.fromDecorations(i));for(let p=0;p<r;p++){const C=a.takeWhile(b=>b.lineNumber===p+1);o.addRequest(n[p],C,t?t[p]:null)}const l=o.finalize(),u=[],c=this.hiddenAreasDecorationIds.map(p=>this.model.getDecorationRange(p)).sort(w.compareRangesUsingStarts);let h=1,d=0,f=-1,m=f+1<c.length?d+1:r+2;for(let p=0;p<r;p++){const C=p+1;C===m&&(f++,h=c[f].startLineNumber,d=c[f].endLineNumber,m=f+1<c.length?d+1:r+2);const b=C>=h&&C<=d,L=Dr(l[p],!b);u[p]=L.getViewLineCount(),this.modelLineProjections[p]=L}this._validModelVersionId=this.model.getVersionId(),this.projectedModelLineLineCounts=new Im(u)}getHiddenAreas(){return this.hiddenAreasDecorationIds.map(e=>this.model.getDecorationRange(e))}setHiddenAreas(e){const t=e.map(d=>this.model.validateRange(d)),n=AL(t),i=this.hiddenAreasDecorationIds.map(d=>this.model.getDecorationRange(d)).sort(w.compareRangesUsingStarts);if(n.length===i.length){let d=!1;for(let f=0;f<n.length;f++)if(!n[f].equalsRange(i[f])){d=!0;break}if(!d)return!1}const r=n.map(d=>({range:d,options:$e.EMPTY}));this.hiddenAreasDecorationIds=this.model.deltaDecorations(this.hiddenAreasDecorationIds,r);const o=n;let a=1,l=0,u=-1,c=u+1<o.length?l+1:this.modelLineProjections.length+2,h=!1;for(let d=0;d<this.modelLineProjections.length;d++){const f=d+1;f===c&&(u++,a=o[u].startLineNumber,l=o[u].endLineNumber,c=u+1<o.length?l+1:this.modelLineProjections.length+2);let m=!1;if(f>=a&&f<=l?this.modelLineProjections[d].isVisible()&&(this.modelLineProjections[d]=this.modelLineProjections[d].setVisible(!1),m=!0):(h=!0,this.modelLineProjections[d].isVisible()||(this.modelLineProjections[d]=this.modelLineProjections[d].setVisible(!0),m=!0)),m){const p=this.modelLineProjections[d].getViewLineCount();this.projectedModelLineLineCounts.setValue(d,p)}}return h||this.setHiddenAreas([]),!0}modelPositionIsVisible(e,t){return e<1||e>this.modelLineProjections.length?!1:this.modelLineProjections[e-1].isVisible()}getModelLineViewLineCount(e){return e<1||e>this.modelLineProjections.length?1:this.modelLineProjections[e-1].getViewLineCount()}setTabSize(e){return this.tabSize===e?!1:(this.tabSize=e,this._constructLines(!1,null),!0)}setWrappingSettings(e,t,n,i,r){const o=this.fontInfo.equals(e),a=this.wrappingStrategy===t,l=this.wrappingColumn===n,u=this.wrappingIndent===i,c=this.wordBreak===r;if(o&&a&&l&&u&&c)return!1;const h=o&&a&&!l&&u&&c;this.fontInfo=e,this.wrappingStrategy=t,this.wrappingColumn=n,this.wrappingIndent=i,this.wordBreak=r;let d=null;if(h){d=[];for(let f=0,m=this.modelLineProjections.length;f<m;f++)d[f]=this.modelLineProjections[f].getProjectionData()}return this._constructLines(!1,d),!0}createLineBreaksComputer(){return(this.wrappingStrategy==="advanced"?this._domLineBreaksComputerFactory:this._monospaceLineBreaksComputerFactory).createLineBreaksComputer(this.fontInfo,this.tabSize,this.wrappingColumn,this.wrappingIndent,this.wordBreak)}onModelFlushed(){this._constructLines(!0,null)}onModelLinesDeleted(e,t,n){if(!e||e<=this._validModelVersionId)return null;const i=t===1?1:this.projectedModelLineLineCounts.getPrefixSum(t-1)+1,r=this.projectedModelLineLineCounts.getPrefixSum(n);return this.modelLineProjections.splice(t-1,n-t+1),this.projectedModelLineLineCounts.removeValues(t-1,n-t+1),new xo(i,r)}onModelLinesInserted(e,t,n,i){if(!e||e<=this._validModelVersionId)return null;const r=t>2&&!this.modelLineProjections[t-2].isVisible(),o=t===1?1:this.projectedModelLineLineCounts.getPrefixSum(t-1)+1;let a=0;const l=[],u=[];for(let c=0,h=i.length;c<h;c++){const d=Dr(i[c],!r);l.push(d);const f=d.getViewLineCount();a+=f,u[c]=f}return this.modelLineProjections=this.modelLineProjections.slice(0,t-1).concat(l).concat(this.modelLineProjections.slice(t-1)),this.projectedModelLineLineCounts.insertValues(t-1,u),new To(o,o+a-1)}onModelLineChanged(e,t,n){if(e!==null&&e<=this._validModelVersionId)return[!1,null,null,null];const i=t-1,r=this.modelLineProjections[i].getViewLineCount(),o=this.modelLineProjections[i].isVisible(),a=Dr(n,o);this.modelLineProjections[i]=a;const l=this.modelLineProjections[i].getViewLineCount();let u=!1,c=0,h=-1,d=0,f=-1,m=0,p=-1;r>l?(c=this.projectedModelLineLineCounts.getPrefixSum(t-1)+1,h=c+l-1,m=h+1,p=m+(r-l)-1,u=!0):r<l?(c=this.projectedModelLineLineCounts.getPrefixSum(t-1)+1,h=c+r-1,d=h+1,f=d+(l-r)-1,u=!0):(c=this.projectedModelLineLineCounts.getPrefixSum(t-1)+1,h=c+l-1),this.projectedModelLineLineCounts.setValue(i,l);const C=c<=h?new yh(c,h-c+1):null,b=d<=f?new To(d,f):null,L=m<=p?new xo(m,p):null;return[u,C,b,L]}acceptVersionId(e){this._validModelVersionId=e,this.modelLineProjections.length===1&&!this.modelLineProjections[0].isVisible()&&this.setHiddenAreas([])}getViewLineCount(){return this.projectedModelLineLineCounts.getTotalSum()}_toValidViewLineNumber(e){if(e<1)return 1;const t=this.getViewLineCount();return e>t?t:e|0}getActiveIndentGuide(e,t,n){e=this._toValidViewLineNumber(e),t=this._toValidViewLineNumber(t),n=this._toValidViewLineNumber(n);const i=this.convertViewPositionToModelPosition(e,this.getViewLineMinColumn(e)),r=this.convertViewPositionToModelPosition(t,this.getViewLineMinColumn(t)),o=this.convertViewPositionToModelPosition(n,this.getViewLineMinColumn(n)),a=this.model.guides.getActiveIndentGuide(i.lineNumber,r.lineNumber,o.lineNumber),l=this.convertModelPositionToViewPosition(a.startLineNumber,1),u=this.convertModelPositionToViewPosition(a.endLineNumber,this.model.getLineMaxColumn(a.endLineNumber));return{startLineNumber:l.lineNumber,endLineNumber:u.lineNumber,indent:a.indent}}getViewLineInfo(e){e=this._toValidViewLineNumber(e);const t=this.projectedModelLineLineCounts.getIndexOf(e-1),n=t.index,i=t.remainder;return new nc(n+1,i)}getMinColumnOfViewLine(e){return this.modelLineProjections[e.modelLineNumber-1].getViewLineMinColumn(this.model,e.modelLineNumber,e.modelLineWrappedLineIdx)}getMaxColumnOfViewLine(e){return this.modelLineProjections[e.modelLineNumber-1].getViewLineMaxColumn(this.model,e.modelLineNumber,e.modelLineWrappedLineIdx)}getModelStartPositionOfViewLine(e){const t=this.modelLineProjections[e.modelLineNumber-1],n=t.getViewLineMinColumn(this.model,e.modelLineNumber,e.modelLineWrappedLineIdx),i=t.getModelColumnOfViewPosition(e.modelLineWrappedLineIdx,n);return new I(e.modelLineNumber,i)}getModelEndPositionOfViewLine(e){const t=this.modelLineProjections[e.modelLineNumber-1],n=t.getViewLineMaxColumn(this.model,e.modelLineNumber,e.modelLineWrappedLineIdx),i=t.getModelColumnOfViewPosition(e.modelLineWrappedLineIdx,n);return new I(e.modelLineNumber,i)}getViewLineInfosGroupedByModelRanges(e,t){const n=this.getViewLineInfo(e),i=this.getViewLineInfo(t),r=new Array;let o=this.getModelStartPositionOfViewLine(n),a=new Array;for(let l=n.modelLineNumber;l<=i.modelLineNumber;l++){const u=this.modelLineProjections[l-1];if(u.isVisible()){const c=l===n.modelLineNumber?n.modelLineWrappedLineIdx:0,h=l===i.modelLineNumber?i.modelLineWrappedLineIdx+1:u.getViewLineCount();for(let d=c;d<h;d++)a.push(new nc(l,d))}if(!u.isVisible()&&o){const c=new I(l-1,this.model.getLineMaxColumn(l-1)+1),h=w.fromPositions(o,c);r.push(new ic(h,a)),a=[],o=null}else u.isVisible()&&!o&&(o=new I(l,1))}if(o){const l=w.fromPositions(o,this.getModelEndPositionOfViewLine(i));r.push(new ic(l,a))}return r}getViewLinesBracketGuides(e,t,n,i){const r=n?this.convertViewPositionToModelPosition(n.lineNumber,n.column):null,o=[];for(const a of this.getViewLineInfosGroupedByModelRanges(e,t)){const l=a.modelRange.startLineNumber,u=this.model.guides.getLinesBracketGuides(l,a.modelRange.endLineNumber,r,i);for(const c of a.viewLines){const d=u[c.modelLineNumber-l].map(f=>{if(f.forWrappedLinesAfterColumn!==-1&&this.modelLineProjections[c.modelLineNumber-1].getViewPositionOfModelPosition(0,f.forWrappedLinesAfterColumn).lineNumber>=c.modelLineWrappedLineIdx||f.forWrappedLinesBeforeOrAtColumn!==-1&&this.modelLineProjections[c.modelLineNumber-1].getViewPositionOfModelPosition(0,f.forWrappedLinesBeforeOrAtColumn).lineNumber<c.modelLineWrappedLineIdx)return;if(!f.horizontalLine)return f;let m=-1;if(f.column!==-1){const b=this.modelLineProjections[c.modelLineNumber-1].getViewPositionOfModelPosition(0,f.column);if(b.lineNumber===c.modelLineWrappedLineIdx)m=b.column;else if(b.lineNumber<c.modelLineWrappedLineIdx)m=this.getMinColumnOfViewLine(c);else if(b.lineNumber>c.modelLineWrappedLineIdx)return}const p=this.convertModelPositionToViewPosition(c.modelLineNumber,f.horizontalLine.endColumn),C=this.modelLineProjections[c.modelLineNumber-1].getViewPositionOfModelPosition(0,f.horizontalLine.endColumn);return C.lineNumber===c.modelLineWrappedLineIdx?new Sn(f.visibleColumn,m,f.className,new ri(f.horizontalLine.top,p.column),-1,-1):C.lineNumber<c.modelLineWrappedLineIdx||f.visibleColumn!==-1?void 0:new Sn(f.visibleColumn,m,f.className,new ri(f.horizontalLine.top,this.getMaxColumnOfViewLine(c)),-1,-1)});o.push(d.filter(f=>!!f))}}return o}getViewLinesIndentGuides(e,t){e=this._toValidViewLineNumber(e),t=this._toValidViewLineNumber(t);const n=this.convertViewPositionToModelPosition(e,this.getViewLineMinColumn(e)),i=this.convertViewPositionToModelPosition(t,this.getViewLineMaxColumn(t));let r=[];const o=[],a=[],l=n.lineNumber-1,u=i.lineNumber-1;let c=null;for(let m=l;m<=u;m++){const p=this.modelLineProjections[m];if(p.isVisible()){const C=p.getViewLineNumberOfModelPosition(0,m===l?n.column:1),b=p.getViewLineNumberOfModelPosition(0,this.model.getLineMaxColumn(m+1)),L=b-C+1;let _=0;L>1&&p.getViewLineMinColumn(this.model,m+1,b)===1&&(_=C===0?1:2),o.push(L),a.push(_),c===null&&(c=new I(m+1,0))}else c!==null&&(r=r.concat(this.model.guides.getLinesIndentGuides(c.lineNumber,m)),c=null)}c!==null&&(r=r.concat(this.model.guides.getLinesIndentGuides(c.lineNumber,i.lineNumber)),c=null);const h=t-e+1,d=new Array(h);let f=0;for(let m=0,p=r.length;m<p;m++){let C=r[m];const b=Math.min(h-f,o[m]),L=a[m];let _;L===2?_=0:L===1?_=1:_=b;for(let k=0;k<b;k++)k===_&&(C=0),d[f++]=C}return d}getViewLineContent(e){const t=this.getViewLineInfo(e);return this.modelLineProjections[t.modelLineNumber-1].getViewLineContent(this.model,t.modelLineNumber,t.modelLineWrappedLineIdx)}getViewLineLength(e){const t=this.getViewLineInfo(e);return this.modelLineProjections[t.modelLineNumber-1].getViewLineLength(this.model,t.modelLineNumber,t.modelLineWrappedLineIdx)}getViewLineMinColumn(e){const t=this.getViewLineInfo(e);return this.modelLineProjections[t.modelLineNumber-1].getViewLineMinColumn(this.model,t.modelLineNumber,t.modelLineWrappedLineIdx)}getViewLineMaxColumn(e){const t=this.getViewLineInfo(e);return this.modelLineProjections[t.modelLineNumber-1].getViewLineMaxColumn(this.model,t.modelLineNumber,t.modelLineWrappedLineIdx)}getViewLineData(e){const t=this.getViewLineInfo(e);return this.modelLineProjections[t.modelLineNumber-1].getViewLineData(this.model,t.modelLineNumber,t.modelLineWrappedLineIdx)}getViewLinesData(e,t,n){e=this._toValidViewLineNumber(e),t=this._toValidViewLineNumber(t);const i=this.projectedModelLineLineCounts.getIndexOf(e-1);let r=e;const o=i.index,a=i.remainder,l=[];for(let u=o,c=this.model.getLineCount();u<c;u++){const h=this.modelLineProjections[u];if(!h.isVisible())continue;const d=u===o?a:0;let f=h.getViewLineCount()-d,m=!1;if(r+f>t&&(m=!0,f=t-r+1),h.getViewLinesData(this.model,u+1,d,f,r-e,n,l),r+=f,m)break}return l}validateViewPosition(e,t,n){e=this._toValidViewLineNumber(e);const i=this.projectedModelLineLineCounts.getIndexOf(e-1),r=i.index,o=i.remainder,a=this.modelLineProjections[r],l=a.getViewLineMinColumn(this.model,r+1,o),u=a.getViewLineMaxColumn(this.model,r+1,o);t<l&&(t=l),t>u&&(t=u);const c=a.getModelColumnOfViewPosition(o,t);return this.model.validatePosition(new I(r+1,c)).equals(n)?new I(e,t):this.convertModelPositionToViewPosition(n.lineNumber,n.column)}validateViewRange(e,t){const n=this.validateViewPosition(e.startLineNumber,e.startColumn,t.getStartPosition()),i=this.validateViewPosition(e.endLineNumber,e.endColumn,t.getEndPosition());return new w(n.lineNumber,n.column,i.lineNumber,i.column)}convertViewPositionToModelPosition(e,t){const n=this.getViewLineInfo(e),i=this.modelLineProjections[n.modelLineNumber-1].getModelColumnOfViewPosition(n.modelLineWrappedLineIdx,t);return this.model.validatePosition(new I(n.modelLineNumber,i))}convertViewRangeToModelRange(e){const t=this.convertViewPositionToModelPosition(e.startLineNumber,e.startColumn),n=this.convertViewPositionToModelPosition(e.endLineNumber,e.endColumn);return new w(t.lineNumber,t.column,n.lineNumber,n.column)}convertModelPositionToViewPosition(e,t,n=2,i=!1,r=!1){const o=this.model.validatePosition(new I(e,t)),a=o.lineNumber,l=o.column;let u=a-1,c=!1;if(r)for(;u<this.modelLineProjections.length&&!this.modelLineProjections[u].isVisible();)u++,c=!0;else for(;u>0&&!this.modelLineProjections[u].isVisible();)u--,c=!0;if(u===0&&!this.modelLineProjections[u].isVisible())return new I(i?0:1,1);const h=1+this.projectedModelLineLineCounts.getPrefixSum(u);let d;return c?r?d=this.modelLineProjections[u].getViewPositionOfModelPosition(h,1,n):d=this.modelLineProjections[u].getViewPositionOfModelPosition(h,this.model.getLineMaxColumn(u+1),n):d=this.modelLineProjections[a-1].getViewPositionOfModelPosition(h,l,n),d}convertModelRangeToViewRange(e,t=0){if(e.isEmpty()){const n=this.convertModelPositionToViewPosition(e.startLineNumber,e.startColumn,t);return w.fromPositions(n)}else{const n=this.convertModelPositionToViewPosition(e.startLineNumber,e.startColumn,1),i=this.convertModelPositionToViewPosition(e.endLineNumber,e.endColumn,0);return new w(n.lineNumber,n.column,i.lineNumber,i.column)}}getViewLineNumberOfModelPosition(e,t){let n=e-1;if(this.modelLineProjections[n].isVisible()){const r=1+this.projectedModelLineLineCounts.getPrefixSum(n);return this.modelLineProjections[n].getViewLineNumberOfModelPosition(r,t)}for(;n>0&&!this.modelLineProjections[n].isVisible();)n--;if(n===0&&!this.modelLineProjections[n].isVisible())return 1;const i=1+this.projectedModelLineLineCounts.getPrefixSum(n);return this.modelLineProjections[n].getViewLineNumberOfModelPosition(i,this.model.getLineMaxColumn(n+1))}getDecorationsInRange(e,t,n,i,r){const o=this.convertViewPositionToModelPosition(e.startLineNumber,e.startColumn),a=this.convertViewPositionToModelPosition(e.endLineNumber,e.endColumn);if(a.lineNumber-o.lineNumber<=e.endLineNumber-e.startLineNumber)return this.model.getDecorationsInRange(new w(o.lineNumber,1,a.lineNumber,a.column),t,n,i,r);let l=[];const u=o.lineNumber-1,c=a.lineNumber-1;let h=null;for(let p=u;p<=c;p++)if(this.modelLineProjections[p].isVisible())h===null&&(h=new I(p+1,p===u?o.column:1));else if(h!==null){const b=this.model.getLineMaxColumn(p);l=l.concat(this.model.getDecorationsInRange(new w(h.lineNumber,h.column,p,b),t,n,i)),h=null}h!==null&&(l=l.concat(this.model.getDecorationsInRange(new w(h.lineNumber,h.column,a.lineNumber,a.column),t,n,i)),h=null),l.sort((p,C)=>{const b=w.compareRangesUsingStarts(p.range,C.range);return b===0?p.id<C.id?-1:p.id>C.id?1:0:b});const d=[];let f=0,m=null;for(const p of l){const C=p.id;m!==C&&(m=C,d[f++]=p)}return d}getInjectedTextAt(e){const t=this.getViewLineInfo(e.lineNumber);return this.modelLineProjections[t.modelLineNumber-1].getInjectedTextAt(t.modelLineWrappedLineIdx,e.column)}normalizePosition(e,t){const n=this.getViewLineInfo(e.lineNumber);return this.modelLineProjections[n.modelLineNumber-1].normalizePosition(n.modelLineWrappedLineIdx,e,t)}getLineIndentColumn(e){const t=this.getViewLineInfo(e);return t.modelLineWrappedLineIdx===0?this.model.getLineIndentColumn(t.modelLineNumber):0}}function AL(s){if(s.length===0)return[];const e=s.slice();e.sort(w.compareRangesUsingStarts);const t=[];let n=e[0].startLineNumber,i=e[0].endLineNumber;for(let r=1,o=e.length;r<o;r++){const a=e[r];a.startLineNumber>i+1?(t.push(new w(n,1,i,1)),n=a.startLineNumber,i=a.endLineNumber):a.endLineNumber>i&&(i=a.endLineNumber)}return t.push(new w(n,1,i,1)),t}class nc{constructor(e,t){this.modelLineNumber=e,this.modelLineWrappedLineIdx=t}}class ic{constructor(e,t){this.modelRange=e,this.viewLines=t}}class DL{constructor(e){this._lines=e}convertViewPositionToModelPosition(e){return this._lines.convertViewPositionToModelPosition(e.lineNumber,e.column)}convertViewRangeToModelRange(e){return this._lines.convertViewRangeToModelRange(e)}validateViewPosition(e,t){return this._lines.validateViewPosition(e.lineNumber,e.column,t)}validateViewRange(e,t){return this._lines.validateViewRange(e,t)}convertModelPositionToViewPosition(e,t,n,i){return this._lines.convertModelPositionToViewPosition(e.lineNumber,e.column,t,n,i)}convertModelRangeToViewRange(e,t){return this._lines.convertModelRangeToViewRange(e,t)}modelPositionIsVisible(e){return this._lines.modelPositionIsVisible(e.lineNumber,e.column)}getModelLineViewLineCount(e){return this._lines.getModelLineViewLineCount(e)}getViewLineNumberOfModelPosition(e,t){return this._lines.getViewLineNumberOfModelPosition(e,t)}}class OL{constructor(e){this.model=e}dispose(){}createCoordinatesConverter(){return new BL(this)}getHiddenAreas(){return[]}setHiddenAreas(e){return!1}setTabSize(e){return!1}setWrappingSettings(e,t,n,i){return!1}createLineBreaksComputer(){const e=[];return{addRequest:(t,n,i)=>{e.push(null)},finalize:()=>e}}onModelFlushed(){}onModelLinesDeleted(e,t,n){return new xo(t,n)}onModelLinesInserted(e,t,n,i){return new To(t,n)}onModelLineChanged(e,t,n){return[!1,new yh(t,1),null,null]}acceptVersionId(e){}getViewLineCount(){return this.model.getLineCount()}getActiveIndentGuide(e,t,n){return{startLineNumber:e,endLineNumber:e,indent:0}}getViewLinesBracketGuides(e,t,n){return new Array(t-e+1).fill([])}getViewLinesIndentGuides(e,t){const n=t-e+1,i=new Array(n);for(let r=0;r<n;r++)i[r]=0;return i}getViewLineContent(e){return this.model.getLineContent(e)}getViewLineLength(e){return this.model.getLineLength(e)}getViewLineMinColumn(e){return this.model.getLineMinColumn(e)}getViewLineMaxColumn(e){return this.model.getLineMaxColumn(e)}getViewLineData(e){const t=this.model.tokenization.getLineTokens(e),n=t.getLineContent();return new Yo(n,!1,1,n.length+1,0,t.inflate(),null)}getViewLinesData(e,t,n){const i=this.model.getLineCount();e=Math.min(Math.max(1,e),i),t=Math.min(Math.max(1,t),i);const r=[];for(let o=e;o<=t;o++){const a=o-e;r[a]=n[a]?this.getViewLineData(o):null}return r}getDecorationsInRange(e,t,n,i,r){return this.model.getDecorationsInRange(e,t,n,i,r)}normalizePosition(e,t){return this.model.normalizePosition(e,t)}getLineIndentColumn(e){return this.model.getLineIndentColumn(e)}getInjectedTextAt(e){return null}}class BL{constructor(e){this._lines=e}_validPosition(e){return this._lines.model.validatePosition(e)}_validRange(e){return this._lines.model.validateRange(e)}convertViewPositionToModelPosition(e){return this._validPosition(e)}convertViewRangeToModelRange(e){return this._validRange(e)}validateViewPosition(e,t){return this._validPosition(t)}validateViewRange(e,t){return this._validRange(t)}convertModelPositionToViewPosition(e){return this._validPosition(e)}convertModelRangeToViewRange(e){return this._validRange(e)}modelPositionIsVisible(e){const t=this._lines.model.getLineCount();return!(e.lineNumber<1||e.lineNumber>t)}getModelLineViewLineCount(e){return 1}getViewLineNumberOfModelPosition(e,t){return e}}const Ut=xi.Right;class VL{constructor(e){this.persist=0,this._requiredLanes=1,this.lanes=new Uint8Array(Math.ceil((e+1)*Ut/8))}reset(e){const t=Math.ceil((e+1)*Ut/8);this.lanes.length<t?this.lanes=new Uint8Array(t):this.lanes.fill(0),this._requiredLanes=1}get requiredLanes(){return this._requiredLanes}push(e,t,n){n&&(this.persist|=1<<e-1);for(let i=t.startLineNumber;i<=t.endLineNumber;i++){const r=Ut*i+(e-1);this.lanes[r>>>3]|=1<<r%8,this._requiredLanes=Math.max(this._requiredLanes,this.countAtLine(i))}}getLanesAtLine(e){const t=[];let n=Ut*e;for(let i=0;i<Ut;i++)(this.persist&1<<i||this.lanes[n>>>3]&1<<n%8)&&t.push(i+1),n++;return t.length?t:[xi.Center]}countAtLine(e){let t=Ut*e,n=0;for(let i=0;i<Ut;i++)(this.persist&1<<i||this.lanes[t>>>3]&1<<t%8)&&n++,t++;return n}}class R_ extends oe{constructor(e,t,n,i,r,o,a,l,u,c){if(super(),this.languageConfigurationService=a,this._themeService=l,this._attachedView=u,this._transactionalTarget=c,this.hiddenAreasModel=new FL,this.previousHiddenAreas=[],this._editorId=e,this._configuration=t,this.model=n,this._eventDispatcher=new lL,this.onEvent=this._eventDispatcher.onEvent,this.cursorConfig=new pn(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._updateConfigurationViewLineCount=this._register(new pc(()=>this._updateConfigurationViewLineCountNow(),0)),this._hasFocus=!1,this._viewportStart=ua.create(this.model),this.glyphLanes=new VL(0),this.model.isTooLargeForTokenization())this._lines=new OL(this.model);else{const h=this._configuration.options,d=h.get(50),f=h.get(140),m=h.get(147),p=h.get(139),C=h.get(130);this._lines=new PL(this._editorId,this.model,i,r,d,this.model.getOptions().tabSize,f,m.wrappingColumn,p,C)}this.coordinatesConverter=this._lines.createCoordinatesConverter(),this._cursor=this._register(new LL(n,this,this.coordinatesConverter,this.cursorConfig)),this.viewLayout=this._register(new NL(this._configuration,this.getLineCount(),o)),this._register(this.viewLayout.onDidScroll(h=>{h.scrollTopChanged&&this._handleVisibleLinesChanged(),h.scrollTopChanged&&this._viewportStart.invalidate(),this._eventDispatcher.emitSingleViewEvent(new iL(h)),this._eventDispatcher.emitOutgoingEvent(new la(h.oldScrollWidth,h.oldScrollLeft,h.oldScrollHeight,h.oldScrollTop,h.scrollWidth,h.scrollLeft,h.scrollHeight,h.scrollTop))})),this._register(this.viewLayout.onDidContentSizeChange(h=>{this._eventDispatcher.emitOutgoingEvent(h)})),this._decorations=new xL(this._editorId,this.model,this._configuration,this._lines,this.coordinatesConverter),this._registerModelEvents(),this._register(this._configuration.onDidChangeFast(h=>{try{const d=this._eventDispatcher.beginEmitViewEvents();this._onConfigurationChanged(d,h)}finally{this._eventDispatcher.endEmitViewEvents()}})),this._register(ko.getInstance().onDidChange(()=>{this._eventDispatcher.emitSingleViewEvent(new oL)})),this._register(this._themeService.onDidColorThemeChange(h=>{this._invalidateDecorationsColorCache(),this._eventDispatcher.emitSingleViewEvent(new sL(h))})),this._updateConfigurationViewLineCountNow()}dispose(){super.dispose(),this._decorations.dispose(),this._lines.dispose(),this._viewportStart.dispose(),this._eventDispatcher.dispose()}createLineBreaksComputer(){return this._lines.createLineBreaksComputer()}addViewEventHandler(e){this._eventDispatcher.addViewEventHandler(e)}removeViewEventHandler(e){this._eventDispatcher.removeViewEventHandler(e)}_updateConfigurationViewLineCountNow(){this._configuration.setViewLineCount(this._lines.getViewLineCount())}getModelVisibleRanges(){const e=this.viewLayout.getLinesViewportData(),t=new w(e.startLineNumber,this.getLineMinColumn(e.startLineNumber),e.endLineNumber,this.getLineMaxColumn(e.endLineNumber));return this._toModelVisibleRanges(t)}visibleLinesStabilized(){const e=this.getModelVisibleRanges();this._attachedView.setVisibleLines(e,!0)}_handleVisibleLinesChanged(){const e=this.getModelVisibleRanges();this._attachedView.setVisibleLines(e,!1)}setHasFocus(e){this._hasFocus=e,this._cursor.setHasFocus(e),this._eventDispatcher.emitSingleViewEvent(new tL(e)),this._eventDispatcher.emitOutgoingEvent(new aa(!e,e))}onCompositionStart(){this._eventDispatcher.emitSingleViewEvent(new Jb)}onCompositionEnd(){this._eventDispatcher.emitSingleViewEvent(new Yb)}_captureStableViewport(){if(this._viewportStart.isValid&&this.viewLayout.getCurrentScrollTop()>0){const e=new I(this._viewportStart.viewLineNumber,this.getLineMinColumn(this._viewportStart.viewLineNumber)),t=this.coordinatesConverter.convertViewPositionToModelPosition(e);return new rc(t,this._viewportStart.startLineDelta)}return new rc(null,0)}_onConfigurationChanged(e,t){const n=this._captureStableViewport(),i=this._configuration.options,r=i.get(50),o=i.get(140),a=i.get(147),l=i.get(139),u=i.get(130);this._lines.setWrappingSettings(r,o,a.wrappingColumn,l,u)&&(e.emitViewEvent(new os),e.emitViewEvent(new as),e.emitViewEvent(new jt(null)),this._cursor.onLineMappingChanged(e),this._decorations.onLineMappingChanged(),this.viewLayout.onFlushed(this.getLineCount()),this._updateConfigurationViewLineCount.schedule()),t.hasChanged(92)&&(this._decorations.reset(),e.emitViewEvent(new jt(null))),t.hasChanged(99)&&(this._decorations.reset(),e.emitViewEvent(new jt(null))),e.emitViewEvent(new Kb(t)),this.viewLayout.onConfigurationChanged(t),n.recoverViewportStart(this.coordinatesConverter,this.viewLayout),pn.shouldRecreate(t)&&(this.cursorConfig=new pn(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._cursor.updateConfiguration(this.cursorConfig))}_registerModelEvents(){this._register(this.model.onDidChangeContentOrInjectedText(e=>{try{const n=this._eventDispatcher.beginEmitViewEvents();let i=!1,r=!1;const o=e instanceof Kt?e.rawContentChangedEvent.changes:e.changes,a=e instanceof Kt?e.rawContentChangedEvent.versionId:null,l=this._lines.createLineBreaksComputer();for(const h of o)switch(h.changeType){case 4:{for(let d=0;d<h.detail.length;d++){const f=h.detail[d];let m=h.injectedTexts[d];m&&(m=m.filter(p=>!p.ownerId||p.ownerId===this._editorId)),l.addRequest(f,m,null)}break}case 2:{let d=null;h.injectedText&&(d=h.injectedText.filter(f=>!f.ownerId||f.ownerId===this._editorId)),l.addRequest(h.detail,d,null);break}}const u=l.finalize(),c=new ki(u);for(const h of o)switch(h.changeType){case 1:{this._lines.onModelFlushed(),n.emitViewEvent(new os),this._decorations.reset(),this.viewLayout.onFlushed(this.getLineCount()),i=!0;break}case 3:{const d=this._lines.onModelLinesDeleted(a,h.fromLineNumber,h.toLineNumber);d!==null&&(n.emitViewEvent(d),this.viewLayout.onLinesDeleted(d.fromLineNumber,d.toLineNumber)),i=!0;break}case 4:{const d=c.takeCount(h.detail.length),f=this._lines.onModelLinesInserted(a,h.fromLineNumber,h.toLineNumber,d);f!==null&&(n.emitViewEvent(f),this.viewLayout.onLinesInserted(f.fromLineNumber,f.toLineNumber)),i=!0;break}case 2:{const d=c.dequeue(),[f,m,p,C]=this._lines.onModelLineChanged(a,h.lineNumber,d);r=f,m&&n.emitViewEvent(m),p&&(n.emitViewEvent(p),this.viewLayout.onLinesInserted(p.fromLineNumber,p.toLineNumber)),C&&(n.emitViewEvent(C),this.viewLayout.onLinesDeleted(C.fromLineNumber,C.toLineNumber));break}case 5:break}a!==null&&this._lines.acceptVersionId(a),this.viewLayout.onHeightMaybeChanged(),!i&&r&&(n.emitViewEvent(new as),n.emitViewEvent(new jt(null)),this._cursor.onLineMappingChanged(n),this._decorations.onLineMappingChanged())}finally{this._eventDispatcher.endEmitViewEvents()}const t=this._viewportStart.isValid;if(this._viewportStart.invalidate(),this._configuration.setModelLineCount(this.model.getLineCount()),this._updateConfigurationViewLineCountNow(),!this._hasFocus&&this.model.getAttachedEditorCount()>=2&&t){const n=this.model._getTrackedRange(this._viewportStart.modelTrackedRange);if(n){const i=this.coordinatesConverter.convertModelPositionToViewPosition(n.getStartPosition()),r=this.viewLayout.getVerticalOffsetForLineNumber(i.lineNumber);this.viewLayout.setScrollPosition({scrollTop:r+this._viewportStart.startLineDelta},1)}}try{const n=this._eventDispatcher.beginEmitViewEvents();e instanceof Kt&&n.emitOutgoingEvent(new pL(e.contentChangedEvent)),this._cursor.onModelContentChanged(n,e)}finally{this._eventDispatcher.endEmitViewEvents()}this._handleVisibleLinesChanged()})),this._register(this.model.onDidChangeTokens(e=>{const t=[];for(let n=0,i=e.ranges.length;n<i;n++){const r=e.ranges[n],o=this.coordinatesConverter.convertModelPositionToViewPosition(new I(r.fromLineNumber,1)).lineNumber,a=this.coordinatesConverter.convertModelPositionToViewPosition(new I(r.toLineNumber,this.model.getLineMaxColumn(r.toLineNumber))).lineNumber;t[n]={fromLineNumber:o,toLineNumber:a}}this._eventDispatcher.emitSingleViewEvent(new rL(t)),this._eventDispatcher.emitOutgoingEvent(new bL(e))})),this._register(this.model.onDidChangeLanguageConfiguration(e=>{this._eventDispatcher.emitSingleViewEvent(new nL),this.cursorConfig=new pn(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._cursor.updateConfiguration(this.cursorConfig),this._eventDispatcher.emitOutgoingEvent(new mL(e))})),this._register(this.model.onDidChangeLanguage(e=>{this.cursorConfig=new pn(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._cursor.updateConfiguration(this.cursorConfig),this._eventDispatcher.emitOutgoingEvent(new gL(e))})),this._register(this.model.onDidChangeOptions(e=>{if(this._lines.setTabSize(this.model.getOptions().tabSize)){try{const t=this._eventDispatcher.beginEmitViewEvents();t.emitViewEvent(new os),t.emitViewEvent(new as),t.emitViewEvent(new jt(null)),this._cursor.onLineMappingChanged(t),this._decorations.onLineMappingChanged(),this.viewLayout.onFlushed(this.getLineCount())}finally{this._eventDispatcher.endEmitViewEvents()}this._updateConfigurationViewLineCount.schedule()}this.cursorConfig=new pn(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._cursor.updateConfiguration(this.cursorConfig),this._eventDispatcher.emitOutgoingEvent(new CL(e))})),this._register(this.model.onDidChangeDecorations(e=>{this._decorations.onModelDecorationsChanged(),this._eventDispatcher.emitSingleViewEvent(new jt(e)),this._eventDispatcher.emitOutgoingEvent(new fL(e))}))}setHiddenAreas(e,t){var o;this.hiddenAreasModel.setHiddenAreas(t,e);const n=this.hiddenAreasModel.getMergedRanges();if(n===this.previousHiddenAreas)return;this.previousHiddenAreas=n;const i=this._captureStableViewport();let r=!1;try{const a=this._eventDispatcher.beginEmitViewEvents();r=this._lines.setHiddenAreas(n),r&&(a.emitViewEvent(new os),a.emitViewEvent(new as),a.emitViewEvent(new jt(null)),this._cursor.onLineMappingChanged(a),this._decorations.onLineMappingChanged(),this.viewLayout.onFlushed(this.getLineCount()),this.viewLayout.onHeightMaybeChanged());const l=(o=i.viewportStartModelPosition)==null?void 0:o.lineNumber;l&&n.some(c=>c.startLineNumber<=l&&l<=c.endLineNumber)||i.recoverViewportStart(this.coordinatesConverter,this.viewLayout)}finally{this._eventDispatcher.endEmitViewEvents()}this._updateConfigurationViewLineCount.schedule(),r&&this._eventDispatcher.emitOutgoingEvent(new hL)}getVisibleRangesPlusViewportAboveBelow(){const e=this._configuration.options.get(146),t=this._configuration.options.get(67),n=Math.max(20,Math.round(e.height/t)),i=this.viewLayout.getLinesViewportData(),r=Math.max(1,i.completelyVisibleStartLineNumber-n),o=Math.min(this.getLineCount(),i.completelyVisibleEndLineNumber+n);return this._toModelVisibleRanges(new w(r,this.getLineMinColumn(r),o,this.getLineMaxColumn(o)))}getVisibleRanges(){const e=this.getCompletelyVisibleViewRange();return this._toModelVisibleRanges(e)}getHiddenAreas(){return this._lines.getHiddenAreas()}_toModelVisibleRanges(e){const t=this.coordinatesConverter.convertViewRangeToModelRange(e),n=this._lines.getHiddenAreas();if(n.length===0)return[t];const i=[];let r=0,o=t.startLineNumber,a=t.startColumn;const l=t.endLineNumber,u=t.endColumn;for(let c=0,h=n.length;c<h;c++){const d=n[c].startLineNumber,f=n[c].endLineNumber;f<o||d>l||(o<d&&(i[r++]=new w(o,a,d-1,this.model.getLineMaxColumn(d-1))),o=f+1,a=1)}return(o<l||o===l&&a<u)&&(i[r++]=new w(o,a,l,u)),i}getCompletelyVisibleViewRange(){const e=this.viewLayout.getLinesViewportData(),t=e.completelyVisibleStartLineNumber,n=e.completelyVisibleEndLineNumber;return new w(t,this.getLineMinColumn(t),n,this.getLineMaxColumn(n))}getCompletelyVisibleViewRangeAtScrollTop(e){const t=this.viewLayout.getLinesViewportDataAtScrollTop(e),n=t.completelyVisibleStartLineNumber,i=t.completelyVisibleEndLineNumber;return new w(n,this.getLineMinColumn(n),i,this.getLineMaxColumn(i))}saveState(){const e=this.viewLayout.saveState(),t=e.scrollTop,n=this.viewLayout.getLineNumberAtVerticalOffset(t),i=this.coordinatesConverter.convertViewPositionToModelPosition(new I(n,this.getLineMinColumn(n))),r=this.viewLayout.getVerticalOffsetForLineNumber(n)-t;return{scrollLeft:e.scrollLeft,firstPosition:i,firstPositionDeltaTop:r}}reduceRestoreState(e){if(typeof e.firstPosition>"u")return this._reduceRestoreStateCompatibility(e);const t=this.model.validatePosition(e.firstPosition),n=this.coordinatesConverter.convertModelPositionToViewPosition(t),i=this.viewLayout.getVerticalOffsetForLineNumber(n.lineNumber)-e.firstPositionDeltaTop;return{scrollLeft:e.scrollLeft,scrollTop:i}}_reduceRestoreStateCompatibility(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTopWithoutViewZones}}getTabSize(){return this.model.getOptions().tabSize}getLineCount(){return this._lines.getViewLineCount()}setViewport(e,t,n){this._viewportStart.update(this,e)}getActiveIndentGuide(e,t,n){return this._lines.getActiveIndentGuide(e,t,n)}getLinesIndentGuides(e,t){return this._lines.getViewLinesIndentGuides(e,t)}getBracketGuidesInRangeByLine(e,t,n,i){return this._lines.getViewLinesBracketGuides(e,t,n,i)}getLineContent(e){return this._lines.getViewLineContent(e)}getLineLength(e){return this._lines.getViewLineLength(e)}getLineMinColumn(e){return this._lines.getViewLineMinColumn(e)}getLineMaxColumn(e){return this._lines.getViewLineMaxColumn(e)}getLineFirstNonWhitespaceColumn(e){const t=Ve(this.getLineContent(e));return t===-1?0:t+1}getLineLastNonWhitespaceColumn(e){const t=on(this.getLineContent(e));return t===-1?0:t+2}getMinimapDecorationsInRange(e){return this._decorations.getMinimapDecorationsInRange(e)}getDecorationsInViewport(e){return this._decorations.getDecorationsViewportData(e).decorations}getInjectedTextAt(e){return this._lines.getInjectedTextAt(e)}getViewportViewLineRenderingData(e,t){const i=this._decorations.getDecorationsViewportData(e).inlineDecorations[t-e.startLineNumber];return this._getViewLineRenderingData(t,i)}getViewLineRenderingData(e){const t=this._decorations.getInlineDecorationsOnLine(e);return this._getViewLineRenderingData(e,t)}_getViewLineRenderingData(e,t){const n=this.model.mightContainRTL(),i=this.model.mightContainNonBasicASCII(),r=this.getTabSize(),o=this._lines.getViewLineData(e);return o.inlineDecorations&&(t=[...t,...o.inlineDecorations.map(a=>a.toInlineDecoration(e))]),new Bs(o.minColumn,o.maxColumn,o.content,o.continuesWithWrappedLine,n,i,o.tokens,t,r,o.startVisibleColumn)}getViewLineData(e){return this._lines.getViewLineData(e)}getMinimapLinesRenderingData(e,t,n){const i=this._lines.getViewLinesData(e,t,n);return new mb(this.getTabSize(),i)}getAllOverviewRulerDecorations(e){const t=this.model.getOverviewRulerDecorations(this._editorId,xc(this._configuration.options)),n=new WL;for(const i of t){const r=i.options,o=r.overviewRuler;if(!o)continue;const a=o.position;if(a===0)continue;const l=o.getColor(e.value),u=this.coordinatesConverter.getViewLineNumberOfModelPosition(i.range.startLineNumber,i.range.startColumn),c=this.coordinatesConverter.getViewLineNumberOfModelPosition(i.range.endLineNumber,i.range.endColumn);n.accept(l,r.zIndex,u,c,a)}return n.asArray}_invalidateDecorationsColorCache(){const e=this.model.getOverviewRulerDecorations();for(const t of e){const n=t.options.overviewRuler;n==null||n.invalidateCachedColor();const i=t.options.minimap;i==null||i.invalidateCachedColor()}}getValueInRange(e,t){const n=this.coordinatesConverter.convertViewRangeToModelRange(e);return this.model.getValueInRange(n,t)}getValueLengthInRange(e,t){const n=this.coordinatesConverter.convertViewRangeToModelRange(e);return this.model.getValueLengthInRange(n,t)}modifyPosition(e,t){const n=this.coordinatesConverter.convertViewPositionToModelPosition(e),i=this.model.modifyPosition(n,t);return this.coordinatesConverter.convertModelPositionToViewPosition(i)}deduceModelPositionRelativeToViewPosition(e,t,n){const i=this.coordinatesConverter.convertViewPositionToModelPosition(e);this.model.getEOL().length===2&&(t<0?t-=n:t+=n);const o=this.model.getOffsetAt(i)+t;return this.model.getPositionAt(o)}getPlainTextToCopy(e,t,n){const i=n?`\r
`:this.model.getEOL();e=e.slice(0),e.sort(w.compareRangesUsingStarts);let r=!1,o=!1;for(const l of e)l.isEmpty()?r=!0:o=!0;if(!o){if(!t)return"";const l=e.map(c=>c.startLineNumber);let u="";for(let c=0;c<l.length;c++)c>0&&l[c-1]===l[c]||(u+=this.model.getLineContent(l[c])+i);return u}if(r&&t){const l=[];let u=0;for(const c of e){const h=c.startLineNumber;c.isEmpty()?h!==u&&l.push(this.model.getLineContent(h)):l.push(this.model.getValueInRange(c,n?2:0)),u=h}return l.length===1?l[0]:l}const a=[];for(const l of e)l.isEmpty()||a.push(this.model.getValueInRange(l,n?2:0));return a.length===1?a[0]:a}getRichTextToCopy(e,t){const n=this.model.getLanguageId();if(n===at||e.length!==1)return null;let i=e[0];if(i.isEmpty()){if(!t)return null;const c=i.startLineNumber;i=new w(c,this.model.getLineMinColumn(c),c,this.model.getLineMaxColumn(c))}const r=this._configuration.options.get(50),o=this._getColorMap(),l=/[:;\\\/<>]/.test(r.fontFamily)||r.fontFamily===We.fontFamily;let u;return l?u=We.fontFamily:(u=r.fontFamily,u=u.replace(/"/g,"'"),/[,']/.test(u)||/[+ ]/.test(u)&&(u=`'${u}'`),u=`${u}, ${We.fontFamily}`),{mode:n,html:`<div style="color: ${o[1]};background-color: ${o[2]};font-family: ${u};font-weight: ${r.fontWeight};font-size: ${r.fontSize}px;line-height: ${r.lineHeight}px;white-space: pre;">`+this._getHTMLToCopy(i,o)+"</div>"}}_getHTMLToCopy(e,t){const n=e.startLineNumber,i=e.startColumn,r=e.endLineNumber,o=e.endColumn,a=this.getTabSize();let l="";for(let u=n;u<=r;u++){const c=this.model.tokenization.getLineTokens(u),h=c.getLineContent(),d=u===n?i-1:0,f=u===r?o-1:h.length;h===""?l+="<br>":l+=Fm(h,c.inflate(),t,d,f,a,Vd)}return l}_getColorMap(){const e=nn.getColorMap(),t=["#000000"];if(e)for(let n=1,i=e.length;n<i;n++)t[n]=fe.Format.CSS.formatHex(e[n]);return t}getPrimaryCursorState(){return this._cursor.getPrimaryCursorState()}getLastAddedCursorIndex(){return this._cursor.getLastAddedCursorIndex()}getCursorStates(){return this._cursor.getCursorStates()}setCursorStates(e,t,n){return this._withViewEventsCollector(i=>this._cursor.setStates(i,e,t,n))}getCursorColumnSelectData(){return this._cursor.getCursorColumnSelectData()}getCursorAutoClosedCharacters(){return this._cursor.getAutoClosedCharacters()}setCursorColumnSelectData(e){this._cursor.setCursorColumnSelectData(e)}getPrevEditOperationType(){return this._cursor.getPrevEditOperationType()}setPrevEditOperationType(e){this._cursor.setPrevEditOperationType(e)}getSelection(){return this._cursor.getSelection()}getSelections(){return this._cursor.getSelections()}getPosition(){return this._cursor.getPrimaryCursorState().modelState.position}setSelections(e,t,n=0){this._withViewEventsCollector(i=>this._cursor.setSelections(i,e,t,n))}saveCursorState(){return this._cursor.saveState()}restoreCursorState(e){this._withViewEventsCollector(t=>this._cursor.restoreState(t,e))}_executeCursorEdit(e){if(this._cursor.context.cursorConfig.readOnly){this._eventDispatcher.emitOutgoingEvent(new dL);return}this._withViewEventsCollector(e)}executeEdits(e,t,n){this._executeCursorEdit(i=>this._cursor.executeEdits(i,e,t,n))}startComposition(){this._executeCursorEdit(e=>this._cursor.startComposition(e))}endComposition(e){this._executeCursorEdit(t=>this._cursor.endComposition(t,e))}type(e,t){this._executeCursorEdit(n=>this._cursor.type(n,e,t))}compositionType(e,t,n,i,r){this._executeCursorEdit(o=>this._cursor.compositionType(o,e,t,n,i,r))}paste(e,t,n,i){this._executeCursorEdit(r=>this._cursor.paste(r,e,t,n,i))}cut(e){this._executeCursorEdit(t=>this._cursor.cut(t,e))}executeCommand(e,t){this._executeCursorEdit(n=>this._cursor.executeCommand(n,e,t))}executeCommands(e,t){this._executeCursorEdit(n=>this._cursor.executeCommands(n,e,t))}revealAllCursors(e,t,n=!1){this._withViewEventsCollector(i=>this._cursor.revealAll(i,e,n,0,t,0))}revealPrimaryCursor(e,t,n=!1){this._withViewEventsCollector(i=>this._cursor.revealPrimary(i,e,n,0,t,0))}revealTopMostCursor(e){const t=this._cursor.getTopMostViewPosition(),n=new w(t.lineNumber,t.column,t.lineNumber,t.column);this._withViewEventsCollector(i=>i.emitViewEvent(new di(e,!1,n,null,0,!0,0)))}revealBottomMostCursor(e){const t=this._cursor.getBottomMostViewPosition(),n=new w(t.lineNumber,t.column,t.lineNumber,t.column);this._withViewEventsCollector(i=>i.emitViewEvent(new di(e,!1,n,null,0,!0,0)))}revealRange(e,t,n,i,r){this._withViewEventsCollector(o=>o.emitViewEvent(new di(e,!1,n,null,i,t,r)))}changeWhitespace(e){this.viewLayout.changeWhitespace(e)&&(this._eventDispatcher.emitSingleViewEvent(new aL),this._eventDispatcher.emitOutgoingEvent(new cL))}_withViewEventsCollector(e){return this._transactionalTarget.batchChanges(()=>{try{const t=this._eventDispatcher.beginEmitViewEvents();return e(t)}finally{this._eventDispatcher.endEmitViewEvents()}})}batchEvents(e){this._withViewEventsCollector(()=>{e()})}normalizePosition(e,t){return this._lines.normalizePosition(e,t)}getLineIndentColumn(e){return this._lines.getLineIndentColumn(e)}}class ua{static create(e){const t=e._setTrackedRange(null,new w(1,1,1,1),1);return new ua(e,1,!1,t,0)}get viewLineNumber(){return this._viewLineNumber}get isValid(){return this._isValid}get modelTrackedRange(){return this._modelTrackedRange}get startLineDelta(){return this._startLineDelta}constructor(e,t,n,i,r){this._model=e,this._viewLineNumber=t,this._isValid=n,this._modelTrackedRange=i,this._startLineDelta=r}dispose(){this._model._setTrackedRange(this._modelTrackedRange,null,1)}update(e,t){const n=e.coordinatesConverter.convertViewPositionToModelPosition(new I(t,e.getLineMinColumn(t))),i=e.model._setTrackedRange(this._modelTrackedRange,new w(n.lineNumber,n.column,n.lineNumber,n.column),1),r=e.viewLayout.getVerticalOffsetForLineNumber(t),o=e.viewLayout.getCurrentScrollTop();this._viewLineNumber=t,this._isValid=!0,this._modelTrackedRange=i,this._startLineDelta=o-r}invalidate(){this._isValid=!1}}class WL{constructor(){this._asMap=Object.create(null),this.asArray=[]}accept(e,t,n,i,r){const o=this._asMap[e];if(o){const a=o.data,l=a[a.length-3],u=a[a.length-1];if(l===r&&u+1>=n){i>u&&(a[a.length-1]=i);return}a.push(r,n,i)}else{const a=new Ko(e,t,[r,n,i]);this._asMap[e]=a,this.asArray.push(a)}}}class FL{constructor(){this.hiddenAreas=new Map,this.shouldRecompute=!1,this.ranges=[]}setHiddenAreas(e,t){const n=this.hiddenAreas.get(e);n&&sc(n,t)||(this.hiddenAreas.set(e,t),this.shouldRecompute=!0)}getMergedRanges(){if(!this.shouldRecompute)return this.ranges;this.shouldRecompute=!1;const e=Array.from(this.hiddenAreas.values()).reduce((t,n)=>zL(t,n),[]);return sc(this.ranges,e)?this.ranges:(this.ranges=e,this.ranges)}}function zL(s,e){const t=[];let n=0,i=0;for(;n<s.length&&i<e.length;){const r=s[n],o=e[i];if(r.endLineNumber<o.startLineNumber-1)t.push(s[n++]);else if(o.endLineNumber<r.startLineNumber-1)t.push(e[i++]);else{const a=Math.min(r.startLineNumber,o.startLineNumber),l=Math.max(r.endLineNumber,o.endLineNumber);t.push(new w(a,1,l,1)),n++,i++}}for(;n<s.length;)t.push(s[n++]);for(;i<e.length;)t.push(e[i++]);return t}function sc(s,e){if(s.length!==e.length)return!1;for(let t=0;t<s.length;t++)if(!s[t].equalsRange(e[t]))return!1;return!0}class rc{constructor(e,t){this.viewportStartModelPosition=e,this.startLineDelta=t}recoverViewportStart(e,t){if(!this.viewportStartModelPosition)return;const n=e.convertModelPositionToViewPosition(this.viewportStartModelPosition),i=t.getVerticalOffsetForLineNumber(n.lineNumber);t.setScrollPosition({scrollTop:i+this.startLineDelta},1)}}class M_ extends Wc{constructor(e){super(),this._textModel=e}getValueOfRange(e){return this._textModel.getValueInRange(e)}get length(){const e=this._textModel.getLineCount(),t=this._textModel.getLineLength(e);return new Bn(e-1,t)}}class HL{constructor(){this._dragOperations=new Map}removeDragOperationTransfer(e){if(e&&this._dragOperations.has(e)){const t=this._dragOperations.get(e);return this._dragOperations.delete(e),t}}}class P_{constructor(e){this.identifier=e}}const jL=ze("treeViewsDndService");Vi(jL,HL,1);function A_(s,e){const t=new nh,n=new sh(t,u=>e.getLanguageConfiguration(u)),i=new ih(new UL([s]),n),r=co(i,[],void 0,!0);let o="";const a=s.getLineContent();function l(u,c){if(u.kind===2)if(l(u.openingBracket,c),c=ne(c,u.openingBracket.length),u.child&&(l(u.child,c),c=ne(c,u.child.length)),u.closingBracket)l(u.closingBracket,c),c=ne(c,u.closingBracket.length);else{const d=n.getSingleLanguageBracketTokens(u.openingBracket.languageId).findClosingTokenText(u.openingBracket.bracketIds);o+=d}else if(u.kind!==3){if(u.kind===0||u.kind===1)o+=a.substring(c,ne(c,u.length));else if(u.kind===4)for(const h of u.children)l(h,c),c=ne(c,h.length)}}return l(r,xe),o}class UL{constructor(e){this.lines=e,this.tokenization={getLineTokens:t=>this.lines[t-1]}}getLineCount(){return this.lines.length}getLineLength(e){return this.lines[e-1].getLineContent().length}}const qL=/(?:\/|^)(?:([^\/]+)\/)?([^\/]+)$/;function D_(s,e,t,n,i){if(Wd.isThemeIcon(i))return[`codicon-${i.id}`,"predefined-file-icon"];if(ot.isUri(i))return[];const r=n===Ui.ROOT_FOLDER?["rootfolder-icon"]:n===Ui.FOLDER?["folder-icon"]:["file-icon"];if(t){let o;if(t.scheme===Ge.data)o=An.parseMetaData(t).get(An.META_DATA_LABEL);else{const a=t.path.match(qL);a?(o=ls(a[2].toLowerCase()),a[1]&&r.push(`${ls(a[1].toLowerCase())}-name-dir-icon`)):o=ls(t.authority.toLowerCase())}if(n===Ui.ROOT_FOLDER)r.push(`${o}-root-name-folder-icon`);else if(n===Ui.FOLDER)r.push(`${o}-name-folder-icon`);else{if(o){if(r.push(`${o}-name-file-icon`),r.push("name-file-icon"),o.length<=255){const l=o.split(".");for(let u=1;u<l.length;u++)r.push(`${l.slice(u).join(".")}-ext-file-icon`)}r.push("ext-file-icon")}const a=GL(s,e,t);a&&r.push(`${ls(a)}-lang-file-icon`)}}return r}function GL(s,e,t){if(!t)return null;let n=null;if(t.scheme===Ge.data){const r=An.parseMetaData(t).get(An.META_DATA_MIME);r&&(n=e.getLanguageIdByMimeType(r))}else{const i=s.getModel(t);i&&(n=i.getLanguageId())}return n&&n!==at?n:e.guessLanguageIdByFilepathOrFirstLine(t)}function ls(s){return s.replace(/[\s]/g,"/")}class O_{constructor(e,t,n){this._selection=e,this._cursors=t,this._selectionId=null,this._trimInRegexesAndStrings=n}getEditOperations(e,t){const n=$L(e,this._cursors,this._trimInRegexesAndStrings);for(let i=0,r=n.length;i<r;i++){const o=n[i];t.addEditOperation(o.range,o.text)}this._selectionId=t.trackSelection(this._selection)}computeCursorState(e,t){return t.getTrackedSelection(this._selectionId)}}function $L(s,e,t){e.sort((a,l)=>a.lineNumber===l.lineNumber?a.column-l.column:a.lineNumber-l.lineNumber);for(let a=e.length-2;a>=0;a--)e[a].lineNumber===e[a+1].lineNumber&&e.splice(a,1);const n=[];let i=0,r=0;const o=e.length;for(let a=1,l=s.getLineCount();a<=l;a++){const u=s.getLineContent(a),c=u.length+1;let h=0;if(r<o&&e[r].lineNumber===a&&(h=e[r].column,r++,h===c)||u.length===0)continue;const d=on(u);let f=0;if(d===-1)f=1;else if(d!==u.length-1)f=d+2;else continue;if(!t){if(!s.tokenization.hasAccurateTokensForLine(a))continue;const m=s.tokenization.getLineTokens(a),p=m.getStandardTokenType(m.findTokenIndexAtOffset(f));if(p===2||p===3)continue}f=Math.max(h,f),n[i++]=Um.delete(new w(a,f,a,c))}return n}function QL(s){for(let e=0,t=s.length;e<t;e+=4){const n=s[e+0],i=s[e+1],r=s[e+2],o=s[e+3];s[e+0]=o,s[e+1]=r,s[e+2]=i,s[e+3]=n}}function ZL(s){const e=new Uint8Array(s.buffer,s.byteOffset,s.length*4);return oc()||QL(e),Fd.wrap(e)}function B_(s){const e=new Uint32Array(XL(s));let t=0;if(e[t++]=s.id,s.type==="full")e[t++]=1,e[t++]=s.data.length,e.set(s.data,t),t+=s.data.length;else{e[t++]=2,e[t++]=s.deltas.length;for(const n of s.deltas)e[t++]=n.start,e[t++]=n.deleteCount,n.data?(e[t++]=n.data.length,e.set(n.data,t),t+=n.data.length):e[t++]=0}return ZL(e)}function XL(s){let e=0;if(e+=2,s.type==="full")e+=1+s.data.length;else{e+=1,e+=3*s.deltas.length;for(const t of s.deltas)t.data&&(e+=t.data.length)}return e}export{kl as $,hu as A,E_ as B,at as C,nw as D,Um as E,m_ as F,Zf as G,cs as H,Yf as I,Ns as J,Cr as K,pu as L,zu as M,$c as N,uw as O,I as P,ni as Q,w as R,fu as S,nn as T,ew as U,Bs as V,bl as W,fl as X,tl as Y,Il as Z,vl as _,Pw as a,qw as a$,Sl as a0,pl as a1,Cl as a2,ml as a3,gl as a4,Ya as a5,hl as a6,cl as a7,al as a8,ol as a9,za as aA,$a as aB,lw as aC,Ss as aD,Qf as aE,jr as aF,zg as aG,qe as aH,$ as aI,It as aJ,Je as aK,Rl as aL,_r as aM,mw as aN,kw as aO,We as aP,Jd as aQ,Tc as aR,L_ as aS,Dt as aT,p_ as aU,ib as aV,nb as aW,Vs as aX,be as aY,Z as aZ,Mw as a_,rl as aa,Ja as ab,Xa as ac,Za as ad,Qa as ae,Ga as af,qa as ag,Ua as ah,Va as ai,rw as aj,Ma as ak,Ka as al,dl as am,ul as an,ll as ao,Wa as ap,sl as aq,il as ar,nl as as,Ll as at,ja as au,el as av,_l as aw,wl as ax,Fa as ay,Ha as az,JC as b,Et as b$,vs as b0,kh as b1,$u as b2,S_ as b3,H as b4,Vb as b5,Zn as b6,Di as b7,Uu as b8,sg as b9,Ow as bA,jw as bB,Bw as bC,Uw as bD,Vw as bE,Up as bF,Ds as bG,Sn as bH,ko as bI,Cb as bJ,ci as bK,ti as bL,Xd as bM,Ko as bN,Gw as bO,Jc as bP,Tw as bQ,yw as bR,$w as bS,N_ as bT,Lt as bU,Yc as bV,Ew as bW,Rw as bX,Kc as bY,T_ as bZ,x_ as b_,Ym as ba,xw as bb,xi as bc,i_ as bd,Jw as be,op as bf,s_ as bg,Yw as bh,ap as bi,r_ as bj,Kw as bk,lp as bl,o_ as bm,e_ as bn,up as bo,a_ as bp,t_ as bq,cp as br,l_ as bs,n_ as bt,hp as bu,Fw as bv,Aw as bw,zw as bx,Dw as by,Hw as bz,wt as c,ya as c$,Ar as c0,$e as c1,q as c2,xc as c3,R_ as c4,Th as c5,Qw as c6,Bn as c7,z as c8,yi as c9,Lo as cA,ow as cB,Da as cC,Ai as cD,On as cE,Oa as cF,P_ as cG,jL as cH,dn as cI,kb as cJ,Xw as cK,sn as cL,dw as cM,jg as cN,A_ as cO,Na as cP,D_ as cQ,vh as cR,eh as cS,rn as cT,v_ as cU,I_ as cV,_w as cW,Ce as cX,na as cY,O_ as cZ,w_ as c_,rt as ca,ku as cb,fm as cc,Ul as cd,gs as ce,Vc as cf,M_ as cg,fw as ch,Ra as ci,Gb as cj,y as ck,Yd as cl,re as cm,tw as cn,Se as co,Is as cp,j as cq,Pe as cr,Ta as cs,Hp as ct,dt as cu,zm as cv,Mm as cw,f_ as cx,xa as cy,Ia as cz,zi as d,Ba as d0,Ea as d1,Zw as d2,Aa as d3,Pa as d4,B_ as d5,Bm as d6,Lw as d7,Qe as d8,TL as d9,yL as da,EL as db,Wg as dc,Ft as dd,Ic as de,Ag as df,qc as dg,__ as dh,aw as di,ou as dj,lu as dk,au as dl,cu as dm,uu as dn,du as dp,Ww as e,pw as f,d_ as g,rr as h,ym as i,g_ as j,vw as k,Iw as l,Em as m,Lu as n,c_ as o,Nw as p,cw as q,kC as r,Sw as s,Qc as t,yc as u,qf as v,Gf as w,b_ as x,C_ as y,Te as z};
//# sourceMappingURL=monaco-editor-editor-common-D0kkP5dn.js.map
